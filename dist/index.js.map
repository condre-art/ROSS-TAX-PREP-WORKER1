{
  "version": 3,
  "sources": ["../node_modules/itty-router/index.mjs", "../node_modules/@tsndr/cloudflare-worker-jwt/index.js", "../src/middleware/auth.ts", "../node_modules/uuid/dist/stringify.js", "../node_modules/uuid/dist/rng.js", "../node_modules/uuid/dist/native.js", "../node_modules/uuid/dist/v4.js", "../src/routes/consult.ts", "../src/utils/audit.ts", "../src/routes/diz.ts", "../src/routes/ero.ts", "../src/health.ts", "../src/cors.ts", "../node_modules/bcryptjs/index.js", "../node_modules/otpauth/dist/otpauth.esm.js", "../src/routes/auth.ts", "../src/efileProviders.ts", "../node_modules/hono/dist/compose.js", "../node_modules/hono/dist/request/constants.js", "../node_modules/hono/dist/utils/body.js", "../node_modules/hono/dist/utils/url.js", "../node_modules/hono/dist/request.js", "../node_modules/hono/dist/utils/html.js", "../node_modules/hono/dist/context.js", "../node_modules/hono/dist/router.js", "../node_modules/hono/dist/utils/constants.js", "../node_modules/hono/dist/hono-base.js", "../node_modules/hono/dist/router/reg-exp-router/matcher.js", "../node_modules/hono/dist/router/reg-exp-router/node.js", "../node_modules/hono/dist/router/reg-exp-router/trie.js", "../node_modules/hono/dist/router/reg-exp-router/router.js", "../node_modules/hono/dist/router/smart-router/router.js", "../node_modules/hono/dist/router/trie-router/node.js", "../node_modules/hono/dist/router/trie-router/router.js", "../node_modules/hono/dist/hono.js", "../src/payment.ts", "../src/mef.ts", "../src/schemaValidator.ts", "../src/efile.ts", "../src/irs.ts", "../src/utils/encryption.ts", "../src/routes/crm.ts", "../src/middleware/validation.ts", "../src/routes/lms.ts", "../src/routes/portal.ts", "../src/routes/portalAuth.ts", "../src/routes/certificates.ts", "../src/routes/team.ts", "../src/routes/compliance.ts", "../src/routes/socialMedia.ts", "../src/instagram.js", "../src/utils/dataRetention.ts", "../src/handlers/irs-callback.ts", "../src/handlers/payment-webhook.ts", "../src/handlers/credential-upload.ts", "../src/handlers/irs-realtime.ts", "../src/index.ts"],
  "sourceRoot": "dist",
  "sourcesContent": ["const e=({base:e=\"\",routes:t=[],...r}={})=>({__proto__:new Proxy({},{get:(r,o,a,s)=>(r,...c)=>t.push([o.toUpperCase(),RegExp(`^${(s=(e+r).replace(/\\/+(\\/|$)/g,\"$1\")).replace(/(\\/?\\.?):(\\w+)\\+/g,\"($1(?<$2>*))\").replace(/(\\/?\\.?):(\\w+)/g,\"($1(?<$2>[^$1/]+?))\").replace(/\\./g,\"\\\\.\").replace(/(\\/?)\\*/g,\"($1.*)?\")}/*$`),c,s])&&a}),routes:t,...r,async fetch(e,...r){let o,a,s=new URL(e.url),c=e.query={__proto__:null};for(let[e,t]of s.searchParams)c[e]=c[e]?[].concat(c[e],t):t;for(let[c,n,l,i]of t)if((c==e.method||\"ALL\"==c)&&(a=s.pathname.match(n))){e.params=a.groups||{},e.route=i;for(let t of l)if(null!=(o=await t(e.proxy??e,...r)))return o}}}),t=({base:e=\"\",routes:t=[],...r}={})=>({__proto__:new Proxy({},{get:(r,o,a,s)=>(r,...c)=>t.push([o.toUpperCase?.(),RegExp(`^${(s=(e+r).replace(/\\/+(\\/|$)/g,\"$1\")).replace(/(\\/?\\.?):(\\w+)\\+/g,\"($1(?<$2>*))\").replace(/(\\/?\\.?):(\\w+)/g,\"($1(?<$2>[^$1/]+?))\").replace(/\\./g,\"\\\\.\").replace(/(\\/?)\\*/g,\"($1.*)?\")}/*$`),c,s])&&a}),routes:t,...r,async fetch(e,...o){let a,s,c=new URL(e.url),n=e.query={__proto__:null};for(let[e,t]of c.searchParams)n[e]=n[e]?[].concat(n[e],t):t;e:try{for(let t of r.before||[])if(null!=(a=await t(e.proxy??e,...o)))break e;t:for(let[r,n,l,i]of t)if((r==e.method||\"ALL\"==r)&&(s=c.pathname.match(n))){e.params=s.groups||{},e.route=i;for(let t of l)if(null!=(a=await t(e.proxy??e,...o)))break t}}catch(t){if(!r.catch)throw t;a=await r.catch(t,e.proxy??e,...o)}try{for(let t of r.finally||[])a=await t(a,e.proxy??e,...o)??a}catch(t){if(!r.catch)throw t;a=await r.catch(t,e.proxy??e,...o)}return a}}),r=(e=\"text/plain; charset=utf-8\",t)=>(r,o={})=>{if(void 0===r||r instanceof Response)return r;const a=new Response(t?.(r)??r,o.url?void 0:o);return a.headers.set(\"content-type\",e),a},o=r(\"application/json; charset=utf-8\",JSON.stringify),a=e=>({400:\"Bad Request\",401:\"Unauthorized\",403:\"Forbidden\",404:\"Not Found\",500:\"Internal Server Error\"}[e]||\"Unknown Error\"),s=(e=500,t)=>{if(e instanceof Error){const{message:r,...o}=e;e=e.status||500,t={error:r||a(e),...o}}return t={status:e,...\"object\"==typeof t?t:{error:t||a(e)}},o(t,{status:e})},c=e=>{e.proxy=new Proxy(e.proxy??e,{get:(t,r)=>t[r]?.bind?.(e)??t[r]??t?.params?.[r]})},n=({format:e=o,missing:r=(()=>s(404)),finally:a=[],before:n=[],...l}={})=>t({before:[c,...n],catch:s,finally:[(e,...t)=>e??r(...t),e,...a],...l});class l extends Error{status;constructor(e=500,t){super(\"object\"==typeof t?t.error:t),\"object\"==typeof t&&Object.assign(this,t),this.status=e}}const i=(e,t)=>new Response(null,{...t,status:e}),p=r(\"text/plain; charset=utf-8\",String),f=r(\"text/html\"),u=r(\"image/jpeg\"),h=r(\"image/png\"),g=r(\"image/webp\"),d=async e=>{e.content=e.body?await e.clone().json().catch((()=>e.clone().formData())).catch((()=>e.text())):void 0},w=e=>{e.cookies=(e.headers.get(\"Cookie\")||\"\").split(/;\\s*/).map((e=>e.split(/=(.+)/))).reduce(((e,[t,r])=>r?(e[t]=r,e):e),{})},y=(e={})=>{const{origin:t=\"*\",credentials:r=!1,allowMethods:o=\"*\",allowHeaders:a,exposeHeaders:s,maxAge:c}=e,n=e=>{const o=e?.headers.get(\"origin\");return!0===t?o:t instanceof RegExp?t.test(o)?o:void 0:Array.isArray(t)?t.includes(o)?o:void 0:t instanceof Function?t(o):\"*\"==t&&r?o:t},l=(e,t)=>{for(const[r,o]of Object.entries(t))o&&e.headers.append(r,o);return e};return{corsify:(e,t)=>e?.headers?.get(\"access-control-allow-origin\")||101==e.status?e:l(e.clone(),{\"access-control-allow-origin\":n(t),\"access-control-allow-credentials\":r}),preflight:e=>{if(\"OPTIONS\"==e.method){const t=new Response(null,{status:204});return l(t,{\"access-control-allow-origin\":n(e),\"access-control-allow-methods\":o?.join?.(\",\")??o,\"access-control-expose-headers\":s?.join?.(\",\")??s,\"access-control-allow-headers\":a?.join?.(\",\")??a??e.headers.get(\"access-control-request-headers\"),\"access-control-max-age\":c,\"access-control-allow-credentials\":r})}}}};export{n as AutoRouter,e as IttyRouter,t as Router,l as StatusError,y as cors,r as createResponse,s as error,f as html,u as jpeg,o as json,h as png,i as status,p as text,g as webp,d as withContent,w as withCookies,c as withParams};\r\n", "// src/utils.ts\nfunction bytesToByteString(bytes) {\n  let byteStr = \"\";\n  for (let i = 0; i < bytes.byteLength; i++) {\n    byteStr += String.fromCharCode(bytes[i]);\n  }\n  return byteStr;\n}\nfunction byteStringToBytes(byteStr) {\n  let bytes = new Uint8Array(byteStr.length);\n  for (let i = 0; i < byteStr.length; i++) {\n    bytes[i] = byteStr.charCodeAt(i);\n  }\n  return bytes;\n}\nfunction arrayBufferToBase64String(arrayBuffer) {\n  return btoa(bytesToByteString(new Uint8Array(arrayBuffer)));\n}\nfunction base64StringToUint8Array(b64str) {\n  return byteStringToBytes(atob(b64str));\n}\nfunction textToUint8Array(str) {\n  return byteStringToBytes(str);\n}\nfunction arrayBufferToBase64Url(arrayBuffer) {\n  return arrayBufferToBase64String(arrayBuffer).replace(/=/g, \"\").replace(/\\+/g, \"-\").replace(/\\//g, \"_\");\n}\nfunction base64UrlToUint8Array(b64url) {\n  return base64StringToUint8Array(b64url.replace(/-/g, \"+\").replace(/_/g, \"/\").replace(/\\s/g, \"\"));\n}\nfunction textToBase64Url(str) {\n  const encoder = new TextEncoder();\n  const charCodes = encoder.encode(str);\n  const binaryStr = String.fromCharCode(...charCodes);\n  return btoa(binaryStr).replace(/=/g, \"\").replace(/\\+/g, \"-\").replace(/\\//g, \"_\");\n}\nfunction pemToBinary(pem) {\n  return base64StringToUint8Array(pem.replace(/-+(BEGIN|END).*/g, \"\").replace(/\\s/g, \"\"));\n}\nasync function importTextSecret(key, algorithm, keyUsages) {\n  return await crypto.subtle.importKey(\"raw\", textToUint8Array(key), algorithm, true, keyUsages);\n}\nasync function importJwk(key, algorithm, keyUsages) {\n  return await crypto.subtle.importKey(\"jwk\", key, algorithm, true, keyUsages);\n}\nasync function importPublicKey(key, algorithm, keyUsages) {\n  return await crypto.subtle.importKey(\"spki\", pemToBinary(key), algorithm, true, keyUsages);\n}\nasync function importPrivateKey(key, algorithm, keyUsages) {\n  return await crypto.subtle.importKey(\"pkcs8\", pemToBinary(key), algorithm, true, keyUsages);\n}\nasync function importKey(key, algorithm, keyUsages) {\n  if (typeof key === \"object\")\n    return importJwk(key, algorithm, keyUsages);\n  if (typeof key !== \"string\")\n    throw new Error(\"Unsupported key type!\");\n  if (key.includes(\"PUBLIC\"))\n    return importPublicKey(key, algorithm, keyUsages);\n  if (key.includes(\"PRIVATE\"))\n    return importPrivateKey(key, algorithm, keyUsages);\n  return importTextSecret(key, algorithm, keyUsages);\n}\nfunction decodePayload(raw) {\n  const bytes = Array.from(atob(raw), (char) => char.charCodeAt(0));\n  const decodedString = new TextDecoder(\"utf-8\").decode(new Uint8Array(bytes));\n  return JSON.parse(decodedString);\n}\n\n// src/index.ts\nif (typeof crypto === \"undefined\" || !crypto.subtle)\n  throw new Error(\"SubtleCrypto not supported!\");\nvar algorithms = {\n  none: { name: \"none\" },\n  ES256: { name: \"ECDSA\", namedCurve: \"P-256\", hash: { name: \"SHA-256\" } },\n  ES384: { name: \"ECDSA\", namedCurve: \"P-384\", hash: { name: \"SHA-384\" } },\n  ES512: { name: \"ECDSA\", namedCurve: \"P-521\", hash: { name: \"SHA-512\" } },\n  HS256: { name: \"HMAC\", hash: { name: \"SHA-256\" } },\n  HS384: { name: \"HMAC\", hash: { name: \"SHA-384\" } },\n  HS512: { name: \"HMAC\", hash: { name: \"SHA-512\" } },\n  RS256: { name: \"RSASSA-PKCS1-v1_5\", hash: { name: \"SHA-256\" } },\n  RS384: { name: \"RSASSA-PKCS1-v1_5\", hash: { name: \"SHA-384\" } },\n  RS512: { name: \"RSASSA-PKCS1-v1_5\", hash: { name: \"SHA-512\" } }\n};\nasync function sign(payload, secret, options = \"HS256\") {\n  if (typeof options === \"string\")\n    options = { algorithm: options };\n  options = { algorithm: \"HS256\", header: { typ: \"JWT\", ...options.header ?? {} }, ...options };\n  if (!payload || typeof payload !== \"object\")\n    throw new Error(\"payload must be an object\");\n  if (options.algorithm !== \"none\" && (!secret || typeof secret !== \"string\" && typeof secret !== \"object\"))\n    throw new Error(\"secret must be a string, a JWK object or a CryptoKey object\");\n  if (typeof options.algorithm !== \"string\")\n    throw new Error(\"options.algorithm must be a string\");\n  const algorithm = algorithms[options.algorithm];\n  if (!algorithm)\n    throw new Error(\"algorithm not found\");\n  if (!payload.iat)\n    payload.iat = Math.floor(Date.now() / 1e3);\n  const partialToken = `${textToBase64Url(JSON.stringify({ ...options.header, alg: options.algorithm }))}.${textToBase64Url(JSON.stringify(payload))}`;\n  if (options.algorithm === \"none\")\n    return partialToken;\n  const key = secret instanceof CryptoKey ? secret : await importKey(secret, algorithm, [\"sign\"]);\n  const signature = await crypto.subtle.sign(algorithm, key, textToUint8Array(partialToken));\n  return `${partialToken}.${arrayBufferToBase64Url(signature)}`;\n}\nasync function verify(token, secret, options = \"HS256\") {\n  if (typeof options === \"string\")\n    options = { algorithm: options };\n  options = { algorithm: \"HS256\", clockTolerance: 0, throwError: false, ...options };\n  if (typeof token !== \"string\")\n    throw new Error(\"token must be a string\");\n  if (options.algorithm !== \"none\" && typeof secret !== \"string\" && typeof secret !== \"object\")\n    throw new Error(\"secret must be a string, a JWK object or a CryptoKey object\");\n  if (typeof options.algorithm !== \"string\")\n    throw new Error(\"options.algorithm must be a string\");\n  const tokenParts = token.split(\".\", 3);\n  if (tokenParts.length < 2)\n    throw new Error(\"token must consist of 2 or more parts\");\n  const [tokenHeader, tokenPayload, tokenSignature] = tokenParts;\n  const algorithm = algorithms[options.algorithm];\n  if (!algorithm)\n    throw new Error(\"algorithm not found\");\n  const decodedToken = decode(token);\n  try {\n    if (decodedToken.header?.alg !== options.algorithm)\n      throw new Error(\"INVALID_SIGNATURE\");\n    if (decodedToken.payload) {\n      const now = Math.floor(Date.now() / 1e3);\n      if (decodedToken.payload.nbf && decodedToken.payload.nbf > now && decodedToken.payload.nbf - now > (options.clockTolerance ?? 0))\n        throw new Error(\"NOT_YET_VALID\");\n      if (decodedToken.payload.exp && decodedToken.payload.exp <= now && now - decodedToken.payload.exp > (options.clockTolerance ?? 0))\n        throw new Error(\"EXPIRED\");\n    }\n    if (algorithm.name === \"none\")\n      return decodedToken;\n    const key = secret instanceof CryptoKey ? secret : await importKey(secret, algorithm, [\"verify\"]);\n    if (!await crypto.subtle.verify(algorithm, key, base64UrlToUint8Array(tokenSignature), textToUint8Array(`${tokenHeader}.${tokenPayload}`)))\n      throw new Error(\"INVALID_SIGNATURE\");\n    return decodedToken;\n  } catch (err) {\n    if (options.throwError)\n      throw err;\n    return;\n  }\n}\nfunction decode(token) {\n  return {\n    header: decodePayload(token.split(\".\")[0].replace(/-/g, \"+\").replace(/_/g, \"/\")),\n    payload: decodePayload(token.split(\".\")[1].replace(/-/g, \"+\").replace(/_/g, \"/\"))\n  };\n}\nvar index_default = {\n  sign,\n  verify,\n  decode\n};\nexport {\n  decode,\n  index_default as default,\n  sign,\n  verify\n};\n", "/**\r\n * Middleware to require manager role\r\n */\r\nexport async function requireManager(req: Request, env: any): Promise<AuthenticatedUser | Response> {\r\n  const user = await verifyJWT(req, env);\r\n  if (!user) {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), {\r\n      status: 401,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  if (user.role !== \"manager\" && user.role !== \"admin\") {\r\n    return new Response(JSON.stringify({ error: \"Forbidden - Manager access required\" }), {\r\n      status: 403,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  return user;\r\n}\r\n\r\n/**\r\n * Middleware to require supervisor role\r\n */\r\nexport async function requireSupervisor(req: Request, env: any): Promise<AuthenticatedUser | Response> {\r\n  const user = await verifyJWT(req, env);\r\n  if (!user) {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), {\r\n      status: 401,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  if (user.role !== \"supervisor\" && user.role !== \"manager\" && user.role !== \"admin\") {\r\n    return new Response(JSON.stringify({ error: \"Forbidden - Supervisor access required\" }), {\r\n      status: 403,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  return user;\r\n}\r\n\r\n/**\r\n * Middleware to require team lead role\r\n */\r\nexport async function requireLead(req: Request, env: any): Promise<AuthenticatedUser | Response> {\r\n  const user = await verifyJWT(req, env);\r\n  if (!user) {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), {\r\n      status: 401,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  if (user.role !== \"lead\" && user.role !== \"supervisor\" && user.role !== \"manager\" && user.role !== \"admin\") {\r\n    return new Response(JSON.stringify({ error: \"Forbidden - Team Lead access required\" }), {\r\n      status: 403,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  return user;\r\n}\r\n\r\n/**\r\n * Middleware to require tax associate role\r\n */\r\nexport async function requireAssociate(req: Request, env: any): Promise<AuthenticatedUser | Response> {\r\n  const user = await verifyJWT(req, env);\r\n  if (!user) {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), {\r\n      status: 401,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  if (user.role !== \"associate\" && user.role !== \"lead\" && user.role !== \"supervisor\" && user.role !== \"manager\" && user.role !== \"admin\") {\r\n    return new Response(JSON.stringify({ error: \"Forbidden - Tax Associate access required\" }), {\r\n      status: 403,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  return user;\r\n}\r\n\r\n/**\r\n * Middleware to require PTIN holder role\r\n */\r\nexport async function requirePTINHolder(req: Request, env: any): Promise<AuthenticatedUser | Response> {\r\n  const user = await verifyJWT(req, env);\r\n  if (!user) {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), {\r\n      status: 401,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  if (user.role !== \"ptin_holder\" && user.role !== \"associate\" && user.role !== \"lead\" && user.role !== \"supervisor\" && user.role !== \"manager\" && user.role !== \"admin\") {\r\n    return new Response(JSON.stringify({ error: \"Forbidden - PTIN Holder access required\" }), {\r\n      status: 403,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  return user;\r\n}\r\n\r\n/**\r\n * Middleware to require ERO role\r\n */\r\nexport async function requireERO(req: Request, env: any): Promise<AuthenticatedUser | Response> {\r\n  const user = await verifyJWT(req, env);\r\n  if (!user) {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), {\r\n      status: 401,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  if (user.role !== \"ero\" && user.role !== \"admin\") {\r\n    return new Response(JSON.stringify({ error: \"Forbidden - ERO access required\" }), {\r\n      status: 403,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  return user;\r\n}\r\nimport jwt from \"@tsndr/cloudflare-worker-jwt\";\r\n\r\nexport interface AuthenticatedUser {\r\n  id: number;\r\n  email: string;\r\n  role: string;\r\n  name?: string;\r\n}\r\n\r\n/**\r\n * Extract and verify JWT token from Authorization header\r\n * Returns user object if valid, null if invalid or missing\r\n */\r\nexport async function verifyJWT(req: Request, env: any): Promise<AuthenticatedUser | null> {\r\n  const authHeader = req.headers.get(\"Authorization\");\r\n  if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n    return null;\r\n  }\r\n\r\n  const token = authHeader.substring(7);\r\n  try {\r\n    const isValid = await jwt.verify(token, env.JWT_SECRET || \"your-secret-key-change-in-production\");\r\n    if (!isValid) {\r\n      return null;\r\n    }\r\n\r\n    const { payload } = jwt.decode(token);\r\n    return payload as AuthenticatedUser;\r\n  } catch (error) {\r\n    console.error(\"JWT verification failed:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Middleware to require authentication\r\n * Returns 401 response if not authenticated\r\n */\r\nexport async function requireAuth(req: Request, env: any): Promise<AuthenticatedUser | Response> {\r\n  const user = await verifyJWT(req, env);\r\n  if (!user) {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), {\r\n      status: 401,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  return user;\r\n}\r\n\r\n/**\r\n * Middleware to require admin role\r\n * Returns 403 response if not admin\r\n */\r\nexport async function requireAdmin(req: Request, env: any): Promise<AuthenticatedUser | Response> {\r\n  const user = await verifyJWT(req, env);\r\n  if (!user) {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), {\r\n      status: 401,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  if (user.role !== \"admin\") {\r\n    return new Response(JSON.stringify({ error: \"Forbidden - Admin access required\" }), {\r\n      status: 403,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  return user;\r\n}\r\n\r\n/**\r\n * Middleware to require staff or admin role\r\n * Returns 403 response if client\r\n */\r\nexport async function requireStaff(req: Request, env: any): Promise<AuthenticatedUser | Response> {\r\n  const user = await verifyJWT(req, env);\r\n  if (!user) {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), {\r\n      status: 401,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  if (user.role !== \"admin\" && user.role !== \"staff\") {\r\n    return new Response(JSON.stringify({ error: \"Forbidden - Staff access required\" }), {\r\n      status: 403,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n  return user;\r\n}\r\n\r\n/**\r\n * Generate JWT token for authenticated user\r\n */\r\nexport async function generateToken(user: AuthenticatedUser, env: any): Promise<string> {\r\n  const token = await jwt.sign(\r\n    {\r\n      id: user.id,\r\n      email: user.email,\r\n      role: user.role,\r\n      name: user.name,\r\n      exp: Math.floor(Date.now() / 1000) + (24 * 60 * 60) // 24 hours\r\n    },\r\n    env.JWT_SECRET || \"your-secret-key-change-in-production\"\r\n  );\r\n  return token;\r\n}\r\n", "import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n", "let getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n    if (!getRandomValues) {\n        if (typeof crypto === 'undefined' || !crypto.getRandomValues) {\n            throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n        }\n        getRandomValues = crypto.getRandomValues.bind(crypto);\n    }\n    return getRandomValues(rnds8);\n}\n", "const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default { randomUUID };\n", "import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction _v4(options, buf, offset) {\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    return _v4(options, buf, offset);\n}\nexport default v4;\n", "// @ts-ignore - itty-router is a JS dependency\r\nimport { Router } from 'itty-router';\r\nimport { requireAuth } from '../middleware/auth';\r\nimport { v4 as uuid } from 'uuid';\r\n\r\nconst consultRouter = Router();\r\n\r\n// In-memory slot store (replace with DB in production)\r\ninterface Slot {\r\n  id: string;\r\n  start: string;\r\n  end: string;\r\n  booked: boolean;\r\n  client_id: number | null;\r\n  fee: number;\r\n}\r\n\r\nconst SLOT_DURATION_MIN = 30;\r\nconst SLOT_FEE = 50.00;\r\n\r\nfunction getSlots(): Slot[] {\r\n  // Generate slots for next 24 hours on each request (stateless)\r\n  const slots: Slot[] = [];\r\n  const now = new Date();\r\n  for (let i = 0; i < 48; i++) {\r\n    const slot = new Date(now.getTime() + i * SLOT_DURATION_MIN * 60000);\r\n    slots.push({\r\n      id: uuid(),\r\n      start: slot.toISOString(),\r\n      end: new Date(slot.getTime() + SLOT_DURATION_MIN * 60000).toISOString(),\r\n      booked: false,\r\n      client_id: null,\r\n      fee: SLOT_FEE\r\n    });\r\n  }\r\n  return slots;\r\n}\r\n\r\n\r\n// GET /api/consult/slots - List all available slots\r\nconsultRouter.get('/slots', async (req: Request, env: any) => {\r\n  // Always generate fresh slots (stateless, demo only)\r\n  const slots = getSlots();\r\n  return new Response(JSON.stringify(slots.filter(s => !s.booked)), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n\r\n// POST /api/consult/book - Book a slot (auth required)\r\nconsultRouter.post('/book', async (req: Request, env: any) => {\r\n  const user = await requireAuth(req, env);\r\n  if (user instanceof Response) return user;\r\n  const body = (await req.json()) as { slot_id?: string };\r\n  const slot_id = body.slot_id;\r\n  if (!slot_id) return new Response(JSON.stringify({ error: 'Missing slot_id' }), { status: 400 });\r\n  // In a real app, booking would persist to DB. Here, just return the slot as booked.\r\n  const slots = getSlots();\r\n  const slot = slots.find((s: Slot) => s.id === slot_id && !s.booked);\r\n  if (!slot) return new Response(JSON.stringify({ error: 'Slot unavailable' }), { status: 400 });\r\n  slot.booked = true;\r\n  slot.client_id = user.id;\r\n  // TODO: Integrate payment gateway and require $50 payment\r\n  // TODO: Send confirmation/notification\r\n  return new Response(JSON.stringify({ success: true, slot }), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n\r\nexport default consultRouter;\r\n", "import { v4 as uuid } from \"uuid\";\r\n\r\nexport interface AuditLogEntry {\r\n  action: string;\r\n  entity: string;\r\n  entity_id?: string;\r\n  user_id?: number;\r\n  user_role?: string;\r\n  user_email?: string;\r\n  details?: string;\r\n  ip_address?: string;\r\n  user_agent?: string;\r\n}\r\n\r\n/**\r\n * Log an audit entry to the database\r\n * Captures all sensitive actions for compliance tracking\r\n * \r\n * @param env - Environment with DB access\r\n * @param entry - Audit log entry details\r\n * @param req - Optional request object to extract IP and user agent\r\n */\r\nexport async function logAudit(\r\n  env: any,\r\n  entry: AuditLogEntry,\r\n  req?: Request\r\n): Promise<void> {\r\n  try {\r\n    const id = uuid();\r\n    const ip_address = entry.ip_address || req?.headers.get(\"CF-Connecting-IP\") || req?.headers.get(\"X-Forwarded-For\") || \"unknown\";\r\n    const user_agent = entry.user_agent || req?.headers.get(\"User-Agent\") || \"unknown\";\r\n    \r\n    await env.DB.prepare(\r\n      `INSERT INTO audit_log (id, action, entity, entity_id, user_id, user_role, user_email, details, ip_address, user_agent, created_at)\r\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))`\r\n    ).bind(\r\n      id,\r\n      entry.action,\r\n      entry.entity,\r\n      entry.entity_id || null,\r\n      entry.user_id || null,\r\n      entry.user_role || null,\r\n      entry.user_email || null,\r\n      entry.details || null,\r\n      ip_address,\r\n      user_agent\r\n    ).run();\r\n    \r\n    console.log(`[AUDIT] ${entry.action} on ${entry.entity} by ${entry.user_email || \"system\"}`);\r\n  } catch (error) {\r\n    console.error(\"Failed to log audit entry:\", error);\r\n    // Don't throw - audit logging should not break the application\r\n  }\r\n}\r\n\r\n/**\r\n * Audit helper for login attempts\r\n */\r\nexport async function auditLogin(\r\n  env: any,\r\n  email: string,\r\n  success: boolean,\r\n  req: Request,\r\n  mfaUsed: boolean = false\r\n): Promise<void> {\r\n  await logAudit(env, {\r\n    action: success ? \"login_success\" : \"login_failed\",\r\n    entity: \"authentication\",\r\n    user_email: email,\r\n    details: JSON.stringify({ mfa_used: mfaUsed })\r\n  }, req);\r\n}\r\n\r\n/**\r\n * Audit helper for data access\r\n */\r\nexport async function auditDataAccess(\r\n  env: any,\r\n  entity: string,\r\n  entity_id: string,\r\n  user: { id: number; email: string; role: string },\r\n  action: \"read\" | \"list\" | \"search\",\r\n  req?: Request\r\n): Promise<void> {\r\n  await logAudit(env, {\r\n    action: `${entity}_${action}`,\r\n    entity,\r\n    entity_id,\r\n    user_id: user.id,\r\n    user_role: user.role,\r\n    user_email: user.email\r\n  }, req);\r\n}\r\n\r\n/**\r\n * Audit helper for data modifications\r\n */\r\nexport async function auditDataChange(\r\n  env: any,\r\n  entity: string,\r\n  entity_id: string,\r\n  user: { id: number; email: string; role: string },\r\n  action: \"create\" | \"update\" | \"delete\",\r\n  details?: any,\r\n  req?: Request\r\n): Promise<void> {\r\n  await logAudit(env, {\r\n    action: `${entity}_${action}`,\r\n    entity,\r\n    entity_id,\r\n    user_id: user.id,\r\n    user_role: user.role,\r\n    user_email: user.email,\r\n    details: details ? JSON.stringify(details) : undefined\r\n  }, req);\r\n}\r\n\r\n/**\r\n * Audit helper for file operations\r\n */\r\nexport async function auditFileOperation(\r\n  env: any,\r\n  filename: string,\r\n  user: { id: number; email: string; role: string },\r\n  action: \"upload\" | \"download\" | \"delete\",\r\n  req?: Request\r\n): Promise<void> {\r\n  await logAudit(env, {\r\n    action: `file_${action}`,\r\n    entity: \"document\",\r\n    entity_id: filename,\r\n    user_id: user.id,\r\n    user_role: user.role,\r\n    user_email: user.email,\r\n    details: JSON.stringify({ filename })\r\n  }, req);\r\n}\r\n\r\n/**\r\n * Audit helper for admin actions\r\n */\r\nexport async function auditAdminAction(\r\n  env: any,\r\n  action: string,\r\n  entity: string,\r\n  user: { id: number; email: string; role: string },\r\n  details?: any,\r\n  req?: Request\r\n): Promise<void> {\r\n  await logAudit(env, {\r\n    action: `admin_${action}`,\r\n    entity,\r\n    user_id: user.id,\r\n    user_role: user.role,\r\n    user_email: user.email,\r\n    details: details ? JSON.stringify(details) : undefined\r\n  }, req);\r\n}\r\n\r\n/**\r\n * Audit helper for permission changes\r\n */\r\nexport async function auditPermissionChange(\r\n  env: any,\r\n  targetUserId: number,\r\n  targetEmail: string,\r\n  user: { id: number; email: string; role: string },\r\n  changes: any,\r\n  req?: Request\r\n): Promise<void> {\r\n  await logAudit(env, {\r\n    action: \"permission_change\",\r\n    entity: \"user\",\r\n    entity_id: targetUserId.toString(),\r\n    user_id: user.id,\r\n    user_role: user.role,\r\n    user_email: user.email,\r\n    details: JSON.stringify({\r\n      target_email: targetEmail,\r\n      changes\r\n    })\r\n  }, req);\r\n}\r\n\r\n/**\r\n * Audit helper for payment transactions\r\n */\r\nexport async function auditPayment(\r\n  env: any,\r\n  transactionId: string,\r\n  amount: number,\r\n  user: { id: number; email: string; role: string },\r\n  status: \"initiated\" | \"completed\" | \"failed\",\r\n  req?: Request\r\n): Promise<void> {\r\n  await logAudit(env, {\r\n    action: `payment_${status}`,\r\n    entity: \"payment\",\r\n    entity_id: transactionId,\r\n    user_id: user.id,\r\n    user_role: user.role,\r\n    user_email: user.email,\r\n    details: JSON.stringify({ amount, currency: \"USD\" })\r\n  }, req);\r\n}\r\n\r\n/**\r\n * Audit helper for e-file submissions\r\n */\r\nexport async function auditEfileSubmission(\r\n  env: any,\r\n  returnId: string,\r\n  user: { id: number; email: string; role: string },\r\n  status: \"submitted\" | \"accepted\" | \"rejected\",\r\n  details?: any,\r\n  req?: Request\r\n): Promise<void> {\r\n  await logAudit(env, {\r\n    action: `efile_${status}`,\r\n    entity: \"tax_return\",\r\n    entity_id: returnId,\r\n    user_id: user.id,\r\n    user_role: user.role,\r\n    user_email: user.email,\r\n    details: details ? JSON.stringify(details) : undefined\r\n  }, req);\r\n}\r\n", "// @ts-ignore - itty-router is a JS dependency\r\nimport { Router } from 'itty-router';\r\nimport { requireAuth } from '../middleware/auth';\r\nimport { logAudit } from '../utils/audit';\r\n\r\nconst dizRouter = Router();\r\n\r\n// GET /api/diz/returns - List all returns for the authenticated client\r\n// List all returns for the authenticated client\r\ndizRouter.get('/returns', async (req: Request, env: any) => {\r\n  const user = await requireAuth(req, env);\r\n  if (user instanceof Response) return user;\r\n  const { results } = await env.DB.prepare(\r\n    `SELECT * FROM returns WHERE client_id = ? ORDER BY updated_at DESC LIMIT 20`\r\n  ).bind(user.id).all();\r\n  return new Response(JSON.stringify(results), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n\r\n// POST /api/diz/returns - Create a new return (DIY onboarding)\r\n// Create a new return (DIY onboarding)\r\ndizRouter.post('/returns', async (req: Request, env: any) => {\r\n  const user = await requireAuth(req, env);\r\n  if (user instanceof Response) return user;\r\n  const body = (await req.json()) as { tax_year: string };\r\n  const tax_year = body.tax_year;\r\n  const result = await env.DB.prepare(\r\n    `INSERT INTO returns (client_id, tax_year, status, updated_at) VALUES (?, ?, 'pending', CURRENT_TIMESTAMP)`\r\n  ).bind(user.id, tax_year).run();\r\n  await logAudit(env, { action: 'diz_return_create', entity: 'returns', entity_id: result.lastRowId, user_id: user.id, user_email: user.email });\r\n  return new Response(JSON.stringify({ success: true, id: result.lastRowId }), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n\r\n// POST /api/diz/returns/:id/upload - Upload document for a return\r\n// Upload document for a return\r\ndizRouter.post('/returns/:id/upload', async (req: Request & { params?: any }, env: any) => {\r\n  const user = await requireAuth(req, env);\r\n  if (user instanceof Response) return user;\r\n  // TODO: Handle file upload (R2 or similar)\r\n  // For now, just log\r\n  await logAudit(env, { action: 'diz_upload', entity: 'returns', entity_id: req.params?.id, user_id: user.id, user_email: user.email });\r\n  return new Response(JSON.stringify({ success: true }));\r\n});\r\n\r\n// POST /api/diz/returns/:id/esign - Mark e-signature as complete\r\n// Mark e-signature as complete\r\ndizRouter.post('/returns/:id/esign', async (req: Request & { params?: any }, env: any) => {\r\n  const user = await requireAuth(req, env);\r\n  if (user instanceof Response) return user;\r\n  await env.DB.prepare(\r\n    `UPDATE returns SET status = 'signed', updated_at = CURRENT_TIMESTAMP WHERE id = ? AND client_id = ?`\r\n  ).bind(req.params?.id, user.id).run();\r\n  await logAudit(env, { action: 'diz_esign', entity: 'returns', entity_id: req.params?.id, user_id: user.id, user_email: user.email });\r\n  return new Response(JSON.stringify({ success: true }));\r\n});\r\n\r\n// POST /api/diz/returns/:id/payment - Mark payment as complete\r\n// Mark payment as complete\r\ndizRouter.post('/returns/:id/payment', async (req: Request & { params?: any }, env: any) => {\r\n  const user = await requireAuth(req, env);\r\n  if (user instanceof Response) return user;\r\n  await env.DB.prepare(\r\n    `UPDATE returns SET status = 'paid', updated_at = CURRENT_TIMESTAMP WHERE id = ? AND client_id = ?`\r\n  ).bind(req.params?.id, user.id).run();\r\n  await logAudit(env, { action: 'diz_payment', entity: 'returns', entity_id: req.params?.id, user_id: user.id, user_email: user.email });\r\n  return new Response(JSON.stringify({ success: true }));\r\n});\r\n\r\n// POST /api/diz/returns/:id/efile - Submit return for e-file\r\n// Submit return for e-file\r\ndizRouter.post('/returns/:id/efile', async (req: Request & { params?: any }, env: any) => {\r\n  const user = await requireAuth(req, env);\r\n  if (user instanceof Response) return user;\r\n  // Check payment status\r\n  const row = await env.DB.prepare(\r\n    `SELECT status FROM returns WHERE id = ? AND client_id = ?`\r\n  ).bind(req.params?.id, user.id).first();\r\n  if (!row || row.status !== 'paid') {\r\n    return new Response(JSON.stringify({ error: 'Payment required before e-file' }), { status: 403 });\r\n  }\r\n  // TODO: Validate, store, and transmit return XML\r\n  await env.DB.prepare(\r\n    `UPDATE returns SET status = 'efile_submitted', updated_at = CURRENT_TIMESTAMP WHERE id = ? AND client_id = ?`\r\n  ).bind(req.params?.id, user.id).run();\r\n  await logAudit(env, { action: 'diz_efile', entity: 'returns', entity_id: req.params?.id, user_id: user.id, user_email: user.email });\r\n  return new Response(JSON.stringify({ success: true }));\r\n});\r\n\r\n// GET /api/diz/returns/:id/status - Get workflow status/history for a return\r\ndizRouter.get('/returns/:id/status', async (req: Request & { params?: any }, env: any) => {\r\n  const user = await requireAuth(req, env);\r\n  if (user instanceof Response) return user;\r\n  const row = await env.DB.prepare(\r\n    `SELECT * FROM returns WHERE id = ? AND client_id = ?`\r\n  ).bind(req.params?.id, user.id).first();\r\n  if (!row) return new Response(JSON.stringify({ error: 'Not found' }), { status: 404 });\r\n  // Optionally join with payments, efile_transmissions, etc.\r\n  return new Response(JSON.stringify(row), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\nexport default dizRouter;\r\n", "// @ts-ignore - itty-router is a JS dependency\r\nimport { Router } from 'itty-router';\r\nimport { requireStaff } from '../middleware/auth';\r\nimport { logAudit } from '../utils/audit';\r\n\r\nconst eroRouter = Router();\r\n\r\n// GET /api/ero/returns - List all returns needing ERO review\r\neroRouter.get('/returns', async (req: Request, env: any) => {\r\n  const authResult = await requireStaff(req, env);\r\n  if (authResult instanceof Response) return authResult;\r\n  const user = authResult;\r\n  const { results } = await env.DB.prepare(\r\n    `SELECT t.*, c.full_name, c.email FROM efile_transmissions t\r\n     LEFT JOIN clients c ON t.client_id = c.id\r\n     WHERE t.status IN ('created', 'pending', 'review', 'awaiting_signature', 'awaiting_payment')\r\n     ORDER BY t.updated_at DESC LIMIT 100`\r\n  ).all();\r\n  return new Response(JSON.stringify(results), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n\r\n// POST /api/ero/returns/:id/claim - Claim a return for review\r\neroRouter.post('/returns/:id/claim', async (req: Request & { params?: any }, env: any) => {\r\n  const authResult = await requireStaff(req, env);\r\n  if (authResult instanceof Response) return authResult;\r\n  const user = authResult;\r\n  const id = req.params?.id;\r\n  await env.DB.prepare(\r\n    `UPDATE efile_transmissions SET preparer_id = ?, status = 'review' WHERE id = ? AND (preparer_id IS NULL OR preparer_id = ?)`\r\n  ).bind(user.id, id, user.id).run();\r\n  await logAudit(env, { action: 'ero_claim', entity: 'efile_transmissions', entity_id: id, user_id: user.id, user_email: user.email });\r\n  return new Response(JSON.stringify({ success: true }));\r\n});\r\n\r\n// POST /api/ero/returns/:id/compliance - Mark compliance review\r\neroRouter.post('/returns/:id/compliance', async (req: Request & { params?: any }, env: any) => {\r\n  const authResult = await requireStaff(req, env);\r\n  if (authResult instanceof Response) return authResult;\r\n  const user = authResult;\r\n  const id = req.params?.id;\r\n  const body = (await req.json()) as { compliant?: boolean; notes?: string };\r\n  const compliant = body.compliant;\r\n  const notes = body.notes;\r\n  await env.DB.prepare(\r\n    `UPDATE efile_transmissions SET status = ?, compliance_notes = ? WHERE id = ?`\r\n  ).bind(compliant ? 'awaiting_signature' : 'review', notes || null, id).run();\r\n  await logAudit(env, { action: 'ero_compliance', entity: 'efile_transmissions', entity_id: id, user_id: user.id, user_email: user.email, details: JSON.stringify({ compliant, notes }) });\r\n  return new Response(JSON.stringify({ success: true }));\r\n});\r\n\r\n// POST /api/ero/returns/:id/signature - Mark signature as received\r\neroRouter.post('/returns/:id/signature', async (req: Request & { params?: any }, env: any) => {\r\n  const authResult = await requireStaff(req, env);\r\n  if (authResult instanceof Response) return authResult;\r\n  const user = authResult;\r\n  const id = req.params?.id;\r\n  await env.DB.prepare(\r\n    `UPDATE efile_transmissions SET status = 'awaiting_payment' WHERE id = ?`\r\n  ).bind(id).run();\r\n  await logAudit(env, { action: 'ero_signature', entity: 'efile_transmissions', entity_id: id, user_id: user.id, user_email: user.email });\r\n  return new Response(JSON.stringify({ success: true }));\r\n});\r\n\r\n// POST /api/ero/returns/:id/payment - Mark payment as received\r\neroRouter.post('/returns/:id/payment', async (req: Request & { params?: any }, env: any) => {\r\n  const authResult = await requireStaff(req, env);\r\n  if (authResult instanceof Response) return authResult;\r\n  const user = authResult;\r\n  const id = req.params?.id;\r\n  await env.DB.prepare(\r\n    `UPDATE efile_transmissions SET status = 'ready_to_transmit' WHERE id = ?`\r\n  ).bind(id).run();\r\n  await logAudit(env, { action: 'ero_payment', entity: 'efile_transmissions', entity_id: id, user_id: user.id, user_email: user.email });\r\n  return new Response(JSON.stringify({ success: true }));\r\n});\r\n\r\n// POST /api/ero/returns/:id/transmit - Transmit return to IRS/state\r\neroRouter.post('/returns/:id/transmit', async (req: Request & { params?: any }, env: any) => {\r\n  const authResult = await requireStaff(req, env);\r\n  if (authResult instanceof Response) return authResult;\r\n  const user = authResult;\r\n  const id = req.params?.id;\r\n  // Fetch transmission and XML\r\n  const row = await env.DB.prepare('SELECT * FROM efile_transmissions WHERE id = ?').bind(id).first();\r\n  if (!row) return new Response(JSON.stringify({ error: 'Not found' }), { status: 404 });\r\n  // TODO: Fetch return XML and type\r\n  // const xml = ...\r\n  // const returnType = ...\r\n  // const result = await transmitEFile(env, row, xml, returnType, row.tax_year);\r\n  // For now, just mark as transmitting\r\n  await env.DB.prepare(\r\n    `UPDATE efile_transmissions SET status = 'transmitting' WHERE id = ?`\r\n  ).bind(id).run();\r\n  await logAudit(env, { action: 'ero_transmit', entity: 'efile_transmissions', entity_id: id, user_id: user.id, user_email: user.email });\r\n  return new Response(JSON.stringify({ success: true }));\r\n});\r\n\r\nexport default eroRouter;\r\n", "export function healthRoute() {\r\n  return new Response(\r\n    JSON.stringify({ status: \"ok\", service: \"ross-tax-prep-api\" }),\r\n    { headers: { \"Content-Type\": \"application/json\" } }\r\n  );\r\n}\r\n", "export function cors(res: Response) {\r\n  const headers = new Headers(res.headers);\r\n  headers.set(\"Access-Control-Allow-Origin\", \"*\");\r\n  headers.set(\"Access-Control-Allow-Methods\", \"GET,POST,OPTIONS\");\r\n  headers.set(\"Access-Control-Allow-Headers\", \"Content-Type,Authorization\");\r\n\r\n  return new Response(res.body, {\r\n    status: res.status,\r\n    headers\r\n  });\r\n}\r\n", "/*\n Copyright (c) 2012 Nevins Bartolomeo <nevins.bartolomeo@gmail.com>\n Copyright (c) 2012 Shane Girish <shaneGirish@gmail.com>\n Copyright (c) 2025 Daniel Wirtz <dcode@dcode.io>\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions\n are met:\n 1. Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n 2. Redistributions in binary form must reproduce the above copyright\n notice, this list of conditions and the following disclaimer in the\n documentation and/or other materials provided with the distribution.\n 3. The name of the author may not be used to endorse or promote products\n derived from this software without specific prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR\n IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,\n INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n// The Node.js crypto module is used as a fallback for the Web Crypto API. When\n// building for the browser, inclusion of the crypto module should be disabled,\n// which the package hints at in its package.json for bundlers that support it.\nimport nodeCrypto from \"crypto\";\n\n/**\n * The random implementation to use as a fallback.\n * @type {?function(number):!Array.<number>}\n * @inner\n */\nvar randomFallback = null;\n\n/**\n * Generates cryptographically secure random bytes.\n * @function\n * @param {number} len Bytes length\n * @returns {!Array.<number>} Random bytes\n * @throws {Error} If no random implementation is available\n * @inner\n */\nfunction randomBytes(len) {\n  // Web Crypto API. Globally available in the browser and in Node.js >=23.\n  try {\n    return crypto.getRandomValues(new Uint8Array(len));\n  } catch {}\n  // Node.js crypto module for non-browser environments.\n  try {\n    return nodeCrypto.randomBytes(len);\n  } catch {}\n  // Custom fallback specified with `setRandomFallback`.\n  if (!randomFallback) {\n    throw Error(\n      \"Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative\",\n    );\n  }\n  return randomFallback(len);\n}\n\n/**\n * Sets the pseudo random number generator to use as a fallback if neither node's `crypto` module nor the Web Crypto\n *  API is available. Please note: It is highly important that the PRNG used is cryptographically secure and that it\n *  is seeded properly!\n * @param {?function(number):!Array.<number>} random Function taking the number of bytes to generate as its\n *  sole argument, returning the corresponding array of cryptographically secure random byte values.\n * @see http://nodejs.org/api/crypto.html\n * @see http://www.w3.org/TR/WebCryptoAPI/\n */\nexport function setRandomFallback(random) {\n  randomFallback = random;\n}\n\n/**\n * Synchronously generates a salt.\n * @param {number=} rounds Number of rounds to use, defaults to 10 if omitted\n * @param {number=} seed_length Not supported.\n * @returns {string} Resulting salt\n * @throws {Error} If a random fallback is required but not set\n */\nexport function genSaltSync(rounds, seed_length) {\n  rounds = rounds || GENSALT_DEFAULT_LOG2_ROUNDS;\n  if (typeof rounds !== \"number\")\n    throw Error(\n      \"Illegal arguments: \" + typeof rounds + \", \" + typeof seed_length,\n    );\n  if (rounds < 4) rounds = 4;\n  else if (rounds > 31) rounds = 31;\n  var salt = [];\n  salt.push(\"$2b$\");\n  if (rounds < 10) salt.push(\"0\");\n  salt.push(rounds.toString());\n  salt.push(\"$\");\n  salt.push(base64_encode(randomBytes(BCRYPT_SALT_LEN), BCRYPT_SALT_LEN)); // May throw\n  return salt.join(\"\");\n}\n\n/**\n * Asynchronously generates a salt.\n * @param {(number|function(Error, string=))=} rounds Number of rounds to use, defaults to 10 if omitted\n * @param {(number|function(Error, string=))=} seed_length Not supported.\n * @param {function(Error, string=)=} callback Callback receiving the error, if any, and the resulting salt\n * @returns {!Promise} If `callback` has been omitted\n * @throws {Error} If `callback` is present but not a function\n */\nexport function genSalt(rounds, seed_length, callback) {\n  if (typeof seed_length === \"function\")\n    (callback = seed_length), (seed_length = undefined); // Not supported.\n  if (typeof rounds === \"function\") (callback = rounds), (rounds = undefined);\n  if (typeof rounds === \"undefined\") rounds = GENSALT_DEFAULT_LOG2_ROUNDS;\n  else if (typeof rounds !== \"number\")\n    throw Error(\"illegal arguments: \" + typeof rounds);\n\n  function _async(callback) {\n    nextTick(function () {\n      // Pretty thin, but salting is fast enough\n      try {\n        callback(null, genSaltSync(rounds));\n      } catch (err) {\n        callback(err);\n      }\n    });\n  }\n\n  if (callback) {\n    if (typeof callback !== \"function\")\n      throw Error(\"Illegal callback: \" + typeof callback);\n    _async(callback);\n  } else\n    return new Promise(function (resolve, reject) {\n      _async(function (err, res) {\n        if (err) {\n          reject(err);\n          return;\n        }\n        resolve(res);\n      });\n    });\n}\n\n/**\n * Synchronously generates a hash for the given password.\n * @param {string} password Password to hash\n * @param {(number|string)=} salt Salt length to generate or salt to use, default to 10\n * @returns {string} Resulting hash\n */\nexport function hashSync(password, salt) {\n  if (typeof salt === \"undefined\") salt = GENSALT_DEFAULT_LOG2_ROUNDS;\n  if (typeof salt === \"number\") salt = genSaltSync(salt);\n  if (typeof password !== \"string\" || typeof salt !== \"string\")\n    throw Error(\"Illegal arguments: \" + typeof password + \", \" + typeof salt);\n  return _hash(password, salt);\n}\n\n/**\n * Asynchronously generates a hash for the given password.\n * @param {string} password Password to hash\n * @param {number|string} salt Salt length to generate or salt to use\n * @param {function(Error, string=)=} callback Callback receiving the error, if any, and the resulting hash\n * @param {function(number)=} progressCallback Callback successively called with the percentage of rounds completed\n *  (0.0 - 1.0), maximally once per `MAX_EXECUTION_TIME = 100` ms.\n * @returns {!Promise} If `callback` has been omitted\n * @throws {Error} If `callback` is present but not a function\n */\nexport function hash(password, salt, callback, progressCallback) {\n  function _async(callback) {\n    if (typeof password === \"string\" && typeof salt === \"number\")\n      genSalt(salt, function (err, salt) {\n        _hash(password, salt, callback, progressCallback);\n      });\n    else if (typeof password === \"string\" && typeof salt === \"string\")\n      _hash(password, salt, callback, progressCallback);\n    else\n      nextTick(\n        callback.bind(\n          this,\n          Error(\"Illegal arguments: \" + typeof password + \", \" + typeof salt),\n        ),\n      );\n  }\n\n  if (callback) {\n    if (typeof callback !== \"function\")\n      throw Error(\"Illegal callback: \" + typeof callback);\n    _async(callback);\n  } else\n    return new Promise(function (resolve, reject) {\n      _async(function (err, res) {\n        if (err) {\n          reject(err);\n          return;\n        }\n        resolve(res);\n      });\n    });\n}\n\n/**\n * Compares two strings of the same length in constant time.\n * @param {string} known Must be of the correct length\n * @param {string} unknown Must be the same length as `known`\n * @returns {boolean}\n * @inner\n */\nfunction safeStringCompare(known, unknown) {\n  var diff = known.length ^ unknown.length;\n  for (var i = 0; i < known.length; ++i) {\n    diff |= known.charCodeAt(i) ^ unknown.charCodeAt(i);\n  }\n  return diff === 0;\n}\n\n/**\n * Synchronously tests a password against a hash.\n * @param {string} password Password to compare\n * @param {string} hash Hash to test against\n * @returns {boolean} true if matching, otherwise false\n * @throws {Error} If an argument is illegal\n */\nexport function compareSync(password, hash) {\n  if (typeof password !== \"string\" || typeof hash !== \"string\")\n    throw Error(\"Illegal arguments: \" + typeof password + \", \" + typeof hash);\n  if (hash.length !== 60) return false;\n  return safeStringCompare(\n    hashSync(password, hash.substring(0, hash.length - 31)),\n    hash,\n  );\n}\n\n/**\n * Asynchronously tests a password against a hash.\n * @param {string} password Password to compare\n * @param {string} hashValue Hash to test against\n * @param {function(Error, boolean)=} callback Callback receiving the error, if any, otherwise the result\n * @param {function(number)=} progressCallback Callback successively called with the percentage of rounds completed\n *  (0.0 - 1.0), maximally once per `MAX_EXECUTION_TIME = 100` ms.\n * @returns {!Promise} If `callback` has been omitted\n * @throws {Error} If `callback` is present but not a function\n */\nexport function compare(password, hashValue, callback, progressCallback) {\n  function _async(callback) {\n    if (typeof password !== \"string\" || typeof hashValue !== \"string\") {\n      nextTick(\n        callback.bind(\n          this,\n          Error(\n            \"Illegal arguments: \" + typeof password + \", \" + typeof hashValue,\n          ),\n        ),\n      );\n      return;\n    }\n    if (hashValue.length !== 60) {\n      nextTick(callback.bind(this, null, false));\n      return;\n    }\n    hash(\n      password,\n      hashValue.substring(0, 29),\n      function (err, comp) {\n        if (err) callback(err);\n        else callback(null, safeStringCompare(comp, hashValue));\n      },\n      progressCallback,\n    );\n  }\n\n  if (callback) {\n    if (typeof callback !== \"function\")\n      throw Error(\"Illegal callback: \" + typeof callback);\n    _async(callback);\n  } else\n    return new Promise(function (resolve, reject) {\n      _async(function (err, res) {\n        if (err) {\n          reject(err);\n          return;\n        }\n        resolve(res);\n      });\n    });\n}\n\n/**\n * Gets the number of rounds used to encrypt the specified hash.\n * @param {string} hash Hash to extract the used number of rounds from\n * @returns {number} Number of rounds used\n * @throws {Error} If `hash` is not a string\n */\nexport function getRounds(hash) {\n  if (typeof hash !== \"string\")\n    throw Error(\"Illegal arguments: \" + typeof hash);\n  return parseInt(hash.split(\"$\")[2], 10);\n}\n\n/**\n * Gets the salt portion from a hash. Does not validate the hash.\n * @param {string} hash Hash to extract the salt from\n * @returns {string} Extracted salt part\n * @throws {Error} If `hash` is not a string or otherwise invalid\n */\nexport function getSalt(hash) {\n  if (typeof hash !== \"string\")\n    throw Error(\"Illegal arguments: \" + typeof hash);\n  if (hash.length !== 60)\n    throw Error(\"Illegal hash length: \" + hash.length + \" != 60\");\n  return hash.substring(0, 29);\n}\n\n/**\n * Tests if a password will be truncated when hashed, that is its length is\n * greater than 72 bytes when converted to UTF-8.\n * @param {string} password The password to test\n * @returns {boolean} `true` if truncated, otherwise `false`\n */\nexport function truncates(password) {\n  if (typeof password !== \"string\")\n    throw Error(\"Illegal arguments: \" + typeof password);\n  return utf8Length(password) > 72;\n}\n\n/**\n * Continues with the callback after yielding to the event loop.\n * @function\n * @param {function(...[*])} callback Callback to execute\n * @inner\n */\nvar nextTick =\n  typeof setImmediate === \"function\"\n    ? setImmediate\n    : typeof scheduler === \"object\" && typeof scheduler.postTask === \"function\"\n      ? scheduler.postTask.bind(scheduler)\n      : setTimeout;\n\n/** Calculates the byte length of a string encoded as UTF8. */\nfunction utf8Length(string) {\n  var len = 0,\n    c = 0;\n  for (var i = 0; i < string.length; ++i) {\n    c = string.charCodeAt(i);\n    if (c < 128) len += 1;\n    else if (c < 2048) len += 2;\n    else if (\n      (c & 0xfc00) === 0xd800 &&\n      (string.charCodeAt(i + 1) & 0xfc00) === 0xdc00\n    ) {\n      ++i;\n      len += 4;\n    } else len += 3;\n  }\n  return len;\n}\n\n/** Converts a string to an array of UTF8 bytes. */\nfunction utf8Array(string) {\n  var offset = 0,\n    c1,\n    c2;\n  var buffer = new Array(utf8Length(string));\n  for (var i = 0, k = string.length; i < k; ++i) {\n    c1 = string.charCodeAt(i);\n    if (c1 < 128) {\n      buffer[offset++] = c1;\n    } else if (c1 < 2048) {\n      buffer[offset++] = (c1 >> 6) | 192;\n      buffer[offset++] = (c1 & 63) | 128;\n    } else if (\n      (c1 & 0xfc00) === 0xd800 &&\n      ((c2 = string.charCodeAt(i + 1)) & 0xfc00) === 0xdc00\n    ) {\n      c1 = 0x10000 + ((c1 & 0x03ff) << 10) + (c2 & 0x03ff);\n      ++i;\n      buffer[offset++] = (c1 >> 18) | 240;\n      buffer[offset++] = ((c1 >> 12) & 63) | 128;\n      buffer[offset++] = ((c1 >> 6) & 63) | 128;\n      buffer[offset++] = (c1 & 63) | 128;\n    } else {\n      buffer[offset++] = (c1 >> 12) | 224;\n      buffer[offset++] = ((c1 >> 6) & 63) | 128;\n      buffer[offset++] = (c1 & 63) | 128;\n    }\n  }\n  return buffer;\n}\n\n// A base64 implementation for the bcrypt algorithm. This is partly non-standard.\n\n/**\n * bcrypt's own non-standard base64 dictionary.\n * @type {!Array.<string>}\n * @const\n * @inner\n **/\nvar BASE64_CODE =\n  \"./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\".split(\"\");\n\n/**\n * @type {!Array.<number>}\n * @const\n * @inner\n **/\nvar BASE64_INDEX = [\n  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n  -1, -1, -1, -1, -1, -1, -1, -1, 0, 1, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63,\n  -1, -1, -1, -1, -1, -1, -1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,\n  16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, -1, -1, -1, -1, -1, -1, 28,\n  29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,\n  48, 49, 50, 51, 52, 53, -1, -1, -1, -1, -1,\n];\n\n/**\n * Encodes a byte array to base64 with up to len bytes of input.\n * @param {!Array.<number>} b Byte array\n * @param {number} len Maximum input length\n * @returns {string}\n * @inner\n */\nfunction base64_encode(b, len) {\n  var off = 0,\n    rs = [],\n    c1,\n    c2;\n  if (len <= 0 || len > b.length) throw Error(\"Illegal len: \" + len);\n  while (off < len) {\n    c1 = b[off++] & 0xff;\n    rs.push(BASE64_CODE[(c1 >> 2) & 0x3f]);\n    c1 = (c1 & 0x03) << 4;\n    if (off >= len) {\n      rs.push(BASE64_CODE[c1 & 0x3f]);\n      break;\n    }\n    c2 = b[off++] & 0xff;\n    c1 |= (c2 >> 4) & 0x0f;\n    rs.push(BASE64_CODE[c1 & 0x3f]);\n    c1 = (c2 & 0x0f) << 2;\n    if (off >= len) {\n      rs.push(BASE64_CODE[c1 & 0x3f]);\n      break;\n    }\n    c2 = b[off++] & 0xff;\n    c1 |= (c2 >> 6) & 0x03;\n    rs.push(BASE64_CODE[c1 & 0x3f]);\n    rs.push(BASE64_CODE[c2 & 0x3f]);\n  }\n  return rs.join(\"\");\n}\n\n/**\n * Decodes a base64 encoded string to up to len bytes of output.\n * @param {string} s String to decode\n * @param {number} len Maximum output length\n * @returns {!Array.<number>}\n * @inner\n */\nfunction base64_decode(s, len) {\n  var off = 0,\n    slen = s.length,\n    olen = 0,\n    rs = [],\n    c1,\n    c2,\n    c3,\n    c4,\n    o,\n    code;\n  if (len <= 0) throw Error(\"Illegal len: \" + len);\n  while (off < slen - 1 && olen < len) {\n    code = s.charCodeAt(off++);\n    c1 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\n    code = s.charCodeAt(off++);\n    c2 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\n    if (c1 == -1 || c2 == -1) break;\n    o = (c1 << 2) >>> 0;\n    o |= (c2 & 0x30) >> 4;\n    rs.push(String.fromCharCode(o));\n    if (++olen >= len || off >= slen) break;\n    code = s.charCodeAt(off++);\n    c3 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\n    if (c3 == -1) break;\n    o = ((c2 & 0x0f) << 4) >>> 0;\n    o |= (c3 & 0x3c) >> 2;\n    rs.push(String.fromCharCode(o));\n    if (++olen >= len || off >= slen) break;\n    code = s.charCodeAt(off++);\n    c4 = code < BASE64_INDEX.length ? BASE64_INDEX[code] : -1;\n    o = ((c3 & 0x03) << 6) >>> 0;\n    o |= c4;\n    rs.push(String.fromCharCode(o));\n    ++olen;\n  }\n  var res = [];\n  for (off = 0; off < olen; off++) res.push(rs[off].charCodeAt(0));\n  return res;\n}\n\n/**\n * @type {number}\n * @const\n * @inner\n */\nvar BCRYPT_SALT_LEN = 16;\n\n/**\n * @type {number}\n * @const\n * @inner\n */\nvar GENSALT_DEFAULT_LOG2_ROUNDS = 10;\n\n/**\n * @type {number}\n * @const\n * @inner\n */\nvar BLOWFISH_NUM_ROUNDS = 16;\n\n/**\n * @type {number}\n * @const\n * @inner\n */\nvar MAX_EXECUTION_TIME = 100;\n\n/**\n * @type {Array.<number>}\n * @const\n * @inner\n */\nvar P_ORIG = [\n  0x243f6a88, 0x85a308d3, 0x13198a2e, 0x03707344, 0xa4093822, 0x299f31d0,\n  0x082efa98, 0xec4e6c89, 0x452821e6, 0x38d01377, 0xbe5466cf, 0x34e90c6c,\n  0xc0ac29b7, 0xc97c50dd, 0x3f84d5b5, 0xb5470917, 0x9216d5d9, 0x8979fb1b,\n];\n\n/**\n * @type {Array.<number>}\n * @const\n * @inner\n */\nvar S_ORIG = [\n  0xd1310ba6, 0x98dfb5ac, 0x2ffd72db, 0xd01adfb7, 0xb8e1afed, 0x6a267e96,\n  0xba7c9045, 0xf12c7f99, 0x24a19947, 0xb3916cf7, 0x0801f2e2, 0x858efc16,\n  0x636920d8, 0x71574e69, 0xa458fea3, 0xf4933d7e, 0x0d95748f, 0x728eb658,\n  0x718bcd58, 0x82154aee, 0x7b54a41d, 0xc25a59b5, 0x9c30d539, 0x2af26013,\n  0xc5d1b023, 0x286085f0, 0xca417918, 0xb8db38ef, 0x8e79dcb0, 0x603a180e,\n  0x6c9e0e8b, 0xb01e8a3e, 0xd71577c1, 0xbd314b27, 0x78af2fda, 0x55605c60,\n  0xe65525f3, 0xaa55ab94, 0x57489862, 0x63e81440, 0x55ca396a, 0x2aab10b6,\n  0xb4cc5c34, 0x1141e8ce, 0xa15486af, 0x7c72e993, 0xb3ee1411, 0x636fbc2a,\n  0x2ba9c55d, 0x741831f6, 0xce5c3e16, 0x9b87931e, 0xafd6ba33, 0x6c24cf5c,\n  0x7a325381, 0x28958677, 0x3b8f4898, 0x6b4bb9af, 0xc4bfe81b, 0x66282193,\n  0x61d809cc, 0xfb21a991, 0x487cac60, 0x5dec8032, 0xef845d5d, 0xe98575b1,\n  0xdc262302, 0xeb651b88, 0x23893e81, 0xd396acc5, 0x0f6d6ff3, 0x83f44239,\n  0x2e0b4482, 0xa4842004, 0x69c8f04a, 0x9e1f9b5e, 0x21c66842, 0xf6e96c9a,\n  0x670c9c61, 0xabd388f0, 0x6a51a0d2, 0xd8542f68, 0x960fa728, 0xab5133a3,\n  0x6eef0b6c, 0x137a3be4, 0xba3bf050, 0x7efb2a98, 0xa1f1651d, 0x39af0176,\n  0x66ca593e, 0x82430e88, 0x8cee8619, 0x456f9fb4, 0x7d84a5c3, 0x3b8b5ebe,\n  0xe06f75d8, 0x85c12073, 0x401a449f, 0x56c16aa6, 0x4ed3aa62, 0x363f7706,\n  0x1bfedf72, 0x429b023d, 0x37d0d724, 0xd00a1248, 0xdb0fead3, 0x49f1c09b,\n  0x075372c9, 0x80991b7b, 0x25d479d8, 0xf6e8def7, 0xe3fe501a, 0xb6794c3b,\n  0x976ce0bd, 0x04c006ba, 0xc1a94fb6, 0x409f60c4, 0x5e5c9ec2, 0x196a2463,\n  0x68fb6faf, 0x3e6c53b5, 0x1339b2eb, 0x3b52ec6f, 0x6dfc511f, 0x9b30952c,\n  0xcc814544, 0xaf5ebd09, 0xbee3d004, 0xde334afd, 0x660f2807, 0x192e4bb3,\n  0xc0cba857, 0x45c8740f, 0xd20b5f39, 0xb9d3fbdb, 0x5579c0bd, 0x1a60320a,\n  0xd6a100c6, 0x402c7279, 0x679f25fe, 0xfb1fa3cc, 0x8ea5e9f8, 0xdb3222f8,\n  0x3c7516df, 0xfd616b15, 0x2f501ec8, 0xad0552ab, 0x323db5fa, 0xfd238760,\n  0x53317b48, 0x3e00df82, 0x9e5c57bb, 0xca6f8ca0, 0x1a87562e, 0xdf1769db,\n  0xd542a8f6, 0x287effc3, 0xac6732c6, 0x8c4f5573, 0x695b27b0, 0xbbca58c8,\n  0xe1ffa35d, 0xb8f011a0, 0x10fa3d98, 0xfd2183b8, 0x4afcb56c, 0x2dd1d35b,\n  0x9a53e479, 0xb6f84565, 0xd28e49bc, 0x4bfb9790, 0xe1ddf2da, 0xa4cb7e33,\n  0x62fb1341, 0xcee4c6e8, 0xef20cada, 0x36774c01, 0xd07e9efe, 0x2bf11fb4,\n  0x95dbda4d, 0xae909198, 0xeaad8e71, 0x6b93d5a0, 0xd08ed1d0, 0xafc725e0,\n  0x8e3c5b2f, 0x8e7594b7, 0x8ff6e2fb, 0xf2122b64, 0x8888b812, 0x900df01c,\n  0x4fad5ea0, 0x688fc31c, 0xd1cff191, 0xb3a8c1ad, 0x2f2f2218, 0xbe0e1777,\n  0xea752dfe, 0x8b021fa1, 0xe5a0cc0f, 0xb56f74e8, 0x18acf3d6, 0xce89e299,\n  0xb4a84fe0, 0xfd13e0b7, 0x7cc43b81, 0xd2ada8d9, 0x165fa266, 0x80957705,\n  0x93cc7314, 0x211a1477, 0xe6ad2065, 0x77b5fa86, 0xc75442f5, 0xfb9d35cf,\n  0xebcdaf0c, 0x7b3e89a0, 0xd6411bd3, 0xae1e7e49, 0x00250e2d, 0x2071b35e,\n  0x226800bb, 0x57b8e0af, 0x2464369b, 0xf009b91e, 0x5563911d, 0x59dfa6aa,\n  0x78c14389, 0xd95a537f, 0x207d5ba2, 0x02e5b9c5, 0x83260376, 0x6295cfa9,\n  0x11c81968, 0x4e734a41, 0xb3472dca, 0x7b14a94a, 0x1b510052, 0x9a532915,\n  0xd60f573f, 0xbc9bc6e4, 0x2b60a476, 0x81e67400, 0x08ba6fb5, 0x571be91f,\n  0xf296ec6b, 0x2a0dd915, 0xb6636521, 0xe7b9f9b6, 0xff34052e, 0xc5855664,\n  0x53b02d5d, 0xa99f8fa1, 0x08ba4799, 0x6e85076a, 0x4b7a70e9, 0xb5b32944,\n  0xdb75092e, 0xc4192623, 0xad6ea6b0, 0x49a7df7d, 0x9cee60b8, 0x8fedb266,\n  0xecaa8c71, 0x699a17ff, 0x5664526c, 0xc2b19ee1, 0x193602a5, 0x75094c29,\n  0xa0591340, 0xe4183a3e, 0x3f54989a, 0x5b429d65, 0x6b8fe4d6, 0x99f73fd6,\n  0xa1d29c07, 0xefe830f5, 0x4d2d38e6, 0xf0255dc1, 0x4cdd2086, 0x8470eb26,\n  0x6382e9c6, 0x021ecc5e, 0x09686b3f, 0x3ebaefc9, 0x3c971814, 0x6b6a70a1,\n  0x687f3584, 0x52a0e286, 0xb79c5305, 0xaa500737, 0x3e07841c, 0x7fdeae5c,\n  0x8e7d44ec, 0x5716f2b8, 0xb03ada37, 0xf0500c0d, 0xf01c1f04, 0x0200b3ff,\n  0xae0cf51a, 0x3cb574b2, 0x25837a58, 0xdc0921bd, 0xd19113f9, 0x7ca92ff6,\n  0x94324773, 0x22f54701, 0x3ae5e581, 0x37c2dadc, 0xc8b57634, 0x9af3dda7,\n  0xa9446146, 0x0fd0030e, 0xecc8c73e, 0xa4751e41, 0xe238cd99, 0x3bea0e2f,\n  0x3280bba1, 0x183eb331, 0x4e548b38, 0x4f6db908, 0x6f420d03, 0xf60a04bf,\n  0x2cb81290, 0x24977c79, 0x5679b072, 0xbcaf89af, 0xde9a771f, 0xd9930810,\n  0xb38bae12, 0xdccf3f2e, 0x5512721f, 0x2e6b7124, 0x501adde6, 0x9f84cd87,\n  0x7a584718, 0x7408da17, 0xbc9f9abc, 0xe94b7d8c, 0xec7aec3a, 0xdb851dfa,\n  0x63094366, 0xc464c3d2, 0xef1c1847, 0x3215d908, 0xdd433b37, 0x24c2ba16,\n  0x12a14d43, 0x2a65c451, 0x50940002, 0x133ae4dd, 0x71dff89e, 0x10314e55,\n  0x81ac77d6, 0x5f11199b, 0x043556f1, 0xd7a3c76b, 0x3c11183b, 0x5924a509,\n  0xf28fe6ed, 0x97f1fbfa, 0x9ebabf2c, 0x1e153c6e, 0x86e34570, 0xeae96fb1,\n  0x860e5e0a, 0x5a3e2ab3, 0x771fe71c, 0x4e3d06fa, 0x2965dcb9, 0x99e71d0f,\n  0x803e89d6, 0x5266c825, 0x2e4cc978, 0x9c10b36a, 0xc6150eba, 0x94e2ea78,\n  0xa5fc3c53, 0x1e0a2df4, 0xf2f74ea7, 0x361d2b3d, 0x1939260f, 0x19c27960,\n  0x5223a708, 0xf71312b6, 0xebadfe6e, 0xeac31f66, 0xe3bc4595, 0xa67bc883,\n  0xb17f37d1, 0x018cff28, 0xc332ddef, 0xbe6c5aa5, 0x65582185, 0x68ab9802,\n  0xeecea50f, 0xdb2f953b, 0x2aef7dad, 0x5b6e2f84, 0x1521b628, 0x29076170,\n  0xecdd4775, 0x619f1510, 0x13cca830, 0xeb61bd96, 0x0334fe1e, 0xaa0363cf,\n  0xb5735c90, 0x4c70a239, 0xd59e9e0b, 0xcbaade14, 0xeecc86bc, 0x60622ca7,\n  0x9cab5cab, 0xb2f3846e, 0x648b1eaf, 0x19bdf0ca, 0xa02369b9, 0x655abb50,\n  0x40685a32, 0x3c2ab4b3, 0x319ee9d5, 0xc021b8f7, 0x9b540b19, 0x875fa099,\n  0x95f7997e, 0x623d7da8, 0xf837889a, 0x97e32d77, 0x11ed935f, 0x16681281,\n  0x0e358829, 0xc7e61fd6, 0x96dedfa1, 0x7858ba99, 0x57f584a5, 0x1b227263,\n  0x9b83c3ff, 0x1ac24696, 0xcdb30aeb, 0x532e3054, 0x8fd948e4, 0x6dbc3128,\n  0x58ebf2ef, 0x34c6ffea, 0xfe28ed61, 0xee7c3c73, 0x5d4a14d9, 0xe864b7e3,\n  0x42105d14, 0x203e13e0, 0x45eee2b6, 0xa3aaabea, 0xdb6c4f15, 0xfacb4fd0,\n  0xc742f442, 0xef6abbb5, 0x654f3b1d, 0x41cd2105, 0xd81e799e, 0x86854dc7,\n  0xe44b476a, 0x3d816250, 0xcf62a1f2, 0x5b8d2646, 0xfc8883a0, 0xc1c7b6a3,\n  0x7f1524c3, 0x69cb7492, 0x47848a0b, 0x5692b285, 0x095bbf00, 0xad19489d,\n  0x1462b174, 0x23820e00, 0x58428d2a, 0x0c55f5ea, 0x1dadf43e, 0x233f7061,\n  0x3372f092, 0x8d937e41, 0xd65fecf1, 0x6c223bdb, 0x7cde3759, 0xcbee7460,\n  0x4085f2a7, 0xce77326e, 0xa6078084, 0x19f8509e, 0xe8efd855, 0x61d99735,\n  0xa969a7aa, 0xc50c06c2, 0x5a04abfc, 0x800bcadc, 0x9e447a2e, 0xc3453484,\n  0xfdd56705, 0x0e1e9ec9, 0xdb73dbd3, 0x105588cd, 0x675fda79, 0xe3674340,\n  0xc5c43465, 0x713e38d8, 0x3d28f89e, 0xf16dff20, 0x153e21e7, 0x8fb03d4a,\n  0xe6e39f2b, 0xdb83adf7, 0xe93d5a68, 0x948140f7, 0xf64c261c, 0x94692934,\n  0x411520f7, 0x7602d4f7, 0xbcf46b2e, 0xd4a20068, 0xd4082471, 0x3320f46a,\n  0x43b7d4b7, 0x500061af, 0x1e39f62e, 0x97244546, 0x14214f74, 0xbf8b8840,\n  0x4d95fc1d, 0x96b591af, 0x70f4ddd3, 0x66a02f45, 0xbfbc09ec, 0x03bd9785,\n  0x7fac6dd0, 0x31cb8504, 0x96eb27b3, 0x55fd3941, 0xda2547e6, 0xabca0a9a,\n  0x28507825, 0x530429f4, 0x0a2c86da, 0xe9b66dfb, 0x68dc1462, 0xd7486900,\n  0x680ec0a4, 0x27a18dee, 0x4f3ffea2, 0xe887ad8c, 0xb58ce006, 0x7af4d6b6,\n  0xaace1e7c, 0xd3375fec, 0xce78a399, 0x406b2a42, 0x20fe9e35, 0xd9f385b9,\n  0xee39d7ab, 0x3b124e8b, 0x1dc9faf7, 0x4b6d1856, 0x26a36631, 0xeae397b2,\n  0x3a6efa74, 0xdd5b4332, 0x6841e7f7, 0xca7820fb, 0xfb0af54e, 0xd8feb397,\n  0x454056ac, 0xba489527, 0x55533a3a, 0x20838d87, 0xfe6ba9b7, 0xd096954b,\n  0x55a867bc, 0xa1159a58, 0xcca92963, 0x99e1db33, 0xa62a4a56, 0x3f3125f9,\n  0x5ef47e1c, 0x9029317c, 0xfdf8e802, 0x04272f70, 0x80bb155c, 0x05282ce3,\n  0x95c11548, 0xe4c66d22, 0x48c1133f, 0xc70f86dc, 0x07f9c9ee, 0x41041f0f,\n  0x404779a4, 0x5d886e17, 0x325f51eb, 0xd59bc0d1, 0xf2bcc18f, 0x41113564,\n  0x257b7834, 0x602a9c60, 0xdff8e8a3, 0x1f636c1b, 0x0e12b4c2, 0x02e1329e,\n  0xaf664fd1, 0xcad18115, 0x6b2395e0, 0x333e92e1, 0x3b240b62, 0xeebeb922,\n  0x85b2a20e, 0xe6ba0d99, 0xde720c8c, 0x2da2f728, 0xd0127845, 0x95b794fd,\n  0x647d0862, 0xe7ccf5f0, 0x5449a36f, 0x877d48fa, 0xc39dfd27, 0xf33e8d1e,\n  0x0a476341, 0x992eff74, 0x3a6f6eab, 0xf4f8fd37, 0xa812dc60, 0xa1ebddf8,\n  0x991be14c, 0xdb6e6b0d, 0xc67b5510, 0x6d672c37, 0x2765d43b, 0xdcd0e804,\n  0xf1290dc7, 0xcc00ffa3, 0xb5390f92, 0x690fed0b, 0x667b9ffb, 0xcedb7d9c,\n  0xa091cf0b, 0xd9155ea3, 0xbb132f88, 0x515bad24, 0x7b9479bf, 0x763bd6eb,\n  0x37392eb3, 0xcc115979, 0x8026e297, 0xf42e312d, 0x6842ada7, 0xc66a2b3b,\n  0x12754ccc, 0x782ef11c, 0x6a124237, 0xb79251e7, 0x06a1bbe6, 0x4bfb6350,\n  0x1a6b1018, 0x11caedfa, 0x3d25bdd8, 0xe2e1c3c9, 0x44421659, 0x0a121386,\n  0xd90cec6e, 0xd5abea2a, 0x64af674e, 0xda86a85f, 0xbebfe988, 0x64e4c3fe,\n  0x9dbc8057, 0xf0f7c086, 0x60787bf8, 0x6003604d, 0xd1fd8346, 0xf6381fb0,\n  0x7745ae04, 0xd736fccc, 0x83426b33, 0xf01eab71, 0xb0804187, 0x3c005e5f,\n  0x77a057be, 0xbde8ae24, 0x55464299, 0xbf582e61, 0x4e58f48f, 0xf2ddfda2,\n  0xf474ef38, 0x8789bdc2, 0x5366f9c3, 0xc8b38e74, 0xb475f255, 0x46fcd9b9,\n  0x7aeb2661, 0x8b1ddf84, 0x846a0e79, 0x915f95e2, 0x466e598e, 0x20b45770,\n  0x8cd55591, 0xc902de4c, 0xb90bace1, 0xbb8205d0, 0x11a86248, 0x7574a99e,\n  0xb77f19b6, 0xe0a9dc09, 0x662d09a1, 0xc4324633, 0xe85a1f02, 0x09f0be8c,\n  0x4a99a025, 0x1d6efe10, 0x1ab93d1d, 0x0ba5a4df, 0xa186f20f, 0x2868f169,\n  0xdcb7da83, 0x573906fe, 0xa1e2ce9b, 0x4fcd7f52, 0x50115e01, 0xa70683fa,\n  0xa002b5c4, 0x0de6d027, 0x9af88c27, 0x773f8641, 0xc3604c06, 0x61a806b5,\n  0xf0177a28, 0xc0f586e0, 0x006058aa, 0x30dc7d62, 0x11e69ed7, 0x2338ea63,\n  0x53c2dd94, 0xc2c21634, 0xbbcbee56, 0x90bcb6de, 0xebfc7da1, 0xce591d76,\n  0x6f05e409, 0x4b7c0188, 0x39720a3d, 0x7c927c24, 0x86e3725f, 0x724d9db9,\n  0x1ac15bb4, 0xd39eb8fc, 0xed545578, 0x08fca5b5, 0xd83d7cd3, 0x4dad0fc4,\n  0x1e50ef5e, 0xb161e6f8, 0xa28514d9, 0x6c51133c, 0x6fd5c7e7, 0x56e14ec4,\n  0x362abfce, 0xddc6c837, 0xd79a3234, 0x92638212, 0x670efa8e, 0x406000e0,\n  0x3a39ce37, 0xd3faf5cf, 0xabc27737, 0x5ac52d1b, 0x5cb0679e, 0x4fa33742,\n  0xd3822740, 0x99bc9bbe, 0xd5118e9d, 0xbf0f7315, 0xd62d1c7e, 0xc700c47b,\n  0xb78c1b6b, 0x21a19045, 0xb26eb1be, 0x6a366eb4, 0x5748ab2f, 0xbc946e79,\n  0xc6a376d2, 0x6549c2c8, 0x530ff8ee, 0x468dde7d, 0xd5730a1d, 0x4cd04dc6,\n  0x2939bbdb, 0xa9ba4650, 0xac9526e8, 0xbe5ee304, 0xa1fad5f0, 0x6a2d519a,\n  0x63ef8ce2, 0x9a86ee22, 0xc089c2b8, 0x43242ef6, 0xa51e03aa, 0x9cf2d0a4,\n  0x83c061ba, 0x9be96a4d, 0x8fe51550, 0xba645bd6, 0x2826a2f9, 0xa73a3ae1,\n  0x4ba99586, 0xef5562e9, 0xc72fefd3, 0xf752f7da, 0x3f046f69, 0x77fa0a59,\n  0x80e4a915, 0x87b08601, 0x9b09e6ad, 0x3b3ee593, 0xe990fd5a, 0x9e34d797,\n  0x2cf0b7d9, 0x022b8b51, 0x96d5ac3a, 0x017da67d, 0xd1cf3ed6, 0x7c7d2d28,\n  0x1f9f25cf, 0xadf2b89b, 0x5ad6b472, 0x5a88f54c, 0xe029ac71, 0xe019a5e6,\n  0x47b0acfd, 0xed93fa9b, 0xe8d3c48d, 0x283b57cc, 0xf8d56629, 0x79132e28,\n  0x785f0191, 0xed756055, 0xf7960e44, 0xe3d35e8c, 0x15056dd4, 0x88f46dba,\n  0x03a16125, 0x0564f0bd, 0xc3eb9e15, 0x3c9057a2, 0x97271aec, 0xa93a072a,\n  0x1b3f6d9b, 0x1e6321f5, 0xf59c66fb, 0x26dcf319, 0x7533d928, 0xb155fdf5,\n  0x03563482, 0x8aba3cbb, 0x28517711, 0xc20ad9f8, 0xabcc5167, 0xccad925f,\n  0x4de81751, 0x3830dc8e, 0x379d5862, 0x9320f991, 0xea7a90c2, 0xfb3e7bce,\n  0x5121ce64, 0x774fbe32, 0xa8b6e37e, 0xc3293d46, 0x48de5369, 0x6413e680,\n  0xa2ae0810, 0xdd6db224, 0x69852dfd, 0x09072166, 0xb39a460a, 0x6445c0dd,\n  0x586cdecf, 0x1c20c8ae, 0x5bbef7dd, 0x1b588d40, 0xccd2017f, 0x6bb4e3bb,\n  0xdda26a7e, 0x3a59ff45, 0x3e350a44, 0xbcb4cdd5, 0x72eacea8, 0xfa6484bb,\n  0x8d6612ae, 0xbf3c6f47, 0xd29be463, 0x542f5d9e, 0xaec2771b, 0xf64e6370,\n  0x740e0d8d, 0xe75b1357, 0xf8721671, 0xaf537d5d, 0x4040cb08, 0x4eb4e2cc,\n  0x34d2466a, 0x0115af84, 0xe1b00428, 0x95983a1d, 0x06b89fb4, 0xce6ea048,\n  0x6f3f3b82, 0x3520ab82, 0x011a1d4b, 0x277227f8, 0x611560b1, 0xe7933fdc,\n  0xbb3a792b, 0x344525bd, 0xa08839e1, 0x51ce794b, 0x2f32c9b7, 0xa01fbac9,\n  0xe01cc87e, 0xbcc7d1f6, 0xcf0111c3, 0xa1e8aac7, 0x1a908749, 0xd44fbd9a,\n  0xd0dadecb, 0xd50ada38, 0x0339c32a, 0xc6913667, 0x8df9317c, 0xe0b12b4f,\n  0xf79e59b7, 0x43f5bb3a, 0xf2d519ff, 0x27d9459c, 0xbf97222c, 0x15e6fc2a,\n  0x0f91fc71, 0x9b941525, 0xfae59361, 0xceb69ceb, 0xc2a86459, 0x12baa8d1,\n  0xb6c1075e, 0xe3056a0c, 0x10d25065, 0xcb03a442, 0xe0ec6e0e, 0x1698db3b,\n  0x4c98a0be, 0x3278e964, 0x9f1f9532, 0xe0d392df, 0xd3a0342b, 0x8971f21e,\n  0x1b0a7441, 0x4ba3348c, 0xc5be7120, 0xc37632d8, 0xdf359f8d, 0x9b992f2e,\n  0xe60b6f47, 0x0fe3f11d, 0xe54cda54, 0x1edad891, 0xce6279cf, 0xcd3e7e6f,\n  0x1618b166, 0xfd2c1d05, 0x848fd2c5, 0xf6fb2299, 0xf523f357, 0xa6327623,\n  0x93a83531, 0x56cccd02, 0xacf08162, 0x5a75ebb5, 0x6e163697, 0x88d273cc,\n  0xde966292, 0x81b949d0, 0x4c50901b, 0x71c65614, 0xe6c6c7bd, 0x327a140a,\n  0x45e1d006, 0xc3f27b9a, 0xc9aa53fd, 0x62a80f00, 0xbb25bfe2, 0x35bdd2f6,\n  0x71126905, 0xb2040222, 0xb6cbcf7c, 0xcd769c2b, 0x53113ec0, 0x1640e3d3,\n  0x38abbd60, 0x2547adf0, 0xba38209c, 0xf746ce76, 0x77afa1c5, 0x20756060,\n  0x85cbfe4e, 0x8ae88dd8, 0x7aaaf9b0, 0x4cf9aa7e, 0x1948c25c, 0x02fb8a8c,\n  0x01c36ae4, 0xd6ebe1f9, 0x90d4f869, 0xa65cdea0, 0x3f09252d, 0xc208e69f,\n  0xb74e6132, 0xce77e25b, 0x578fdfe3, 0x3ac372e6,\n];\n\n/**\n * @type {Array.<number>}\n * @const\n * @inner\n */\nvar C_ORIG = [\n  0x4f727068, 0x65616e42, 0x65686f6c, 0x64657253, 0x63727944, 0x6f756274,\n];\n\n/**\n * @param {Array.<number>} lr\n * @param {number} off\n * @param {Array.<number>} P\n * @param {Array.<number>} S\n * @returns {Array.<number>}\n * @inner\n */\nfunction _encipher(lr, off, P, S) {\n  // This is our bottleneck: 1714/1905 ticks / 90% - see profile.txt\n  var n,\n    l = lr[off],\n    r = lr[off + 1];\n\n  l ^= P[0];\n\n  /*\n    for (var i=0, k=BLOWFISH_NUM_ROUNDS-2; i<=k;)\n        // Feistel substitution on left word\n        n  = S[l >>> 24],\n        n += S[0x100 | ((l >> 16) & 0xff)],\n        n ^= S[0x200 | ((l >> 8) & 0xff)],\n        n += S[0x300 | (l & 0xff)],\n        r ^= n ^ P[++i],\n        // Feistel substitution on right word\n        n  = S[r >>> 24],\n        n += S[0x100 | ((r >> 16) & 0xff)],\n        n ^= S[0x200 | ((r >> 8) & 0xff)],\n        n += S[0x300 | (r & 0xff)],\n        l ^= n ^ P[++i];\n    */\n\n  //The following is an unrolled version of the above loop.\n  //Iteration 0\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[1];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[2];\n  //Iteration 1\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[3];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[4];\n  //Iteration 2\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[5];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[6];\n  //Iteration 3\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[7];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[8];\n  //Iteration 4\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[9];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[10];\n  //Iteration 5\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[11];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[12];\n  //Iteration 6\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[13];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[14];\n  //Iteration 7\n  n = S[l >>> 24];\n  n += S[0x100 | ((l >> 16) & 0xff)];\n  n ^= S[0x200 | ((l >> 8) & 0xff)];\n  n += S[0x300 | (l & 0xff)];\n  r ^= n ^ P[15];\n  n = S[r >>> 24];\n  n += S[0x100 | ((r >> 16) & 0xff)];\n  n ^= S[0x200 | ((r >> 8) & 0xff)];\n  n += S[0x300 | (r & 0xff)];\n  l ^= n ^ P[16];\n\n  lr[off] = r ^ P[BLOWFISH_NUM_ROUNDS + 1];\n  lr[off + 1] = l;\n  return lr;\n}\n\n/**\n * @param {Array.<number>} data\n * @param {number} offp\n * @returns {{key: number, offp: number}}\n * @inner\n */\nfunction _streamtoword(data, offp) {\n  for (var i = 0, word = 0; i < 4; ++i)\n    (word = (word << 8) | (data[offp] & 0xff)),\n      (offp = (offp + 1) % data.length);\n  return { key: word, offp: offp };\n}\n\n/**\n * @param {Array.<number>} key\n * @param {Array.<number>} P\n * @param {Array.<number>} S\n * @inner\n */\nfunction _key(key, P, S) {\n  var offset = 0,\n    lr = [0, 0],\n    plen = P.length,\n    slen = S.length,\n    sw;\n  for (var i = 0; i < plen; i++)\n    (sw = _streamtoword(key, offset)),\n      (offset = sw.offp),\n      (P[i] = P[i] ^ sw.key);\n  for (i = 0; i < plen; i += 2)\n    (lr = _encipher(lr, 0, P, S)), (P[i] = lr[0]), (P[i + 1] = lr[1]);\n  for (i = 0; i < slen; i += 2)\n    (lr = _encipher(lr, 0, P, S)), (S[i] = lr[0]), (S[i + 1] = lr[1]);\n}\n\n/**\n * Expensive key schedule Blowfish.\n * @param {Array.<number>} data\n * @param {Array.<number>} key\n * @param {Array.<number>} P\n * @param {Array.<number>} S\n * @inner\n */\nfunction _ekskey(data, key, P, S) {\n  var offp = 0,\n    lr = [0, 0],\n    plen = P.length,\n    slen = S.length,\n    sw;\n  for (var i = 0; i < plen; i++)\n    (sw = _streamtoword(key, offp)), (offp = sw.offp), (P[i] = P[i] ^ sw.key);\n  offp = 0;\n  for (i = 0; i < plen; i += 2)\n    (sw = _streamtoword(data, offp)),\n      (offp = sw.offp),\n      (lr[0] ^= sw.key),\n      (sw = _streamtoword(data, offp)),\n      (offp = sw.offp),\n      (lr[1] ^= sw.key),\n      (lr = _encipher(lr, 0, P, S)),\n      (P[i] = lr[0]),\n      (P[i + 1] = lr[1]);\n  for (i = 0; i < slen; i += 2)\n    (sw = _streamtoword(data, offp)),\n      (offp = sw.offp),\n      (lr[0] ^= sw.key),\n      (sw = _streamtoword(data, offp)),\n      (offp = sw.offp),\n      (lr[1] ^= sw.key),\n      (lr = _encipher(lr, 0, P, S)),\n      (S[i] = lr[0]),\n      (S[i + 1] = lr[1]);\n}\n\n/**\n * Internaly crypts a string.\n * @param {Array.<number>} b Bytes to crypt\n * @param {Array.<number>} salt Salt bytes to use\n * @param {number} rounds Number of rounds\n * @param {function(Error, Array.<number>=)=} callback Callback receiving the error, if any, and the resulting bytes. If\n *  omitted, the operation will be performed synchronously.\n *  @param {function(number)=} progressCallback Callback called with the current progress\n * @returns {!Array.<number>|undefined} Resulting bytes if callback has been omitted, otherwise `undefined`\n * @inner\n */\nfunction _crypt(b, salt, rounds, callback, progressCallback) {\n  var cdata = C_ORIG.slice(),\n    clen = cdata.length,\n    err;\n\n  // Validate\n  if (rounds < 4 || rounds > 31) {\n    err = Error(\"Illegal number of rounds (4-31): \" + rounds);\n    if (callback) {\n      nextTick(callback.bind(this, err));\n      return;\n    } else throw err;\n  }\n  if (salt.length !== BCRYPT_SALT_LEN) {\n    err = Error(\n      \"Illegal salt length: \" + salt.length + \" != \" + BCRYPT_SALT_LEN,\n    );\n    if (callback) {\n      nextTick(callback.bind(this, err));\n      return;\n    } else throw err;\n  }\n  rounds = (1 << rounds) >>> 0;\n\n  var P,\n    S,\n    i = 0,\n    j;\n\n  //Use typed arrays when available - huge speedup!\n  if (typeof Int32Array === \"function\") {\n    P = new Int32Array(P_ORIG);\n    S = new Int32Array(S_ORIG);\n  } else {\n    P = P_ORIG.slice();\n    S = S_ORIG.slice();\n  }\n\n  _ekskey(salt, b, P, S);\n\n  /**\n   * Calcualtes the next round.\n   * @returns {Array.<number>|undefined} Resulting array if callback has been omitted, otherwise `undefined`\n   * @inner\n   */\n  function next() {\n    if (progressCallback) progressCallback(i / rounds);\n    if (i < rounds) {\n      var start = Date.now();\n      for (; i < rounds; ) {\n        i = i + 1;\n        _key(b, P, S);\n        _key(salt, P, S);\n        if (Date.now() - start > MAX_EXECUTION_TIME) break;\n      }\n    } else {\n      for (i = 0; i < 64; i++)\n        for (j = 0; j < clen >> 1; j++) _encipher(cdata, j << 1, P, S);\n      var ret = [];\n      for (i = 0; i < clen; i++)\n        ret.push(((cdata[i] >> 24) & 0xff) >>> 0),\n          ret.push(((cdata[i] >> 16) & 0xff) >>> 0),\n          ret.push(((cdata[i] >> 8) & 0xff) >>> 0),\n          ret.push((cdata[i] & 0xff) >>> 0);\n      if (callback) {\n        callback(null, ret);\n        return;\n      } else return ret;\n    }\n    if (callback) nextTick(next);\n  }\n\n  // Async\n  if (typeof callback !== \"undefined\") {\n    next();\n\n    // Sync\n  } else {\n    var res;\n    while (true) if (typeof (res = next()) !== \"undefined\") return res || [];\n  }\n}\n\n/**\n * Internally hashes a password.\n * @param {string} password Password to hash\n * @param {?string} salt Salt to use, actually never null\n * @param {function(Error, string=)=} callback Callback receiving the error, if any, and the resulting hash. If omitted,\n *  hashing is performed synchronously.\n *  @param {function(number)=} progressCallback Callback called with the current progress\n * @returns {string|undefined} Resulting hash if callback has been omitted, otherwise `undefined`\n * @inner\n */\nfunction _hash(password, salt, callback, progressCallback) {\n  var err;\n  if (typeof password !== \"string\" || typeof salt !== \"string\") {\n    err = Error(\"Invalid string / salt: Not a string\");\n    if (callback) {\n      nextTick(callback.bind(this, err));\n      return;\n    } else throw err;\n  }\n\n  // Validate the salt\n  var minor, offset;\n  if (salt.charAt(0) !== \"$\" || salt.charAt(1) !== \"2\") {\n    err = Error(\"Invalid salt version: \" + salt.substring(0, 2));\n    if (callback) {\n      nextTick(callback.bind(this, err));\n      return;\n    } else throw err;\n  }\n  if (salt.charAt(2) === \"$\") (minor = String.fromCharCode(0)), (offset = 3);\n  else {\n    minor = salt.charAt(2);\n    if (\n      (minor !== \"a\" && minor !== \"b\" && minor !== \"y\") ||\n      salt.charAt(3) !== \"$\"\n    ) {\n      err = Error(\"Invalid salt revision: \" + salt.substring(2, 4));\n      if (callback) {\n        nextTick(callback.bind(this, err));\n        return;\n      } else throw err;\n    }\n    offset = 4;\n  }\n\n  // Extract number of rounds\n  if (salt.charAt(offset + 2) > \"$\") {\n    err = Error(\"Missing salt rounds\");\n    if (callback) {\n      nextTick(callback.bind(this, err));\n      return;\n    } else throw err;\n  }\n  var r1 = parseInt(salt.substring(offset, offset + 1), 10) * 10,\n    r2 = parseInt(salt.substring(offset + 1, offset + 2), 10),\n    rounds = r1 + r2,\n    real_salt = salt.substring(offset + 3, offset + 25);\n  password += minor >= \"a\" ? \"\\x00\" : \"\";\n\n  var passwordb = utf8Array(password),\n    saltb = base64_decode(real_salt, BCRYPT_SALT_LEN);\n\n  /**\n   * Finishes hashing.\n   * @param {Array.<number>} bytes Byte array\n   * @returns {string}\n   * @inner\n   */\n  function finish(bytes) {\n    var res = [];\n    res.push(\"$2\");\n    if (minor >= \"a\") res.push(minor);\n    res.push(\"$\");\n    if (rounds < 10) res.push(\"0\");\n    res.push(rounds.toString());\n    res.push(\"$\");\n    res.push(base64_encode(saltb, saltb.length));\n    res.push(base64_encode(bytes, C_ORIG.length * 4 - 1));\n    return res.join(\"\");\n  }\n\n  // Sync\n  if (typeof callback == \"undefined\")\n    return finish(_crypt(passwordb, saltb, rounds));\n  // Async\n  else {\n    _crypt(\n      passwordb,\n      saltb,\n      rounds,\n      function (err, bytes) {\n        if (err) callback(err, null);\n        else callback(null, finish(bytes));\n      },\n      progressCallback,\n    );\n  }\n}\n\n/**\n * Encodes a byte array to base64 with up to len bytes of input, using the custom bcrypt alphabet.\n * @function\n * @param {!Array.<number>} bytes Byte array\n * @param {number} length Maximum input length\n * @returns {string}\n */\nexport function encodeBase64(bytes, length) {\n  return base64_encode(bytes, length);\n}\n\n/**\n * Decodes a base64 encoded string to up to len bytes of output, using the custom bcrypt alphabet.\n * @function\n * @param {string} string String to decode\n * @param {number} length Maximum output length\n * @returns {!Array.<number>}\n */\nexport function decodeBase64(string, length) {\n  return base64_decode(string, length);\n}\n\nexport default {\n  setRandomFallback,\n  genSaltSync,\n  genSalt,\n  hashSync,\n  hash,\n  compareSync,\n  compare,\n  getRounds,\n  getSalt,\n  truncates,\n  encodeBase64,\n  decodeBase64,\n};\n", "//! otpauth 9.4.1 | (c) H\u00E9ctor Molinero Fern\u00E1ndez | MIT | https://github.com/hectorm/otpauth\n//! noble-hashes 1.8.0 | (c) Paul Miller | MIT | https://github.com/paulmillr/noble-hashes\n/// <reference types=\"./otpauth.d.ts\" />\n// @ts-nocheck\n/**\n * Converts an integer to an Uint8Array.\n * @param {number} num Integer.\n * @returns {Uint8Array} Uint8Array.\n */ const uintDecode = (num)=>{\n    const buf = new ArrayBuffer(8);\n    const arr = new Uint8Array(buf);\n    let acc = num;\n    for(let i = 7; i >= 0; i--){\n        if (acc === 0) break;\n        arr[i] = acc & 255;\n        acc -= arr[i];\n        acc /= 256;\n    }\n    return arr;\n};\n\n/**\n * Utilities for hex, bytes, CSPRNG.\n * @module\n */ /*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */ // We use WebCrypto aka globalThis.crypto, which exists in browsers and node.js 16+.\n// node.js versions earlier than v19 don't declare it in global scope.\n// For node.js, package.json#exports field mapping rewrites import\n// from `crypto` to `cryptoNode`, which imports native module.\n// Makes the utils un-importable in browsers without a bundler.\n// Once node.js 18 is deprecated (2025-04-30), we can just drop the import.\n/** Checks if something is Uint8Array. Be careful: nodejs Buffer will return true. */ function isBytes(a) {\n    return a instanceof Uint8Array || ArrayBuffer.isView(a) && a.constructor.name === 'Uint8Array';\n}\n/** Asserts something is positive integer. */ function anumber(n) {\n    if (!Number.isSafeInteger(n) || n < 0) throw new Error('positive integer expected, got ' + n);\n}\n/** Asserts something is Uint8Array. */ function abytes(b, ...lengths) {\n    if (!isBytes(b)) throw new Error('Uint8Array expected');\n    if (lengths.length > 0 && !lengths.includes(b.length)) throw new Error('Uint8Array expected of length ' + lengths + ', got length=' + b.length);\n}\n/** Asserts something is hash */ function ahash(h) {\n    if (typeof h !== 'function' || typeof h.create !== 'function') throw new Error('Hash should be wrapped by utils.createHasher');\n    anumber(h.outputLen);\n    anumber(h.blockLen);\n}\n/** Asserts a hash instance has not been destroyed / finished */ function aexists(instance, checkFinished = true) {\n    if (instance.destroyed) throw new Error('Hash instance has been destroyed');\n    if (checkFinished && instance.finished) throw new Error('Hash#digest() has already been called');\n}\n/** Asserts output is properly-sized byte array */ function aoutput(out, instance) {\n    abytes(out);\n    const min = instance.outputLen;\n    if (out.length < min) {\n        throw new Error('digestInto() expects output buffer of length at least ' + min);\n    }\n}\n/** Cast u8 / u16 / u32 to u32. */ function u32(arr) {\n    return new Uint32Array(arr.buffer, arr.byteOffset, Math.floor(arr.byteLength / 4));\n}\n/** Zeroize a byte array. Warning: JS provides no guarantees. */ function clean(...arrays) {\n    for(let i = 0; i < arrays.length; i++){\n        arrays[i].fill(0);\n    }\n}\n/** Create DataView of an array for easy byte-level manipulation. */ function createView(arr) {\n    return new DataView(arr.buffer, arr.byteOffset, arr.byteLength);\n}\n/** The rotate right (circular right shift) operation for uint32 */ function rotr(word, shift) {\n    return word << 32 - shift | word >>> shift;\n}\n/** The rotate left (circular left shift) operation for uint32 */ function rotl(word, shift) {\n    return word << shift | word >>> 32 - shift >>> 0;\n}\n/** Is current platform little-endian? Most are. Big-Endian platform: IBM */ const isLE = /* @__PURE__ */ (()=>new Uint8Array(new Uint32Array([\n        0x11223344\n    ]).buffer)[0] === 0x44)();\n/** The byte swap operation for uint32 */ function byteSwap(word) {\n    return word << 24 & 0xff000000 | word << 8 & 0xff0000 | word >>> 8 & 0xff00 | word >>> 24 & 0xff;\n}\n/** In place byte swap for Uint32Array */ function byteSwap32(arr) {\n    for(let i = 0; i < arr.length; i++){\n        arr[i] = byteSwap(arr[i]);\n    }\n    return arr;\n}\nconst swap32IfBE = isLE ? (u)=>u : byteSwap32;\n/**\n * Converts string to bytes using UTF8 encoding.\n * @example utf8ToBytes('abc') // Uint8Array.from([97, 98, 99])\n */ function utf8ToBytes(str) {\n    if (typeof str !== 'string') throw new Error('string expected');\n    return new Uint8Array(new TextEncoder().encode(str)); // https://bugzil.la/1681809\n}\n/**\n * Normalizes (non-hex) string or Uint8Array to Uint8Array.\n * Warning: when Uint8Array is passed, it would NOT get copied.\n * Keep in mind for future mutable operations.\n */ function toBytes(data) {\n    if (typeof data === 'string') data = utf8ToBytes(data);\n    abytes(data);\n    return data;\n}\n/** For runtime check if class implements interface */ class Hash {\n}\n/** Wraps hash function, creating an interface on top of it */ function createHasher(hashCons) {\n    const hashC = (msg)=>hashCons().update(toBytes(msg)).digest();\n    const tmp = hashCons();\n    hashC.outputLen = tmp.outputLen;\n    hashC.blockLen = tmp.blockLen;\n    hashC.create = ()=>hashCons();\n    return hashC;\n}\n\nclass HMAC extends Hash {\n    update(buf) {\n        aexists(this);\n        this.iHash.update(buf);\n        return this;\n    }\n    digestInto(out) {\n        aexists(this);\n        abytes(out, this.outputLen);\n        this.finished = true;\n        this.iHash.digestInto(out);\n        this.oHash.update(out);\n        this.oHash.digestInto(out);\n        this.destroy();\n    }\n    digest() {\n        const out = new Uint8Array(this.oHash.outputLen);\n        this.digestInto(out);\n        return out;\n    }\n    _cloneInto(to) {\n        // Create new instance without calling constructor since key already in state and we don't know it.\n        to || (to = Object.create(Object.getPrototypeOf(this), {}));\n        const { oHash, iHash, finished, destroyed, blockLen, outputLen } = this;\n        to = to;\n        to.finished = finished;\n        to.destroyed = destroyed;\n        to.blockLen = blockLen;\n        to.outputLen = outputLen;\n        to.oHash = oHash._cloneInto(to.oHash);\n        to.iHash = iHash._cloneInto(to.iHash);\n        return to;\n    }\n    clone() {\n        return this._cloneInto();\n    }\n    destroy() {\n        this.destroyed = true;\n        this.oHash.destroy();\n        this.iHash.destroy();\n    }\n    constructor(hash, _key){\n        super();\n        this.finished = false;\n        this.destroyed = false;\n        ahash(hash);\n        const key = toBytes(_key);\n        this.iHash = hash.create();\n        if (typeof this.iHash.update !== 'function') throw new Error('Expected instance of class which extends utils.Hash');\n        this.blockLen = this.iHash.blockLen;\n        this.outputLen = this.iHash.outputLen;\n        const blockLen = this.blockLen;\n        const pad = new Uint8Array(blockLen);\n        // blockLen can be bigger than outputLen\n        pad.set(key.length > blockLen ? hash.create().update(key).digest() : key);\n        for(let i = 0; i < pad.length; i++)pad[i] ^= 0x36;\n        this.iHash.update(pad);\n        // By doing update (processing of first block) of outer hash here we can re-use it between multiple calls via clone\n        this.oHash = hash.create();\n        // Undo internal XOR && apply outer XOR\n        for(let i = 0; i < pad.length; i++)pad[i] ^= 0x36 ^ 0x5c;\n        this.oHash.update(pad);\n        clean(pad);\n    }\n}\n/**\n * HMAC: RFC2104 message authentication code.\n * @param hash - function that would be used e.g. sha256\n * @param key - message key\n * @param message - message data\n * @example\n * import { hmac } from '@noble/hashes/hmac';\n * import { sha256 } from '@noble/hashes/sha2';\n * const mac1 = hmac(sha256, 'key', 'message');\n */ const hmac = (hash, key, message)=>new HMAC(hash, key).update(message).digest();\nhmac.create = (hash, key)=>new HMAC(hash, key);\n\n/** Polyfill for Safari 14. https://caniuse.com/mdn-javascript_builtins_dataview_setbiguint64 */ function setBigUint64(view, byteOffset, value, isLE) {\n    if (typeof view.setBigUint64 === 'function') return view.setBigUint64(byteOffset, value, isLE);\n    const _32n = BigInt(32);\n    const _u32_max = BigInt(0xffffffff);\n    const wh = Number(value >> _32n & _u32_max);\n    const wl = Number(value & _u32_max);\n    const h = isLE ? 4 : 0;\n    const l = isLE ? 0 : 4;\n    view.setUint32(byteOffset + h, wh, isLE);\n    view.setUint32(byteOffset + l, wl, isLE);\n}\n/** Choice: a ? b : c */ function Chi(a, b, c) {\n    return a & b ^ ~a & c;\n}\n/** Majority function, true if any two inputs is true. */ function Maj(a, b, c) {\n    return a & b ^ a & c ^ b & c;\n}\n/**\n * Merkle-Damgard hash construction base class.\n * Could be used to create MD5, RIPEMD, SHA1, SHA2.\n */ class HashMD extends Hash {\n    update(data) {\n        aexists(this);\n        data = toBytes(data);\n        abytes(data);\n        const { view, buffer, blockLen } = this;\n        const len = data.length;\n        for(let pos = 0; pos < len;){\n            const take = Math.min(blockLen - this.pos, len - pos);\n            // Fast path: we have at least one block in input, cast it to view and process\n            if (take === blockLen) {\n                const dataView = createView(data);\n                for(; blockLen <= len - pos; pos += blockLen)this.process(dataView, pos);\n                continue;\n            }\n            buffer.set(data.subarray(pos, pos + take), this.pos);\n            this.pos += take;\n            pos += take;\n            if (this.pos === blockLen) {\n                this.process(view, 0);\n                this.pos = 0;\n            }\n        }\n        this.length += data.length;\n        this.roundClean();\n        return this;\n    }\n    digestInto(out) {\n        aexists(this);\n        aoutput(out, this);\n        this.finished = true;\n        // Padding\n        // We can avoid allocation of buffer for padding completely if it\n        // was previously not allocated here. But it won't change performance.\n        const { buffer, view, blockLen, isLE } = this;\n        let { pos } = this;\n        // append the bit '1' to the message\n        buffer[pos++] = 0b10000000;\n        clean(this.buffer.subarray(pos));\n        // we have less than padOffset left in buffer, so we cannot put length in\n        // current block, need process it and pad again\n        if (this.padOffset > blockLen - pos) {\n            this.process(view, 0);\n            pos = 0;\n        }\n        // Pad until full block byte with zeros\n        for(let i = pos; i < blockLen; i++)buffer[i] = 0;\n        // Note: sha512 requires length to be 128bit integer, but length in JS will overflow before that\n        // You need to write around 2 exabytes (u64_max / 8 / (1024**6)) for this to happen.\n        // So we just write lowest 64 bits of that value.\n        setBigUint64(view, blockLen - 8, BigInt(this.length * 8), isLE);\n        this.process(view, 0);\n        const oview = createView(out);\n        const len = this.outputLen;\n        // NOTE: we do division by 4 later, which should be fused in single op with modulo by JIT\n        if (len % 4) throw new Error('_sha2: outputLen should be aligned to 32bit');\n        const outLen = len / 4;\n        const state = this.get();\n        if (outLen > state.length) throw new Error('_sha2: outputLen bigger than state');\n        for(let i = 0; i < outLen; i++)oview.setUint32(4 * i, state[i], isLE);\n    }\n    digest() {\n        const { buffer, outputLen } = this;\n        this.digestInto(buffer);\n        const res = buffer.slice(0, outputLen);\n        this.destroy();\n        return res;\n    }\n    _cloneInto(to) {\n        to || (to = new this.constructor());\n        to.set(...this.get());\n        const { blockLen, buffer, length, finished, destroyed, pos } = this;\n        to.destroyed = destroyed;\n        to.finished = finished;\n        to.length = length;\n        to.pos = pos;\n        if (length % blockLen) to.buffer.set(buffer);\n        return to;\n    }\n    clone() {\n        return this._cloneInto();\n    }\n    constructor(blockLen, outputLen, padOffset, isLE){\n        super();\n        this.finished = false;\n        this.length = 0;\n        this.pos = 0;\n        this.destroyed = false;\n        this.blockLen = blockLen;\n        this.outputLen = outputLen;\n        this.padOffset = padOffset;\n        this.isLE = isLE;\n        this.buffer = new Uint8Array(blockLen);\n        this.view = createView(this.buffer);\n    }\n}\n/**\n * Initial SHA-2 state: fractional parts of square roots of first 16 primes 2..53.\n * Check out `test/misc/sha2-gen-iv.js` for recomputation guide.\n */ /** Initial SHA256 state. Bits 0..32 of frac part of sqrt of primes 2..19 */ const SHA256_IV = /* @__PURE__ */ Uint32Array.from([\n    0x6a09e667,\n    0xbb67ae85,\n    0x3c6ef372,\n    0xa54ff53a,\n    0x510e527f,\n    0x9b05688c,\n    0x1f83d9ab,\n    0x5be0cd19\n]);\n/** Initial SHA224 state. Bits 32..64 of frac part of sqrt of primes 23..53 */ const SHA224_IV = /* @__PURE__ */ Uint32Array.from([\n    0xc1059ed8,\n    0x367cd507,\n    0x3070dd17,\n    0xf70e5939,\n    0xffc00b31,\n    0x68581511,\n    0x64f98fa7,\n    0xbefa4fa4\n]);\n/** Initial SHA384 state. Bits 0..64 of frac part of sqrt of primes 23..53 */ const SHA384_IV = /* @__PURE__ */ Uint32Array.from([\n    0xcbbb9d5d,\n    0xc1059ed8,\n    0x629a292a,\n    0x367cd507,\n    0x9159015a,\n    0x3070dd17,\n    0x152fecd8,\n    0xf70e5939,\n    0x67332667,\n    0xffc00b31,\n    0x8eb44a87,\n    0x68581511,\n    0xdb0c2e0d,\n    0x64f98fa7,\n    0x47b5481d,\n    0xbefa4fa4\n]);\n/** Initial SHA512 state. Bits 0..64 of frac part of sqrt of primes 2..19 */ const SHA512_IV = /* @__PURE__ */ Uint32Array.from([\n    0x6a09e667,\n    0xf3bcc908,\n    0xbb67ae85,\n    0x84caa73b,\n    0x3c6ef372,\n    0xfe94f82b,\n    0xa54ff53a,\n    0x5f1d36f1,\n    0x510e527f,\n    0xade682d1,\n    0x9b05688c,\n    0x2b3e6c1f,\n    0x1f83d9ab,\n    0xfb41bd6b,\n    0x5be0cd19,\n    0x137e2179\n]);\n\n/** Initial SHA1 state */ const SHA1_IV = /* @__PURE__ */ Uint32Array.from([\n    0x67452301,\n    0xefcdab89,\n    0x98badcfe,\n    0x10325476,\n    0xc3d2e1f0\n]);\n// Reusable temporary buffer\nconst SHA1_W = /* @__PURE__ */ new Uint32Array(80);\n/** SHA1 legacy hash class. */ class SHA1 extends HashMD {\n    get() {\n        const { A, B, C, D, E } = this;\n        return [\n            A,\n            B,\n            C,\n            D,\n            E\n        ];\n    }\n    set(A, B, C, D, E) {\n        this.A = A | 0;\n        this.B = B | 0;\n        this.C = C | 0;\n        this.D = D | 0;\n        this.E = E | 0;\n    }\n    process(view, offset) {\n        for(let i = 0; i < 16; i++, offset += 4)SHA1_W[i] = view.getUint32(offset, false);\n        for(let i = 16; i < 80; i++)SHA1_W[i] = rotl(SHA1_W[i - 3] ^ SHA1_W[i - 8] ^ SHA1_W[i - 14] ^ SHA1_W[i - 16], 1);\n        // Compression function main loop, 80 rounds\n        let { A, B, C, D, E } = this;\n        for(let i = 0; i < 80; i++){\n            let F, K;\n            if (i < 20) {\n                F = Chi(B, C, D);\n                K = 0x5a827999;\n            } else if (i < 40) {\n                F = B ^ C ^ D;\n                K = 0x6ed9eba1;\n            } else if (i < 60) {\n                F = Maj(B, C, D);\n                K = 0x8f1bbcdc;\n            } else {\n                F = B ^ C ^ D;\n                K = 0xca62c1d6;\n            }\n            const T = rotl(A, 5) + F + E + K + SHA1_W[i] | 0;\n            E = D;\n            D = C;\n            C = rotl(B, 30);\n            B = A;\n            A = T;\n        }\n        // Add the compressed chunk to the current hash value\n        A = A + this.A | 0;\n        B = B + this.B | 0;\n        C = C + this.C | 0;\n        D = D + this.D | 0;\n        E = E + this.E | 0;\n        this.set(A, B, C, D, E);\n    }\n    roundClean() {\n        clean(SHA1_W);\n    }\n    destroy() {\n        this.set(0, 0, 0, 0, 0);\n        clean(this.buffer);\n    }\n    constructor(){\n        super(64, 20, 8, false);\n        this.A = SHA1_IV[0] | 0;\n        this.B = SHA1_IV[1] | 0;\n        this.C = SHA1_IV[2] | 0;\n        this.D = SHA1_IV[3] | 0;\n        this.E = SHA1_IV[4] | 0;\n    }\n}\n/** SHA1 (RFC 3174) legacy hash function. It was cryptographically broken. */ const sha1 = /* @__PURE__ */ createHasher(()=>new SHA1());\n\n/**\n * Internal helpers for u64. BigUint64Array is too slow as per 2025, so we implement it using Uint32Array.\n * @todo re-check https://issues.chromium.org/issues/42212588\n * @module\n */ const U32_MASK64 = /* @__PURE__ */ BigInt(2 ** 32 - 1);\nconst _32n = /* @__PURE__ */ BigInt(32);\nfunction fromBig(n, le = false) {\n    if (le) return {\n        h: Number(n & U32_MASK64),\n        l: Number(n >> _32n & U32_MASK64)\n    };\n    return {\n        h: Number(n >> _32n & U32_MASK64) | 0,\n        l: Number(n & U32_MASK64) | 0\n    };\n}\nfunction split(lst, le = false) {\n    const len = lst.length;\n    let Ah = new Uint32Array(len);\n    let Al = new Uint32Array(len);\n    for(let i = 0; i < len; i++){\n        const { h, l } = fromBig(lst[i], le);\n        [Ah[i], Al[i]] = [\n            h,\n            l\n        ];\n    }\n    return [\n        Ah,\n        Al\n    ];\n}\n// for Shift in [0, 32)\nconst shrSH = (h, _l, s)=>h >>> s;\nconst shrSL = (h, l, s)=>h << 32 - s | l >>> s;\n// Right rotate for Shift in [1, 32)\nconst rotrSH = (h, l, s)=>h >>> s | l << 32 - s;\nconst rotrSL = (h, l, s)=>h << 32 - s | l >>> s;\n// Right rotate for Shift in (32, 64), NOTE: 32 is special case.\nconst rotrBH = (h, l, s)=>h << 64 - s | l >>> s - 32;\nconst rotrBL = (h, l, s)=>h >>> s - 32 | l << 64 - s;\n// Left rotate for Shift in [1, 32)\nconst rotlSH = (h, l, s)=>h << s | l >>> 32 - s;\nconst rotlSL = (h, l, s)=>l << s | h >>> 32 - s;\n// Left rotate for Shift in (32, 64), NOTE: 32 is special case.\nconst rotlBH = (h, l, s)=>l << s - 32 | h >>> 64 - s;\nconst rotlBL = (h, l, s)=>h << s - 32 | l >>> 64 - s;\n// JS uses 32-bit signed integers for bitwise operations which means we cannot\n// simple take carry out of low bit sum by shift, we need to use division.\nfunction add(Ah, Al, Bh, Bl) {\n    const l = (Al >>> 0) + (Bl >>> 0);\n    return {\n        h: Ah + Bh + (l / 2 ** 32 | 0) | 0,\n        l: l | 0\n    };\n}\n// Addition with more than 2 elements\nconst add3L = (Al, Bl, Cl)=>(Al >>> 0) + (Bl >>> 0) + (Cl >>> 0);\nconst add3H = (low, Ah, Bh, Ch)=>Ah + Bh + Ch + (low / 2 ** 32 | 0) | 0;\nconst add4L = (Al, Bl, Cl, Dl)=>(Al >>> 0) + (Bl >>> 0) + (Cl >>> 0) + (Dl >>> 0);\nconst add4H = (low, Ah, Bh, Ch, Dh)=>Ah + Bh + Ch + Dh + (low / 2 ** 32 | 0) | 0;\nconst add5L = (Al, Bl, Cl, Dl, El)=>(Al >>> 0) + (Bl >>> 0) + (Cl >>> 0) + (Dl >>> 0) + (El >>> 0);\nconst add5H = (low, Ah, Bh, Ch, Dh, Eh)=>Ah + Bh + Ch + Dh + Eh + (low / 2 ** 32 | 0) | 0;\n\n/**\n * Round constants:\n * First 32 bits of fractional parts of the cube roots of the first 64 primes 2..311)\n */ // prettier-ignore\nconst SHA256_K = /* @__PURE__ */ Uint32Array.from([\n    0x428a2f98,\n    0x71374491,\n    0xb5c0fbcf,\n    0xe9b5dba5,\n    0x3956c25b,\n    0x59f111f1,\n    0x923f82a4,\n    0xab1c5ed5,\n    0xd807aa98,\n    0x12835b01,\n    0x243185be,\n    0x550c7dc3,\n    0x72be5d74,\n    0x80deb1fe,\n    0x9bdc06a7,\n    0xc19bf174,\n    0xe49b69c1,\n    0xefbe4786,\n    0x0fc19dc6,\n    0x240ca1cc,\n    0x2de92c6f,\n    0x4a7484aa,\n    0x5cb0a9dc,\n    0x76f988da,\n    0x983e5152,\n    0xa831c66d,\n    0xb00327c8,\n    0xbf597fc7,\n    0xc6e00bf3,\n    0xd5a79147,\n    0x06ca6351,\n    0x14292967,\n    0x27b70a85,\n    0x2e1b2138,\n    0x4d2c6dfc,\n    0x53380d13,\n    0x650a7354,\n    0x766a0abb,\n    0x81c2c92e,\n    0x92722c85,\n    0xa2bfe8a1,\n    0xa81a664b,\n    0xc24b8b70,\n    0xc76c51a3,\n    0xd192e819,\n    0xd6990624,\n    0xf40e3585,\n    0x106aa070,\n    0x19a4c116,\n    0x1e376c08,\n    0x2748774c,\n    0x34b0bcb5,\n    0x391c0cb3,\n    0x4ed8aa4a,\n    0x5b9cca4f,\n    0x682e6ff3,\n    0x748f82ee,\n    0x78a5636f,\n    0x84c87814,\n    0x8cc70208,\n    0x90befffa,\n    0xa4506ceb,\n    0xbef9a3f7,\n    0xc67178f2\n]);\n/** Reusable temporary buffer. \"W\" comes straight from spec. */ const SHA256_W = /* @__PURE__ */ new Uint32Array(64);\nclass SHA256 extends HashMD {\n    get() {\n        const { A, B, C, D, E, F, G, H } = this;\n        return [\n            A,\n            B,\n            C,\n            D,\n            E,\n            F,\n            G,\n            H\n        ];\n    }\n    // prettier-ignore\n    set(A, B, C, D, E, F, G, H) {\n        this.A = A | 0;\n        this.B = B | 0;\n        this.C = C | 0;\n        this.D = D | 0;\n        this.E = E | 0;\n        this.F = F | 0;\n        this.G = G | 0;\n        this.H = H | 0;\n    }\n    process(view, offset) {\n        // Extend the first 16 words into the remaining 48 words w[16..63] of the message schedule array\n        for(let i = 0; i < 16; i++, offset += 4)SHA256_W[i] = view.getUint32(offset, false);\n        for(let i = 16; i < 64; i++){\n            const W15 = SHA256_W[i - 15];\n            const W2 = SHA256_W[i - 2];\n            const s0 = rotr(W15, 7) ^ rotr(W15, 18) ^ W15 >>> 3;\n            const s1 = rotr(W2, 17) ^ rotr(W2, 19) ^ W2 >>> 10;\n            SHA256_W[i] = s1 + SHA256_W[i - 7] + s0 + SHA256_W[i - 16] | 0;\n        }\n        // Compression function main loop, 64 rounds\n        let { A, B, C, D, E, F, G, H } = this;\n        for(let i = 0; i < 64; i++){\n            const sigma1 = rotr(E, 6) ^ rotr(E, 11) ^ rotr(E, 25);\n            const T1 = H + sigma1 + Chi(E, F, G) + SHA256_K[i] + SHA256_W[i] | 0;\n            const sigma0 = rotr(A, 2) ^ rotr(A, 13) ^ rotr(A, 22);\n            const T2 = sigma0 + Maj(A, B, C) | 0;\n            H = G;\n            G = F;\n            F = E;\n            E = D + T1 | 0;\n            D = C;\n            C = B;\n            B = A;\n            A = T1 + T2 | 0;\n        }\n        // Add the compressed chunk to the current hash value\n        A = A + this.A | 0;\n        B = B + this.B | 0;\n        C = C + this.C | 0;\n        D = D + this.D | 0;\n        E = E + this.E | 0;\n        F = F + this.F | 0;\n        G = G + this.G | 0;\n        H = H + this.H | 0;\n        this.set(A, B, C, D, E, F, G, H);\n    }\n    roundClean() {\n        clean(SHA256_W);\n    }\n    destroy() {\n        this.set(0, 0, 0, 0, 0, 0, 0, 0);\n        clean(this.buffer);\n    }\n    constructor(outputLen = 32){\n        super(64, outputLen, 8, false);\n        // We cannot use array here since array allows indexing by variable\n        // which means optimizer/compiler cannot use registers.\n        this.A = SHA256_IV[0] | 0;\n        this.B = SHA256_IV[1] | 0;\n        this.C = SHA256_IV[2] | 0;\n        this.D = SHA256_IV[3] | 0;\n        this.E = SHA256_IV[4] | 0;\n        this.F = SHA256_IV[5] | 0;\n        this.G = SHA256_IV[6] | 0;\n        this.H = SHA256_IV[7] | 0;\n    }\n}\nclass SHA224 extends SHA256 {\n    constructor(){\n        super(28);\n        this.A = SHA224_IV[0] | 0;\n        this.B = SHA224_IV[1] | 0;\n        this.C = SHA224_IV[2] | 0;\n        this.D = SHA224_IV[3] | 0;\n        this.E = SHA224_IV[4] | 0;\n        this.F = SHA224_IV[5] | 0;\n        this.G = SHA224_IV[6] | 0;\n        this.H = SHA224_IV[7] | 0;\n    }\n}\n// SHA2-512 is slower than sha256 in js because u64 operations are slow.\n// Round contants\n// First 32 bits of the fractional parts of the cube roots of the first 80 primes 2..409\n// prettier-ignore\nconst K512 = /* @__PURE__ */ (()=>split([\n        '0x428a2f98d728ae22',\n        '0x7137449123ef65cd',\n        '0xb5c0fbcfec4d3b2f',\n        '0xe9b5dba58189dbbc',\n        '0x3956c25bf348b538',\n        '0x59f111f1b605d019',\n        '0x923f82a4af194f9b',\n        '0xab1c5ed5da6d8118',\n        '0xd807aa98a3030242',\n        '0x12835b0145706fbe',\n        '0x243185be4ee4b28c',\n        '0x550c7dc3d5ffb4e2',\n        '0x72be5d74f27b896f',\n        '0x80deb1fe3b1696b1',\n        '0x9bdc06a725c71235',\n        '0xc19bf174cf692694',\n        '0xe49b69c19ef14ad2',\n        '0xefbe4786384f25e3',\n        '0x0fc19dc68b8cd5b5',\n        '0x240ca1cc77ac9c65',\n        '0x2de92c6f592b0275',\n        '0x4a7484aa6ea6e483',\n        '0x5cb0a9dcbd41fbd4',\n        '0x76f988da831153b5',\n        '0x983e5152ee66dfab',\n        '0xa831c66d2db43210',\n        '0xb00327c898fb213f',\n        '0xbf597fc7beef0ee4',\n        '0xc6e00bf33da88fc2',\n        '0xd5a79147930aa725',\n        '0x06ca6351e003826f',\n        '0x142929670a0e6e70',\n        '0x27b70a8546d22ffc',\n        '0x2e1b21385c26c926',\n        '0x4d2c6dfc5ac42aed',\n        '0x53380d139d95b3df',\n        '0x650a73548baf63de',\n        '0x766a0abb3c77b2a8',\n        '0x81c2c92e47edaee6',\n        '0x92722c851482353b',\n        '0xa2bfe8a14cf10364',\n        '0xa81a664bbc423001',\n        '0xc24b8b70d0f89791',\n        '0xc76c51a30654be30',\n        '0xd192e819d6ef5218',\n        '0xd69906245565a910',\n        '0xf40e35855771202a',\n        '0x106aa07032bbd1b8',\n        '0x19a4c116b8d2d0c8',\n        '0x1e376c085141ab53',\n        '0x2748774cdf8eeb99',\n        '0x34b0bcb5e19b48a8',\n        '0x391c0cb3c5c95a63',\n        '0x4ed8aa4ae3418acb',\n        '0x5b9cca4f7763e373',\n        '0x682e6ff3d6b2b8a3',\n        '0x748f82ee5defb2fc',\n        '0x78a5636f43172f60',\n        '0x84c87814a1f0ab72',\n        '0x8cc702081a6439ec',\n        '0x90befffa23631e28',\n        '0xa4506cebde82bde9',\n        '0xbef9a3f7b2c67915',\n        '0xc67178f2e372532b',\n        '0xca273eceea26619c',\n        '0xd186b8c721c0c207',\n        '0xeada7dd6cde0eb1e',\n        '0xf57d4f7fee6ed178',\n        '0x06f067aa72176fba',\n        '0x0a637dc5a2c898a6',\n        '0x113f9804bef90dae',\n        '0x1b710b35131c471b',\n        '0x28db77f523047d84',\n        '0x32caab7b40c72493',\n        '0x3c9ebe0a15c9bebc',\n        '0x431d67c49c100d4c',\n        '0x4cc5d4becb3e42b6',\n        '0x597f299cfc657e2a',\n        '0x5fcb6fab3ad6faec',\n        '0x6c44198c4a475817'\n    ].map((n)=>BigInt(n))))();\nconst SHA512_Kh = /* @__PURE__ */ (()=>K512[0])();\nconst SHA512_Kl = /* @__PURE__ */ (()=>K512[1])();\n// Reusable temporary buffers\nconst SHA512_W_H = /* @__PURE__ */ new Uint32Array(80);\nconst SHA512_W_L = /* @__PURE__ */ new Uint32Array(80);\nclass SHA512 extends HashMD {\n    // prettier-ignore\n    get() {\n        const { Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl } = this;\n        return [\n            Ah,\n            Al,\n            Bh,\n            Bl,\n            Ch,\n            Cl,\n            Dh,\n            Dl,\n            Eh,\n            El,\n            Fh,\n            Fl,\n            Gh,\n            Gl,\n            Hh,\n            Hl\n        ];\n    }\n    // prettier-ignore\n    set(Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl) {\n        this.Ah = Ah | 0;\n        this.Al = Al | 0;\n        this.Bh = Bh | 0;\n        this.Bl = Bl | 0;\n        this.Ch = Ch | 0;\n        this.Cl = Cl | 0;\n        this.Dh = Dh | 0;\n        this.Dl = Dl | 0;\n        this.Eh = Eh | 0;\n        this.El = El | 0;\n        this.Fh = Fh | 0;\n        this.Fl = Fl | 0;\n        this.Gh = Gh | 0;\n        this.Gl = Gl | 0;\n        this.Hh = Hh | 0;\n        this.Hl = Hl | 0;\n    }\n    process(view, offset) {\n        // Extend the first 16 words into the remaining 64 words w[16..79] of the message schedule array\n        for(let i = 0; i < 16; i++, offset += 4){\n            SHA512_W_H[i] = view.getUint32(offset);\n            SHA512_W_L[i] = view.getUint32(offset += 4);\n        }\n        for(let i = 16; i < 80; i++){\n            // s0 := (w[i-15] rightrotate 1) xor (w[i-15] rightrotate 8) xor (w[i-15] rightshift 7)\n            const W15h = SHA512_W_H[i - 15] | 0;\n            const W15l = SHA512_W_L[i - 15] | 0;\n            const s0h = rotrSH(W15h, W15l, 1) ^ rotrSH(W15h, W15l, 8) ^ shrSH(W15h, W15l, 7);\n            const s0l = rotrSL(W15h, W15l, 1) ^ rotrSL(W15h, W15l, 8) ^ shrSL(W15h, W15l, 7);\n            // s1 := (w[i-2] rightrotate 19) xor (w[i-2] rightrotate 61) xor (w[i-2] rightshift 6)\n            const W2h = SHA512_W_H[i - 2] | 0;\n            const W2l = SHA512_W_L[i - 2] | 0;\n            const s1h = rotrSH(W2h, W2l, 19) ^ rotrBH(W2h, W2l, 61) ^ shrSH(W2h, W2l, 6);\n            const s1l = rotrSL(W2h, W2l, 19) ^ rotrBL(W2h, W2l, 61) ^ shrSL(W2h, W2l, 6);\n            // SHA256_W[i] = s0 + s1 + SHA256_W[i - 7] + SHA256_W[i - 16];\n            const SUMl = add4L(s0l, s1l, SHA512_W_L[i - 7], SHA512_W_L[i - 16]);\n            const SUMh = add4H(SUMl, s0h, s1h, SHA512_W_H[i - 7], SHA512_W_H[i - 16]);\n            SHA512_W_H[i] = SUMh | 0;\n            SHA512_W_L[i] = SUMl | 0;\n        }\n        let { Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl } = this;\n        // Compression function main loop, 80 rounds\n        for(let i = 0; i < 80; i++){\n            // S1 := (e rightrotate 14) xor (e rightrotate 18) xor (e rightrotate 41)\n            const sigma1h = rotrSH(Eh, El, 14) ^ rotrSH(Eh, El, 18) ^ rotrBH(Eh, El, 41);\n            const sigma1l = rotrSL(Eh, El, 14) ^ rotrSL(Eh, El, 18) ^ rotrBL(Eh, El, 41);\n            //const T1 = (H + sigma1 + Chi(E, F, G) + SHA256_K[i] + SHA256_W[i]) | 0;\n            const CHIh = Eh & Fh ^ ~Eh & Gh;\n            const CHIl = El & Fl ^ ~El & Gl;\n            // T1 = H + sigma1 + Chi(E, F, G) + SHA512_K[i] + SHA512_W[i]\n            // prettier-ignore\n            const T1ll = add5L(Hl, sigma1l, CHIl, SHA512_Kl[i], SHA512_W_L[i]);\n            const T1h = add5H(T1ll, Hh, sigma1h, CHIh, SHA512_Kh[i], SHA512_W_H[i]);\n            const T1l = T1ll | 0;\n            // S0 := (a rightrotate 28) xor (a rightrotate 34) xor (a rightrotate 39)\n            const sigma0h = rotrSH(Ah, Al, 28) ^ rotrBH(Ah, Al, 34) ^ rotrBH(Ah, Al, 39);\n            const sigma0l = rotrSL(Ah, Al, 28) ^ rotrBL(Ah, Al, 34) ^ rotrBL(Ah, Al, 39);\n            const MAJh = Ah & Bh ^ Ah & Ch ^ Bh & Ch;\n            const MAJl = Al & Bl ^ Al & Cl ^ Bl & Cl;\n            Hh = Gh | 0;\n            Hl = Gl | 0;\n            Gh = Fh | 0;\n            Gl = Fl | 0;\n            Fh = Eh | 0;\n            Fl = El | 0;\n            ({ h: Eh, l: El } = add(Dh | 0, Dl | 0, T1h | 0, T1l | 0));\n            Dh = Ch | 0;\n            Dl = Cl | 0;\n            Ch = Bh | 0;\n            Cl = Bl | 0;\n            Bh = Ah | 0;\n            Bl = Al | 0;\n            const All = add3L(T1l, sigma0l, MAJl);\n            Ah = add3H(All, T1h, sigma0h, MAJh);\n            Al = All | 0;\n        }\n        // Add the compressed chunk to the current hash value\n        ({ h: Ah, l: Al } = add(this.Ah | 0, this.Al | 0, Ah | 0, Al | 0));\n        ({ h: Bh, l: Bl } = add(this.Bh | 0, this.Bl | 0, Bh | 0, Bl | 0));\n        ({ h: Ch, l: Cl } = add(this.Ch | 0, this.Cl | 0, Ch | 0, Cl | 0));\n        ({ h: Dh, l: Dl } = add(this.Dh | 0, this.Dl | 0, Dh | 0, Dl | 0));\n        ({ h: Eh, l: El } = add(this.Eh | 0, this.El | 0, Eh | 0, El | 0));\n        ({ h: Fh, l: Fl } = add(this.Fh | 0, this.Fl | 0, Fh | 0, Fl | 0));\n        ({ h: Gh, l: Gl } = add(this.Gh | 0, this.Gl | 0, Gh | 0, Gl | 0));\n        ({ h: Hh, l: Hl } = add(this.Hh | 0, this.Hl | 0, Hh | 0, Hl | 0));\n        this.set(Ah, Al, Bh, Bl, Ch, Cl, Dh, Dl, Eh, El, Fh, Fl, Gh, Gl, Hh, Hl);\n    }\n    roundClean() {\n        clean(SHA512_W_H, SHA512_W_L);\n    }\n    destroy() {\n        clean(this.buffer);\n        this.set(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);\n    }\n    constructor(outputLen = 64){\n        super(128, outputLen, 16, false);\n        // We cannot use array here since array allows indexing by variable\n        // which means optimizer/compiler cannot use registers.\n        // h -- high 32 bits, l -- low 32 bits\n        this.Ah = SHA512_IV[0] | 0;\n        this.Al = SHA512_IV[1] | 0;\n        this.Bh = SHA512_IV[2] | 0;\n        this.Bl = SHA512_IV[3] | 0;\n        this.Ch = SHA512_IV[4] | 0;\n        this.Cl = SHA512_IV[5] | 0;\n        this.Dh = SHA512_IV[6] | 0;\n        this.Dl = SHA512_IV[7] | 0;\n        this.Eh = SHA512_IV[8] | 0;\n        this.El = SHA512_IV[9] | 0;\n        this.Fh = SHA512_IV[10] | 0;\n        this.Fl = SHA512_IV[11] | 0;\n        this.Gh = SHA512_IV[12] | 0;\n        this.Gl = SHA512_IV[13] | 0;\n        this.Hh = SHA512_IV[14] | 0;\n        this.Hl = SHA512_IV[15] | 0;\n    }\n}\nclass SHA384 extends SHA512 {\n    constructor(){\n        super(48);\n        this.Ah = SHA384_IV[0] | 0;\n        this.Al = SHA384_IV[1] | 0;\n        this.Bh = SHA384_IV[2] | 0;\n        this.Bl = SHA384_IV[3] | 0;\n        this.Ch = SHA384_IV[4] | 0;\n        this.Cl = SHA384_IV[5] | 0;\n        this.Dh = SHA384_IV[6] | 0;\n        this.Dl = SHA384_IV[7] | 0;\n        this.Eh = SHA384_IV[8] | 0;\n        this.El = SHA384_IV[9] | 0;\n        this.Fh = SHA384_IV[10] | 0;\n        this.Fl = SHA384_IV[11] | 0;\n        this.Gh = SHA384_IV[12] | 0;\n        this.Gl = SHA384_IV[13] | 0;\n        this.Hh = SHA384_IV[14] | 0;\n        this.Hl = SHA384_IV[15] | 0;\n    }\n}\n/**\n * SHA2-256 hash function from RFC 4634.\n *\n * It is the fastest JS hash, even faster than Blake3.\n * To break sha256 using birthday attack, attackers need to try 2^128 hashes.\n * BTC network is doing 2^70 hashes/sec (2^95 hashes/year) as per 2025.\n */ const sha256 = /* @__PURE__ */ createHasher(()=>new SHA256());\n/** SHA2-224 hash function from RFC 4634 */ const sha224 = /* @__PURE__ */ createHasher(()=>new SHA224());\n/** SHA2-512 hash function from RFC 4634. */ const sha512 = /* @__PURE__ */ createHasher(()=>new SHA512());\n/** SHA2-384 hash function from RFC 4634. */ const sha384 = /* @__PURE__ */ createHasher(()=>new SHA384());\n\n// No __PURE__ annotations in sha3 header:\n// EVERYTHING is in fact used on every export.\n// Various per round constants calculations\nconst _0n = BigInt(0);\nconst _1n = BigInt(1);\nconst _2n = BigInt(2);\nconst _7n = BigInt(7);\nconst _256n = BigInt(256);\nconst _0x71n = BigInt(0x71);\nconst SHA3_PI = [];\nconst SHA3_ROTL = [];\nconst _SHA3_IOTA = [];\nfor(let round = 0, R = _1n, x = 1, y = 0; round < 24; round++){\n    // Pi\n    [x, y] = [\n        y,\n        (2 * x + 3 * y) % 5\n    ];\n    SHA3_PI.push(2 * (5 * y + x));\n    // Rotational\n    SHA3_ROTL.push((round + 1) * (round + 2) / 2 % 64);\n    // Iota\n    let t = _0n;\n    for(let j = 0; j < 7; j++){\n        R = (R << _1n ^ (R >> _7n) * _0x71n) % _256n;\n        if (R & _2n) t ^= _1n << (_1n << /* @__PURE__ */ BigInt(j)) - _1n;\n    }\n    _SHA3_IOTA.push(t);\n}\nconst IOTAS = split(_SHA3_IOTA, true);\nconst SHA3_IOTA_H = IOTAS[0];\nconst SHA3_IOTA_L = IOTAS[1];\n// Left rotation (without 0, 32, 64)\nconst rotlH = (h, l, s)=>s > 32 ? rotlBH(h, l, s) : rotlSH(h, l, s);\nconst rotlL = (h, l, s)=>s > 32 ? rotlBL(h, l, s) : rotlSL(h, l, s);\n/** `keccakf1600` internal function, additionally allows to adjust round count. */ function keccakP(s, rounds = 24) {\n    const B = new Uint32Array(5 * 2);\n    // NOTE: all indices are x2 since we store state as u32 instead of u64 (bigints to slow in js)\n    for(let round = 24 - rounds; round < 24; round++){\n        // Theta \u03B8\n        for(let x = 0; x < 10; x++)B[x] = s[x] ^ s[x + 10] ^ s[x + 20] ^ s[x + 30] ^ s[x + 40];\n        for(let x = 0; x < 10; x += 2){\n            const idx1 = (x + 8) % 10;\n            const idx0 = (x + 2) % 10;\n            const B0 = B[idx0];\n            const B1 = B[idx0 + 1];\n            const Th = rotlH(B0, B1, 1) ^ B[idx1];\n            const Tl = rotlL(B0, B1, 1) ^ B[idx1 + 1];\n            for(let y = 0; y < 50; y += 10){\n                s[x + y] ^= Th;\n                s[x + y + 1] ^= Tl;\n            }\n        }\n        // Rho (\u03C1) and Pi (\u03C0)\n        let curH = s[2];\n        let curL = s[3];\n        for(let t = 0; t < 24; t++){\n            const shift = SHA3_ROTL[t];\n            const Th = rotlH(curH, curL, shift);\n            const Tl = rotlL(curH, curL, shift);\n            const PI = SHA3_PI[t];\n            curH = s[PI];\n            curL = s[PI + 1];\n            s[PI] = Th;\n            s[PI + 1] = Tl;\n        }\n        // Chi (\u03C7)\n        for(let y = 0; y < 50; y += 10){\n            for(let x = 0; x < 10; x++)B[x] = s[y + x];\n            for(let x = 0; x < 10; x++)s[y + x] ^= ~B[(x + 2) % 10] & B[(x + 4) % 10];\n        }\n        // Iota (\u03B9)\n        s[0] ^= SHA3_IOTA_H[round];\n        s[1] ^= SHA3_IOTA_L[round];\n    }\n    clean(B);\n}\n/** Keccak sponge function. */ class Keccak extends Hash {\n    clone() {\n        return this._cloneInto();\n    }\n    keccak() {\n        swap32IfBE(this.state32);\n        keccakP(this.state32, this.rounds);\n        swap32IfBE(this.state32);\n        this.posOut = 0;\n        this.pos = 0;\n    }\n    update(data) {\n        aexists(this);\n        data = toBytes(data);\n        abytes(data);\n        const { blockLen, state } = this;\n        const len = data.length;\n        for(let pos = 0; pos < len;){\n            const take = Math.min(blockLen - this.pos, len - pos);\n            for(let i = 0; i < take; i++)state[this.pos++] ^= data[pos++];\n            if (this.pos === blockLen) this.keccak();\n        }\n        return this;\n    }\n    finish() {\n        if (this.finished) return;\n        this.finished = true;\n        const { state, suffix, pos, blockLen } = this;\n        // Do the padding\n        state[pos] ^= suffix;\n        if ((suffix & 0x80) !== 0 && pos === blockLen - 1) this.keccak();\n        state[blockLen - 1] ^= 0x80;\n        this.keccak();\n    }\n    writeInto(out) {\n        aexists(this, false);\n        abytes(out);\n        this.finish();\n        const bufferOut = this.state;\n        const { blockLen } = this;\n        for(let pos = 0, len = out.length; pos < len;){\n            if (this.posOut >= blockLen) this.keccak();\n            const take = Math.min(blockLen - this.posOut, len - pos);\n            out.set(bufferOut.subarray(this.posOut, this.posOut + take), pos);\n            this.posOut += take;\n            pos += take;\n        }\n        return out;\n    }\n    xofInto(out) {\n        // Sha3/Keccak usage with XOF is probably mistake, only SHAKE instances can do XOF\n        if (!this.enableXOF) throw new Error('XOF is not possible for this instance');\n        return this.writeInto(out);\n    }\n    xof(bytes) {\n        anumber(bytes);\n        return this.xofInto(new Uint8Array(bytes));\n    }\n    digestInto(out) {\n        aoutput(out, this);\n        if (this.finished) throw new Error('digest() was already called');\n        this.writeInto(out);\n        this.destroy();\n        return out;\n    }\n    digest() {\n        return this.digestInto(new Uint8Array(this.outputLen));\n    }\n    destroy() {\n        this.destroyed = true;\n        clean(this.state);\n    }\n    _cloneInto(to) {\n        const { blockLen, suffix, outputLen, rounds, enableXOF } = this;\n        to || (to = new Keccak(blockLen, suffix, outputLen, enableXOF, rounds));\n        to.state32.set(this.state32);\n        to.pos = this.pos;\n        to.posOut = this.posOut;\n        to.finished = this.finished;\n        to.rounds = rounds;\n        // Suffix can change in cSHAKE\n        to.suffix = suffix;\n        to.outputLen = outputLen;\n        to.enableXOF = enableXOF;\n        to.destroyed = this.destroyed;\n        return to;\n    }\n    // NOTE: we accept arguments in bytes instead of bits here.\n    constructor(blockLen, suffix, outputLen, enableXOF = false, rounds = 24){\n        super();\n        this.pos = 0;\n        this.posOut = 0;\n        this.finished = false;\n        this.destroyed = false;\n        this.enableXOF = false;\n        this.blockLen = blockLen;\n        this.suffix = suffix;\n        this.outputLen = outputLen;\n        this.enableXOF = enableXOF;\n        this.rounds = rounds;\n        // Can be passed from user as dkLen\n        anumber(outputLen);\n        // 1600 = 5x5 matrix of 64bit.  1600 bits === 200 bytes\n        // 0 < blockLen < 200\n        if (!(0 < blockLen && blockLen < 200)) throw new Error('only keccak-f1600 function is supported');\n        this.state = new Uint8Array(200);\n        this.state32 = u32(this.state);\n    }\n}\nconst gen = (suffix, blockLen, outputLen)=>createHasher(()=>new Keccak(blockLen, suffix, outputLen));\n/** SHA3-224 hash function. */ const sha3_224 = /* @__PURE__ */ (()=>gen(0x06, 144, 224 / 8))();\n/** SHA3-256 hash function. Different from keccak-256. */ const sha3_256 = /* @__PURE__ */ (()=>gen(0x06, 136, 256 / 8))();\n/** SHA3-384 hash function. */ const sha3_384 = /* @__PURE__ */ (()=>gen(0x06, 104, 384 / 8))();\n/** SHA3-512 hash function. */ const sha3_512 = /* @__PURE__ */ (()=>gen(0x06, 72, 512 / 8))();\n\n/**\n * \"globalThis\" ponyfill.\n * @see [A horrifying globalThis polyfill in universal JavaScript](https://mathiasbynens.be/notes/globalthis)\n * @type {Object.<string, *>}\n */ const globalScope = (()=>{\n    if (typeof globalThis === \"object\") return globalThis;\n    else {\n        Object.defineProperty(Object.prototype, \"__GLOBALTHIS__\", {\n            get () {\n                return this;\n            },\n            configurable: true\n        });\n        try {\n            // @ts-expect-error\n            // eslint-disable-next-line no-undef\n            if (typeof __GLOBALTHIS__ !== \"undefined\") return __GLOBALTHIS__;\n        } finally{\n            // @ts-expect-error\n            delete Object.prototype.__GLOBALTHIS__;\n        }\n    }\n    // Still unable to determine \"globalThis\", fall back to a naive method.\n    if (typeof self !== \"undefined\") return self;\n    else if (typeof window !== \"undefined\") return window;\n    else if (typeof global !== \"undefined\") return global;\n    return undefined;\n})();\n\n/**\n * @noble/hashes hash functions.\n * @type {Object.<string, sha1|sha224|sha256|sha384|sha512|sha3_224|sha3_256|sha3_384|sha3_512>}\n */ const nobleHashes = {\n    SHA1: sha1,\n    SHA224: sha224,\n    SHA256: sha256,\n    SHA384: sha384,\n    SHA512: sha512,\n    \"SHA3-224\": sha3_224,\n    \"SHA3-256\": sha3_256,\n    \"SHA3-384\": sha3_384,\n    \"SHA3-512\": sha3_512\n};\n/**\n * Canonicalizes a hash algorithm name.\n * @param {string} algorithm Hash algorithm name.\n * @returns {\"SHA1\"|\"SHA224\"|\"SHA256\"|\"SHA384\"|\"SHA512\"|\"SHA3-224\"|\"SHA3-256\"|\"SHA3-384\"|\"SHA3-512\"} Canonicalized hash algorithm name.\n */ const canonicalizeAlgorithm = (algorithm)=>{\n    switch(true){\n        case /^(?:SHA-?1|SSL3-SHA1)$/i.test(algorithm):\n            return \"SHA1\";\n        case /^SHA(?:2?-)?224$/i.test(algorithm):\n            return \"SHA224\";\n        case /^SHA(?:2?-)?256$/i.test(algorithm):\n            return \"SHA256\";\n        case /^SHA(?:2?-)?384$/i.test(algorithm):\n            return \"SHA384\";\n        case /^SHA(?:2?-)?512$/i.test(algorithm):\n            return \"SHA512\";\n        case /^SHA3-224$/i.test(algorithm):\n            return \"SHA3-224\";\n        case /^SHA3-256$/i.test(algorithm):\n            return \"SHA3-256\";\n        case /^SHA3-384$/i.test(algorithm):\n            return \"SHA3-384\";\n        case /^SHA3-512$/i.test(algorithm):\n            return \"SHA3-512\";\n        default:\n            throw new TypeError(`Unknown hash algorithm: ${algorithm}`);\n    }\n};\n/**\n * Calculates an HMAC digest.\n * @param {string} algorithm Algorithm.\n * @param {Uint8Array} key Key.\n * @param {Uint8Array} message Message.\n * @returns {Uint8Array} Digest.\n */ const hmacDigest = (algorithm, key, message)=>{\n    if (hmac) {\n        const hash = nobleHashes[algorithm] ?? nobleHashes[canonicalizeAlgorithm(algorithm)];\n        return hmac(hash, key, message);\n    } else {\n        throw new Error(\"Missing HMAC function\");\n    }\n};\n\n/**\n * RFC 4648 base32 alphabet without pad.\n * @type {string}\n */ const ALPHABET = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\";\n/**\n * Converts a base32 string to an Uint8Array (RFC 4648).\n * @see [LinusU/base32-decode](https://github.com/LinusU/base32-decode)\n * @param {string} str Base32 string.\n * @returns {Uint8Array} Uint8Array.\n */ const base32Decode = (str)=>{\n    // Remove spaces (although they are not allowed by the spec, some issuers add them for readability).\n    str = str.replace(/ /g, \"\");\n    // Canonicalize to all upper case and remove padding if it exists.\n    let end = str.length;\n    while(str[end - 1] === \"=\")--end;\n    str = (end < str.length ? str.substring(0, end) : str).toUpperCase();\n    const buf = new ArrayBuffer(str.length * 5 / 8 | 0);\n    const arr = new Uint8Array(buf);\n    let bits = 0;\n    let value = 0;\n    let index = 0;\n    for(let i = 0; i < str.length; i++){\n        const idx = ALPHABET.indexOf(str[i]);\n        if (idx === -1) throw new TypeError(`Invalid character found: ${str[i]}`);\n        value = value << 5 | idx;\n        bits += 5;\n        if (bits >= 8) {\n            bits -= 8;\n            arr[index++] = value >>> bits;\n        }\n    }\n    return arr;\n};\n/**\n * Converts an Uint8Array to a base32 string (RFC 4648).\n * @see [LinusU/base32-encode](https://github.com/LinusU/base32-encode)\n * @param {Uint8Array} arr Uint8Array.\n * @returns {string} Base32 string.\n */ const base32Encode = (arr)=>{\n    let bits = 0;\n    let value = 0;\n    let str = \"\";\n    for(let i = 0; i < arr.length; i++){\n        value = value << 8 | arr[i];\n        bits += 8;\n        while(bits >= 5){\n            str += ALPHABET[value >>> bits - 5 & 31];\n            bits -= 5;\n        }\n    }\n    if (bits > 0) {\n        str += ALPHABET[value << 5 - bits & 31];\n    }\n    return str;\n};\n\n/**\n * Converts a hexadecimal string to an Uint8Array.\n * @param {string} str Hexadecimal string.\n * @returns {Uint8Array} Uint8Array.\n */ const hexDecode = (str)=>{\n    // Remove spaces (although they are not allowed by the spec, some issuers add them for readability).\n    str = str.replace(/ /g, \"\");\n    const buf = new ArrayBuffer(str.length / 2);\n    const arr = new Uint8Array(buf);\n    for(let i = 0; i < str.length; i += 2){\n        arr[i / 2] = parseInt(str.substring(i, i + 2), 16);\n    }\n    return arr;\n};\n/**\n * Converts an Uint8Array to a hexadecimal string.\n * @param {Uint8Array} arr Uint8Array.\n * @returns {string} Hexadecimal string.\n */ const hexEncode = (arr)=>{\n    let str = \"\";\n    for(let i = 0; i < arr.length; i++){\n        const hex = arr[i].toString(16);\n        if (hex.length === 1) str += \"0\";\n        str += hex;\n    }\n    return str.toUpperCase();\n};\n\n/**\n * Converts a Latin-1 string to an Uint8Array.\n * @param {string} str Latin-1 string.\n * @returns {Uint8Array} Uint8Array.\n */ const latin1Decode = (str)=>{\n    const buf = new ArrayBuffer(str.length);\n    const arr = new Uint8Array(buf);\n    for(let i = 0; i < str.length; i++){\n        arr[i] = str.charCodeAt(i) & 0xff;\n    }\n    return arr;\n};\n/**\n * Converts an Uint8Array to a Latin-1 string.\n * @param {Uint8Array} arr Uint8Array.\n * @returns {string} Latin-1 string.\n */ const latin1Encode = (arr)=>{\n    let str = \"\";\n    for(let i = 0; i < arr.length; i++){\n        str += String.fromCharCode(arr[i]);\n    }\n    return str;\n};\n\n/**\n * TextEncoder instance.\n * @type {TextEncoder|null}\n */ const ENCODER = globalScope.TextEncoder ? new globalScope.TextEncoder() : null;\n/**\n * TextDecoder instance.\n * @type {TextDecoder|null}\n */ const DECODER = globalScope.TextDecoder ? new globalScope.TextDecoder() : null;\n/**\n * Converts an UTF-8 string to an Uint8Array.\n * @param {string} str String.\n * @returns {Uint8Array} Uint8Array.\n */ const utf8Decode = (str)=>{\n    if (!ENCODER) {\n        throw new Error(\"Encoding API not available\");\n    }\n    return ENCODER.encode(str);\n};\n/**\n * Converts an Uint8Array to an UTF-8 string.\n * @param {Uint8Array} arr Uint8Array.\n * @returns {string} String.\n */ const utf8Encode = (arr)=>{\n    if (!DECODER) {\n        throw new Error(\"Encoding API not available\");\n    }\n    return DECODER.decode(arr);\n};\n\n/**\n * Returns random bytes.\n * @param {number} size Size.\n * @returns {Uint8Array} Random bytes.\n */ const randomBytes = (size)=>{\n    if (globalScope.crypto?.getRandomValues) {\n        return globalScope.crypto.getRandomValues(new Uint8Array(size));\n    } else {\n        throw new Error(\"Cryptography API not available\");\n    }\n};\n\n/**\n * OTP secret key.\n */ class Secret {\n    /**\n   * Converts a Latin-1 string to a Secret object.\n   * @param {string} str Latin-1 string.\n   * @returns {Secret} Secret object.\n   */ static fromLatin1(str) {\n        return new Secret({\n            buffer: latin1Decode(str).buffer\n        });\n    }\n    /**\n   * Converts an UTF-8 string to a Secret object.\n   * @param {string} str UTF-8 string.\n   * @returns {Secret} Secret object.\n   */ static fromUTF8(str) {\n        return new Secret({\n            buffer: utf8Decode(str).buffer\n        });\n    }\n    /**\n   * Converts a base32 string to a Secret object.\n   * @param {string} str Base32 string.\n   * @returns {Secret} Secret object.\n   */ static fromBase32(str) {\n        return new Secret({\n            buffer: base32Decode(str).buffer\n        });\n    }\n    /**\n   * Converts a hexadecimal string to a Secret object.\n   * @param {string} str Hexadecimal string.\n   * @returns {Secret} Secret object.\n   */ static fromHex(str) {\n        return new Secret({\n            buffer: hexDecode(str).buffer\n        });\n    }\n    /**\n   * Secret key buffer.\n   * @deprecated For backward compatibility, the \"bytes\" property should be used instead.\n   * @type {ArrayBufferLike}\n   */ get buffer() {\n        return this.bytes.buffer;\n    }\n    /**\n   * Latin-1 string representation of secret key.\n   * @type {string}\n   */ get latin1() {\n        Object.defineProperty(this, \"latin1\", {\n            enumerable: true,\n            writable: false,\n            configurable: false,\n            value: latin1Encode(this.bytes)\n        });\n        return this.latin1;\n    }\n    /**\n   * UTF-8 string representation of secret key.\n   * @type {string}\n   */ get utf8() {\n        Object.defineProperty(this, \"utf8\", {\n            enumerable: true,\n            writable: false,\n            configurable: false,\n            value: utf8Encode(this.bytes)\n        });\n        return this.utf8;\n    }\n    /**\n   * Base32 string representation of secret key.\n   * @type {string}\n   */ get base32() {\n        Object.defineProperty(this, \"base32\", {\n            enumerable: true,\n            writable: false,\n            configurable: false,\n            value: base32Encode(this.bytes)\n        });\n        return this.base32;\n    }\n    /**\n   * Hexadecimal string representation of secret key.\n   * @type {string}\n   */ get hex() {\n        Object.defineProperty(this, \"hex\", {\n            enumerable: true,\n            writable: false,\n            configurable: false,\n            value: hexEncode(this.bytes)\n        });\n        return this.hex;\n    }\n    /**\n   * Creates a secret key object.\n   * @param {Object} [config] Configuration options.\n   * @param {ArrayBufferLike} [config.buffer] Secret key buffer.\n   * @param {number} [config.size=20] Number of random bytes to generate, ignored if 'buffer' is provided.\n   */ constructor({ buffer, size = 20 } = {}){\n        /**\n     * Secret key.\n     * @type {Uint8Array}\n     * @readonly\n     */ this.bytes = typeof buffer === \"undefined\" ? randomBytes(size) : new Uint8Array(buffer);\n        // Prevent the \"bytes\" property from being modified.\n        Object.defineProperty(this, \"bytes\", {\n            enumerable: true,\n            writable: false,\n            configurable: false,\n            value: this.bytes\n        });\n    }\n}\n\n/**\n * Returns true if a is equal to b, without leaking timing information that would allow an attacker to guess one of the values.\n * @param {string} a String a.\n * @param {string} b String b.\n * @returns {boolean} Equality result.\n */ const timingSafeEqual = (a, b)=>{\n    {\n        if (a.length !== b.length) {\n            throw new TypeError(\"Input strings must have the same length\");\n        }\n        let i = -1;\n        let out = 0;\n        while(++i < a.length){\n            out |= a.charCodeAt(i) ^ b.charCodeAt(i);\n        }\n        return out === 0;\n    }\n};\n\n/**\n * HOTP: An HMAC-based One-time Password Algorithm.\n * @see [RFC 4226](https://datatracker.ietf.org/doc/html/rfc4226)\n */ class HOTP {\n    /**\n   * Default configuration.\n   * @type {{\n   *   issuer: string,\n   *   label: string,\n   *   issuerInLabel: boolean,\n   *   algorithm: string,\n   *   digits: number,\n   *   counter: number\n   *   window: number\n   * }}\n   */ static get defaults() {\n        return {\n            issuer: \"\",\n            label: \"OTPAuth\",\n            issuerInLabel: true,\n            algorithm: \"SHA1\",\n            digits: 6,\n            counter: 0,\n            window: 1\n        };\n    }\n    /**\n   * Generates an HOTP token.\n   * @param {Object} config Configuration options.\n   * @param {Secret} config.secret Secret key.\n   * @param {string} [config.algorithm='SHA1'] HMAC hashing algorithm.\n   * @param {number} [config.digits=6] Token length.\n   * @param {number} [config.counter=0] Counter value.\n   * @returns {string} Token.\n   */ static generate({ secret, algorithm = HOTP.defaults.algorithm, digits = HOTP.defaults.digits, counter = HOTP.defaults.counter }) {\n        const digest = hmacDigest(algorithm, secret.bytes, uintDecode(counter));\n        const offset = digest[digest.byteLength - 1] & 15;\n        const otp = ((digest[offset] & 127) << 24 | (digest[offset + 1] & 255) << 16 | (digest[offset + 2] & 255) << 8 | digest[offset + 3] & 255) % 10 ** digits;\n        return otp.toString().padStart(digits, \"0\");\n    }\n    /**\n   * Generates an HOTP token.\n   * @param {Object} [config] Configuration options.\n   * @param {number} [config.counter=this.counter++] Counter value.\n   * @returns {string} Token.\n   */ generate({ counter = this.counter++ } = {}) {\n        return HOTP.generate({\n            secret: this.secret,\n            algorithm: this.algorithm,\n            digits: this.digits,\n            counter\n        });\n    }\n    /**\n   * Validates an HOTP token.\n   * @param {Object} config Configuration options.\n   * @param {string} config.token Token value.\n   * @param {Secret} config.secret Secret key.\n   * @param {string} [config.algorithm='SHA1'] HMAC hashing algorithm.\n   * @param {number} [config.digits=6] Token length.\n   * @param {number} [config.counter=0] Counter value.\n   * @param {number} [config.window=1] Window of counter values to test.\n   * @returns {number|null} Token delta or null if it is not found in the search window, in which case it should be considered invalid.\n   */ static validate({ token, secret, algorithm, digits = HOTP.defaults.digits, counter = HOTP.defaults.counter, window = HOTP.defaults.window }) {\n        // Return early if the token length does not match the digit number.\n        if (token.length !== digits) return null;\n        let delta = null;\n        const check = (/** @type {number} */ i)=>{\n            const generatedToken = HOTP.generate({\n                secret,\n                algorithm,\n                digits,\n                counter: i\n            });\n            if (timingSafeEqual(token, generatedToken)) {\n                delta = i - counter;\n            }\n        };\n        check(counter);\n        for(let i = 1; i <= window && delta === null; ++i){\n            check(counter - i);\n            if (delta !== null) break;\n            check(counter + i);\n            if (delta !== null) break;\n        }\n        return delta;\n    }\n    /**\n   * Validates an HOTP token.\n   * @param {Object} config Configuration options.\n   * @param {string} config.token Token value.\n   * @param {number} [config.counter=this.counter] Counter value.\n   * @param {number} [config.window=1] Window of counter values to test.\n   * @returns {number|null} Token delta or null if it is not found in the search window, in which case it should be considered invalid.\n   */ validate({ token, counter = this.counter, window }) {\n        return HOTP.validate({\n            token,\n            secret: this.secret,\n            algorithm: this.algorithm,\n            digits: this.digits,\n            counter,\n            window\n        });\n    }\n    /**\n   * Returns a Google Authenticator key URI.\n   * @returns {string} URI.\n   */ toString() {\n        const e = encodeURIComponent;\n        return \"otpauth://hotp/\" + `${this.issuer.length > 0 ? this.issuerInLabel ? `${e(this.issuer)}:${e(this.label)}?issuer=${e(this.issuer)}&` : `${e(this.label)}?issuer=${e(this.issuer)}&` : `${e(this.label)}?`}` + `secret=${e(this.secret.base32)}&` + `algorithm=${e(this.algorithm)}&` + `digits=${e(this.digits)}&` + `counter=${e(this.counter)}`;\n    }\n    /**\n   * Creates an HOTP object.\n   * @param {Object} [config] Configuration options.\n   * @param {string} [config.issuer=''] Account provider.\n   * @param {string} [config.label='OTPAuth'] Account label.\n   * @param {boolean} [config.issuerInLabel=true] Include issuer prefix in label.\n   * @param {Secret|string} [config.secret=Secret] Secret key.\n   * @param {string} [config.algorithm='SHA1'] HMAC hashing algorithm.\n   * @param {number} [config.digits=6] Token length.\n   * @param {number} [config.counter=0] Initial counter value.\n   */ constructor({ issuer = HOTP.defaults.issuer, label = HOTP.defaults.label, issuerInLabel = HOTP.defaults.issuerInLabel, secret = new Secret(), algorithm = HOTP.defaults.algorithm, digits = HOTP.defaults.digits, counter = HOTP.defaults.counter } = {}){\n        /**\n     * Account provider.\n     * @type {string}\n     */ this.issuer = issuer;\n        /**\n     * Account label.\n     * @type {string}\n     */ this.label = label;\n        /**\n     * Include issuer prefix in label.\n     * @type {boolean}\n     */ this.issuerInLabel = issuerInLabel;\n        /**\n     * Secret key.\n     * @type {Secret}\n     */ this.secret = typeof secret === \"string\" ? Secret.fromBase32(secret) : secret;\n        /**\n     * HMAC hashing algorithm.\n     * @type {string}\n     */ this.algorithm = canonicalizeAlgorithm(algorithm);\n        /**\n     * Token length.\n     * @type {number}\n     */ this.digits = digits;\n        /**\n     * Initial counter value.\n     * @type {number}\n     */ this.counter = counter;\n    }\n}\n\n/**\n * TOTP: Time-Based One-Time Password Algorithm.\n * @see [RFC 6238](https://datatracker.ietf.org/doc/html/rfc6238)\n */ class TOTP {\n    /**\n   * Default configuration.\n   * @type {{\n   *   issuer: string,\n   *   label: string,\n   *   issuerInLabel: boolean,\n   *   algorithm: string,\n   *   digits: number,\n   *   period: number\n   *   window: number\n   * }}\n   */ static get defaults() {\n        return {\n            issuer: \"\",\n            label: \"OTPAuth\",\n            issuerInLabel: true,\n            algorithm: \"SHA1\",\n            digits: 6,\n            period: 30,\n            window: 1\n        };\n    }\n    /**\n   * Calculates the counter. i.e. the number of periods since timestamp 0.\n   * @param {Object} [config] Configuration options.\n   * @param {number} [config.period=30] Token time-step duration.\n   * @param {number} [config.timestamp=Date.now] Timestamp value in milliseconds.\n   * @returns {number} Counter.\n   */ static counter({ period = TOTP.defaults.period, timestamp = Date.now() } = {}) {\n        return Math.floor(timestamp / 1000 / period);\n    }\n    /**\n   * Calculates the counter. i.e. the number of periods since timestamp 0.\n   * @param {Object} [config] Configuration options.\n   * @param {number} [config.timestamp=Date.now] Timestamp value in milliseconds.\n   * @returns {number} Counter.\n   */ counter({ timestamp = Date.now() } = {}) {\n        return TOTP.counter({\n            period: this.period,\n            timestamp\n        });\n    }\n    /**\n   * Calculates the remaining time in milliseconds until the next token is generated.\n   * @param {Object} [config] Configuration options.\n   * @param {number} [config.period=30] Token time-step duration.\n   * @param {number} [config.timestamp=Date.now] Timestamp value in milliseconds.\n   * @returns {number} counter.\n   */ static remaining({ period = TOTP.defaults.period, timestamp = Date.now() } = {}) {\n        return period * 1000 - timestamp % (period * 1000);\n    }\n    /**\n   * Calculates the remaining time in milliseconds until the next token is generated.\n   * @param {Object} [config] Configuration options.\n   * @param {number} [config.timestamp=Date.now] Timestamp value in milliseconds.\n   * @returns {number} counter.\n   */ remaining({ timestamp = Date.now() } = {}) {\n        return TOTP.remaining({\n            period: this.period,\n            timestamp\n        });\n    }\n    /**\n   * Generates a TOTP token.\n   * @param {Object} config Configuration options.\n   * @param {Secret} config.secret Secret key.\n   * @param {string} [config.algorithm='SHA1'] HMAC hashing algorithm.\n   * @param {number} [config.digits=6] Token length.\n   * @param {number} [config.period=30] Token time-step duration.\n   * @param {number} [config.timestamp=Date.now] Timestamp value in milliseconds.\n   * @returns {string} Token.\n   */ static generate({ secret, algorithm, digits, period = TOTP.defaults.period, timestamp = Date.now() }) {\n        return HOTP.generate({\n            secret,\n            algorithm,\n            digits,\n            counter: TOTP.counter({\n                period,\n                timestamp\n            })\n        });\n    }\n    /**\n   * Generates a TOTP token.\n   * @param {Object} [config] Configuration options.\n   * @param {number} [config.timestamp=Date.now] Timestamp value in milliseconds.\n   * @returns {string} Token.\n   */ generate({ timestamp = Date.now() } = {}) {\n        return TOTP.generate({\n            secret: this.secret,\n            algorithm: this.algorithm,\n            digits: this.digits,\n            period: this.period,\n            timestamp\n        });\n    }\n    /**\n   * Validates a TOTP token.\n   * @param {Object} config Configuration options.\n   * @param {string} config.token Token value.\n   * @param {Secret} config.secret Secret key.\n   * @param {string} [config.algorithm='SHA1'] HMAC hashing algorithm.\n   * @param {number} [config.digits=6] Token length.\n   * @param {number} [config.period=30] Token time-step duration.\n   * @param {number} [config.timestamp=Date.now] Timestamp value in milliseconds.\n   * @param {number} [config.window=1] Window of counter values to test.\n   * @returns {number|null} Token delta or null if it is not found in the search window, in which case it should be considered invalid.\n   */ static validate({ token, secret, algorithm, digits, period = TOTP.defaults.period, timestamp = Date.now(), window }) {\n        return HOTP.validate({\n            token,\n            secret,\n            algorithm,\n            digits,\n            counter: TOTP.counter({\n                period,\n                timestamp\n            }),\n            window\n        });\n    }\n    /**\n   * Validates a TOTP token.\n   * @param {Object} config Configuration options.\n   * @param {string} config.token Token value.\n   * @param {number} [config.timestamp=Date.now] Timestamp value in milliseconds.\n   * @param {number} [config.window=1] Window of counter values to test.\n   * @returns {number|null} Token delta or null if it is not found in the search window, in which case it should be considered invalid.\n   */ validate({ token, timestamp, window }) {\n        return TOTP.validate({\n            token,\n            secret: this.secret,\n            algorithm: this.algorithm,\n            digits: this.digits,\n            period: this.period,\n            timestamp,\n            window\n        });\n    }\n    /**\n   * Returns a Google Authenticator key URI.\n   * @returns {string} URI.\n   */ toString() {\n        const e = encodeURIComponent;\n        return \"otpauth://totp/\" + `${this.issuer.length > 0 ? this.issuerInLabel ? `${e(this.issuer)}:${e(this.label)}?issuer=${e(this.issuer)}&` : `${e(this.label)}?issuer=${e(this.issuer)}&` : `${e(this.label)}?`}` + `secret=${e(this.secret.base32)}&` + `algorithm=${e(this.algorithm)}&` + `digits=${e(this.digits)}&` + `period=${e(this.period)}`;\n    }\n    /**\n   * Creates a TOTP object.\n   * @param {Object} [config] Configuration options.\n   * @param {string} [config.issuer=''] Account provider.\n   * @param {string} [config.label='OTPAuth'] Account label.\n   * @param {boolean} [config.issuerInLabel=true] Include issuer prefix in label.\n   * @param {Secret|string} [config.secret=Secret] Secret key.\n   * @param {string} [config.algorithm='SHA1'] HMAC hashing algorithm.\n   * @param {number} [config.digits=6] Token length.\n   * @param {number} [config.period=30] Token time-step duration.\n   */ constructor({ issuer = TOTP.defaults.issuer, label = TOTP.defaults.label, issuerInLabel = TOTP.defaults.issuerInLabel, secret = new Secret(), algorithm = TOTP.defaults.algorithm, digits = TOTP.defaults.digits, period = TOTP.defaults.period } = {}){\n        /**\n     * Account provider.\n     * @type {string}\n     */ this.issuer = issuer;\n        /**\n     * Account label.\n     * @type {string}\n     */ this.label = label;\n        /**\n     * Include issuer prefix in label.\n     * @type {boolean}\n     */ this.issuerInLabel = issuerInLabel;\n        /**\n     * Secret key.\n     * @type {Secret}\n     */ this.secret = typeof secret === \"string\" ? Secret.fromBase32(secret) : secret;\n        /**\n     * HMAC hashing algorithm.\n     * @type {string}\n     */ this.algorithm = canonicalizeAlgorithm(algorithm);\n        /**\n     * Token length.\n     * @type {number}\n     */ this.digits = digits;\n        /**\n     * Token time-step duration.\n     * @type {number}\n     */ this.period = period;\n    }\n}\n\n/**\n * Key URI regex (otpauth://TYPE/[ISSUER:]LABEL?PARAMETERS).\n * @type {RegExp}\n */ const OTPURI_REGEX = /^otpauth:\\/\\/([ht]otp)\\/(.+)\\?([A-Z0-9.~_-]+=[^?&]*(?:&[A-Z0-9.~_-]+=[^?&]*)*)$/i;\n/**\n * RFC 4648 base32 alphabet with pad.\n * @type {RegExp}\n */ const SECRET_REGEX = /^[2-7A-Z]+=*$/i;\n/**\n * Regex for supported algorithms.\n * @type {RegExp}\n */ const ALGORITHM_REGEX = /^SHA(?:1|224|256|384|512|3-224|3-256|3-384|3-512)$/i;\n/**\n * Integer regex.\n * @type {RegExp}\n */ const INTEGER_REGEX = /^[+-]?\\d+$/;\n/**\n * Positive integer regex.\n * @type {RegExp}\n */ const POSITIVE_INTEGER_REGEX = /^\\+?[1-9]\\d*$/;\n/**\n * HOTP/TOTP object/string conversion.\n * @see [Key URI Format](https://github.com/google/google-authenticator/wiki/Key-Uri-Format)\n */ class URI {\n    /**\n   * Parses a Google Authenticator key URI and returns an HOTP/TOTP object.\n   * @param {string} uri Google Authenticator Key URI.\n   * @returns {HOTP|TOTP} HOTP/TOTP object.\n   */ static parse(uri) {\n        let uriGroups;\n        try {\n            uriGroups = uri.match(OTPURI_REGEX);\n        // eslint-disable-next-line no-unused-vars\n        } catch (_) {\n        /* Handled below */ }\n        if (!Array.isArray(uriGroups)) {\n            throw new URIError(\"Invalid URI format\");\n        }\n        // Extract URI groups.\n        const uriType = uriGroups[1].toLowerCase();\n        const uriLabel = uriGroups[2].split(/(?::|%3A) *(.+)/i, 2).map(decodeURIComponent);\n        /** @type {Object.<string, string>} */ const uriParams = uriGroups[3].split(\"&\").reduce((acc, cur)=>{\n            const pairArr = cur.split(/=(.*)/, 2).map(decodeURIComponent);\n            const pairKey = pairArr[0].toLowerCase();\n            const pairVal = pairArr[1];\n            /** @type {Object.<string, string>} */ const pairAcc = acc;\n            pairAcc[pairKey] = pairVal;\n            return pairAcc;\n        }, {});\n        // 'OTP' will be instantiated with 'config' argument.\n        let OTP;\n        const config = {};\n        if (uriType === \"hotp\") {\n            OTP = HOTP;\n            // Counter: required\n            if (typeof uriParams.counter !== \"undefined\" && INTEGER_REGEX.test(uriParams.counter)) {\n                config.counter = parseInt(uriParams.counter, 10);\n            } else {\n                throw new TypeError(\"Missing or invalid 'counter' parameter\");\n            }\n        } else if (uriType === \"totp\") {\n            OTP = TOTP;\n            // Period: optional\n            if (typeof uriParams.period !== \"undefined\") {\n                if (POSITIVE_INTEGER_REGEX.test(uriParams.period)) {\n                    config.period = parseInt(uriParams.period, 10);\n                } else {\n                    throw new TypeError(\"Invalid 'period' parameter\");\n                }\n            }\n        } else {\n            throw new TypeError(\"Unknown OTP type\");\n        }\n        // Label: required\n        // Issuer: optional\n        if (typeof uriParams.issuer !== \"undefined\") {\n            config.issuer = uriParams.issuer;\n        }\n        if (uriLabel.length === 2) {\n            config.label = uriLabel[1];\n            if (typeof config.issuer === \"undefined\" || config.issuer === \"\") {\n                config.issuer = uriLabel[0];\n            } else if (uriLabel[0] === \"\") {\n                config.issuerInLabel = false;\n            }\n        } else {\n            config.label = uriLabel[0];\n            if (typeof config.issuer !== \"undefined\" && config.issuer !== \"\") {\n                config.issuerInLabel = false;\n            }\n        }\n        // Secret: required\n        if (typeof uriParams.secret !== \"undefined\" && SECRET_REGEX.test(uriParams.secret)) {\n            config.secret = uriParams.secret;\n        } else {\n            throw new TypeError(\"Missing or invalid 'secret' parameter\");\n        }\n        // Algorithm: optional\n        if (typeof uriParams.algorithm !== \"undefined\") {\n            if (ALGORITHM_REGEX.test(uriParams.algorithm)) {\n                config.algorithm = uriParams.algorithm;\n            } else {\n                throw new TypeError(\"Invalid 'algorithm' parameter\");\n            }\n        }\n        // Digits: optional\n        if (typeof uriParams.digits !== \"undefined\") {\n            if (POSITIVE_INTEGER_REGEX.test(uriParams.digits)) {\n                config.digits = parseInt(uriParams.digits, 10);\n            } else {\n                throw new TypeError(\"Invalid 'digits' parameter\");\n            }\n        }\n        return new OTP(config);\n    }\n    /**\n   * Converts an HOTP/TOTP object to a Google Authenticator key URI.\n   * @param {HOTP|TOTP} otp HOTP/TOTP object.\n   * @returns {string} Google Authenticator Key URI.\n   */ static stringify(otp) {\n        if (otp instanceof HOTP || otp instanceof TOTP) {\n            return otp.toString();\n        }\n        throw new TypeError(\"Invalid 'HOTP/TOTP' object\");\n    }\n}\n\n/**\n * Library version.\n * @type {string}\n */ const version = \"9.4.1\";\n\nexport { HOTP, Secret, TOTP, URI, version };\n", "\r\nimport * as OTPAuth from \"otpauth\";\r\nimport { v4 as uuid } from \"uuid\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport jwt from \"@tsndr/cloudflare-worker-jwt\";\r\n\r\n// TOTP helper using OTPAuth\r\nfunction verifyTOTP(secret: string, token: string): boolean {\r\n  const totp = new OTPAuth.TOTP({\r\n    secret: OTPAuth.Secret.fromBase32(secret),\r\n    algorithm: \"SHA1\",\r\n    digits: 6,\r\n    period: 30\r\n  });\r\n  return totp.validate({ token, window: 1 }) !== null;\r\n}\r\n\r\nfunction generateTOTPSecret(): string {\r\n  const secret = new OTPAuth.Secret({ size: 20 });\r\n  return secret.base32;\r\n}\r\n\r\n// AES-GCM encryption utilities\r\nasync function getKey(env: any) {\r\n  const keyData = new TextEncoder().encode(env.ENCRYPTION_KEY);\r\n  return await crypto.subtle.importKey(\r\n    \"raw\",\r\n    keyData,\r\n    { name: \"AES-GCM\" },\r\n    false,\r\n    [\"encrypt\", \"decrypt\"]\r\n  );\r\n}\r\n\r\nasync function encrypt(text: string, env: any) {\r\n  const iv = crypto.getRandomValues(new Uint8Array(12));\r\n  const key = await getKey(env);\r\n  const encoded = new TextEncoder().encode(text);\r\n  const ciphertext = await crypto.subtle.encrypt(\r\n    { name: \"AES-GCM\", iv },\r\n    key,\r\n    encoded\r\n  );\r\n  return btoa(String.fromCharCode(...iv) + String.fromCharCode(...new Uint8Array(ciphertext)));\r\n}\r\n\r\nasync function decrypt(data: string, env: any) {\r\n  const raw = atob(data);\r\n  const iv = new Uint8Array([...raw].slice(0, 12).map((c: string) => c.charCodeAt(0)));\r\n  const ciphertext = new Uint8Array([...raw].slice(12).map((c: string) => c.charCodeAt(0)));\r\n  const key = await getKey(env);\r\n  const decrypted = await crypto.subtle.decrypt(\r\n    { name: \"AES-GCM\", iv },\r\n    key,\r\n    ciphertext\r\n  );\r\n  return new TextDecoder().decode(decrypted);\r\n}\r\n\r\n// Utility: get user by email (staff or client)\r\nasync function getUserByEmail(env: any, email: string) {\r\n  let user = await env.DB.prepare(\"SELECT * FROM staff WHERE email = ?\").bind(email).first();\r\n  if (!user) user = await env.DB.prepare(\"SELECT * FROM clients WHERE email = ?\").bind(email).first();\r\n  return user;\r\n}\r\n\r\n// POST /api/auth/login\r\nexport async function authRoute(req: Request, env: Env) {\r\n  if (req.method !== \"POST\") {\r\n    return new Response(\"Method Not Allowed\", { status: 405 });\r\n  }\r\n  const { email, password, mfa_code } = await req.json() as { email: string; password: string; mfa_code?: string };\r\n  const user = await getUserByEmail(env, email);\r\n  if (!user) return new Response(JSON.stringify({ error: \"Invalid credentials\" }), { status: 401 });\r\n  \r\n  // Verify password with bcrypt\r\n  const passwordValid = await bcrypt.compare(password, user.password_hash);\r\n  if (!passwordValid) return new Response(JSON.stringify({ error: \"Invalid credentials\" }), { status: 401 });\r\n  // MFA required?\r\n  if (user.mfa_enabled) {\r\n    if (!mfa_code) {\r\n      return new Response(JSON.stringify({ mfa_required: true, mfa_method: user.mfa_method }), { status: 200 });\r\n    }\r\n    \r\n    let mfaValid = false;\r\n    \r\n    if (user.mfa_method === \"totp\") {\r\n      let mfaSecret = user.mfa_secret;\r\n      if (mfaSecret && !mfaSecret.startsWith(\"MFA\")) {\r\n        // If not encrypted, encrypt and update\r\n        mfaSecret = await encrypt(mfaSecret, env);\r\n        await (env as any).DB.prepare(`UPDATE ${user.role ? \"staff\" : \"clients\"} SET mfa_secret = ? WHERE id = ?`).bind(mfaSecret, user.id).run();\r\n      }\r\n      const decryptedSecret = await decrypt(mfaSecret, env);\r\n      mfaValid = decryptedSecret && verifyTOTP(decryptedSecret, mfa_code);\r\n    } else if (user.mfa_method === \"email\" || user.mfa_method === \"sms\") {\r\n      // Check verification code from KV (stored temporarily)\r\n      const storedCode = await (env as any).KV_NAMESPACE?.get(`mfa:${user.id}`);\r\n      mfaValid = storedCode && storedCode === mfa_code;\r\n      if (mfaValid && (env as any).KV_NAMESPACE) {\r\n        await (env as any).KV_NAMESPACE.delete(`mfa:${user.id}`);\r\n      }\r\n    }\r\n    \r\n    // Check backup codes if primary method fails\r\n    if (!mfaValid && user.mfa_backup_codes) {\r\n      try {\r\n        const backupCodes = JSON.parse(user.mfa_backup_codes);\r\n        const codeIndex = backupCodes.findIndex((code: string) => code === mfa_code);\r\n        if (codeIndex !== -1) {\r\n          mfaValid = true;\r\n          // Remove used backup code\r\n          backupCodes.splice(codeIndex, 1);\r\n          await (env as any).DB.prepare(`UPDATE ${user.role ? \"staff\" : \"clients\"} SET mfa_backup_codes = ? WHERE id = ?`)\r\n            .bind(JSON.stringify(backupCodes), user.id).run();\r\n        }\r\n      } catch (e) {\r\n        console.error(\"Failed to parse backup codes:\", e);\r\n      }\r\n    }\r\n    \r\n    if (!mfaValid) {\r\n      return new Response(JSON.stringify({ error: \"Invalid MFA code\" }), { status: 401 });\r\n    }\r\n  }\r\n  \r\n  // Generate JWT token\r\n  const token = await jwt.sign(\r\n    {\r\n      id: user.id,\r\n      email: user.email,\r\n      role: user.role || \"client\",\r\n      name: user.name,\r\n      exp: Math.floor(Date.now() / 1000) + (24 * 60 * 60) // 24 hours\r\n    },\r\n    (env as any).JWT_SECRET || \"change-this-secret-in-production\"\r\n  );\r\n  \r\n  // Success: return JWT token\r\n  return new Response(JSON.stringify({ \r\n    success: true, \r\n    token,\r\n    user: { id: user.id, email: user.email, role: user.role || \"client\", name: user.name } \r\n  }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\n// POST /api/auth/mfa/setup (enroll TOTP)\r\nexport async function mfaSetupRoute(req: Request, env: Env) {\r\n  const { email } = await req.json() as { email: string };\r\n  const user = await getUserByEmail(env, email);\r\n  if (!user) return new Response(JSON.stringify({ error: \"User not found\" }), { status: 404 });\r\n  const secret = generateTOTPSecret();\r\n  const encryptedSecret = await encrypt(secret, env);\r\n  // Save encrypted secret (do not enable yet)\r\n  await (env as any).DB.prepare(`UPDATE ${user.role ? \"staff\" : \"clients\"} SET mfa_secret = ? WHERE id = ?`).bind(encryptedSecret, user.id).run();\r\n  // Return secret for QR code (not encrypted)\r\n  return new Response(JSON.stringify({ secret }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\n// POST /api/auth/mfa/verify (verify TOTP and enable)\r\nexport async function mfaVerifyRoute(req: Request, env: Env) {\r\n  const { email, code } = await req.json() as { email: string; code: string };\r\n  const user = await getUserByEmail(env, email);\r\n  if (!user || !user.mfa_secret) return new Response(JSON.stringify({ error: \"User not found or not enrolled\" }), { status: 404 });\r\n  const decryptedSecret = await decrypt(user.mfa_secret, env);\r\n  if (!verifyTOTP(decryptedSecret, code)) return new Response(JSON.stringify({ error: \"Invalid code\" }), { status: 401 });\r\n  await (env as any).DB.prepare(`UPDATE ${user.role ? \"staff\" : \"clients\"} SET mfa_enabled = 1 WHERE id = ?`).bind(user.id).run();\r\n  return new Response(JSON.stringify({ success: true }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n", "// efileProviders.ts\r\n// IRS MeF E-File Provider Configuration\r\n// PRODUCTION INTEGRATION - ATS \u2192 Production Gate Compliant\r\n\r\nexport interface EfinProfile {\r\n  efin: string;\r\n  etin_prod: string;\r\n  etin_test?: string;\r\n  firm_name: string;\r\n  owner_name: string;\r\n  address: string;\r\n  phone: string;\r\n  email: string;\r\n  status: \"active\" | \"inactive\" | \"test\";\r\n  approved_years: string[];\r\n  provider_options: string[];\r\n  software_developer_approved: boolean;\r\n  role: \"Software Developer\" | \"ERO\" | \"Transmitter\";\r\n}\r\n\r\nexport interface MefConfig {\r\n  environment: \"ATS\" | \"PRODUCTION\";\r\n  active_profile: string;\r\n  transmissions_enabled: boolean; // Kill switch\r\n  endpoints: {\r\n    ATS_BASE: string;\r\n    PROD_BASE: string;\r\n  };\r\n  transport: \"mime\" | \"mtom\";\r\n  services: {\r\n    SendSubmissions: string;\r\n    GetSubmissionStatus: string;\r\n    GetAck: string;\r\n    GetAcks: string;\r\n    GetNewAcks: string;\r\n  };\r\n  retry: {\r\n    max_attempts: number;\r\n    initial_delay_ms: number;\r\n    max_delay_ms: number;\r\n    backoff_multiplier: number;\r\n  };\r\n  timeouts: {\r\n    connection_ms: number;\r\n    read_ms: number;\r\n  };\r\n}\r\n\r\nexport interface BankProductProvider {\r\n  id: string;\r\n  name: string;\r\n  api_url: string;\r\n  supported_products: string[];\r\n  support_contact: string;\r\n}\r\n\r\n// ============================================================================\r\n// EFIN PROFILES\r\n// ============================================================================\r\n\r\n/**\r\n * Profile A - ROSS TAX PREP AND BOOKKEEPING LLC\r\n * ERO only - NOT for custom software development\r\n */\r\nexport const ROSS_TAX_PREP_PROFILE: EfinProfile = {\r\n  efin: \"****86\", // Redacted for public\r\n  etin_prod: \"98978\",\r\n  firm_name: \"ROSS TAX PREP AND BOOKKEEPING LLC\",\r\n  owner_name: \"Condre Ross\",\r\n  address: \"[Business Address]\",\r\n  phone: \"[Business Phone]\",\r\n  email: \"[Business Email]\",\r\n  status: \"test\",\r\n  approved_years: [\"2025\", \"2026\"],\r\n  provider_options: [\"ERO\", \"Transmitter\", \"ISP\"],\r\n  software_developer_approved: false,\r\n  role: \"ERO\"\r\n};\r\n\r\n/**\r\n * Profile B - 254 - TAX CONSULTANTS (Software Developer Approved)\r\n * \u2705 REQUIREMENT 0: Software Developer = Accepted\r\n * This is the CORRECT profile for custom-built transmitter software\r\n */\r\nexport const TAX_CONSULTANTS_PROFILE: EfinProfile = {\r\n  efin: \"****35\", // Redacted for public\r\n  etin_prod: \"95409\",\r\n  etin_test: \"95410\",\r\n  firm_name: \"254 - TAX CONSULTANTS\",\r\n  owner_name: \"Condre Ross\",\r\n  address: \"[Business Address]\",\r\n  phone: \"[Business Phone]\",\r\n  email: \"[Business Email]\",\r\n  status: \"test\",\r\n  approved_years: [\"2025\", \"2026\"],\r\n  provider_options: [\"ERO\", \"Transmitter\", \"ISP\", \"Software Developer\"],\r\n  software_developer_approved: true,  // \u2705 This is the key requirement\r\n  role: \"Software Developer\"          // \u2705 Role alignment for \"I built the transmitter\"\r\n};\r\n\r\n// ============================================================================\r\n// ACTIVE PROFILE SELECTION\r\n// ============================================================================\r\n\r\n/**\r\n * ACTIVE PROFILE - Set to Software Developer approved profile\r\n * \u2705 Requirement 0: Operating under EFIN where Software Developer = Accepted\r\n */\r\nexport const ERO_EFIN_PROFILE = TAX_CONSULTANTS_PROFILE;\r\n\r\n// All EFIN profiles for lookup\r\nexport const EFIN_PROFILES: Record<string, EfinProfile> = {\r\n  \"ross_tax_prep\": ROSS_TAX_PREP_PROFILE,\r\n  \"254_tax_consultants\": TAX_CONSULTANTS_PROFILE\r\n};\r\n\r\n// ============================================================================\r\n// MEF CONFIGURATION\r\n// ============================================================================\r\n\r\n/**\r\n * IRS MeF A2A Configuration\r\n * \u2705 Requirement 5: Environment switch is config toggle, not code change\r\n */\r\nexport const MEF_CONFIG: MefConfig = {\r\n  // ============================================================\r\n  // ENVIRONMENT TOGGLE - Change this for ATS vs Production\r\n  // NO CODE CHANGES REQUIRED - just change this value\r\n  // ============================================================\r\n  environment: \"PRODUCTION\", // \"ATS\" for testing, \"PRODUCTION\" for live filing\r\n  \r\n  // Active EFIN profile\r\n  active_profile: \"254_tax_consultants\", // Software Developer approved\r\n  \r\n  // ============================================================\r\n  // KILL SWITCH - Disable transmissions without taking app down\r\n  // \u2705 Requirement 5: \"stop the line\" switch\r\n  // ============================================================\r\n  transmissions_enabled: true, // Set to false to stop all transmissions\r\n  \r\n  // MeF Endpoints\r\n  endpoints: {\r\n    ATS_BASE: \"https://la.alt.www4.irs.gov/a2a/mef\",\r\n    PROD_BASE: \"https://la.www4.irs.gov/a2a/mef\"\r\n  },\r\n  \r\n  // Transport format\r\n  transport: \"mime\",\r\n  \r\n  // MeF Services\r\n  services: {\r\n    SendSubmissions: \"SendSubmissions\",\r\n    GetSubmissionStatus: \"GetSubmissionStatus\",\r\n    GetAck: \"GetAck\",\r\n    GetAcks: \"GetAcks\",\r\n    GetNewAcks: \"GetNewAcks\"\r\n  },\r\n  \r\n  // Retry configuration for resilience\r\n  retry: {\r\n    max_attempts: 3,\r\n    initial_delay_ms: 1000,\r\n    max_delay_ms: 30000,\r\n    backoff_multiplier: 2,\r\n  },\r\n  \r\n  // Timeout configuration\r\n  timeouts: {\r\n    connection_ms: 30000,\r\n    read_ms: 120000,\r\n  }\r\n};\r\n\r\n// ============================================================================\r\n// HELPER FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Get current MeF endpoint based on environment\r\n */\r\nexport function getMefEndpoint(service: string): string {\r\n  const baseUrl = MEF_CONFIG.environment === \"ATS\" \r\n    ? MEF_CONFIG.endpoints.ATS_BASE \r\n    : MEF_CONFIG.endpoints.PROD_BASE;\r\n  return `${baseUrl}/${MEF_CONFIG.transport}/${service}`;\r\n}\r\n\r\n/**\r\n * Get active ETIN based on environment\r\n */\r\nexport function getActiveEtin(): string {\r\n  const profile = EFIN_PROFILES[MEF_CONFIG.active_profile];\r\n  if (MEF_CONFIG.environment === \"ATS\" && profile.etin_test) {\r\n    return profile.etin_test;\r\n  }\r\n  return profile.etin_prod;\r\n}\r\n\r\n/**\r\n * Get active EFIN profile\r\n */\r\nexport function getActiveProfile(): EfinProfile {\r\n  return EFIN_PROFILES[MEF_CONFIG.active_profile];\r\n}\r\n\r\n/**\r\n * Check if transmissions are enabled (kill switch)\r\n * \u2705 Requirement 5: \"stop the line\" switch\r\n */\r\nexport function isTransmissionEnabled(): boolean {\r\n  return MEF_CONFIG.transmissions_enabled;\r\n}\r\n\r\n/**\r\n * Check if using production environment\r\n */\r\nexport function isProduction(): boolean {\r\n  return MEF_CONFIG.environment === \"PRODUCTION\";\r\n}\r\n\r\n/**\r\n * Validate profile has Software Developer approval\r\n * \u2705 Requirement 0 validation\r\n */\r\nexport function validateSoftwareDeveloperApproval(): { valid: boolean; message: string } {\r\n  const profile = getActiveProfile();\r\n  if (!profile.software_developer_approved) {\r\n    return {\r\n      valid: false,\r\n      message: `Profile ${profile.firm_name} (EFIN: ${profile.efin}) does not have Software Developer approval. Cannot transmit custom software submissions.`\r\n    };\r\n  }\r\n  if (profile.role !== \"Software Developer\") {\r\n    return {\r\n      valid: false,\r\n      message: `Profile ${profile.firm_name} role is \"${profile.role}\", expected \"Software Developer\".`\r\n    };\r\n  }\r\n  return {\r\n    valid: true,\r\n    message: `Profile ${profile.firm_name} (EFIN: ${profile.efin}) has Software Developer approval.`\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// BANK PRODUCT PROVIDERS\r\n// ============================================================================\r\n\r\nexport const BANK_PRODUCT_PROVIDERS: BankProductProvider[] = [\r\n  {\r\n    id: \"sbtpg\",\r\n    name: \"Santa Barbara TPG\",\r\n    api_url: \"https://www.sbtpg.com/api\",\r\n    supported_products: [\"refund transfer\", \"cash advance\"],\r\n    support_contact: \"support@sbtpg.com\"\r\n  },\r\n  {\r\n    id: \"refundadvantage\",\r\n    name: \"Refund Advantage\",\r\n    api_url: \"https://www.refund-advantage.com/api\",\r\n    supported_products: [\"refund transfer\", \"prepaid card\"],\r\n    support_contact: \"support@refund-advantage.com\"\r\n  },\r\n  {\r\n    id: \"eps\",\r\n    name: \"EPS Financial\",\r\n    api_url: \"https://www.epsfinancial.net/api\",\r\n    supported_products: [\"refund transfer\", \"cash advance\", \"prepaid card\"],\r\n    support_contact: \"support@epsfinancial.net\"\r\n  }\r\n];\r\n\r\nexport const SUPPORTED_PAYMENT_METHODS = [\r\n  \"ach\",\r\n  \"chime\",\r\n  \"cashapp\",\r\n  \"credit_card\",\r\n  \"debit_card\",\r\n  \"direct_deposit\",\r\n  \"check\",\r\n  \"prepaid_card\",\r\n  \"refund_transfer\"\r\n];\r\n", "// src/compose.ts\nvar compose = (middleware, onError, onNotFound) => {\n  return (context, next) => {\n    let index = -1;\n    return dispatch(0);\n    async function dispatch(i) {\n      if (i <= index) {\n        throw new Error(\"next() called multiple times\");\n      }\n      index = i;\n      let res;\n      let isError = false;\n      let handler;\n      if (middleware[i]) {\n        handler = middleware[i][0][0];\n        context.req.routeIndex = i;\n      } else {\n        handler = i === middleware.length && next || void 0;\n      }\n      if (handler) {\n        try {\n          res = await handler(context, () => dispatch(i + 1));\n        } catch (err) {\n          if (err instanceof Error && onError) {\n            context.error = err;\n            res = await onError(err, context);\n            isError = true;\n          } else {\n            throw err;\n          }\n        }\n      } else {\n        if (context.finalized === false && onNotFound) {\n          res = await onNotFound(context);\n        }\n      }\n      if (res && (context.finalized === false || isError)) {\n        context.res = res;\n      }\n      return context;\n    }\n  };\n};\nexport {\n  compose\n};\n", "// src/request/constants.ts\nvar GET_MATCH_RESULT = /* @__PURE__ */ Symbol();\nexport {\n  GET_MATCH_RESULT\n};\n", "// src/utils/body.ts\nimport { HonoRequest } from \"../request.js\";\nvar parseBody = async (request, options = /* @__PURE__ */ Object.create(null)) => {\n  const { all = false, dot = false } = options;\n  const headers = request instanceof HonoRequest ? request.raw.headers : request.headers;\n  const contentType = headers.get(\"Content-Type\");\n  if (contentType?.startsWith(\"multipart/form-data\") || contentType?.startsWith(\"application/x-www-form-urlencoded\")) {\n    return parseFormData(request, { all, dot });\n  }\n  return {};\n};\nasync function parseFormData(request, options) {\n  const formData = await request.formData();\n  if (formData) {\n    return convertFormDataToBodyData(formData, options);\n  }\n  return {};\n}\nfunction convertFormDataToBodyData(formData, options) {\n  const form = /* @__PURE__ */ Object.create(null);\n  formData.forEach((value, key) => {\n    const shouldParseAllValues = options.all || key.endsWith(\"[]\");\n    if (!shouldParseAllValues) {\n      form[key] = value;\n    } else {\n      handleParsingAllValues(form, key, value);\n    }\n  });\n  if (options.dot) {\n    Object.entries(form).forEach(([key, value]) => {\n      const shouldParseDotValues = key.includes(\".\");\n      if (shouldParseDotValues) {\n        handleParsingNestedValues(form, key, value);\n        delete form[key];\n      }\n    });\n  }\n  return form;\n}\nvar handleParsingAllValues = (form, key, value) => {\n  if (form[key] !== void 0) {\n    if (Array.isArray(form[key])) {\n      ;\n      form[key].push(value);\n    } else {\n      form[key] = [form[key], value];\n    }\n  } else {\n    if (!key.endsWith(\"[]\")) {\n      form[key] = value;\n    } else {\n      form[key] = [value];\n    }\n  }\n};\nvar handleParsingNestedValues = (form, key, value) => {\n  let nestedForm = form;\n  const keys = key.split(\".\");\n  keys.forEach((key2, index) => {\n    if (index === keys.length - 1) {\n      nestedForm[key2] = value;\n    } else {\n      if (!nestedForm[key2] || typeof nestedForm[key2] !== \"object\" || Array.isArray(nestedForm[key2]) || nestedForm[key2] instanceof File) {\n        nestedForm[key2] = /* @__PURE__ */ Object.create(null);\n      }\n      nestedForm = nestedForm[key2];\n    }\n  });\n};\nexport {\n  parseBody\n};\n", "// src/utils/url.ts\nvar splitPath = (path) => {\n  const paths = path.split(\"/\");\n  if (paths[0] === \"\") {\n    paths.shift();\n  }\n  return paths;\n};\nvar splitRoutingPath = (routePath) => {\n  const { groups, path } = extractGroupsFromPath(routePath);\n  const paths = splitPath(path);\n  return replaceGroupMarks(paths, groups);\n};\nvar extractGroupsFromPath = (path) => {\n  const groups = [];\n  path = path.replace(/\\{[^}]+\\}/g, (match, index) => {\n    const mark = `@${index}`;\n    groups.push([mark, match]);\n    return mark;\n  });\n  return { groups, path };\n};\nvar replaceGroupMarks = (paths, groups) => {\n  for (let i = groups.length - 1; i >= 0; i--) {\n    const [mark] = groups[i];\n    for (let j = paths.length - 1; j >= 0; j--) {\n      if (paths[j].includes(mark)) {\n        paths[j] = paths[j].replace(mark, groups[i][1]);\n        break;\n      }\n    }\n  }\n  return paths;\n};\nvar patternCache = {};\nvar getPattern = (label, next) => {\n  if (label === \"*\") {\n    return \"*\";\n  }\n  const match = label.match(/^\\:([^\\{\\}]+)(?:\\{(.+)\\})?$/);\n  if (match) {\n    const cacheKey = `${label}#${next}`;\n    if (!patternCache[cacheKey]) {\n      if (match[2]) {\n        patternCache[cacheKey] = next && next[0] !== \":\" && next[0] !== \"*\" ? [cacheKey, match[1], new RegExp(`^${match[2]}(?=/${next})`)] : [label, match[1], new RegExp(`^${match[2]}$`)];\n      } else {\n        patternCache[cacheKey] = [label, match[1], true];\n      }\n    }\n    return patternCache[cacheKey];\n  }\n  return null;\n};\nvar tryDecode = (str, decoder) => {\n  try {\n    return decoder(str);\n  } catch {\n    return str.replace(/(?:%[0-9A-Fa-f]{2})+/g, (match) => {\n      try {\n        return decoder(match);\n      } catch {\n        return match;\n      }\n    });\n  }\n};\nvar tryDecodeURI = (str) => tryDecode(str, decodeURI);\nvar getPath = (request) => {\n  const url = request.url;\n  const start = url.indexOf(\"/\", url.indexOf(\":\") + 4);\n  let i = start;\n  for (; i < url.length; i++) {\n    const charCode = url.charCodeAt(i);\n    if (charCode === 37) {\n      const queryIndex = url.indexOf(\"?\", i);\n      const path = url.slice(start, queryIndex === -1 ? void 0 : queryIndex);\n      return tryDecodeURI(path.includes(\"%25\") ? path.replace(/%25/g, \"%2525\") : path);\n    } else if (charCode === 63) {\n      break;\n    }\n  }\n  return url.slice(start, i);\n};\nvar getQueryStrings = (url) => {\n  const queryIndex = url.indexOf(\"?\", 8);\n  return queryIndex === -1 ? \"\" : \"?\" + url.slice(queryIndex + 1);\n};\nvar getPathNoStrict = (request) => {\n  const result = getPath(request);\n  return result.length > 1 && result.at(-1) === \"/\" ? result.slice(0, -1) : result;\n};\nvar mergePath = (base, sub, ...rest) => {\n  if (rest.length) {\n    sub = mergePath(sub, ...rest);\n  }\n  return `${base?.[0] === \"/\" ? \"\" : \"/\"}${base}${sub === \"/\" ? \"\" : `${base?.at(-1) === \"/\" ? \"\" : \"/\"}${sub?.[0] === \"/\" ? sub.slice(1) : sub}`}`;\n};\nvar checkOptionalParameter = (path) => {\n  if (path.charCodeAt(path.length - 1) !== 63 || !path.includes(\":\")) {\n    return null;\n  }\n  const segments = path.split(\"/\");\n  const results = [];\n  let basePath = \"\";\n  segments.forEach((segment) => {\n    if (segment !== \"\" && !/\\:/.test(segment)) {\n      basePath += \"/\" + segment;\n    } else if (/\\:/.test(segment)) {\n      if (/\\?/.test(segment)) {\n        if (results.length === 0 && basePath === \"\") {\n          results.push(\"/\");\n        } else {\n          results.push(basePath);\n        }\n        const optionalSegment = segment.replace(\"?\", \"\");\n        basePath += \"/\" + optionalSegment;\n        results.push(basePath);\n      } else {\n        basePath += \"/\" + segment;\n      }\n    }\n  });\n  return results.filter((v, i, a) => a.indexOf(v) === i);\n};\nvar _decodeURI = (value) => {\n  if (!/[%+]/.test(value)) {\n    return value;\n  }\n  if (value.indexOf(\"+\") !== -1) {\n    value = value.replace(/\\+/g, \" \");\n  }\n  return value.indexOf(\"%\") !== -1 ? tryDecode(value, decodeURIComponent_) : value;\n};\nvar _getQueryParam = (url, key, multiple) => {\n  let encoded;\n  if (!multiple && key && !/[%+]/.test(key)) {\n    let keyIndex2 = url.indexOf(\"?\", 8);\n    if (keyIndex2 === -1) {\n      return void 0;\n    }\n    if (!url.startsWith(key, keyIndex2 + 1)) {\n      keyIndex2 = url.indexOf(`&${key}`, keyIndex2 + 1);\n    }\n    while (keyIndex2 !== -1) {\n      const trailingKeyCode = url.charCodeAt(keyIndex2 + key.length + 1);\n      if (trailingKeyCode === 61) {\n        const valueIndex = keyIndex2 + key.length + 2;\n        const endIndex = url.indexOf(\"&\", valueIndex);\n        return _decodeURI(url.slice(valueIndex, endIndex === -1 ? void 0 : endIndex));\n      } else if (trailingKeyCode == 38 || isNaN(trailingKeyCode)) {\n        return \"\";\n      }\n      keyIndex2 = url.indexOf(`&${key}`, keyIndex2 + 1);\n    }\n    encoded = /[%+]/.test(url);\n    if (!encoded) {\n      return void 0;\n    }\n  }\n  const results = {};\n  encoded ??= /[%+]/.test(url);\n  let keyIndex = url.indexOf(\"?\", 8);\n  while (keyIndex !== -1) {\n    const nextKeyIndex = url.indexOf(\"&\", keyIndex + 1);\n    let valueIndex = url.indexOf(\"=\", keyIndex);\n    if (valueIndex > nextKeyIndex && nextKeyIndex !== -1) {\n      valueIndex = -1;\n    }\n    let name = url.slice(\n      keyIndex + 1,\n      valueIndex === -1 ? nextKeyIndex === -1 ? void 0 : nextKeyIndex : valueIndex\n    );\n    if (encoded) {\n      name = _decodeURI(name);\n    }\n    keyIndex = nextKeyIndex;\n    if (name === \"\") {\n      continue;\n    }\n    let value;\n    if (valueIndex === -1) {\n      value = \"\";\n    } else {\n      value = url.slice(valueIndex + 1, nextKeyIndex === -1 ? void 0 : nextKeyIndex);\n      if (encoded) {\n        value = _decodeURI(value);\n      }\n    }\n    if (multiple) {\n      if (!(results[name] && Array.isArray(results[name]))) {\n        results[name] = [];\n      }\n      ;\n      results[name].push(value);\n    } else {\n      results[name] ??= value;\n    }\n  }\n  return key ? results[key] : results;\n};\nvar getQueryParam = _getQueryParam;\nvar getQueryParams = (url, key) => {\n  return _getQueryParam(url, key, true);\n};\nvar decodeURIComponent_ = decodeURIComponent;\nexport {\n  checkOptionalParameter,\n  decodeURIComponent_,\n  getPath,\n  getPathNoStrict,\n  getPattern,\n  getQueryParam,\n  getQueryParams,\n  getQueryStrings,\n  mergePath,\n  splitPath,\n  splitRoutingPath,\n  tryDecode\n};\n", "// src/request.ts\nimport { HTTPException } from \"./http-exception.js\";\nimport { GET_MATCH_RESULT } from \"./request/constants.js\";\nimport { parseBody } from \"./utils/body.js\";\nimport { decodeURIComponent_, getQueryParam, getQueryParams, tryDecode } from \"./utils/url.js\";\nvar tryDecodeURIComponent = (str) => tryDecode(str, decodeURIComponent_);\nvar HonoRequest = class {\n  /**\n   * `.raw` can get the raw Request object.\n   *\n   * @see {@link https://hono.dev/docs/api/request#raw}\n   *\n   * @example\n   * ```ts\n   * // For Cloudflare Workers\n   * app.post('/', async (c) => {\n   *   const metadata = c.req.raw.cf?.hostMetadata?\n   *   ...\n   * })\n   * ```\n   */\n  raw;\n  #validatedData;\n  // Short name of validatedData\n  #matchResult;\n  routeIndex = 0;\n  /**\n   * `.path` can get the pathname of the request.\n   *\n   * @see {@link https://hono.dev/docs/api/request#path}\n   *\n   * @example\n   * ```ts\n   * app.get('/about/me', (c) => {\n   *   const pathname = c.req.path // `/about/me`\n   * })\n   * ```\n   */\n  path;\n  bodyCache = {};\n  constructor(request, path = \"/\", matchResult = [[]]) {\n    this.raw = request;\n    this.path = path;\n    this.#matchResult = matchResult;\n    this.#validatedData = {};\n  }\n  param(key) {\n    return key ? this.#getDecodedParam(key) : this.#getAllDecodedParams();\n  }\n  #getDecodedParam(key) {\n    const paramKey = this.#matchResult[0][this.routeIndex][1][key];\n    const param = this.#getParamValue(paramKey);\n    return param && /\\%/.test(param) ? tryDecodeURIComponent(param) : param;\n  }\n  #getAllDecodedParams() {\n    const decoded = {};\n    const keys = Object.keys(this.#matchResult[0][this.routeIndex][1]);\n    for (const key of keys) {\n      const value = this.#getParamValue(this.#matchResult[0][this.routeIndex][1][key]);\n      if (value !== void 0) {\n        decoded[key] = /\\%/.test(value) ? tryDecodeURIComponent(value) : value;\n      }\n    }\n    return decoded;\n  }\n  #getParamValue(paramKey) {\n    return this.#matchResult[1] ? this.#matchResult[1][paramKey] : paramKey;\n  }\n  query(key) {\n    return getQueryParam(this.url, key);\n  }\n  queries(key) {\n    return getQueryParams(this.url, key);\n  }\n  header(name) {\n    if (name) {\n      return this.raw.headers.get(name) ?? void 0;\n    }\n    const headerData = {};\n    this.raw.headers.forEach((value, key) => {\n      headerData[key] = value;\n    });\n    return headerData;\n  }\n  async parseBody(options) {\n    return this.bodyCache.parsedBody ??= await parseBody(this, options);\n  }\n  #cachedBody = (key) => {\n    const { bodyCache, raw } = this;\n    const cachedBody = bodyCache[key];\n    if (cachedBody) {\n      return cachedBody;\n    }\n    const anyCachedKey = Object.keys(bodyCache)[0];\n    if (anyCachedKey) {\n      return bodyCache[anyCachedKey].then((body) => {\n        if (anyCachedKey === \"json\") {\n          body = JSON.stringify(body);\n        }\n        return new Response(body)[key]();\n      });\n    }\n    return bodyCache[key] = raw[key]();\n  };\n  /**\n   * `.json()` can parse Request body of type `application/json`\n   *\n   * @see {@link https://hono.dev/docs/api/request#json}\n   *\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.json()\n   * })\n   * ```\n   */\n  json() {\n    return this.#cachedBody(\"text\").then((text) => JSON.parse(text));\n  }\n  /**\n   * `.text()` can parse Request body of type `text/plain`\n   *\n   * @see {@link https://hono.dev/docs/api/request#text}\n   *\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.text()\n   * })\n   * ```\n   */\n  text() {\n    return this.#cachedBody(\"text\");\n  }\n  /**\n   * `.arrayBuffer()` parse Request body as an `ArrayBuffer`\n   *\n   * @see {@link https://hono.dev/docs/api/request#arraybuffer}\n   *\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.arrayBuffer()\n   * })\n   * ```\n   */\n  arrayBuffer() {\n    return this.#cachedBody(\"arrayBuffer\");\n  }\n  /**\n   * Parses the request body as a `Blob`.\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.blob();\n   * });\n   * ```\n   * @see https://hono.dev/docs/api/request#blob\n   */\n  blob() {\n    return this.#cachedBody(\"blob\");\n  }\n  /**\n   * Parses the request body as `FormData`.\n   * @example\n   * ```ts\n   * app.post('/entry', async (c) => {\n   *   const body = await c.req.formData();\n   * });\n   * ```\n   * @see https://hono.dev/docs/api/request#formdata\n   */\n  formData() {\n    return this.#cachedBody(\"formData\");\n  }\n  /**\n   * Adds validated data to the request.\n   *\n   * @param target - The target of the validation.\n   * @param data - The validated data to add.\n   */\n  addValidatedData(target, data) {\n    this.#validatedData[target] = data;\n  }\n  valid(target) {\n    return this.#validatedData[target];\n  }\n  /**\n   * `.url()` can get the request url strings.\n   *\n   * @see {@link https://hono.dev/docs/api/request#url}\n   *\n   * @example\n   * ```ts\n   * app.get('/about/me', (c) => {\n   *   const url = c.req.url // `http://localhost:8787/about/me`\n   *   ...\n   * })\n   * ```\n   */\n  get url() {\n    return this.raw.url;\n  }\n  /**\n   * `.method()` can get the method name of the request.\n   *\n   * @see {@link https://hono.dev/docs/api/request#method}\n   *\n   * @example\n   * ```ts\n   * app.get('/about/me', (c) => {\n   *   const method = c.req.method // `GET`\n   * })\n   * ```\n   */\n  get method() {\n    return this.raw.method;\n  }\n  get [GET_MATCH_RESULT]() {\n    return this.#matchResult;\n  }\n  /**\n   * `.matchedRoutes()` can return a matched route in the handler\n   *\n   * @deprecated\n   *\n   * Use matchedRoutes helper defined in \"hono/route\" instead.\n   *\n   * @see {@link https://hono.dev/docs/api/request#matchedroutes}\n   *\n   * @example\n   * ```ts\n   * app.use('*', async function logger(c, next) {\n   *   await next()\n   *   c.req.matchedRoutes.forEach(({ handler, method, path }, i) => {\n   *     const name = handler.name || (handler.length < 2 ? '[handler]' : '[middleware]')\n   *     console.log(\n   *       method,\n   *       ' ',\n   *       path,\n   *       ' '.repeat(Math.max(10 - path.length, 0)),\n   *       name,\n   *       i === c.req.routeIndex ? '<- respond from here' : ''\n   *     )\n   *   })\n   * })\n   * ```\n   */\n  get matchedRoutes() {\n    return this.#matchResult[0].map(([[, route]]) => route);\n  }\n  /**\n   * `routePath()` can retrieve the path registered within the handler\n   *\n   * @deprecated\n   *\n   * Use routePath helper defined in \"hono/route\" instead.\n   *\n   * @see {@link https://hono.dev/docs/api/request#routepath}\n   *\n   * @example\n   * ```ts\n   * app.get('/posts/:id', (c) => {\n   *   return c.json({ path: c.req.routePath })\n   * })\n   * ```\n   */\n  get routePath() {\n    return this.#matchResult[0].map(([[, route]]) => route)[this.routeIndex].path;\n  }\n};\nvar cloneRawRequest = async (req) => {\n  if (!req.raw.bodyUsed) {\n    return req.raw.clone();\n  }\n  const cacheKey = Object.keys(req.bodyCache)[0];\n  if (!cacheKey) {\n    throw new HTTPException(500, {\n      message: \"Cannot clone request: body was already consumed and not cached. Please use HonoRequest methods (e.g., req.json(), req.text()) instead of consuming req.raw directly.\"\n    });\n  }\n  const requestInit = {\n    body: await req[cacheKey](),\n    cache: req.raw.cache,\n    credentials: req.raw.credentials,\n    headers: req.header(),\n    integrity: req.raw.integrity,\n    keepalive: req.raw.keepalive,\n    method: req.method,\n    mode: req.raw.mode,\n    redirect: req.raw.redirect,\n    referrer: req.raw.referrer,\n    referrerPolicy: req.raw.referrerPolicy,\n    signal: req.raw.signal\n  };\n  return new Request(req.url, requestInit);\n};\nexport {\n  HonoRequest,\n  cloneRawRequest\n};\n", "// src/utils/html.ts\nvar HtmlEscapedCallbackPhase = {\n  Stringify: 1,\n  BeforeStream: 2,\n  Stream: 3\n};\nvar raw = (value, callbacks) => {\n  const escapedString = new String(value);\n  escapedString.isEscaped = true;\n  escapedString.callbacks = callbacks;\n  return escapedString;\n};\nvar escapeRe = /[&<>'\"]/;\nvar stringBufferToString = async (buffer, callbacks) => {\n  let str = \"\";\n  callbacks ||= [];\n  const resolvedBuffer = await Promise.all(buffer);\n  for (let i = resolvedBuffer.length - 1; ; i--) {\n    str += resolvedBuffer[i];\n    i--;\n    if (i < 0) {\n      break;\n    }\n    let r = resolvedBuffer[i];\n    if (typeof r === \"object\") {\n      callbacks.push(...r.callbacks || []);\n    }\n    const isEscaped = r.isEscaped;\n    r = await (typeof r === \"object\" ? r.toString() : r);\n    if (typeof r === \"object\") {\n      callbacks.push(...r.callbacks || []);\n    }\n    if (r.isEscaped ?? isEscaped) {\n      str += r;\n    } else {\n      const buf = [str];\n      escapeToBuffer(r, buf);\n      str = buf[0];\n    }\n  }\n  return raw(str, callbacks);\n};\nvar escapeToBuffer = (str, buffer) => {\n  const match = str.search(escapeRe);\n  if (match === -1) {\n    buffer[0] += str;\n    return;\n  }\n  let escape;\n  let index;\n  let lastIndex = 0;\n  for (index = match; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34:\n        escape = \"&quot;\";\n        break;\n      case 39:\n        escape = \"&#39;\";\n        break;\n      case 38:\n        escape = \"&amp;\";\n        break;\n      case 60:\n        escape = \"&lt;\";\n        break;\n      case 62:\n        escape = \"&gt;\";\n        break;\n      default:\n        continue;\n    }\n    buffer[0] += str.substring(lastIndex, index) + escape;\n    lastIndex = index + 1;\n  }\n  buffer[0] += str.substring(lastIndex, index);\n};\nvar resolveCallbackSync = (str) => {\n  const callbacks = str.callbacks;\n  if (!callbacks?.length) {\n    return str;\n  }\n  const buffer = [str];\n  const context = {};\n  callbacks.forEach((c) => c({ phase: HtmlEscapedCallbackPhase.Stringify, buffer, context }));\n  return buffer[0];\n};\nvar resolveCallback = async (str, phase, preserveCallbacks, context, buffer) => {\n  if (typeof str === \"object\" && !(str instanceof String)) {\n    if (!(str instanceof Promise)) {\n      str = str.toString();\n    }\n    if (str instanceof Promise) {\n      str = await str;\n    }\n  }\n  const callbacks = str.callbacks;\n  if (!callbacks?.length) {\n    return Promise.resolve(str);\n  }\n  if (buffer) {\n    buffer[0] += str;\n  } else {\n    buffer = [str];\n  }\n  const resStr = Promise.all(callbacks.map((c) => c({ phase, buffer, context }))).then(\n    (res) => Promise.all(\n      res.filter(Boolean).map((str2) => resolveCallback(str2, phase, false, context, buffer))\n    ).then(() => buffer[0])\n  );\n  if (preserveCallbacks) {\n    return raw(await resStr, callbacks);\n  } else {\n    return resStr;\n  }\n};\nexport {\n  HtmlEscapedCallbackPhase,\n  escapeToBuffer,\n  raw,\n  resolveCallback,\n  resolveCallbackSync,\n  stringBufferToString\n};\n", "// src/context.ts\nimport { HonoRequest } from \"./request.js\";\nimport { HtmlEscapedCallbackPhase, resolveCallback } from \"./utils/html.js\";\nvar TEXT_PLAIN = \"text/plain; charset=UTF-8\";\nvar setDefaultContentType = (contentType, headers) => {\n  return {\n    \"Content-Type\": contentType,\n    ...headers\n  };\n};\nvar Context = class {\n  #rawRequest;\n  #req;\n  /**\n   * `.env` can get bindings (environment variables, secrets, KV namespaces, D1 database, R2 bucket etc.) in Cloudflare Workers.\n   *\n   * @see {@link https://hono.dev/docs/api/context#env}\n   *\n   * @example\n   * ```ts\n   * // Environment object for Cloudflare Workers\n   * app.get('*', async c => {\n   *   const counter = c.env.COUNTER\n   * })\n   * ```\n   */\n  env = {};\n  #var;\n  finalized = false;\n  /**\n   * `.error` can get the error object from the middleware if the Handler throws an error.\n   *\n   * @see {@link https://hono.dev/docs/api/context#error}\n   *\n   * @example\n   * ```ts\n   * app.use('*', async (c, next) => {\n   *   await next()\n   *   if (c.error) {\n   *     // do something...\n   *   }\n   * })\n   * ```\n   */\n  error;\n  #status;\n  #executionCtx;\n  #res;\n  #layout;\n  #renderer;\n  #notFoundHandler;\n  #preparedHeaders;\n  #matchResult;\n  #path;\n  /**\n   * Creates an instance of the Context class.\n   *\n   * @param req - The Request object.\n   * @param options - Optional configuration options for the context.\n   */\n  constructor(req, options) {\n    this.#rawRequest = req;\n    if (options) {\n      this.#executionCtx = options.executionCtx;\n      this.env = options.env;\n      this.#notFoundHandler = options.notFoundHandler;\n      this.#path = options.path;\n      this.#matchResult = options.matchResult;\n    }\n  }\n  /**\n   * `.req` is the instance of {@link HonoRequest}.\n   */\n  get req() {\n    this.#req ??= new HonoRequest(this.#rawRequest, this.#path, this.#matchResult);\n    return this.#req;\n  }\n  /**\n   * @see {@link https://hono.dev/docs/api/context#event}\n   * The FetchEvent associated with the current request.\n   *\n   * @throws Will throw an error if the context does not have a FetchEvent.\n   */\n  get event() {\n    if (this.#executionCtx && \"respondWith\" in this.#executionCtx) {\n      return this.#executionCtx;\n    } else {\n      throw Error(\"This context has no FetchEvent\");\n    }\n  }\n  /**\n   * @see {@link https://hono.dev/docs/api/context#executionctx}\n   * The ExecutionContext associated with the current request.\n   *\n   * @throws Will throw an error if the context does not have an ExecutionContext.\n   */\n  get executionCtx() {\n    if (this.#executionCtx) {\n      return this.#executionCtx;\n    } else {\n      throw Error(\"This context has no ExecutionContext\");\n    }\n  }\n  /**\n   * @see {@link https://hono.dev/docs/api/context#res}\n   * The Response object for the current request.\n   */\n  get res() {\n    return this.#res ||= new Response(null, {\n      headers: this.#preparedHeaders ??= new Headers()\n    });\n  }\n  /**\n   * Sets the Response object for the current request.\n   *\n   * @param _res - The Response object to set.\n   */\n  set res(_res) {\n    if (this.#res && _res) {\n      _res = new Response(_res.body, _res);\n      for (const [k, v] of this.#res.headers.entries()) {\n        if (k === \"content-type\") {\n          continue;\n        }\n        if (k === \"set-cookie\") {\n          const cookies = this.#res.headers.getSetCookie();\n          _res.headers.delete(\"set-cookie\");\n          for (const cookie of cookies) {\n            _res.headers.append(\"set-cookie\", cookie);\n          }\n        } else {\n          _res.headers.set(k, v);\n        }\n      }\n    }\n    this.#res = _res;\n    this.finalized = true;\n  }\n  /**\n   * `.render()` can create a response within a layout.\n   *\n   * @see {@link https://hono.dev/docs/api/context#render-setrenderer}\n   *\n   * @example\n   * ```ts\n   * app.get('/', (c) => {\n   *   return c.render('Hello!')\n   * })\n   * ```\n   */\n  render = (...args) => {\n    this.#renderer ??= (content) => this.html(content);\n    return this.#renderer(...args);\n  };\n  /**\n   * Sets the layout for the response.\n   *\n   * @param layout - The layout to set.\n   * @returns The layout function.\n   */\n  setLayout = (layout) => this.#layout = layout;\n  /**\n   * Gets the current layout for the response.\n   *\n   * @returns The current layout function.\n   */\n  getLayout = () => this.#layout;\n  /**\n   * `.setRenderer()` can set the layout in the custom middleware.\n   *\n   * @see {@link https://hono.dev/docs/api/context#render-setrenderer}\n   *\n   * @example\n   * ```tsx\n   * app.use('*', async (c, next) => {\n   *   c.setRenderer((content) => {\n   *     return c.html(\n   *       <html>\n   *         <body>\n   *           <p>{content}</p>\n   *         </body>\n   *       </html>\n   *     )\n   *   })\n   *   await next()\n   * })\n   * ```\n   */\n  setRenderer = (renderer) => {\n    this.#renderer = renderer;\n  };\n  /**\n   * `.header()` can set headers.\n   *\n   * @see {@link https://hono.dev/docs/api/context#header}\n   *\n   * @example\n   * ```ts\n   * app.get('/welcome', (c) => {\n   *   // Set headers\n   *   c.header('X-Message', 'Hello!')\n   *   c.header('Content-Type', 'text/plain')\n   *\n   *   return c.body('Thank you for coming')\n   * })\n   * ```\n   */\n  header = (name, value, options) => {\n    if (this.finalized) {\n      this.#res = new Response(this.#res.body, this.#res);\n    }\n    const headers = this.#res ? this.#res.headers : this.#preparedHeaders ??= new Headers();\n    if (value === void 0) {\n      headers.delete(name);\n    } else if (options?.append) {\n      headers.append(name, value);\n    } else {\n      headers.set(name, value);\n    }\n  };\n  status = (status) => {\n    this.#status = status;\n  };\n  /**\n   * `.set()` can set the value specified by the key.\n   *\n   * @see {@link https://hono.dev/docs/api/context#set-get}\n   *\n   * @example\n   * ```ts\n   * app.use('*', async (c, next) => {\n   *   c.set('message', 'Hono is hot!!')\n   *   await next()\n   * })\n   * ```\n   */\n  set = (key, value) => {\n    this.#var ??= /* @__PURE__ */ new Map();\n    this.#var.set(key, value);\n  };\n  /**\n   * `.get()` can use the value specified by the key.\n   *\n   * @see {@link https://hono.dev/docs/api/context#set-get}\n   *\n   * @example\n   * ```ts\n   * app.get('/', (c) => {\n   *   const message = c.get('message')\n   *   return c.text(`The message is \"${message}\"`)\n   * })\n   * ```\n   */\n  get = (key) => {\n    return this.#var ? this.#var.get(key) : void 0;\n  };\n  /**\n   * `.var` can access the value of a variable.\n   *\n   * @see {@link https://hono.dev/docs/api/context#var}\n   *\n   * @example\n   * ```ts\n   * const result = c.var.client.oneMethod()\n   * ```\n   */\n  // c.var.propName is a read-only\n  get var() {\n    if (!this.#var) {\n      return {};\n    }\n    return Object.fromEntries(this.#var);\n  }\n  #newResponse(data, arg, headers) {\n    const responseHeaders = this.#res ? new Headers(this.#res.headers) : this.#preparedHeaders ?? new Headers();\n    if (typeof arg === \"object\" && \"headers\" in arg) {\n      const argHeaders = arg.headers instanceof Headers ? arg.headers : new Headers(arg.headers);\n      for (const [key, value] of argHeaders) {\n        if (key.toLowerCase() === \"set-cookie\") {\n          responseHeaders.append(key, value);\n        } else {\n          responseHeaders.set(key, value);\n        }\n      }\n    }\n    if (headers) {\n      for (const [k, v] of Object.entries(headers)) {\n        if (typeof v === \"string\") {\n          responseHeaders.set(k, v);\n        } else {\n          responseHeaders.delete(k);\n          for (const v2 of v) {\n            responseHeaders.append(k, v2);\n          }\n        }\n      }\n    }\n    const status = typeof arg === \"number\" ? arg : arg?.status ?? this.#status;\n    return new Response(data, { status, headers: responseHeaders });\n  }\n  newResponse = (...args) => this.#newResponse(...args);\n  /**\n   * `.body()` can return the HTTP response.\n   * You can set headers with `.header()` and set HTTP status code with `.status`.\n   * This can also be set in `.text()`, `.json()` and so on.\n   *\n   * @see {@link https://hono.dev/docs/api/context#body}\n   *\n   * @example\n   * ```ts\n   * app.get('/welcome', (c) => {\n   *   // Set headers\n   *   c.header('X-Message', 'Hello!')\n   *   c.header('Content-Type', 'text/plain')\n   *   // Set HTTP status code\n   *   c.status(201)\n   *\n   *   // Return the response body\n   *   return c.body('Thank you for coming')\n   * })\n   * ```\n   */\n  body = (data, arg, headers) => this.#newResponse(data, arg, headers);\n  /**\n   * `.text()` can render text as `Content-Type:text/plain`.\n   *\n   * @see {@link https://hono.dev/docs/api/context#text}\n   *\n   * @example\n   * ```ts\n   * app.get('/say', (c) => {\n   *   return c.text('Hello!')\n   * })\n   * ```\n   */\n  text = (text, arg, headers) => {\n    return !this.#preparedHeaders && !this.#status && !arg && !headers && !this.finalized ? new Response(text) : this.#newResponse(\n      text,\n      arg,\n      setDefaultContentType(TEXT_PLAIN, headers)\n    );\n  };\n  /**\n   * `.json()` can render JSON as `Content-Type:application/json`.\n   *\n   * @see {@link https://hono.dev/docs/api/context#json}\n   *\n   * @example\n   * ```ts\n   * app.get('/api', (c) => {\n   *   return c.json({ message: 'Hello!' })\n   * })\n   * ```\n   */\n  json = (object, arg, headers) => {\n    return this.#newResponse(\n      JSON.stringify(object),\n      arg,\n      setDefaultContentType(\"application/json\", headers)\n    );\n  };\n  html = (html, arg, headers) => {\n    const res = (html2) => this.#newResponse(html2, arg, setDefaultContentType(\"text/html; charset=UTF-8\", headers));\n    return typeof html === \"object\" ? resolveCallback(html, HtmlEscapedCallbackPhase.Stringify, false, {}).then(res) : res(html);\n  };\n  /**\n   * `.redirect()` can Redirect, default status code is 302.\n   *\n   * @see {@link https://hono.dev/docs/api/context#redirect}\n   *\n   * @example\n   * ```ts\n   * app.get('/redirect', (c) => {\n   *   return c.redirect('/')\n   * })\n   * app.get('/redirect-permanently', (c) => {\n   *   return c.redirect('/', 301)\n   * })\n   * ```\n   */\n  redirect = (location, status) => {\n    const locationString = String(location);\n    this.header(\n      \"Location\",\n      // Multibyes should be encoded\n      // eslint-disable-next-line no-control-regex\n      !/[^\\x00-\\xFF]/.test(locationString) ? locationString : encodeURI(locationString)\n    );\n    return this.newResponse(null, status ?? 302);\n  };\n  /**\n   * `.notFound()` can return the Not Found Response.\n   *\n   * @see {@link https://hono.dev/docs/api/context#notfound}\n   *\n   * @example\n   * ```ts\n   * app.get('/notfound', (c) => {\n   *   return c.notFound()\n   * })\n   * ```\n   */\n  notFound = () => {\n    this.#notFoundHandler ??= () => new Response();\n    return this.#notFoundHandler(this);\n  };\n};\nexport {\n  Context,\n  TEXT_PLAIN\n};\n", "// src/router.ts\nvar METHOD_NAME_ALL = \"ALL\";\nvar METHOD_NAME_ALL_LOWERCASE = \"all\";\nvar METHODS = [\"get\", \"post\", \"put\", \"delete\", \"options\", \"patch\"];\nvar MESSAGE_MATCHER_IS_ALREADY_BUILT = \"Can not add a route since the matcher is already built.\";\nvar UnsupportedPathError = class extends Error {\n};\nexport {\n  MESSAGE_MATCHER_IS_ALREADY_BUILT,\n  METHODS,\n  METHOD_NAME_ALL,\n  METHOD_NAME_ALL_LOWERCASE,\n  UnsupportedPathError\n};\n", "// src/utils/constants.ts\nvar COMPOSED_HANDLER = \"__COMPOSED_HANDLER\";\nexport {\n  COMPOSED_HANDLER\n};\n", "// src/hono-base.ts\nimport { compose } from \"./compose.js\";\nimport { Context } from \"./context.js\";\nimport { METHODS, METHOD_NAME_ALL, METHOD_NAME_ALL_LOWERCASE } from \"./router.js\";\nimport { COMPOSED_HANDLER } from \"./utils/constants.js\";\nimport { getPath, getPathNoStrict, mergePath } from \"./utils/url.js\";\nvar notFoundHandler = (c) => {\n  return c.text(\"404 Not Found\", 404);\n};\nvar errorHandler = (err, c) => {\n  if (\"getResponse\" in err) {\n    const res = err.getResponse();\n    return c.newResponse(res.body, res);\n  }\n  console.error(err);\n  return c.text(\"Internal Server Error\", 500);\n};\nvar Hono = class _Hono {\n  get;\n  post;\n  put;\n  delete;\n  options;\n  patch;\n  all;\n  on;\n  use;\n  /*\n    This class is like an abstract class and does not have a router.\n    To use it, inherit the class and implement router in the constructor.\n  */\n  router;\n  getPath;\n  // Cannot use `#` because it requires visibility at JavaScript runtime.\n  _basePath = \"/\";\n  #path = \"/\";\n  routes = [];\n  constructor(options = {}) {\n    const allMethods = [...METHODS, METHOD_NAME_ALL_LOWERCASE];\n    allMethods.forEach((method) => {\n      this[method] = (args1, ...args) => {\n        if (typeof args1 === \"string\") {\n          this.#path = args1;\n        } else {\n          this.#addRoute(method, this.#path, args1);\n        }\n        args.forEach((handler) => {\n          this.#addRoute(method, this.#path, handler);\n        });\n        return this;\n      };\n    });\n    this.on = (method, path, ...handlers) => {\n      for (const p of [path].flat()) {\n        this.#path = p;\n        for (const m of [method].flat()) {\n          handlers.map((handler) => {\n            this.#addRoute(m.toUpperCase(), this.#path, handler);\n          });\n        }\n      }\n      return this;\n    };\n    this.use = (arg1, ...handlers) => {\n      if (typeof arg1 === \"string\") {\n        this.#path = arg1;\n      } else {\n        this.#path = \"*\";\n        handlers.unshift(arg1);\n      }\n      handlers.forEach((handler) => {\n        this.#addRoute(METHOD_NAME_ALL, this.#path, handler);\n      });\n      return this;\n    };\n    const { strict, ...optionsWithoutStrict } = options;\n    Object.assign(this, optionsWithoutStrict);\n    this.getPath = strict ?? true ? options.getPath ?? getPath : getPathNoStrict;\n  }\n  #clone() {\n    const clone = new _Hono({\n      router: this.router,\n      getPath: this.getPath\n    });\n    clone.errorHandler = this.errorHandler;\n    clone.#notFoundHandler = this.#notFoundHandler;\n    clone.routes = this.routes;\n    return clone;\n  }\n  #notFoundHandler = notFoundHandler;\n  // Cannot use `#` because it requires visibility at JavaScript runtime.\n  errorHandler = errorHandler;\n  /**\n   * `.route()` allows grouping other Hono instance in routes.\n   *\n   * @see {@link https://hono.dev/docs/api/routing#grouping}\n   *\n   * @param {string} path - base Path\n   * @param {Hono} app - other Hono instance\n   * @returns {Hono} routed Hono instance\n   *\n   * @example\n   * ```ts\n   * const app = new Hono()\n   * const app2 = new Hono()\n   *\n   * app2.get(\"/user\", (c) => c.text(\"user\"))\n   * app.route(\"/api\", app2) // GET /api/user\n   * ```\n   */\n  route(path, app) {\n    const subApp = this.basePath(path);\n    app.routes.map((r) => {\n      let handler;\n      if (app.errorHandler === errorHandler) {\n        handler = r.handler;\n      } else {\n        handler = async (c, next) => (await compose([], app.errorHandler)(c, () => r.handler(c, next))).res;\n        handler[COMPOSED_HANDLER] = r.handler;\n      }\n      subApp.#addRoute(r.method, r.path, handler);\n    });\n    return this;\n  }\n  /**\n   * `.basePath()` allows base paths to be specified.\n   *\n   * @see {@link https://hono.dev/docs/api/routing#base-path}\n   *\n   * @param {string} path - base Path\n   * @returns {Hono} changed Hono instance\n   *\n   * @example\n   * ```ts\n   * const api = new Hono().basePath('/api')\n   * ```\n   */\n  basePath(path) {\n    const subApp = this.#clone();\n    subApp._basePath = mergePath(this._basePath, path);\n    return subApp;\n  }\n  /**\n   * `.onError()` handles an error and returns a customized Response.\n   *\n   * @see {@link https://hono.dev/docs/api/hono#error-handling}\n   *\n   * @param {ErrorHandler} handler - request Handler for error\n   * @returns {Hono} changed Hono instance\n   *\n   * @example\n   * ```ts\n   * app.onError((err, c) => {\n   *   console.error(`${err}`)\n   *   return c.text('Custom Error Message', 500)\n   * })\n   * ```\n   */\n  onError = (handler) => {\n    this.errorHandler = handler;\n    return this;\n  };\n  /**\n   * `.notFound()` allows you to customize a Not Found Response.\n   *\n   * @see {@link https://hono.dev/docs/api/hono#not-found}\n   *\n   * @param {NotFoundHandler} handler - request handler for not-found\n   * @returns {Hono} changed Hono instance\n   *\n   * @example\n   * ```ts\n   * app.notFound((c) => {\n   *   return c.text('Custom 404 Message', 404)\n   * })\n   * ```\n   */\n  notFound = (handler) => {\n    this.#notFoundHandler = handler;\n    return this;\n  };\n  /**\n   * `.mount()` allows you to mount applications built with other frameworks into your Hono application.\n   *\n   * @see {@link https://hono.dev/docs/api/hono#mount}\n   *\n   * @param {string} path - base Path\n   * @param {Function} applicationHandler - other Request Handler\n   * @param {MountOptions} [options] - options of `.mount()`\n   * @returns {Hono} mounted Hono instance\n   *\n   * @example\n   * ```ts\n   * import { Router as IttyRouter } from 'itty-router'\n   * import { Hono } from 'hono'\n   * // Create itty-router application\n   * const ittyRouter = IttyRouter()\n   * // GET /itty-router/hello\n   * ittyRouter.get('/hello', () => new Response('Hello from itty-router'))\n   *\n   * const app = new Hono()\n   * app.mount('/itty-router', ittyRouter.handle)\n   * ```\n   *\n   * @example\n   * ```ts\n   * const app = new Hono()\n   * // Send the request to another application without modification.\n   * app.mount('/app', anotherApp, {\n   *   replaceRequest: (req) => req,\n   * })\n   * ```\n   */\n  mount(path, applicationHandler, options) {\n    let replaceRequest;\n    let optionHandler;\n    if (options) {\n      if (typeof options === \"function\") {\n        optionHandler = options;\n      } else {\n        optionHandler = options.optionHandler;\n        if (options.replaceRequest === false) {\n          replaceRequest = (request) => request;\n        } else {\n          replaceRequest = options.replaceRequest;\n        }\n      }\n    }\n    const getOptions = optionHandler ? (c) => {\n      const options2 = optionHandler(c);\n      return Array.isArray(options2) ? options2 : [options2];\n    } : (c) => {\n      let executionContext = void 0;\n      try {\n        executionContext = c.executionCtx;\n      } catch {\n      }\n      return [c.env, executionContext];\n    };\n    replaceRequest ||= (() => {\n      const mergedPath = mergePath(this._basePath, path);\n      const pathPrefixLength = mergedPath === \"/\" ? 0 : mergedPath.length;\n      return (request) => {\n        const url = new URL(request.url);\n        url.pathname = url.pathname.slice(pathPrefixLength) || \"/\";\n        return new Request(url, request);\n      };\n    })();\n    const handler = async (c, next) => {\n      const res = await applicationHandler(replaceRequest(c.req.raw), ...getOptions(c));\n      if (res) {\n        return res;\n      }\n      await next();\n    };\n    this.#addRoute(METHOD_NAME_ALL, mergePath(path, \"*\"), handler);\n    return this;\n  }\n  #addRoute(method, path, handler) {\n    method = method.toUpperCase();\n    path = mergePath(this._basePath, path);\n    const r = { basePath: this._basePath, path, method, handler };\n    this.router.add(method, path, [handler, r]);\n    this.routes.push(r);\n  }\n  #handleError(err, c) {\n    if (err instanceof Error) {\n      return this.errorHandler(err, c);\n    }\n    throw err;\n  }\n  #dispatch(request, executionCtx, env, method) {\n    if (method === \"HEAD\") {\n      return (async () => new Response(null, await this.#dispatch(request, executionCtx, env, \"GET\")))();\n    }\n    const path = this.getPath(request, { env });\n    const matchResult = this.router.match(method, path);\n    const c = new Context(request, {\n      path,\n      matchResult,\n      env,\n      executionCtx,\n      notFoundHandler: this.#notFoundHandler\n    });\n    if (matchResult[0].length === 1) {\n      let res;\n      try {\n        res = matchResult[0][0][0][0](c, async () => {\n          c.res = await this.#notFoundHandler(c);\n        });\n      } catch (err) {\n        return this.#handleError(err, c);\n      }\n      return res instanceof Promise ? res.then(\n        (resolved) => resolved || (c.finalized ? c.res : this.#notFoundHandler(c))\n      ).catch((err) => this.#handleError(err, c)) : res ?? this.#notFoundHandler(c);\n    }\n    const composed = compose(matchResult[0], this.errorHandler, this.#notFoundHandler);\n    return (async () => {\n      try {\n        const context = await composed(c);\n        if (!context.finalized) {\n          throw new Error(\n            \"Context is not finalized. Did you forget to return a Response object or `await next()`?\"\n          );\n        }\n        return context.res;\n      } catch (err) {\n        return this.#handleError(err, c);\n      }\n    })();\n  }\n  /**\n   * `.fetch()` will be entry point of your app.\n   *\n   * @see {@link https://hono.dev/docs/api/hono#fetch}\n   *\n   * @param {Request} request - request Object of request\n   * @param {Env} Env - env Object\n   * @param {ExecutionContext} - context of execution\n   * @returns {Response | Promise<Response>} response of request\n   *\n   */\n  fetch = (request, ...rest) => {\n    return this.#dispatch(request, rest[1], rest[0], request.method);\n  };\n  /**\n   * `.request()` is a useful method for testing.\n   * You can pass a URL or pathname to send a GET request.\n   * app will return a Response object.\n   * ```ts\n   * test('GET /hello is ok', async () => {\n   *   const res = await app.request('/hello')\n   *   expect(res.status).toBe(200)\n   * })\n   * ```\n   * @see https://hono.dev/docs/api/hono#request\n   */\n  request = (input, requestInit, Env, executionCtx) => {\n    if (input instanceof Request) {\n      return this.fetch(requestInit ? new Request(input, requestInit) : input, Env, executionCtx);\n    }\n    input = input.toString();\n    return this.fetch(\n      new Request(\n        /^https?:\\/\\//.test(input) ? input : `http://localhost${mergePath(\"/\", input)}`,\n        requestInit\n      ),\n      Env,\n      executionCtx\n    );\n  };\n  /**\n   * `.fire()` automatically adds a global fetch event listener.\n   * This can be useful for environments that adhere to the Service Worker API, such as non-ES module Cloudflare Workers.\n   * @deprecated\n   * Use `fire` from `hono/service-worker` instead.\n   * ```ts\n   * import { Hono } from 'hono'\n   * import { fire } from 'hono/service-worker'\n   *\n   * const app = new Hono()\n   * // ...\n   * fire(app)\n   * ```\n   * @see https://hono.dev/docs/api/hono#fire\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API\n   * @see https://developers.cloudflare.com/workers/reference/migrate-to-module-workers/\n   */\n  fire = () => {\n    addEventListener(\"fetch\", (event) => {\n      event.respondWith(this.#dispatch(event.request, event, void 0, event.request.method));\n    });\n  };\n};\nexport {\n  Hono as HonoBase\n};\n", "// src/router/reg-exp-router/matcher.ts\nimport { METHOD_NAME_ALL } from \"../../router.js\";\nvar emptyParam = [];\nfunction match(method, path) {\n  const matchers = this.buildAllMatchers();\n  const match2 = ((method2, path2) => {\n    const matcher = matchers[method2] || matchers[METHOD_NAME_ALL];\n    const staticMatch = matcher[2][path2];\n    if (staticMatch) {\n      return staticMatch;\n    }\n    const match3 = path2.match(matcher[0]);\n    if (!match3) {\n      return [[], emptyParam];\n    }\n    const index = match3.indexOf(\"\", 1);\n    return [matcher[1][index], match3];\n  });\n  this.match = match2;\n  return match2(method, path);\n}\nexport {\n  emptyParam,\n  match\n};\n", "// src/router/reg-exp-router/node.ts\nvar LABEL_REG_EXP_STR = \"[^/]+\";\nvar ONLY_WILDCARD_REG_EXP_STR = \".*\";\nvar TAIL_WILDCARD_REG_EXP_STR = \"(?:|/.*)\";\nvar PATH_ERROR = /* @__PURE__ */ Symbol();\nvar regExpMetaChars = new Set(\".\\\\+*[^]$()\");\nfunction compareKey(a, b) {\n  if (a.length === 1) {\n    return b.length === 1 ? a < b ? -1 : 1 : -1;\n  }\n  if (b.length === 1) {\n    return 1;\n  }\n  if (a === ONLY_WILDCARD_REG_EXP_STR || a === TAIL_WILDCARD_REG_EXP_STR) {\n    return 1;\n  } else if (b === ONLY_WILDCARD_REG_EXP_STR || b === TAIL_WILDCARD_REG_EXP_STR) {\n    return -1;\n  }\n  if (a === LABEL_REG_EXP_STR) {\n    return 1;\n  } else if (b === LABEL_REG_EXP_STR) {\n    return -1;\n  }\n  return a.length === b.length ? a < b ? -1 : 1 : b.length - a.length;\n}\nvar Node = class _Node {\n  #index;\n  #varIndex;\n  #children = /* @__PURE__ */ Object.create(null);\n  insert(tokens, index, paramMap, context, pathErrorCheckOnly) {\n    if (tokens.length === 0) {\n      if (this.#index !== void 0) {\n        throw PATH_ERROR;\n      }\n      if (pathErrorCheckOnly) {\n        return;\n      }\n      this.#index = index;\n      return;\n    }\n    const [token, ...restTokens] = tokens;\n    const pattern = token === \"*\" ? restTokens.length === 0 ? [\"\", \"\", ONLY_WILDCARD_REG_EXP_STR] : [\"\", \"\", LABEL_REG_EXP_STR] : token === \"/*\" ? [\"\", \"\", TAIL_WILDCARD_REG_EXP_STR] : token.match(/^\\:([^\\{\\}]+)(?:\\{(.+)\\})?$/);\n    let node;\n    if (pattern) {\n      const name = pattern[1];\n      let regexpStr = pattern[2] || LABEL_REG_EXP_STR;\n      if (name && pattern[2]) {\n        if (regexpStr === \".*\") {\n          throw PATH_ERROR;\n        }\n        regexpStr = regexpStr.replace(/^\\((?!\\?:)(?=[^)]+\\)$)/, \"(?:\");\n        if (/\\((?!\\?:)/.test(regexpStr)) {\n          throw PATH_ERROR;\n        }\n      }\n      node = this.#children[regexpStr];\n      if (!node) {\n        if (Object.keys(this.#children).some(\n          (k) => k !== ONLY_WILDCARD_REG_EXP_STR && k !== TAIL_WILDCARD_REG_EXP_STR\n        )) {\n          throw PATH_ERROR;\n        }\n        if (pathErrorCheckOnly) {\n          return;\n        }\n        node = this.#children[regexpStr] = new _Node();\n        if (name !== \"\") {\n          node.#varIndex = context.varIndex++;\n        }\n      }\n      if (!pathErrorCheckOnly && name !== \"\") {\n        paramMap.push([name, node.#varIndex]);\n      }\n    } else {\n      node = this.#children[token];\n      if (!node) {\n        if (Object.keys(this.#children).some(\n          (k) => k.length > 1 && k !== ONLY_WILDCARD_REG_EXP_STR && k !== TAIL_WILDCARD_REG_EXP_STR\n        )) {\n          throw PATH_ERROR;\n        }\n        if (pathErrorCheckOnly) {\n          return;\n        }\n        node = this.#children[token] = new _Node();\n      }\n    }\n    node.insert(restTokens, index, paramMap, context, pathErrorCheckOnly);\n  }\n  buildRegExpStr() {\n    const childKeys = Object.keys(this.#children).sort(compareKey);\n    const strList = childKeys.map((k) => {\n      const c = this.#children[k];\n      return (typeof c.#varIndex === \"number\" ? `(${k})@${c.#varIndex}` : regExpMetaChars.has(k) ? `\\\\${k}` : k) + c.buildRegExpStr();\n    });\n    if (typeof this.#index === \"number\") {\n      strList.unshift(`#${this.#index}`);\n    }\n    if (strList.length === 0) {\n      return \"\";\n    }\n    if (strList.length === 1) {\n      return strList[0];\n    }\n    return \"(?:\" + strList.join(\"|\") + \")\";\n  }\n};\nexport {\n  Node,\n  PATH_ERROR\n};\n", "// src/router/reg-exp-router/trie.ts\nimport { Node } from \"./node.js\";\nvar Trie = class {\n  #context = { varIndex: 0 };\n  #root = new Node();\n  insert(path, index, pathErrorCheckOnly) {\n    const paramAssoc = [];\n    const groups = [];\n    for (let i = 0; ; ) {\n      let replaced = false;\n      path = path.replace(/\\{[^}]+\\}/g, (m) => {\n        const mark = `@\\\\${i}`;\n        groups[i] = [mark, m];\n        i++;\n        replaced = true;\n        return mark;\n      });\n      if (!replaced) {\n        break;\n      }\n    }\n    const tokens = path.match(/(?::[^\\/]+)|(?:\\/\\*$)|./g) || [];\n    for (let i = groups.length - 1; i >= 0; i--) {\n      const [mark] = groups[i];\n      for (let j = tokens.length - 1; j >= 0; j--) {\n        if (tokens[j].indexOf(mark) !== -1) {\n          tokens[j] = tokens[j].replace(mark, groups[i][1]);\n          break;\n        }\n      }\n    }\n    this.#root.insert(tokens, index, paramAssoc, this.#context, pathErrorCheckOnly);\n    return paramAssoc;\n  }\n  buildRegExp() {\n    let regexp = this.#root.buildRegExpStr();\n    if (regexp === \"\") {\n      return [/^$/, [], []];\n    }\n    let captureIndex = 0;\n    const indexReplacementMap = [];\n    const paramReplacementMap = [];\n    regexp = regexp.replace(/#(\\d+)|@(\\d+)|\\.\\*\\$/g, (_, handlerIndex, paramIndex) => {\n      if (handlerIndex !== void 0) {\n        indexReplacementMap[++captureIndex] = Number(handlerIndex);\n        return \"$()\";\n      }\n      if (paramIndex !== void 0) {\n        paramReplacementMap[Number(paramIndex)] = ++captureIndex;\n        return \"\";\n      }\n      return \"\";\n    });\n    return [new RegExp(`^${regexp}`), indexReplacementMap, paramReplacementMap];\n  }\n};\nexport {\n  Trie\n};\n", "// src/router/reg-exp-router/router.ts\nimport {\n  MESSAGE_MATCHER_IS_ALREADY_BUILT,\n  METHOD_NAME_ALL,\n  UnsupportedPathError\n} from \"../../router.js\";\nimport { checkOptionalParameter } from \"../../utils/url.js\";\nimport { match, emptyParam } from \"./matcher.js\";\nimport { PATH_ERROR } from \"./node.js\";\nimport { Trie } from \"./trie.js\";\nvar nullMatcher = [/^$/, [], /* @__PURE__ */ Object.create(null)];\nvar wildcardRegExpCache = /* @__PURE__ */ Object.create(null);\nfunction buildWildcardRegExp(path) {\n  return wildcardRegExpCache[path] ??= new RegExp(\n    path === \"*\" ? \"\" : `^${path.replace(\n      /\\/\\*$|([.\\\\+*[^\\]$()])/g,\n      (_, metaChar) => metaChar ? `\\\\${metaChar}` : \"(?:|/.*)\"\n    )}$`\n  );\n}\nfunction clearWildcardRegExpCache() {\n  wildcardRegExpCache = /* @__PURE__ */ Object.create(null);\n}\nfunction buildMatcherFromPreprocessedRoutes(routes) {\n  const trie = new Trie();\n  const handlerData = [];\n  if (routes.length === 0) {\n    return nullMatcher;\n  }\n  const routesWithStaticPathFlag = routes.map(\n    (route) => [!/\\*|\\/:/.test(route[0]), ...route]\n  ).sort(\n    ([isStaticA, pathA], [isStaticB, pathB]) => isStaticA ? 1 : isStaticB ? -1 : pathA.length - pathB.length\n  );\n  const staticMap = /* @__PURE__ */ Object.create(null);\n  for (let i = 0, j = -1, len = routesWithStaticPathFlag.length; i < len; i++) {\n    const [pathErrorCheckOnly, path, handlers] = routesWithStaticPathFlag[i];\n    if (pathErrorCheckOnly) {\n      staticMap[path] = [handlers.map(([h]) => [h, /* @__PURE__ */ Object.create(null)]), emptyParam];\n    } else {\n      j++;\n    }\n    let paramAssoc;\n    try {\n      paramAssoc = trie.insert(path, j, pathErrorCheckOnly);\n    } catch (e) {\n      throw e === PATH_ERROR ? new UnsupportedPathError(path) : e;\n    }\n    if (pathErrorCheckOnly) {\n      continue;\n    }\n    handlerData[j] = handlers.map(([h, paramCount]) => {\n      const paramIndexMap = /* @__PURE__ */ Object.create(null);\n      paramCount -= 1;\n      for (; paramCount >= 0; paramCount--) {\n        const [key, value] = paramAssoc[paramCount];\n        paramIndexMap[key] = value;\n      }\n      return [h, paramIndexMap];\n    });\n  }\n  const [regexp, indexReplacementMap, paramReplacementMap] = trie.buildRegExp();\n  for (let i = 0, len = handlerData.length; i < len; i++) {\n    for (let j = 0, len2 = handlerData[i].length; j < len2; j++) {\n      const map = handlerData[i][j]?.[1];\n      if (!map) {\n        continue;\n      }\n      const keys = Object.keys(map);\n      for (let k = 0, len3 = keys.length; k < len3; k++) {\n        map[keys[k]] = paramReplacementMap[map[keys[k]]];\n      }\n    }\n  }\n  const handlerMap = [];\n  for (const i in indexReplacementMap) {\n    handlerMap[i] = handlerData[indexReplacementMap[i]];\n  }\n  return [regexp, handlerMap, staticMap];\n}\nfunction findMiddleware(middleware, path) {\n  if (!middleware) {\n    return void 0;\n  }\n  for (const k of Object.keys(middleware).sort((a, b) => b.length - a.length)) {\n    if (buildWildcardRegExp(k).test(path)) {\n      return [...middleware[k]];\n    }\n  }\n  return void 0;\n}\nvar RegExpRouter = class {\n  name = \"RegExpRouter\";\n  #middleware;\n  #routes;\n  constructor() {\n    this.#middleware = { [METHOD_NAME_ALL]: /* @__PURE__ */ Object.create(null) };\n    this.#routes = { [METHOD_NAME_ALL]: /* @__PURE__ */ Object.create(null) };\n  }\n  add(method, path, handler) {\n    const middleware = this.#middleware;\n    const routes = this.#routes;\n    if (!middleware || !routes) {\n      throw new Error(MESSAGE_MATCHER_IS_ALREADY_BUILT);\n    }\n    if (!middleware[method]) {\n      ;\n      [middleware, routes].forEach((handlerMap) => {\n        handlerMap[method] = /* @__PURE__ */ Object.create(null);\n        Object.keys(handlerMap[METHOD_NAME_ALL]).forEach((p) => {\n          handlerMap[method][p] = [...handlerMap[METHOD_NAME_ALL][p]];\n        });\n      });\n    }\n    if (path === \"/*\") {\n      path = \"*\";\n    }\n    const paramCount = (path.match(/\\/:/g) || []).length;\n    if (/\\*$/.test(path)) {\n      const re = buildWildcardRegExp(path);\n      if (method === METHOD_NAME_ALL) {\n        Object.keys(middleware).forEach((m) => {\n          middleware[m][path] ||= findMiddleware(middleware[m], path) || findMiddleware(middleware[METHOD_NAME_ALL], path) || [];\n        });\n      } else {\n        middleware[method][path] ||= findMiddleware(middleware[method], path) || findMiddleware(middleware[METHOD_NAME_ALL], path) || [];\n      }\n      Object.keys(middleware).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          Object.keys(middleware[m]).forEach((p) => {\n            re.test(p) && middleware[m][p].push([handler, paramCount]);\n          });\n        }\n      });\n      Object.keys(routes).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          Object.keys(routes[m]).forEach(\n            (p) => re.test(p) && routes[m][p].push([handler, paramCount])\n          );\n        }\n      });\n      return;\n    }\n    const paths = checkOptionalParameter(path) || [path];\n    for (let i = 0, len = paths.length; i < len; i++) {\n      const path2 = paths[i];\n      Object.keys(routes).forEach((m) => {\n        if (method === METHOD_NAME_ALL || method === m) {\n          routes[m][path2] ||= [\n            ...findMiddleware(middleware[m], path2) || findMiddleware(middleware[METHOD_NAME_ALL], path2) || []\n          ];\n          routes[m][path2].push([handler, paramCount - len + i + 1]);\n        }\n      });\n    }\n  }\n  match = match;\n  buildAllMatchers() {\n    const matchers = /* @__PURE__ */ Object.create(null);\n    Object.keys(this.#routes).concat(Object.keys(this.#middleware)).forEach((method) => {\n      matchers[method] ||= this.#buildMatcher(method);\n    });\n    this.#middleware = this.#routes = void 0;\n    clearWildcardRegExpCache();\n    return matchers;\n  }\n  #buildMatcher(method) {\n    const routes = [];\n    let hasOwnRoute = method === METHOD_NAME_ALL;\n    [this.#middleware, this.#routes].forEach((r) => {\n      const ownRoute = r[method] ? Object.keys(r[method]).map((path) => [path, r[method][path]]) : [];\n      if (ownRoute.length !== 0) {\n        hasOwnRoute ||= true;\n        routes.push(...ownRoute);\n      } else if (method !== METHOD_NAME_ALL) {\n        routes.push(\n          ...Object.keys(r[METHOD_NAME_ALL]).map((path) => [path, r[METHOD_NAME_ALL][path]])\n        );\n      }\n    });\n    if (!hasOwnRoute) {\n      return null;\n    } else {\n      return buildMatcherFromPreprocessedRoutes(routes);\n    }\n  }\n};\nexport {\n  RegExpRouter\n};\n", "// src/router/smart-router/router.ts\nimport { MESSAGE_MATCHER_IS_ALREADY_BUILT, UnsupportedPathError } from \"../../router.js\";\nvar SmartRouter = class {\n  name = \"SmartRouter\";\n  #routers = [];\n  #routes = [];\n  constructor(init) {\n    this.#routers = init.routers;\n  }\n  add(method, path, handler) {\n    if (!this.#routes) {\n      throw new Error(MESSAGE_MATCHER_IS_ALREADY_BUILT);\n    }\n    this.#routes.push([method, path, handler]);\n  }\n  match(method, path) {\n    if (!this.#routes) {\n      throw new Error(\"Fatal error\");\n    }\n    const routers = this.#routers;\n    const routes = this.#routes;\n    const len = routers.length;\n    let i = 0;\n    let res;\n    for (; i < len; i++) {\n      const router = routers[i];\n      try {\n        for (let i2 = 0, len2 = routes.length; i2 < len2; i2++) {\n          router.add(...routes[i2]);\n        }\n        res = router.match(method, path);\n      } catch (e) {\n        if (e instanceof UnsupportedPathError) {\n          continue;\n        }\n        throw e;\n      }\n      this.match = router.match.bind(router);\n      this.#routers = [router];\n      this.#routes = void 0;\n      break;\n    }\n    if (i === len) {\n      throw new Error(\"Fatal error\");\n    }\n    this.name = `SmartRouter + ${this.activeRouter.name}`;\n    return res;\n  }\n  get activeRouter() {\n    if (this.#routes || this.#routers.length !== 1) {\n      throw new Error(\"No active router has been determined yet.\");\n    }\n    return this.#routers[0];\n  }\n};\nexport {\n  SmartRouter\n};\n", "// src/router/trie-router/node.ts\nimport { METHOD_NAME_ALL } from \"../../router.js\";\nimport { getPattern, splitPath, splitRoutingPath } from \"../../utils/url.js\";\nvar emptyParams = /* @__PURE__ */ Object.create(null);\nvar Node = class _Node {\n  #methods;\n  #children;\n  #patterns;\n  #order = 0;\n  #params = emptyParams;\n  constructor(method, handler, children) {\n    this.#children = children || /* @__PURE__ */ Object.create(null);\n    this.#methods = [];\n    if (method && handler) {\n      const m = /* @__PURE__ */ Object.create(null);\n      m[method] = { handler, possibleKeys: [], score: 0 };\n      this.#methods = [m];\n    }\n    this.#patterns = [];\n  }\n  insert(method, path, handler) {\n    this.#order = ++this.#order;\n    let curNode = this;\n    const parts = splitRoutingPath(path);\n    const possibleKeys = [];\n    for (let i = 0, len = parts.length; i < len; i++) {\n      const p = parts[i];\n      const nextP = parts[i + 1];\n      const pattern = getPattern(p, nextP);\n      const key = Array.isArray(pattern) ? pattern[0] : p;\n      if (key in curNode.#children) {\n        curNode = curNode.#children[key];\n        if (pattern) {\n          possibleKeys.push(pattern[1]);\n        }\n        continue;\n      }\n      curNode.#children[key] = new _Node();\n      if (pattern) {\n        curNode.#patterns.push(pattern);\n        possibleKeys.push(pattern[1]);\n      }\n      curNode = curNode.#children[key];\n    }\n    curNode.#methods.push({\n      [method]: {\n        handler,\n        possibleKeys: possibleKeys.filter((v, i, a) => a.indexOf(v) === i),\n        score: this.#order\n      }\n    });\n    return curNode;\n  }\n  #getHandlerSets(node, method, nodeParams, params) {\n    const handlerSets = [];\n    for (let i = 0, len = node.#methods.length; i < len; i++) {\n      const m = node.#methods[i];\n      const handlerSet = m[method] || m[METHOD_NAME_ALL];\n      const processedSet = {};\n      if (handlerSet !== void 0) {\n        handlerSet.params = /* @__PURE__ */ Object.create(null);\n        handlerSets.push(handlerSet);\n        if (nodeParams !== emptyParams || params && params !== emptyParams) {\n          for (let i2 = 0, len2 = handlerSet.possibleKeys.length; i2 < len2; i2++) {\n            const key = handlerSet.possibleKeys[i2];\n            const processed = processedSet[handlerSet.score];\n            handlerSet.params[key] = params?.[key] && !processed ? params[key] : nodeParams[key] ?? params?.[key];\n            processedSet[handlerSet.score] = true;\n          }\n        }\n      }\n    }\n    return handlerSets;\n  }\n  search(method, path) {\n    const handlerSets = [];\n    this.#params = emptyParams;\n    const curNode = this;\n    let curNodes = [curNode];\n    const parts = splitPath(path);\n    const curNodesQueue = [];\n    for (let i = 0, len = parts.length; i < len; i++) {\n      const part = parts[i];\n      const isLast = i === len - 1;\n      const tempNodes = [];\n      for (let j = 0, len2 = curNodes.length; j < len2; j++) {\n        const node = curNodes[j];\n        const nextNode = node.#children[part];\n        if (nextNode) {\n          nextNode.#params = node.#params;\n          if (isLast) {\n            if (nextNode.#children[\"*\"]) {\n              handlerSets.push(\n                ...this.#getHandlerSets(nextNode.#children[\"*\"], method, node.#params)\n              );\n            }\n            handlerSets.push(...this.#getHandlerSets(nextNode, method, node.#params));\n          } else {\n            tempNodes.push(nextNode);\n          }\n        }\n        for (let k = 0, len3 = node.#patterns.length; k < len3; k++) {\n          const pattern = node.#patterns[k];\n          const params = node.#params === emptyParams ? {} : { ...node.#params };\n          if (pattern === \"*\") {\n            const astNode = node.#children[\"*\"];\n            if (astNode) {\n              handlerSets.push(...this.#getHandlerSets(astNode, method, node.#params));\n              astNode.#params = params;\n              tempNodes.push(astNode);\n            }\n            continue;\n          }\n          const [key, name, matcher] = pattern;\n          if (!part && !(matcher instanceof RegExp)) {\n            continue;\n          }\n          const child = node.#children[key];\n          const restPathString = parts.slice(i).join(\"/\");\n          if (matcher instanceof RegExp) {\n            const m = matcher.exec(restPathString);\n            if (m) {\n              params[name] = m[0];\n              handlerSets.push(...this.#getHandlerSets(child, method, node.#params, params));\n              if (Object.keys(child.#children).length) {\n                child.#params = params;\n                const componentCount = m[0].match(/\\//)?.length ?? 0;\n                const targetCurNodes = curNodesQueue[componentCount] ||= [];\n                targetCurNodes.push(child);\n              }\n              continue;\n            }\n          }\n          if (matcher === true || matcher.test(part)) {\n            params[name] = part;\n            if (isLast) {\n              handlerSets.push(...this.#getHandlerSets(child, method, params, node.#params));\n              if (child.#children[\"*\"]) {\n                handlerSets.push(\n                  ...this.#getHandlerSets(child.#children[\"*\"], method, params, node.#params)\n                );\n              }\n            } else {\n              child.#params = params;\n              tempNodes.push(child);\n            }\n          }\n        }\n      }\n      curNodes = tempNodes.concat(curNodesQueue.shift() ?? []);\n    }\n    if (handlerSets.length > 1) {\n      handlerSets.sort((a, b) => {\n        return a.score - b.score;\n      });\n    }\n    return [handlerSets.map(({ handler, params }) => [handler, params])];\n  }\n};\nexport {\n  Node\n};\n", "// src/router/trie-router/router.ts\nimport { checkOptionalParameter } from \"../../utils/url.js\";\nimport { Node } from \"./node.js\";\nvar TrieRouter = class {\n  name = \"TrieRouter\";\n  #node;\n  constructor() {\n    this.#node = new Node();\n  }\n  add(method, path, handler) {\n    const results = checkOptionalParameter(path);\n    if (results) {\n      for (let i = 0, len = results.length; i < len; i++) {\n        this.#node.insert(method, results[i], handler);\n      }\n      return;\n    }\n    this.#node.insert(method, path, handler);\n  }\n  match(method, path) {\n    return this.#node.search(method, path);\n  }\n};\nexport {\n  TrieRouter\n};\n", "// src/hono.ts\nimport { HonoBase } from \"./hono-base.js\";\nimport { RegExpRouter } from \"./router/reg-exp-router/index.js\";\nimport { SmartRouter } from \"./router/smart-router/index.js\";\nimport { TrieRouter } from \"./router/trie-router/index.js\";\nvar Hono = class extends HonoBase {\n  /**\n   * Creates an instance of the Hono class.\n   *\n   * @param options - Optional configuration options for the Hono instance.\n   */\n  constructor(options = {}) {\n    super(options);\n    this.router = options.router ?? new SmartRouter({\n      routers: [new RegExpRouter(), new TrieRouter()]\n    });\n  }\n};\nexport {\n  Hono\n};\n", "// payment.ts - Payment processing integration module (Stripe/Square ready, extensible for banks/EPS)\r\n// This module provides backend endpoints for initiating and verifying payments.\r\n// Extend with additional providers as needed.\r\n\r\nimport { Hono } from 'hono';\r\nimport { auditPayment } from './utils/audit';\r\n\r\nexport const paymentRouter = new Hono();\r\n\r\ninterface PaymentIntentRequest {\r\n  amount: number;\r\n  currency?: string;\r\n  provider: 'stripe' | 'square' | 'bank';\r\n  customer_email: string;\r\n  description?: string;\r\n  metadata?: Record<string, string>;\r\n}\r\n\r\ninterface PaymentVerifyRequest {\r\n  transaction_id: string;\r\n  provider: 'stripe' | 'square' | 'bank';\r\n}\r\n\r\n// POST /api/payment/intent - Create a payment intent (Stripe/Square)\r\npaymentRouter.post('/intent', async (c) => {\r\n  try {\r\n    const body: PaymentIntentRequest = await c.req.json();\r\n    const { amount, currency = 'USD', provider, customer_email, description, metadata } = body;\r\n\r\n    // Validate required fields\r\n    if (!amount || !provider || !customer_email) {\r\n      return c.json({ error: 'Missing required fields: amount, provider, customer_email' }, 400);\r\n    }\r\n\r\n    if (amount <= 0) {\r\n      return c.json({ error: 'Amount must be greater than 0' }, 400);\r\n    }\r\n\r\n    let paymentIntent: any;\r\n\r\n    switch (provider) {\r\n      case 'stripe':\r\n        // Stripe integration\r\n        if (!(c.env as any).STRIPE_SECRET_KEY) {\r\n          return c.json({ error: 'Stripe not configured' }, 500);\r\n        }\r\n\r\n        const stripeResponse = await fetch('https://api.stripe.com/v1/payment_intents', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Authorization': `Bearer ${(c.env as any).STRIPE_SECRET_KEY}`,\r\n            'Content-Type': 'application/x-www-form-urlencoded',\r\n          },\r\n          body: new URLSearchParams({\r\n            amount: (amount * 100).toString(), // Convert to cents\r\n            currency: currency.toLowerCase(),\r\n            'metadata[customer_email]': customer_email,\r\n            'metadata[description]': description || 'Tax preparation service',\r\n            ...Object.entries(metadata || {}).reduce((acc, [key, val]) => ({\r\n              ...acc,\r\n              [`metadata[${key}]`]: val\r\n            }), {})\r\n          })\r\n        });\r\n\r\n        if (!stripeResponse.ok) {\r\n          const error = await stripeResponse.json() as any;\r\n          throw new Error(`Stripe error: ${error.error?.message || 'Unknown error'}`);\r\n        }\r\n\r\n        paymentIntent = await stripeResponse.json();\r\n        \r\n        // Audit log\r\n        const user = c.get('user') || { id: 0, email: customer_email, role: 'client' };\r\n        await auditPayment((c.env as any), paymentIntent.id, amount, user, 'initiated', c.req.raw);\r\n\r\n        return c.json({\r\n          success: true,\r\n          client_secret: paymentIntent.client_secret,\r\n          transaction_id: paymentIntent.id,\r\n          provider: 'stripe'\r\n        });\r\n\r\n      case 'square':\r\n        // Square integration\r\n        if (!(c.env as any).SQUARE_ACCESS_TOKEN || !(c.env as any).SQUARE_LOCATION_ID) {\r\n          return c.json({ error: 'Square not configured' }, 500);\r\n        }\r\n\r\n        const squareResponse = await fetch('https://connect.squareup.com/v2/payments', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Authorization': `Bearer ${(c.env as any).SQUARE_ACCESS_TOKEN}`,\r\n            'Content-Type': 'application/json',\r\n            'Square-Version': '2023-12-13'\r\n          },\r\n          body: JSON.stringify({\r\n            idempotency_key: crypto.randomUUID(),\r\n            amount_money: {\r\n              amount: amount * 100, // Convert to cents\r\n              currency\r\n            },\r\n            source_id: 'PLACEHOLDER_SOURCE', // Client provides source_id from Square.js\r\n            location_id: (c.env as any).SQUARE_LOCATION_ID,\r\n            customer_email,\r\n            note: description || 'Tax preparation service'\r\n          })\r\n        });\r\n\r\n        if (!squareResponse.ok) {\r\n          const error = await squareResponse.json() as any;\r\n          throw new Error(`Square error: ${error.errors?.[0]?.detail || 'Unknown error'}`);\r\n        }\r\n\r\n        paymentIntent = await squareResponse.json();\r\n        \r\n        return c.json({\r\n          success: true,\r\n          transaction_id: paymentIntent.payment.id,\r\n          provider: 'square',\r\n          status: paymentIntent.payment.status\r\n        });\r\n\r\n      case 'bank':\r\n        // Bank ACH transfer (placeholder - requires bank integration)\r\n        return c.json({\r\n          success: true,\r\n          message: 'Bank ACH integration - manual processing required',\r\n          transaction_id: `BANK_${Date.now()}`,\r\n          provider: 'bank',\r\n          instructions: 'Bank transfer details will be sent to your email'\r\n        });\r\n\r\n      default:\r\n        return c.json({ error: 'Unsupported payment provider' }, 400);\r\n    }\r\n  } catch (error: any) {\r\n    console.error('Payment intent error:', error);\r\n    return c.json({ error: error.message || 'Payment processing failed' }, 500);\r\n  }\r\n});\r\n\r\n// POST /api/payment/verify - Verify payment status\r\npaymentRouter.post('/verify', async (c) => {\r\n  try {\r\n    const body: PaymentVerifyRequest = await c.req.json();\r\n    const { transaction_id, provider } = body;\r\n\r\n    if (!transaction_id || !provider) {\r\n      return c.json({ error: 'Missing required fields: transaction_id, provider' }, 400);\r\n    }\r\n\r\n    let paymentStatus: any;\r\n\r\n    switch (provider) {\r\n      case 'stripe':\r\n        if (!(c.env as any).STRIPE_SECRET_KEY) {\r\n          return c.json({ error: 'Stripe not configured' }, 500);\r\n        }\r\n\r\n        const stripeResponse = await fetch(`https://api.stripe.com/v1/payment_intents/${transaction_id}`, {\r\n          headers: {\r\n            'Authorization': `Bearer ${(c.env as any).STRIPE_SECRET_KEY}`,\r\n          }\r\n        });\r\n\r\n        if (!stripeResponse.ok) {\r\n          const error = await stripeResponse.json() as any;\r\n          throw new Error(`Stripe error: ${error.error?.message || 'Unknown error'}`);\r\n        }\r\n\r\n        paymentStatus = await stripeResponse.json();\r\n        \r\n        // Audit log\r\n        const user = c.get('user') || { id: 0, email: 'unknown', role: 'system' };\r\n        const status = paymentStatus.status === 'succeeded' ? 'completed' : 'failed';\r\n        await auditPayment((c.env as any), transaction_id, paymentStatus.amount / 100, user, status, c.req.raw);\r\n\r\n        return c.json({\r\n          success: true,\r\n          status: paymentStatus.status,\r\n          amount: paymentStatus.amount / 100,\r\n          currency: paymentStatus.currency,\r\n          verified: paymentStatus.status === 'succeeded'\r\n        });\r\n\r\n      case 'square':\r\n        if (!(c.env as any).SQUARE_ACCESS_TOKEN) {\r\n          return c.json({ error: 'Square not configured' }, 500);\r\n        }\r\n\r\n        const squareResponse = await fetch(`https://connect.squareup.com/v2/payments/${transaction_id}`, {\r\n          headers: {\r\n            'Authorization': `Bearer ${(c.env as any).SQUARE_ACCESS_TOKEN}`,\r\n            'Square-Version': '2023-12-13'\r\n          }\r\n        });\r\n\r\n        if (!squareResponse.ok) {\r\n          const error = await squareResponse.json() as any;\r\n          throw new Error(`Square error: ${error.errors?.[0]?.detail || 'Unknown error'}`);\r\n        }\r\n\r\n        paymentStatus = await squareResponse.json();\r\n\r\n        return c.json({\r\n          success: true,\r\n          status: paymentStatus.payment.status,\r\n          amount: paymentStatus.payment.amount_money.amount / 100,\r\n          currency: paymentStatus.payment.amount_money.currency,\r\n          verified: paymentStatus.payment.status === 'COMPLETED'\r\n        });\r\n\r\n      case 'bank':\r\n        // Bank payment verification (manual process)\r\n        return c.json({\r\n          success: true,\r\n          status: 'pending_verification',\r\n          message: 'Bank payments require manual verification',\r\n          verified: false\r\n        });\r\n\r\n      default:\r\n        return c.json({ error: 'Unsupported payment provider' }, 400);\r\n    }\r\n  } catch (error: any) {\r\n    console.error('Payment verification error:', error);\r\n    return c.json({ error: error.message || 'Payment verification failed' }, 500);\r\n  }\r\n});\r\n\r\n// Extend with additional endpoints for EPS, banks, etc.\r\n", "/**\r\n * IRS MeF (Modernized e-File) A2A Web Services Integration\r\n * \r\n * ATS \u2192 Production Gate Compliant Implementation\r\n * \r\n * \u2705 Requirement 1: Strong Auth / Certificate Enrollment\r\n *\r\n * === Certificate Requirements for E-File Transmission ===\r\n *\r\n * To enable IRS e-file transmission, the following PEM-encoded certificates/keys must be securely provided as environment variables:\r\n *   - MEF_CLIENT_CERT: IRS-issued client certificate (PEM format)\r\n *   - MEF_CLIENT_KEY:  IRS-issued client private key (PEM format)\r\n *   - MEF_CA_BUNDLE:   IRS CA bundle (PEM, optional but recommended)\r\n *\r\n * These must be securely injected into the Worker environment (e.g., Wrangler secrets, environment variables, or encrypted config).\r\n *\r\n * If any are missing, the Worker will operate in test mode and will NOT transmit to the IRS.\r\n * \u2705 Requirement 2A: SendSubmissions\r\n * \u2705 Requirement 2B: GetSubmissionStatus\r\n * \u2705 Requirement 2C: GetAck / GetAcks / GetNewAcks (idempotent)\r\n * \u2705 Requirement 3: Schema validation before sending\r\n * \u2705 Requirement 4: ATS test scenarios support\r\n * \u2705 Requirement 5: Config toggle, secure secrets, logging, kill switch\r\n * \r\n * Reference Documents:\r\n * - IRS Publication 4164 (MeF Business Rules)\r\n * - IRS STP Reference Guide\r\n * - MeF WSDL/Schema packages (TY2025/PY2026 R10.9)\r\n */\r\n\r\nimport { \r\n  MEF_CONFIG, \r\n  EFIN_PROFILES, \r\n  getMefEndpoint, \r\n  getActiveEtin, \r\n  getActiveProfile,\r\n  isTransmissionEnabled,\r\n  isProduction,\r\n  validateSoftwareDeveloperApproval\r\n} from './efileProviders';\r\nimport { v4 as uuid } from 'uuid';\r\n\r\n// ============================================================================\r\n// TYPES\r\n// ============================================================================\r\n\r\nexport type MefStatus = \r\n  | 'Received'\r\n  | 'Processing'\r\n  | 'Accepted'\r\n  | 'Rejected'\r\n  | 'Error'\r\n  | 'Pending';\r\n\r\nexport interface MefSubmission {\r\n  submissionId: string;\r\n  efin: string;\r\n  etin: string;\r\n  timestamp: string;\r\n  status: MefStatus;\r\n  returnType: string;\r\n  taxYear: string;\r\n  environment: 'ATS' | 'PRODUCTION';\r\n  requestXml?: string;  // Stored for audit\r\n  responseXml?: string; // Stored for audit\r\n}\r\n\r\nexport interface MefAcknowledgment {\r\n  ackId: string;\r\n  submissionId: string;\r\n  status: 'Accepted' | 'Rejected';\r\n  timestamp: string;\r\n  errors?: MefError[];\r\n  dcn?: string;\r\n  taxYear?: string;\r\n  returnType?: string;\r\n}\r\n\r\nexport interface MefError {\r\n  errorCode: string;\r\n  errorCategory: string;\r\n  errorMessage: string;\r\n  ruleNumber?: string;\r\n  xpath?: string;\r\n  severity?: 'Error' | 'Warning' | 'Alert';\r\n}\r\n\r\nexport interface MefCertConfig {\r\n  clientCertPem: string;\r\n  clientKeyPem: string;\r\n  caBundlePem?: string;\r\n}\r\n\r\nexport interface MefOperationResult<T> {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: string;\r\n  requestId: string;\r\n  timestamp: string;\r\n  environment: 'ATS' | 'PRODUCTION';\r\n  durationMs: number;\r\n}\r\n\r\nexport interface ValidationResult {\r\n  valid: boolean;\r\n  errors: ValidationError[];\r\n  warnings: ValidationError[];\r\n}\r\n\r\nexport interface ValidationError {\r\n  code: string;\r\n  message: string;\r\n  field?: string;\r\n  xpath?: string;\r\n  severity: 'error' | 'warning';\r\n}\r\n\r\n// ============================================================================\r\n// LOGGING SYSTEM\r\n// ============================================================================\r\n\r\nexport type LogLevel = 'DEBUG' | 'INFO' | 'WARN' | 'ERROR';\r\n\r\nexport interface MefLogEntry {\r\n  timestamp: string;\r\n  level: LogLevel;\r\n  operation: string;\r\n  submissionId?: string;\r\n  environment: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n  durationMs?: number;\r\n}\r\n\r\nclass MefLogger {\r\n  private logs: MefLogEntry[] = [];\r\n  private env: any;\r\n  \r\n  constructor(env?: any) {\r\n    this.env = env;\r\n  }\r\n  \r\n  log(level: LogLevel, operation: string, message: string, details?: Record<string, any>): MefLogEntry {\r\n    const entry: MefLogEntry = {\r\n      timestamp: new Date().toISOString(),\r\n      level,\r\n      operation,\r\n      environment: MEF_CONFIG.environment,\r\n      message,\r\n      details,\r\n      submissionId: details?.submissionId\r\n    };\r\n    \r\n    this.logs.push(entry);\r\n    \r\n    // Console output\r\n    const prefix = `[MeF][${level}][${operation}]`;\r\n    console.log(`${prefix} ${message}`, details ? JSON.stringify(details) : '');\r\n    \r\n    // Store to DB if available\r\n    this.persistLog(entry);\r\n    \r\n    return entry;\r\n  }\r\n  \r\n  private async persistLog(entry: MefLogEntry) {\r\n    if (this.env?.DB) {\r\n      try {\r\n        await this.env.DB.prepare(`\r\n          INSERT INTO mef_logs (timestamp, level, operation, submission_id, environment, message, details_json)\r\n          VALUES (?, ?, ?, ?, ?, ?, ?)\r\n        `).bind(\r\n          entry.timestamp,\r\n          entry.level,\r\n          entry.operation,\r\n          entry.submissionId || null,\r\n          entry.environment,\r\n          entry.message,\r\n          entry.details ? JSON.stringify(entry.details) : null\r\n        ).run();\r\n      } catch (e) {\r\n        console.error('Failed to persist MeF log:', e);\r\n      }\r\n    }\r\n  }\r\n  \r\n  debug(operation: string, message: string, details?: Record<string, any>) {\r\n    return this.log('DEBUG', operation, message, details);\r\n  }\r\n  \r\n  info(operation: string, message: string, details?: Record<string, any>) {\r\n    return this.log('INFO', operation, message, details);\r\n  }\r\n  \r\n  warn(operation: string, message: string, details?: Record<string, any>) {\r\n    return this.log('WARN', operation, message, details);\r\n  }\r\n  \r\n  error(operation: string, message: string, details?: Record<string, any>) {\r\n    return this.log('ERROR', operation, message, details);\r\n  }\r\n  \r\n  getRecentLogs(count: number = 100): MefLogEntry[] {\r\n    return this.logs.slice(-count);\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// SCHEMA VALIDATION\r\n// \u2705 Requirement 3: Validate XML before sending\r\n// ============================================================================\r\n\r\nconst REQUIRED_ELEMENTS_BY_RETURN_TYPE: Record<string, string[]> = {\r\n  '1040': [\r\n    'ReturnHeader',\r\n    'FilingStatus',\r\n    'Filer/PrimarySSN',\r\n    'Filer/Name',\r\n    'ReturnData'\r\n  ],\r\n  '1040-SR': [\r\n    'ReturnHeader',\r\n    'FilingStatus',\r\n    'Filer/PrimarySSN',\r\n    'Filer/Name',\r\n    'ReturnData'\r\n  ],\r\n  '1040-NR': [\r\n    'ReturnHeader',\r\n    'FilingStatus',\r\n    'Filer/PrimarySSN',\r\n    'Filer/Name',\r\n    'ReturnData'\r\n  ]\r\n};\r\n\r\nexport function validateReturnXml(xml: string, returnType: string): ValidationResult {\r\n  const errors: ValidationError[] = [];\r\n  const warnings: ValidationError[] = [];\r\n  \r\n  // Basic structure checks\r\n  if (!xml || xml.trim().length === 0) {\r\n    errors.push({\r\n      code: 'EMPTY_XML',\r\n      message: 'Return XML is empty',\r\n      severity: 'error'\r\n    });\r\n    return { valid: false, errors, warnings };\r\n  }\r\n  \r\n  if (!xml.includes('<?xml')) {\r\n    errors.push({\r\n      code: 'MISSING_XML_DECL',\r\n      message: 'Missing XML declaration',\r\n      severity: 'error'\r\n    });\r\n  }\r\n  \r\n  // Check for well-formed XML\r\n  try {\r\n    // Basic tag matching check\r\n    const openTags = xml.match(/<[^/][^>]*[^/]>/g) || [];\r\n    const closeTags = xml.match(/<\\/[^>]+>/g) || [];\r\n    if (openTags.length !== closeTags.length) {\r\n      warnings.push({\r\n        code: 'TAG_MISMATCH',\r\n        message: 'Potential mismatched XML tags',\r\n        severity: 'warning'\r\n      });\r\n    }\r\n  } catch (e) {\r\n    errors.push({\r\n      code: 'MALFORMED_XML',\r\n      message: 'XML appears to be malformed',\r\n      severity: 'error'\r\n    });\r\n  }\r\n  \r\n  // Check required elements\r\n  const requiredElements = REQUIRED_ELEMENTS_BY_RETURN_TYPE[returnType] || [];\r\n  for (const element of requiredElements) {\r\n    const elementName = element.split('/').pop()!;\r\n    if (!xml.includes(elementName)) {\r\n      errors.push({\r\n        code: 'MISSING_ELEMENT',\r\n        message: `Missing required element: ${element}`,\r\n        field: element,\r\n        severity: 'error'\r\n      });\r\n    }\r\n  }\r\n  \r\n  // SSN format validation\r\n  const ssnMatch = xml.match(/<.*SSN>(\\d+)<\\/.*SSN>/);\r\n  if (ssnMatch) {\r\n    const ssn = ssnMatch[1];\r\n    if (!/^\\d{9}$/.test(ssn)) {\r\n      errors.push({\r\n        code: 'INVALID_SSN',\r\n        message: 'SSN must be exactly 9 digits',\r\n        field: 'SSN',\r\n        severity: 'error'\r\n      });\r\n    }\r\n    // Check for test SSNs in production\r\n    if (isProduction() && ssn.startsWith('9')) {\r\n      errors.push({\r\n        code: 'TEST_SSN_IN_PROD',\r\n        message: 'Test SSN (starting with 9) cannot be used in production',\r\n        field: 'SSN',\r\n        severity: 'error'\r\n      });\r\n    }\r\n  }\r\n  \r\n  // Check tax year\r\n  const taxYearMatch = xml.match(/<TaxYr>(\\d{4})<\\/TaxYr>/);\r\n  if (taxYearMatch) {\r\n    const year = parseInt(taxYearMatch[1]);\r\n    if (year < 2020 || year > new Date().getFullYear()) {\r\n      warnings.push({\r\n        code: 'UNUSUAL_TAX_YEAR',\r\n        message: `Tax year ${year} seems unusual`,\r\n        field: 'TaxYr',\r\n        severity: 'warning'\r\n      });\r\n    }\r\n  }\r\n  \r\n  return {\r\n    valid: errors.length === 0,\r\n    errors,\r\n    warnings\r\n  };\r\n}\r\n\r\n// ============================================================================\r\n// RETRY LOGIC\r\n// ============================================================================\r\n\r\nasync function withRetry<T>(\r\n  operation: () => Promise<T>,\r\n  operationName: string,\r\n  logger: MefLogger\r\n): Promise<T> {\r\n  const { max_attempts, initial_delay_ms, backoff_multiplier, max_delay_ms } = MEF_CONFIG.retry;\r\n  \r\n  let lastError: Error | null = null;\r\n  let delay = initial_delay_ms;\r\n  \r\n  for (let attempt = 1; attempt <= max_attempts; attempt++) {\r\n    try {\r\n      logger.debug(operationName, `Attempt ${attempt}/${max_attempts}`);\r\n      return await operation();\r\n    } catch (error: any) {\r\n      lastError = error;\r\n      logger.warn(operationName, `Attempt ${attempt} failed: ${error.message}`, {\r\n        attempt,\r\n        maxAttempts: max_attempts,\r\n        error: error.message\r\n      });\r\n      \r\n      if (attempt < max_attempts) {\r\n        logger.debug(operationName, `Waiting ${delay}ms before retry`);\r\n        await new Promise(resolve => setTimeout(resolve, delay));\r\n        delay = Math.min(delay * backoff_multiplier, max_delay_ms);\r\n      }\r\n    }\r\n  }\r\n  \r\n  throw lastError || new Error('Operation failed after retries');\r\n}\r\n\r\n// ============================================================================\r\n// MEF CLIENT\r\n// ============================================================================\r\n\r\nexport class MefClient {\r\n  private config: typeof MEF_CONFIG;\r\n  private certConfig: MefCertConfig | null = null;\r\n  private logger: MefLogger;\r\n  private env: any;\r\n  private processedAcks: Set<string> = new Set(); // For idempotency\r\n  \r\n  constructor(env?: any) {\r\n    this.config = MEF_CONFIG;\r\n    this.env = env;\r\n    this.logger = new MefLogger(env);\r\n\r\n    // === Certificate Validation ===\r\n    // All three are recommended for secure transmission\r\n    const hasCert = !!env?.MEF_CLIENT_CERT;\r\n    const hasKey = !!env?.MEF_CLIENT_KEY;\r\n    const hasCABundle = !!env?.MEF_CA_BUNDLE;\r\n\r\n    if (hasCert && hasKey) {\r\n      this.certConfig = {\r\n        clientCertPem: env.MEF_CLIENT_CERT,\r\n        clientKeyPem: env.MEF_CLIENT_KEY,\r\n        caBundlePem: env.MEF_CA_BUNDLE\r\n      };\r\n      if (!hasCABundle) {\r\n        this.logger.warn('Init', 'CA bundle missing: IRS CA chain validation may fail.');\r\n      }\r\n      this.logger.info('Init', 'Certificate configuration loaded. E-file transmission ENABLED.');\r\n    } else {\r\n      // Log exactly what is missing\r\n      if (!hasCert && !hasKey) {\r\n        this.logger.error('Init', 'Missing BOTH MEF_CLIENT_CERT and MEF_CLIENT_KEY. E-file transmission DISABLED.');\r\n      } else if (!hasCert) {\r\n        this.logger.error('Init', 'Missing MEF_CLIENT_CERT. E-file transmission DISABLED.');\r\n      } else if (!hasKey) {\r\n        this.logger.error('Init', 'Missing MEF_CLIENT_KEY. E-file transmission DISABLED.');\r\n      }\r\n      this.logger.warn('Init', 'No certificate configuration - using test mode. IRS transmission is NOT possible.');\r\n    }\r\n\r\n    // Log initialization\r\n    const profile = getActiveProfile();\r\n    this.logger.info('Init', 'MeF Client initialized', {\r\n      environment: this.config.environment,\r\n      efin: profile.efin,\r\n      etin: getActiveEtin(),\r\n      profile: profile.firm_name,\r\n      transmissionsEnabled: isTransmissionEnabled(),\r\n      hasClientCert: hasCert,\r\n      hasClientKey: hasKey,\r\n      hasCABundle: hasCABundle\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Pre-flight checks before any operation\r\n   */\r\n  private preflight(): { ok: boolean; error?: string } {\r\n    // Check kill switch\r\n    if (!isTransmissionEnabled()) {\r\n      return { ok: false, error: 'Transmissions are disabled (kill switch active)' };\r\n    }\r\n    \r\n    // Validate Software Developer approval\r\n    const approval = validateSoftwareDeveloperApproval();\r\n    if (!approval.valid) {\r\n      return { ok: false, error: approval.message };\r\n    }\r\n    \r\n    return { ok: true };\r\n  }\r\n\r\n  /**\r\n   * Generate unique Submission ID\r\n   */\r\n  generateSubmissionId(): string {\r\n    const profile = getActiveProfile();\r\n    const timestamp = Date.now().toString(36);\r\n    const random = uuid().slice(0, 8);\r\n    return `${profile.efin}-${timestamp}-${random}`.toUpperCase();\r\n  }\r\n\r\n  /**\r\n   * Build SOAP envelope\r\n   */\r\n  private buildSoapEnvelope(operation: string, payload: string): string {\r\n    const profile = getActiveProfile();\r\n    const etin = getActiveEtin();\r\n    \r\n    return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<soapenv:Envelope \r\n  xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"\r\n  xmlns:mef=\"urn:us:gov:treasury:irs:mef\">\r\n  <soapenv:Header>\r\n    <mef:TransmitterHeader>\r\n      <mef:EFIN>${profile.efin}</mef:EFIN>\r\n      <mef:ETIN>${etin}</mef:ETIN>\r\n      <mef:Timestamp>${new Date().toISOString()}</mef:Timestamp>\r\n      <mef:SoftwareId>ROSSTAXPREP-2026</mef:SoftwareId>\r\n    </mef:TransmitterHeader>\r\n  </soapenv:Header>\r\n  <soapenv:Body>\r\n    <mef:${operation}Request>\r\n      ${payload}\r\n    </mef:${operation}Request>\r\n  </soapenv:Body>\r\n</soapenv:Envelope>`;\r\n  }\r\n\r\n  /**\r\n   * \u2705 Requirement 2A: SendSubmissions\r\n   */\r\n  async sendSubmission(\r\n    returnXml: string,\r\n    returnType: string,\r\n    taxYear: string\r\n  ): Promise<MefOperationResult<MefSubmission>> {\r\n    const startTime = Date.now();\r\n    const requestId = uuid();\r\n    const submissionId = this.generateSubmissionId();\r\n    \r\n    this.logger.info('SendSubmission', 'Starting submission', {\r\n      requestId,\r\n      submissionId,\r\n      returnType,\r\n      taxYear\r\n    });\r\n    \r\n    // Pre-flight checks\r\n    const preflight = this.preflight();\r\n    if (!preflight.ok) {\r\n      this.logger.error('SendSubmission', preflight.error!, { requestId, submissionId });\r\n      return {\r\n        success: false,\r\n        error: preflight.error,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n    }\r\n    \r\n    // Validate XML before sending\r\n    const validation = validateReturnXml(returnXml, returnType);\r\n    if (!validation.valid) {\r\n      this.logger.error('SendSubmission', 'Validation failed', {\r\n        requestId,\r\n        submissionId,\r\n        errors: validation.errors\r\n      });\r\n      return {\r\n        success: false,\r\n        error: `Validation failed: ${validation.errors.map(e => e.message).join(', ')}`,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n    }\r\n    \r\n    // Log warnings\r\n    if (validation.warnings.length > 0) {\r\n      this.logger.warn('SendSubmission', 'Validation warnings', {\r\n        requestId,\r\n        submissionId,\r\n        warnings: validation.warnings\r\n      });\r\n    }\r\n    \r\n    const profile = getActiveProfile();\r\n    const endpoint = getMefEndpoint(this.config.services.SendSubmissions);\r\n    \r\n    // Build request\r\n    // Use btoa polyfill for Node.js/Cloudflare Workers\r\n    function toBase64(str: string) {\r\n      if (typeof btoa === 'function') { return btoa(unescape(encodeURIComponent(str))); \r\n      } else if (typeof Buffer !== 'undefined') {\r\n        return Buffer.from(str, 'utf-8').toString('base64');\r\n      } else if (typeof globalThis !== 'undefined' && typeof globalThis.btoa === 'function') {\r\n        return globalThis.btoa(unescape(encodeURIComponent(str)));\r\n      } else {\r\n        throw new Error('No btoa or Buffer available for base64 encoding');\r\n      }\r\n    }\r\n    const soapRequest = this.buildSoapEnvelope('SendSubmissions', `\r\n      <mef:SubmissionId>${submissionId}</mef:SubmissionId>\r\n      <mef:ReturnType>${returnType}</mef:ReturnType>\r\n      <mef:TaxYear>${taxYear}</mef:TaxYear>\r\n      <mef:ReturnData>${toBase64(returnXml)}</mef:ReturnData>\r\n    `);\r\n    \r\n    // Test mode (no certificates)\r\n    if (!this.certConfig) {\r\n      this.logger.warn('SendSubmission', 'Test mode - simulating IRS response', {\r\n        requestId,\r\n        submissionId\r\n      });\r\n      \r\n      const submission: MefSubmission = {\r\n        submissionId,\r\n        efin: profile.efin,\r\n        etin: getActiveEtin(),\r\n        timestamp: new Date().toISOString(),\r\n        status: 'Received',\r\n        returnType,\r\n        taxYear,\r\n        environment: this.config.environment,\r\n        requestXml: soapRequest\r\n      };\r\n      \r\n      // Store submission record\r\n      await this.storeSubmission(submission);\r\n      \r\n      return {\r\n        success: true,\r\n        data: submission,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n    }\r\n    \r\n    // Production mode with certificates\r\n    try {\r\n      const response = await withRetry(\r\n        async () => {\r\n          const resp = await fetch(endpoint, {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'text/xml; charset=utf-8',\r\n              'SOAPAction': `\"urn:SendSubmissions\"`\r\n            },\r\n            body: soapRequest\r\n          });\r\n          \r\n          if (!resp.ok) {\r\n            throw new Error(`HTTP ${resp.status}: ${resp.statusText}`);\r\n          }\r\n          \r\n          return resp.text();\r\n        },\r\n        'SendSubmission',\r\n        this.logger\r\n      );\r\n      \r\n      this.logger.info('SendSubmission', 'Submission sent successfully', {\r\n        requestId,\r\n        submissionId,\r\n        durationMs: Date.now() - startTime\r\n      });\r\n      \r\n      const submission: MefSubmission = {\r\n        submissionId,\r\n        efin: profile.efin,\r\n        etin: getActiveEtin(),\r\n        timestamp: new Date().toISOString(),\r\n        status: 'Received',\r\n        returnType,\r\n        taxYear,\r\n        environment: this.config.environment,\r\n        requestXml: soapRequest,\r\n        responseXml: response\r\n      };\r\n      \r\n      await this.storeSubmission(submission);\r\n      \r\n      return {\r\n        success: true,\r\n        data: submission,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n      \r\n    } catch (error: any) {\r\n      this.logger.error('SendSubmission', 'Submission failed', {\r\n        requestId,\r\n        submissionId,\r\n        error: error.message\r\n      });\r\n      \r\n      return {\r\n        success: false,\r\n        error: error.message,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \u2705 Requirement 2B: GetSubmissionStatus\r\n   */\r\n  async getSubmissionStatus(submissionId: string): Promise<MefOperationResult<MefStatus>> {\r\n    const startTime = Date.now();\r\n    const requestId = uuid();\r\n    \r\n    this.logger.info('GetStatus', 'Checking submission status', {\r\n      requestId,\r\n      submissionId\r\n    });\r\n    \r\n    const endpoint = getMefEndpoint(this.config.services.GetSubmissionStatus);\r\n    const soapRequest = this.buildSoapEnvelope('GetSubmissionStatus', `\r\n      <mef:SubmissionId>${submissionId}</mef:SubmissionId>\r\n    `);\r\n    \r\n    // Test mode\r\n    if (!this.certConfig) {\r\n      // Simulate status progression\r\n      const storedStatus = await this.getStoredStatus(submissionId);\r\n      const status: MefStatus = storedStatus || 'Processing';\r\n      \r\n      this.logger.info('GetStatus', 'Test mode - returning simulated status', {\r\n        requestId,\r\n        submissionId,\r\n        status\r\n      });\r\n      \r\n      return {\r\n        success: true,\r\n        data: status,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n    }\r\n    \r\n    try {\r\n      const response = await withRetry(\r\n        async () => {\r\n          const resp = await fetch(endpoint, {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'text/xml; charset=utf-8',\r\n              'SOAPAction': `\"urn:GetSubmissionStatus\"`\r\n            },\r\n            body: soapRequest\r\n          });\r\n          \r\n          if (!resp.ok) {\r\n            throw new Error(`HTTP ${resp.status}: ${resp.statusText}`);\r\n          }\r\n          \r\n          return resp.text();\r\n        },\r\n        'GetStatus',\r\n        this.logger\r\n      );\r\n      \r\n      // Parse status from response\r\n      const statusMatch = response.match(/<Status>(\\w+)<\\/Status>/);\r\n      const status: MefStatus = (statusMatch?.[1] as MefStatus) || 'Processing';\r\n      \r\n      // Update stored status\r\n      await this.updateStoredStatus(submissionId, status);\r\n      \r\n      return {\r\n        success: true,\r\n        data: status,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n      \r\n    } catch (error: any) {\r\n      this.logger.error('GetStatus', 'Status check failed', {\r\n        requestId,\r\n        submissionId,\r\n        error: error.message\r\n      });\r\n      \r\n      return {\r\n        success: false,\r\n        error: error.message,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \u2705 Requirement 2C: GetAcknowledgment (single)\r\n   */\r\n  async getAcknowledgment(submissionId: string): Promise<MefOperationResult<MefAcknowledgment | null>> {\r\n    const startTime = Date.now();\r\n    const requestId = uuid();\r\n    \r\n    this.logger.info('GetAck', 'Retrieving acknowledgment', {\r\n      requestId,\r\n      submissionId\r\n    });\r\n    \r\n    const endpoint = getMefEndpoint(this.config.services.GetAck);\r\n    const soapRequest = this.buildSoapEnvelope('GetAck', `\r\n      <mef:SubmissionId>${submissionId}</mef:SubmissionId>\r\n    `);\r\n    \r\n    // Test mode\r\n    if (!this.certConfig) {\r\n      const ack: MefAcknowledgment = {\r\n        ackId: `ACK-${submissionId}`,\r\n        submissionId,\r\n        status: 'Accepted',\r\n        timestamp: new Date().toISOString(),\r\n        dcn: `DCN${Date.now()}`\r\n      };\r\n      \r\n      // Check idempotency\r\n      if (this.processedAcks.has(ack.ackId)) {\r\n        this.logger.warn('GetAck', 'ACK already processed (idempotent skip)', {\r\n          requestId,\r\n          submissionId,\r\n          ackId: ack.ackId\r\n        });\r\n      } else {\r\n        await this.storeAcknowledgment(ack);\r\n        this.processedAcks.add(ack.ackId);\r\n      }\r\n      \r\n      return {\r\n        success: true,\r\n        data: ack,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n    }\r\n    \r\n    try {\r\n      const response = await withRetry(\r\n        async () => {\r\n          const resp = await fetch(endpoint, {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'text/xml; charset=utf-8',\r\n              'SOAPAction': `\"urn:GetAck\"`\r\n            },\r\n            body: soapRequest\r\n          });\r\n          \r\n          if (!resp.ok) {\r\n            throw new Error(`HTTP ${resp.status}: ${resp.statusText}`);\r\n          }\r\n          \r\n          return resp.text();\r\n        },\r\n        'GetAck',\r\n        this.logger\r\n      );\r\n      \r\n      // Parse acknowledgment\r\n      const ack = this.parseAcknowledgment(response, submissionId);\r\n      \r\n      if (ack) {\r\n        // Idempotency check\r\n        const isProcessed = await this.isAckProcessed(ack.ackId);\r\n        if (!isProcessed) {\r\n          await this.storeAcknowledgment(ack);\r\n          this.processedAcks.add(ack.ackId);\r\n        } else {\r\n          this.logger.warn('GetAck', 'ACK already processed', {\r\n            requestId,\r\n            ackId: ack.ackId\r\n          });\r\n        }\r\n      }\r\n      \r\n      return {\r\n        success: true,\r\n        data: ack,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n      \r\n    } catch (error: any) {\r\n      this.logger.error('GetAck', 'Failed to retrieve acknowledgment', {\r\n        requestId,\r\n        submissionId,\r\n        error: error.message\r\n      });\r\n      \r\n      return {\r\n        success: false,\r\n        error: error.message,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \u2705 Requirement 2C: GetNewAcks (batch, idempotent)\r\n   */\r\n  async getNewAcknowledgments(): Promise<MefOperationResult<MefAcknowledgment[]>> {\r\n    const startTime = Date.now();\r\n    const requestId = uuid();\r\n    \r\n    this.logger.info('GetNewAcks', 'Retrieving new acknowledgments', { requestId });\r\n    \r\n    const endpoint = getMefEndpoint(this.config.services.GetNewAcks);\r\n    const soapRequest = this.buildSoapEnvelope('GetNewAcks', '');\r\n    \r\n    // Test mode\r\n    if (!this.certConfig) {\r\n      return {\r\n        success: true,\r\n        data: [],\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n    }\r\n    \r\n    try {\r\n      const response = await withRetry(\r\n        async () => {\r\n          const resp = await fetch(endpoint, {\r\n            method: 'POST',\r\n            headers: {\r\n              'Content-Type': 'text/xml; charset=utf-8',\r\n              'SOAPAction': `\"urn:GetNewAcks\"`\r\n            },\r\n            body: soapRequest\r\n          });\r\n          \r\n          if (!resp.ok) {\r\n            throw new Error(`HTTP ${resp.status}: ${resp.statusText}`);\r\n          }\r\n          \r\n          return resp.text();\r\n        },\r\n        'GetNewAcks',\r\n        this.logger\r\n      );\r\n      \r\n      // Parse all acknowledgments\r\n      const acks = this.parseAcknowledgments(response);\r\n      const newAcks: MefAcknowledgment[] = [];\r\n      \r\n      for (const ack of acks) {\r\n        // Idempotency check\r\n        const isProcessed = await this.isAckProcessed(ack.ackId);\r\n        if (!isProcessed) {\r\n          await this.storeAcknowledgment(ack);\r\n          this.processedAcks.add(ack.ackId);\r\n          newAcks.push(ack);\r\n        } else {\r\n          this.logger.debug('GetNewAcks', 'Skipping already processed ACK', {\r\n            ackId: ack.ackId\r\n          });\r\n        }\r\n      }\r\n      \r\n      this.logger.info('GetNewAcks', `Processed ${newAcks.length} new acknowledgments`, {\r\n        requestId,\r\n        totalReceived: acks.length,\r\n        newProcessed: newAcks.length\r\n      });\r\n      \r\n      return {\r\n        success: true,\r\n        data: newAcks,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n      \r\n    } catch (error: any) {\r\n      this.logger.error('GetNewAcks', 'Failed to retrieve acknowledgments', {\r\n        requestId,\r\n        error: error.message\r\n      });\r\n      \r\n      return {\r\n        success: false,\r\n        error: error.message,\r\n        requestId,\r\n        timestamp: new Date().toISOString(),\r\n        environment: this.config.environment,\r\n        durationMs: Date.now() - startTime\r\n      };\r\n    }\r\n  }\r\n\r\n  // ============================================================================\r\n  // HELPER METHODS\r\n  // ============================================================================\r\n\r\n  private parseAcknowledgment(xml: string, submissionId: string): MefAcknowledgment | null {\r\n    // Basic XML parsing - in production use proper XML parser\r\n    const statusMatch = xml.match(/<Status>(\\w+)<\\/Status>/);\r\n    const dcnMatch = xml.match(/<DCN>([^<]+)<\\/DCN>/);\r\n    const ackIdMatch = xml.match(/<AckId>([^<]+)<\\/AckId>/);\r\n    \r\n    if (!statusMatch) return null;\r\n    \r\n    const ack: MefAcknowledgment = {\r\n      ackId: ackIdMatch?.[1] || `ACK-${submissionId}-${Date.now()}`,\r\n      submissionId,\r\n      status: statusMatch[1] as 'Accepted' | 'Rejected',\r\n      timestamp: new Date().toISOString(),\r\n      dcn: dcnMatch?.[1]\r\n    };\r\n    \r\n    // Parse errors if rejected\r\n    if (ack.status === 'Rejected') {\r\n      const errors: MefError[] = [];\r\n      const errorMatches = xml.matchAll(/<Error>[\\s\\S]*?<ErrorCode>([^<]+)<\\/ErrorCode>[\\s\\S]*?<ErrorMessage>([^<]+)<\\/ErrorMessage>[\\s\\S]*?<\\/Error>/g);\r\n      \r\n      for (const match of errorMatches) {\r\n        errors.push({\r\n          errorCode: match[1],\r\n          errorCategory: 'Reject',\r\n          errorMessage: match[2]\r\n        });\r\n      }\r\n      \r\n      if (errors.length > 0) {\r\n        ack.errors = errors;\r\n      }\r\n    }\r\n    \r\n    return ack;\r\n  }\r\n\r\n  private parseAcknowledgments(xml: string): MefAcknowledgment[] {\r\n    const acks: MefAcknowledgment[] = [];\r\n    const ackMatches = xml.matchAll(/<Acknowledgment>[\\s\\S]*?<SubmissionId>([^<]+)<\\/SubmissionId>[\\s\\S]*?<\\/Acknowledgment>/g);\r\n    \r\n    for (const match of ackMatches) {\r\n      const submissionId = match[1];\r\n      const ack = this.parseAcknowledgment(match[0], submissionId);\r\n      if (ack) acks.push(ack);\r\n    }\r\n    \r\n    return acks;\r\n  }\r\n\r\n  private async storeSubmission(submission: MefSubmission): Promise<void> {\r\n    if (!this.env?.DB) return;\r\n    \r\n    try {\r\n      await this.env.DB.prepare(`\r\n        INSERT INTO mef_submissions (\r\n          submission_id, efin, etin, timestamp, status, \r\n          return_type, tax_year, environment, request_xml, response_xml\r\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n      `).bind(\r\n        submission.submissionId,\r\n        submission.efin,\r\n        submission.etin,\r\n        submission.timestamp,\r\n        submission.status,\r\n        submission.returnType,\r\n        submission.taxYear,\r\n        submission.environment,\r\n        submission.requestXml || null,\r\n        submission.responseXml || null\r\n      ).run();\r\n    } catch (e) {\r\n      this.logger.error('Storage', 'Failed to store submission', { error: String(e) });\r\n    }\r\n  }\r\n\r\n  private async storeAcknowledgment(ack: MefAcknowledgment): Promise<void> {\r\n    if (!this.env?.DB) return;\r\n    \r\n    try {\r\n      await this.env.DB.prepare(`\r\n        INSERT INTO mef_acknowledgments (\r\n          id, submission_id, ack_id, status, dcn, \r\n          tax_year, return_type, errors_json, received_at\r\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n      `).bind(\r\n        uuid(),\r\n        ack.submissionId,\r\n        ack.ackId,\r\n        ack.status,\r\n        ack.dcn || null,\r\n        ack.taxYear || null,\r\n        ack.returnType || null,\r\n        ack.errors ? JSON.stringify(ack.errors) : null,\r\n        ack.timestamp\r\n      ).run();\r\n    } catch (e) {\r\n      this.logger.error('Storage', 'Failed to store acknowledgment', { error: String(e) });\r\n    }\r\n  }\r\n\r\n  private async isAckProcessed(ackId: string): Promise<boolean> {\r\n    if (this.processedAcks.has(ackId)) return true;\r\n    \r\n    if (this.env?.DB) {\r\n      try {\r\n        const row = await this.env.DB.prepare(\r\n          'SELECT id FROM mef_acknowledgments WHERE ack_id = ?'\r\n        ).bind(ackId).first();\r\n        return !!row;\r\n      } catch (e) {\r\n        return false;\r\n      }\r\n    }\r\n    \r\n    return false;\r\n  }\r\n\r\n  private async getStoredStatus(submissionId: string): Promise<MefStatus | null> {\r\n    if (!this.env?.DB) return null;\r\n    \r\n    try {\r\n      const row = await this.env.DB.prepare(\r\n        'SELECT status FROM mef_submissions WHERE submission_id = ?'\r\n      ).bind(submissionId).first();\r\n      return row?.status as MefStatus || null;\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private async updateStoredStatus(submissionId: string, status: MefStatus): Promise<void> {\r\n    if (!this.env?.DB) return;\r\n    \r\n    try {\r\n      await this.env.DB.prepare(\r\n        'UPDATE mef_submissions SET status = ? WHERE submission_id = ?'\r\n      ).bind(status, submissionId).run();\r\n    } catch (e) {\r\n      this.logger.error('Storage', 'Failed to update status', { error: String(e) });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get recent logs for monitoring\r\n   */\r\n  getLogs(): MefLogEntry[] {\r\n    return this.logger.getRecentLogs();\r\n  }\r\n\r\n  /**\r\n   * Get client info for debugging\r\n   */\r\n  getInfo(): Record<string, any> {\r\n    const profile = getActiveProfile();\r\n    return {\r\n      environment: this.config.environment,\r\n      efin: profile.efin,\r\n      etin: getActiveEtin(),\r\n      profile: profile.firm_name,\r\n      softwareDevApproved: profile.software_developer_approved,\r\n      transmissionsEnabled: isTransmissionEnabled(),\r\n      hasCertificates: !!this.certConfig,\r\n      isProduction: isProduction()\r\n    };\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// FACTORY\r\n// ============================================================================\r\n\r\nexport function createMefClient(env?: any): MefClient {\r\n  return new MefClient(env);\r\n}\r\n\r\n// ============================================================================\r\n// ENVIRONMENT INFO\r\n// ============================================================================\r\n\r\nexport const MefEnvironments = {\r\n  ATS: {\r\n    name: 'Assurance Testing System',\r\n    baseUrl: MEF_CONFIG.endpoints.ATS_BASE,\r\n    description: 'IRS test environment for validating e-file submissions'\r\n  },\r\n  PRODUCTION: {\r\n    name: 'Production',\r\n    baseUrl: MEF_CONFIG.endpoints.PROD_BASE,\r\n    description: 'IRS production environment for live e-file submissions'\r\n  }\r\n};\r\n", "/**\r\n * IRS MeF Schema Validator\r\n * \r\n * Business Rules-based validation for IRS tax return XML\r\n * Based on IRS Publication 4164 and MeF Business Rules packages\r\n * \r\n * Supports: Form 1120, 1120-S, 1120-H, 1041, 1065, 7004, 94x series\r\n * \r\n * Note: This validator implements business rules. For full XSD validation,\r\n * download the MeF XSD Schema packages from IRS e-file website.\r\n */\r\n\r\n// ============================================================================\r\n// TYPES\r\n// ============================================================================\r\n\r\nexport interface ValidationResult {\r\n  valid: boolean;\r\n  errors: ValidationError[];\r\n  warnings: ValidationWarning[];\r\n  ruleChecks: RuleCheckResult[];\r\n  summary: {\r\n    totalRules: number;\r\n    passed: number;\r\n    failed: number;\r\n    warnings: number;\r\n  };\r\n}\r\n\r\nexport interface ValidationError {\r\n  code: string;\r\n  rule: string;\r\n  message: string;\r\n  field?: string;\r\n  xpath?: string;\r\n  severity: 'reject' | 'error';\r\n  category: string;\r\n}\r\n\r\nexport interface ValidationWarning {\r\n  code: string;\r\n  rule: string;\r\n  message: string;\r\n  field?: string;\r\n  severity: 'warning' | 'alert';\r\n}\r\n\r\nexport interface RuleCheckResult {\r\n  ruleId: string;\r\n  ruleName: string;\r\n  passed: boolean;\r\n  message?: string;\r\n}\r\n\r\nexport type ReturnType = \r\n  | '1040' | '1040-SR' | '1040-NR' | '1040-X'  // Individual\r\n  | '1120' | '1120-S' | '1120-H'              // Corporation\r\n  | '1041'                                     // Estate/Trust\r\n  | '1065'                                     // Partnership\r\n  | '7004'                                     // Extension\r\n  | '940' | '941' | '943' | '944' | '945';    // Employment\r\n\r\n// ============================================================================\r\n// BUSINESS RULES REGISTRY\r\n// ============================================================================\r\n\r\ninterface BusinessRule {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  forms: ReturnType[];\r\n  severity: 'reject' | 'error' | 'warning';\r\n  category: string;\r\n  validate: (xml: string, context: ValidationContext) => boolean;\r\n  errorMessage: string;\r\n}\r\n\r\ninterface ValidationContext {\r\n  taxYear: string;\r\n  returnType: ReturnType;\r\n  isAmended: boolean;\r\n  environment: 'ATS' | 'PRODUCTION';\r\n}\r\n\r\n// Common business rules across all forms\r\nconst COMMON_RULES: BusinessRule[] = [\r\n  {\r\n    id: 'R0001',\r\n    name: 'XML Declaration Required',\r\n    description: 'Return must have valid XML declaration',\r\n    forms: ['1040', '1040-SR', '1040-NR', '1120', '1120-S', '1120-H', '1041', '1065', '7004', '940', '941'],\r\n    severity: 'reject',\r\n    category: 'Structure',\r\n    validate: (xml) => xml.trim().startsWith('<?xml'),\r\n    errorMessage: 'XML declaration is missing or invalid'\r\n  },\r\n  {\r\n    id: 'R0002',\r\n    name: 'Return Element Required',\r\n    description: 'Root Return element must be present',\r\n    forms: ['1040', '1040-SR', '1040-NR', '1120', '1120-S', '1120-H', '1041', '1065', '7004', '940', '941'],\r\n    severity: 'reject',\r\n    category: 'Structure',\r\n    validate: (xml) => /<Return[\\s>]/.test(xml),\r\n    errorMessage: 'Return element is missing'\r\n  },\r\n  {\r\n    id: 'R0003',\r\n    name: 'ReturnHeader Required',\r\n    description: 'ReturnHeader element must be present',\r\n    forms: ['1040', '1040-SR', '1040-NR', '1120', '1120-S', '1120-H', '1041', '1065', '7004', '940', '941'],\r\n    severity: 'reject',\r\n    category: 'Structure',\r\n    validate: (xml) => /<ReturnHeader[\\s>]/.test(xml),\r\n    errorMessage: 'ReturnHeader element is missing'\r\n  },\r\n  {\r\n    id: 'R0004',\r\n    name: 'TaxYear Required',\r\n    description: 'Tax year must be specified',\r\n    forms: ['1040', '1040-SR', '1040-NR', '1120', '1120-S', '1120-H', '1041', '1065', '7004', '940', '941'],\r\n    severity: 'reject',\r\n    category: 'Header',\r\n    validate: (xml) => /<TaxYr>\\d{4}<\\/TaxYr>/.test(xml) || /<TaxYear>\\d{4}<\\/TaxYear>/.test(xml),\r\n    errorMessage: 'Tax year is missing or invalid'\r\n  },\r\n  {\r\n    id: 'R0005',\r\n    name: 'TaxYear Valid Range',\r\n    description: 'Tax year must be within acceptable range',\r\n    forms: ['1040', '1040-SR', '1040-NR', '1120', '1120-S', '1120-H', '1041', '1065', '7004', '940', '941'],\r\n    severity: 'reject',\r\n    category: 'Header',\r\n    validate: (xml, ctx) => {\r\n      const match = xml.match(/<TaxYr>(\\d{4})<\\/TaxYr>/) || xml.match(/<TaxYear>(\\d{4})<\\/TaxYear>/);\r\n      if (!match) return false;\r\n      const year = parseInt(match[1]);\r\n      const currentYear = new Date().getFullYear();\r\n      return year >= 2020 && year <= currentYear;\r\n    },\r\n    errorMessage: 'Tax year is outside acceptable range (2020-current)'\r\n  },\r\n  {\r\n    id: 'R0006',\r\n    name: 'ReturnData Required',\r\n    description: 'ReturnData element must be present',\r\n    forms: ['1040', '1040-SR', '1040-NR', '1120', '1120-S', '1120-H', '1041', '1065', '940', '941'],\r\n    severity: 'reject',\r\n    category: 'Structure',\r\n    validate: (xml) => /<ReturnData[\\s>]/.test(xml),\r\n    errorMessage: 'ReturnData element is missing'\r\n  }\r\n];\r\n\r\n// Individual (1040) specific rules\r\nconst INDIVIDUAL_RULES: BusinessRule[] = [\r\n  {\r\n    id: 'IND-001',\r\n    name: 'Primary SSN Required',\r\n    description: 'Primary taxpayer SSN must be present',\r\n    forms: ['1040', '1040-SR', '1040-NR'],\r\n    severity: 'reject',\r\n    category: 'Filer',\r\n    validate: (xml) => /<PrimarySSN>\\d{9}<\\/PrimarySSN>/.test(xml) || /<TaxpayerSSN>\\d{9}<\\/TaxpayerSSN>/.test(xml),\r\n    errorMessage: 'Primary taxpayer SSN is missing or invalid format'\r\n  },\r\n  {\r\n    id: 'IND-002',\r\n    name: 'SSN Format Valid',\r\n    description: 'SSN must be 9 digits, not all zeros',\r\n    forms: ['1040', '1040-SR', '1040-NR'],\r\n    severity: 'reject',\r\n    category: 'Filer',\r\n    validate: (xml) => {\r\n      const match = xml.match(/<(?:Primary)?(?:Taxpayer)?SSN>(\\d{9})<\\/(?:Primary)?(?:Taxpayer)?SSN>/);\r\n      if (!match) return false;\r\n      const ssn = match[1];\r\n      return ssn !== '000000000' && !/^(\\d)\\1{8}$/.test(ssn);\r\n    },\r\n    errorMessage: 'SSN format is invalid (cannot be all zeros or repeating digit)'\r\n  },\r\n  {\r\n    id: 'IND-003',\r\n    name: 'Filing Status Required',\r\n    description: 'Filing status must be specified',\r\n    forms: ['1040', '1040-SR', '1040-NR'],\r\n    severity: 'reject',\r\n    category: 'Filer',\r\n    validate: (xml) => /<FilingStatus/.test(xml) || /<FilingStatusCd>/.test(xml),\r\n    errorMessage: 'Filing status is missing'\r\n  },\r\n  {\r\n    id: 'IND-004',\r\n    name: 'Taxpayer Name Required',\r\n    description: 'Primary taxpayer name must be present',\r\n    forms: ['1040', '1040-SR', '1040-NR'],\r\n    severity: 'reject',\r\n    category: 'Filer',\r\n    validate: (xml) => /<Name[\\s>]/.test(xml) && (/<FirstName>/.test(xml) || /<PersonFirstNm>/.test(xml)),\r\n    errorMessage: 'Taxpayer name is missing'\r\n  },\r\n  {\r\n    id: 'IND-005',\r\n    name: 'ATS Test SSN Check',\r\n    description: 'Test SSNs (9xx) only allowed in ATS environment',\r\n    forms: ['1040', '1040-SR', '1040-NR'],\r\n    severity: 'reject',\r\n    category: 'Environment',\r\n    validate: (xml, ctx) => {\r\n      const match = xml.match(/<(?:Primary)?(?:Taxpayer)?SSN>(\\d{9})<\\/(?:Primary)?(?:Taxpayer)?SSN>/);\r\n      if (!match) return true;\r\n      const ssn = match[1];\r\n      const isTestSSN = ssn.startsWith('9');\r\n      if (ctx.environment === 'PRODUCTION' && isTestSSN) {\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n    errorMessage: 'Test SSN (starting with 9) cannot be used in Production'\r\n  }\r\n];\r\n\r\n// Corporation (1120) specific rules  \r\nconst CORPORATION_RULES: BusinessRule[] = [\r\n  {\r\n    id: 'CORP-001',\r\n    name: 'EIN Required',\r\n    description: 'Employer Identification Number must be present',\r\n    forms: ['1120', '1120-S', '1120-H'],\r\n    severity: 'reject',\r\n    category: 'Filer',\r\n    validate: (xml) => /<EIN>\\d{9}<\\/EIN>/.test(xml) || /<EmployerIdentificationNumber>\\d{9}<\\/EmployerIdentificationNumber>/.test(xml),\r\n    errorMessage: 'EIN is missing or invalid format'\r\n  },\r\n  {\r\n    id: 'CORP-002',\r\n    name: 'Business Name Required',\r\n    description: 'Business name must be present',\r\n    forms: ['1120', '1120-S', '1120-H'],\r\n    severity: 'reject',\r\n    category: 'Filer',\r\n    validate: (xml) => /<BusinessName[\\s>]/.test(xml) || /<BusinessNameLine1/.test(xml),\r\n    errorMessage: 'Business name is missing'\r\n  },\r\n  {\r\n    id: 'CORP-003',\r\n    name: 'Tax Period End Date',\r\n    description: 'Tax period end date must be specified for corporations',\r\n    forms: ['1120', '1120-S'],\r\n    severity: 'reject',\r\n    category: 'Header',\r\n    validate: (xml) => /<TaxPeriodEndDt>/.test(xml) || /<TaxPeriodEndDate>/.test(xml),\r\n    errorMessage: 'Tax period end date is missing'\r\n  },\r\n  {\r\n    id: 'CORP-004',\r\n    name: 'S-Corp Election Date',\r\n    description: '1120-S requires S election date or box checked',\r\n    forms: ['1120-S'],\r\n    severity: 'warning',\r\n    category: 'Election',\r\n    validate: (xml) => /<SElectionEffectiveDt>/.test(xml) || /<InitialReturn>/.test(xml),\r\n    errorMessage: 'S election effective date or initial return indicator recommended'\r\n  }\r\n];\r\n\r\n// Partnership (1065) specific rules\r\nconst PARTNERSHIP_RULES: BusinessRule[] = [\r\n  {\r\n    id: 'PTNR-001',\r\n    name: 'Partnership EIN Required',\r\n    description: 'Partnership EIN must be present',\r\n    forms: ['1065'],\r\n    severity: 'reject',\r\n    category: 'Filer',\r\n    validate: (xml) => /<EIN>\\d{9}<\\/EIN>/.test(xml),\r\n    errorMessage: 'Partnership EIN is missing'\r\n  },\r\n  {\r\n    id: 'PTNR-002',\r\n    name: 'Partner Information',\r\n    description: 'At least one partner Schedule K-1 required',\r\n    forms: ['1065'],\r\n    severity: 'warning',\r\n    category: 'Schedules',\r\n    validate: (xml) => /<IRS.*K1/.test(xml) || /<Schedule.*K1/.test(xml) || /<PartnerInformation/.test(xml),\r\n    errorMessage: 'No Schedule K-1 partner information found'\r\n  }\r\n];\r\n\r\n// Estate/Trust (1041) specific rules\r\nconst ESTATE_TRUST_RULES: BusinessRule[] = [\r\n  {\r\n    id: 'EST-001',\r\n    name: 'Estate/Trust EIN Required',\r\n    description: 'Estate or Trust EIN must be present',\r\n    forms: ['1041'],\r\n    severity: 'reject',\r\n    category: 'Filer',\r\n    validate: (xml) => /<EIN>\\d{9}<\\/EIN>/.test(xml),\r\n    errorMessage: 'Estate/Trust EIN is missing'\r\n  },\r\n  {\r\n    id: 'EST-002',\r\n    name: 'Entity Type Required',\r\n    description: 'Trust type indicator must be specified',\r\n    forms: ['1041'],\r\n    severity: 'reject',\r\n    category: 'Filer',\r\n    validate: (xml) => /<TypeOfEntity/.test(xml) || /<DecedentEstate/.test(xml) || /<SimpleTrust/.test(xml) || /<ComplexTrust/.test(xml),\r\n    errorMessage: 'Entity type (estate/trust type) is missing'\r\n  }\r\n];\r\n\r\n// Extension (7004) specific rules\r\nconst EXTENSION_RULES: BusinessRule[] = [\r\n  {\r\n    id: 'EXT-001',\r\n    name: 'Form Code Required',\r\n    description: 'Extension must specify which form is being extended',\r\n    forms: ['7004'],\r\n    severity: 'reject',\r\n    category: 'Extension',\r\n    validate: (xml) => /<FormCode>/.test(xml) || /<ExtensionFormCd>/.test(xml),\r\n    errorMessage: 'Form code for extension is missing'\r\n  },\r\n  {\r\n    id: 'EXT-002',\r\n    name: 'Tentative Tax',\r\n    description: 'Tentative tax amount should be specified',\r\n    forms: ['7004'],\r\n    severity: 'warning',\r\n    category: 'Extension',\r\n    validate: (xml) => /<TentativeTax/.test(xml) || /<TotalTax/.test(xml),\r\n    errorMessage: 'Tentative tax amount not specified'\r\n  }\r\n];\r\n\r\n// Employment (94x) specific rules\r\nconst EMPLOYMENT_RULES: BusinessRule[] = [\r\n  {\r\n    id: 'EMP-001',\r\n    name: 'Quarter Indicator Required',\r\n    description: 'Quarterly returns must specify the quarter',\r\n    forms: ['941', '943'],\r\n    severity: 'reject',\r\n    category: 'Period',\r\n    validate: (xml) => /<Quarter/.test(xml) || /<Qtr/.test(xml),\r\n    errorMessage: 'Quarter indicator is missing'\r\n  },\r\n  {\r\n    id: 'EMP-002',\r\n    name: 'Wages Reported',\r\n    description: 'Total wages must be reported',\r\n    forms: ['940', '941', '943', '944', '945'],\r\n    severity: 'reject',\r\n    category: 'Wages',\r\n    validate: (xml) => /<.*Wages.*>/.test(xml) || /<WagesAmt>/.test(xml),\r\n    errorMessage: 'Total wages amount is missing'\r\n  },\r\n  {\r\n    id: 'EMP-003',\r\n    name: 'Employee Count',\r\n    description: 'Number of employees should be specified',\r\n    forms: ['941', '944'],\r\n    severity: 'warning',\r\n    category: 'Employees',\r\n    validate: (xml) => /<NumberOfEmployees/.test(xml) || /<EmployeeCnt/.test(xml),\r\n    errorMessage: 'Number of employees not specified'\r\n  }\r\n];\r\n\r\n// Combine all rules\r\nconst ALL_RULES: BusinessRule[] = [\r\n  ...COMMON_RULES,\r\n  ...INDIVIDUAL_RULES,\r\n  ...CORPORATION_RULES,\r\n  ...PARTNERSHIP_RULES,\r\n  ...ESTATE_TRUST_RULES,\r\n  ...EXTENSION_RULES,\r\n  ...EMPLOYMENT_RULES\r\n];\r\n\r\n// ============================================================================\r\n// VALIDATOR CLASS\r\n// ============================================================================\r\n\r\nexport class SchemaValidator {\r\n  private rules: BusinessRule[];\r\n  \r\n  constructor() {\r\n    this.rules = ALL_RULES;\r\n  }\r\n  \r\n  /**\r\n   * Validate tax return XML against business rules\r\n   */\r\n  validate(\r\n    xml: string, \r\n    returnType: ReturnType,\r\n    options: {\r\n      taxYear?: string;\r\n      isAmended?: boolean;\r\n      environment?: 'ATS' | 'PRODUCTION';\r\n    } = {}\r\n  ): ValidationResult {\r\n    const context: ValidationContext = {\r\n      taxYear: options.taxYear || this.extractTaxYear(xml) || new Date().getFullYear().toString(),\r\n      returnType,\r\n      isAmended: options.isAmended || xml.includes('Amended') || returnType.includes('-X'),\r\n      environment: options.environment || 'ATS'\r\n    };\r\n    \r\n    const errors: ValidationError[] = [];\r\n    const warnings: ValidationWarning[] = [];\r\n    const ruleChecks: RuleCheckResult[] = [];\r\n    \r\n    // Get applicable rules for this return type\r\n    const applicableRules = this.rules.filter(rule => \r\n      rule.forms.includes(returnType) || rule.forms.includes(returnType.split('-')[0] as ReturnType)\r\n    );\r\n    \r\n    // Run each rule\r\n    for (const rule of applicableRules) {\r\n      try {\r\n        const passed = rule.validate(xml, context);\r\n        \r\n        ruleChecks.push({\r\n          ruleId: rule.id,\r\n          ruleName: rule.name,\r\n          passed,\r\n          message: passed ? undefined : rule.errorMessage\r\n        });\r\n        \r\n        if (!passed) {\r\n          if (rule.severity === 'reject' || rule.severity === 'error') {\r\n            errors.push({\r\n              code: rule.id,\r\n              rule: rule.name,\r\n              message: rule.errorMessage,\r\n              severity: rule.severity,\r\n              category: rule.category\r\n            });\r\n          } else {\r\n            warnings.push({\r\n              code: rule.id,\r\n              rule: rule.name,\r\n              message: rule.errorMessage,\r\n              severity: rule.severity\r\n            });\r\n          }\r\n        }\r\n      } catch (e) {\r\n        // Rule execution error\r\n        errors.push({\r\n          code: rule.id,\r\n          rule: rule.name,\r\n          message: `Rule execution error: ${e}`,\r\n          severity: 'error',\r\n          category: 'System'\r\n        });\r\n      }\r\n    }\r\n    \r\n    return {\r\n      valid: errors.length === 0,\r\n      errors,\r\n      warnings,\r\n      ruleChecks,\r\n      summary: {\r\n        totalRules: applicableRules.length,\r\n        passed: ruleChecks.filter(r => r.passed).length,\r\n        failed: errors.length,\r\n        warnings: warnings.length\r\n      }\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Quick validation - only checks critical rules\r\n   */\r\n  quickValidate(xml: string, returnType: ReturnType): { valid: boolean; errors: string[] } {\r\n    const criticalRules = this.rules.filter(r => \r\n      r.severity === 'reject' && r.forms.includes(returnType)\r\n    );\r\n    \r\n    const errors: string[] = [];\r\n    const context: ValidationContext = {\r\n      taxYear: this.extractTaxYear(xml) || new Date().getFullYear().toString(),\r\n      returnType,\r\n      isAmended: false,\r\n      environment: 'ATS'\r\n    };\r\n    \r\n    for (const rule of criticalRules) {\r\n      if (!rule.validate(xml, context)) {\r\n        errors.push(`[${rule.id}] ${rule.errorMessage}`);\r\n      }\r\n    }\r\n    \r\n    return { valid: errors.length === 0, errors };\r\n  }\r\n  \r\n  /**\r\n   * Get list of rules for a specific form\r\n   */\r\n  getRulesForForm(returnType: ReturnType): BusinessRule[] {\r\n    return this.rules.filter(r => r.forms.includes(returnType));\r\n  }\r\n  \r\n  /**\r\n   * Get all supported return types\r\n   */\r\n  getSupportedForms(): ReturnType[] {\r\n    const forms = new Set<ReturnType>();\r\n    this.rules.forEach(r => r.forms.forEach(f => forms.add(f)));\r\n    return Array.from(forms);\r\n  }\r\n  \r\n  /**\r\n   * Extract tax year from XML\r\n   */\r\n  private extractTaxYear(xml: string): string | null {\r\n    const match = xml.match(/<TaxYr>(\\d{4})<\\/TaxYr>/) || xml.match(/<TaxYear>(\\d{4})<\\/TaxYear>/);\r\n    return match ? match[1] : null;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// FORM-SPECIFIC VALIDATORS\r\n// ============================================================================\r\n\r\n/**\r\n * Form 1120 (Corporation) Validator\r\n */\r\nexport function validate1120(xml: string, options?: { environment?: 'ATS' | 'PRODUCTION' }): ValidationResult {\r\n  const validator = new SchemaValidator();\r\n  return validator.validate(xml, '1120', options);\r\n}\r\n\r\n/**\r\n * Form 1120-S (S Corporation) Validator\r\n */\r\nexport function validate1120S(xml: string, options?: { environment?: 'ATS' | 'PRODUCTION' }): ValidationResult {\r\n  const validator = new SchemaValidator();\r\n  return validator.validate(xml, '1120-S', options);\r\n}\r\n\r\n/**\r\n * Form 1065 (Partnership) Validator\r\n */\r\nexport function validate1065(xml: string, options?: { environment?: 'ATS' | 'PRODUCTION' }): ValidationResult {\r\n  const validator = new SchemaValidator();\r\n  return validator.validate(xml, '1065', options);\r\n}\r\n\r\n/**\r\n * Form 1041 (Estate/Trust) Validator\r\n */\r\nexport function validate1041(xml: string, options?: { environment?: 'ATS' | 'PRODUCTION' }): ValidationResult {\r\n  const validator = new SchemaValidator();\r\n  return validator.validate(xml, '1041', options);\r\n}\r\n\r\n/**\r\n * Form 941 (Quarterly Employment) Validator\r\n */\r\nexport function validate941(xml: string, options?: { environment?: 'ATS' | 'PRODUCTION' }): ValidationResult {\r\n  const validator = new SchemaValidator();\r\n  return validator.validate(xml, '941', options);\r\n}\r\n\r\n/**\r\n * Form 7004 (Extension) Validator\r\n */\r\nexport function validate7004(xml: string, options?: { environment?: 'ATS' | 'PRODUCTION' }): ValidationResult {\r\n  const validator = new SchemaValidator();\r\n  return validator.validate(xml, '7004', options);\r\n}\r\n\r\n// ============================================================================\r\n// FACTORY\r\n// ============================================================================\r\n\r\nexport function createSchemaValidator(): SchemaValidator {\r\n  return new SchemaValidator();\r\n}\r\n", "// efile.ts\r\n// E-file transmission extension and integration for DIY and ERO/PTIN workflows\r\n// Integrated with IRS MeF A2A Web Services\r\n\r\nimport { createMefClient, MefSubmission, MefAcknowledgment, MefOperationResult } from './mef';\r\nimport { createSchemaValidator, ReturnType } from './schemaValidator';\r\nimport { ERO_EFIN_PROFILE, MEF_CONFIG, getActiveEtin, isTransmissionEnabled } from './efileProviders';\r\n\r\nexport type EFileStatus =\r\n  | \"created\"\r\n  | \"pending\"\r\n  | \"transmitting\"\r\n  | \"accepted\"\r\n  | \"rejected\"\r\n  | \"error\"\r\n  | \"completed\";\r\n\r\nexport interface EFileTransmission {\r\n  id: string;\r\n  return_id: number;\r\n  client_id: number;\r\n  preparer_id?: number; // ERO/PTIN holder\r\n  method: \"DIY\" | \"ERO\";\r\n  status: EFileStatus;\r\n  irs_submission_id?: string;\r\n  ack_code?: string;\r\n  ack_message?: string;\r\n  dcn?: string; // Document Control Number\r\n  efin?: string;\r\n  etin?: string;\r\n  environment?: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface TransmitResult {\r\n  success: boolean;\r\n  transmission: EFileTransmission;\r\n  mefResult?: MefOperationResult<MefSubmission>;\r\n  errors?: string[];\r\n}\r\n\r\n/**\r\n * Transmit e-file to IRS via MeF A2A\r\n * \r\n * @param env - Environment with DB and MeF credentials\r\n * @param transmission - E-file transmission record\r\n * @param returnXml - XML content of tax return (IRS schema compliant)\r\n * @param returnType - Return type (1040, 1040-SR, etc.)\r\n * @param taxYear - Tax year being filed\r\n */\r\nexport async function transmitEFile(\r\n  env: any,\r\n  transmission: EFileTransmission,\r\n  returnXml?: string,\r\n  returnType: string = \"1040\",\r\n  taxYear: string = \"2025\"\r\n): Promise<TransmitResult> {\r\n  const now = new Date().toISOString();\r\n  const mefClient = createMefClient(env);\r\n  const schemaValidator = createSchemaValidator();\r\n  \r\n  console.log(`[E-File] Starting transmission for return ${transmission.return_id}`);\r\n  console.log(`[E-File] Environment: ${MEF_CONFIG.environment}`);\r\n  console.log(`[E-File] Profile: ${ERO_EFIN_PROFILE.firm_name}`);\r\n  console.log(`[E-File] EFIN: ${ERO_EFIN_PROFILE.efin}, ETIN: ${getActiveEtin()}`);\r\n\r\n  // Check kill switch\r\n  if (!isTransmissionEnabled()) {\r\n    console.log('[E-File] Transmissions disabled (kill switch active)');\r\n    return {\r\n      success: false,\r\n      transmission: {\r\n        ...transmission,\r\n        status: \"error\",\r\n        ack_message: \"Transmissions are currently disabled\",\r\n        updated_at: now,\r\n      },\r\n      errors: [\"Transmissions disabled\"]\r\n    };\r\n  }\r\n\r\n  // If no XML provided, this is a test/demo transmission\r\n  if (!returnXml) {\r\n    console.log('[E-File] No return XML provided - running in test mode');\r\n    \r\n    return {\r\n      success: true,\r\n      transmission: {\r\n        ...transmission,\r\n        status: \"accepted\",\r\n        irs_submission_id: \"TEST-\" + Math.random().toString(36).slice(2, 10).toUpperCase(),\r\n        ack_code: \"A0000\",\r\n        ack_message: \"Test submission accepted\",\r\n        efin: ERO_EFIN_PROFILE.efin,\r\n        etin: getActiveEtin(),\r\n        environment: MEF_CONFIG.environment,\r\n        updated_at: now,\r\n      }\r\n    };\r\n  }\r\n\r\n  // Validate return XML using schema validator\r\n  const validation = schemaValidator.validate(returnXml, returnType as ReturnType, {\r\n    taxYear,\r\n    environment: MEF_CONFIG.environment as 'ATS' | 'PRODUCTION'\r\n  });\r\n  \r\n  if (!validation.valid) {\r\n    console.error('[E-File] Schema validation failed:', validation.errors);\r\n    return {\r\n      success: false,\r\n      transmission: {\r\n        ...transmission,\r\n        status: \"error\",\r\n        ack_message: `Validation failed: ${validation.errors.map(e => e.message).join(', ')}`,\r\n        updated_at: now,\r\n      },\r\n      errors: validation.errors.map(e => `[${e.code}] ${e.message}`)\r\n    };\r\n  }\r\n\r\n  // Log warnings\r\n  if (validation.warnings.length > 0) {\r\n    console.warn('[E-File] Schema validation warnings:', validation.warnings);\r\n  }\r\n\r\n  try {\r\n    // Update status to transmitting\r\n    transmission.status = \"transmitting\";\r\n    transmission.updated_at = now;\r\n\r\n    // Send to IRS via MeF\r\n    const mefResult = await mefClient.sendSubmission(returnXml, returnType, taxYear);\r\n    \r\n    if (!mefResult.success || !mefResult.data) {\r\n      console.error('[E-File] MeF submission failed:', mefResult.error);\r\n      return {\r\n        success: false,\r\n        transmission: {\r\n          ...transmission,\r\n          status: \"error\",\r\n          ack_message: mefResult.error || \"Submission failed\",\r\n          updated_at: now,\r\n        },\r\n        mefResult,\r\n        errors: [mefResult.error || \"Unknown error\"]\r\n      };\r\n    }\r\n    \r\n    console.log(`[E-File] Submission sent: ${mefResult.data.submissionId}`);\r\n\r\n    // Update transmission with MeF details\r\n    const updatedTransmission: EFileTransmission = {\r\n      ...transmission,\r\n      status: mefResult.data.status === 'Received' ? 'pending' : 'transmitting',\r\n      irs_submission_id: mefResult.data.submissionId,\r\n      efin: mefResult.data.efin,\r\n      etin: mefResult.data.etin,\r\n      environment: mefResult.data.environment,\r\n      updated_at: new Date().toISOString(),\r\n    };\r\n\r\n    return {\r\n      success: true,\r\n      transmission: updatedTransmission,\r\n      mefResult\r\n    };\r\n\r\n  } catch (error: any) {\r\n    console.error('[E-File] Transmission failed:', error);\r\n    \r\n    return {\r\n      success: false,\r\n      transmission: {\r\n        ...transmission,\r\n        status: \"error\",\r\n        ack_message: error.message || \"Transmission failed\",\r\n        updated_at: now,\r\n      },\r\n      errors: [error.message]\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Check status of a pending submission\r\n */\r\nexport async function checkSubmissionStatus(\r\n  env: any,\r\n  submissionId: string\r\n): Promise<{ status: string; acknowledgment?: MefAcknowledgment }> {\r\n  const mefClient = createMefClient(env);\r\n  \r\n  console.log(`[E-File] Checking status for ${submissionId}`);\r\n  \r\n  const statusResult = await mefClient.getSubmissionStatus(submissionId);\r\n  \r\n  if (!statusResult.success || !statusResult.data) {\r\n    return { status: 'Error' };\r\n  }\r\n  \r\n  const status = statusResult.data;\r\n  \r\n  if (status === 'Accepted' || status === 'Rejected') {\r\n    const ackResult = await mefClient.getAcknowledgment(submissionId);\r\n    return { \r\n      status, \r\n      acknowledgment: ackResult.success ? ackResult.data || undefined : undefined \r\n    };\r\n  }\r\n  \r\n  return { status };\r\n}\r\n\r\n/**\r\n * Process new acknowledgments from IRS\r\n */\r\nexport async function processNewAcknowledgments(env: any): Promise<MefAcknowledgment[]> {\r\n  const mefClient = createMefClient(env);\r\n  \r\n  console.log('[E-File] Processing new acknowledgments');\r\n  \r\n  const acksResult = await mefClient.getNewAcknowledgments();\r\n  \r\n  if (!acksResult.success || !acksResult.data) {\r\n    console.error('[E-File] Failed to get acknowledgments:', acksResult.error);\r\n    return [];\r\n  }\r\n  \r\n  const acks = acksResult.data;\r\n  \r\n  for (const ack of acks) {\r\n    console.log(`[E-File] Processing ack: ${ack.ackId} - ${ack.status}`);\r\n    \r\n    // Update transmission record in database\r\n    if (env.DB) {\r\n      await env.DB.prepare(`\r\n        UPDATE efile_transmissions \r\n        SET status = ?, \r\n            ack_code = ?,\r\n            ack_message = ?,\r\n            dcn = ?,\r\n            updated_at = ?\r\n        WHERE irs_submission_id = ?\r\n      `).bind(\r\n        ack.status.toLowerCase(),\r\n        ack.status === 'Accepted' ? 'A0000' : 'R0000',\r\n        ack.status === 'Accepted' ? 'Accepted by IRS' : (ack.errors?.[0]?.errorMessage || 'Rejected'),\r\n        ack.dcn || null,\r\n        new Date().toISOString(),\r\n        ack.submissionId\r\n      ).run();\r\n    }\r\n  }\r\n  \r\n  return acks;\r\n}\r\n\r\n/**\r\n * Get e-file status summary\r\n */\r\nexport function getEFileStatusInfo(): {\r\n  environment: string;\r\n  profile: string;\r\n  efin: string;\r\n  etin: string;\r\n  softwareDevApproved: boolean;\r\n  atsEndpoint: string;\r\n  prodEndpoint: string;\r\n} {\r\n  return {\r\n    environment: MEF_CONFIG.environment,\r\n    profile: ERO_EFIN_PROFILE.firm_name,\r\n    efin: ERO_EFIN_PROFILE.efin,\r\n    etin: getActiveEtin(),\r\n    softwareDevApproved: ERO_EFIN_PROFILE.software_developer_approved,\r\n    atsEndpoint: MEF_CONFIG.endpoints.ATS_BASE,\r\n    prodEndpoint: MEF_CONFIG.endpoints.PROD_BASE\r\n  };\r\n}\r\n", "// IRS.gov schema and memos integration (real-time)\r\n// This module fetches IRS schemas and memos in real-time for compliance and reference\r\n\r\nexport async function fetchIrsSchema(): Promise<any> {\r\n  // Example: fetch IRS e-file schema (publicly available XSD or JSON)\r\n  // Replace with actual IRS endpoint or static file as needed\r\n  const res = await fetch(\"https://www.irs.gov/pub/irs-schema/efile/2025/IRSMeF1040.xsd\");\r\n  if (!res.ok) throw new Error(\"Failed to fetch IRS schema\");\r\n  const schemaText = await res.text();\r\n  return schemaText;\r\n}\r\n\r\nexport async function fetchIrsMemos(): Promise<any> {\r\n  // Example: fetch IRS memos or bulletins (publicly available)\r\n  // Replace with actual IRS endpoint or RSS feed as needed\r\n  const res = await fetch(\"https://www.irs.gov/rss/irsnews.xml\");\r\n  if (!res.ok) throw new Error(\"Failed to fetch IRS memos\");\r\n  const xml = await res.text();\r\n  return xml;\r\n}\r\n", "/**\r\n * PII Encryption Utilities\r\n * Uses AES-GCM for encrypting sensitive personal information (SSN, addresses, phone numbers)\r\n * Compliant with IRS Publication 1075 requirements\r\n */\r\n\r\n/**\r\n * Get encryption key from environment\r\n */\r\nasync function getKey(env: any): Promise<CryptoKey> {\r\n  const keyData = new TextEncoder().encode(env.ENCRYPTION_KEY || \"change-this-32-character-key!!\");\r\n  return await crypto.subtle.importKey(\r\n    \"raw\",\r\n    keyData.slice(0, 32), // Ensure 32 bytes for AES-256\r\n    { name: \"AES-GCM\" },\r\n    false,\r\n    [\"encrypt\", \"decrypt\"]\r\n  );\r\n}\r\n\r\n/**\r\n * Encrypt sensitive text data\r\n * @param text - Plain text to encrypt\r\n * @param env - Environment with ENCRYPTION_KEY\r\n * @returns Base64 encoded encrypted data with IV prepended\r\n */\r\nexport async function encryptPII(text: string, env: any): Promise<string> {\r\n  if (!text) return \"\";\r\n  \r\n  const iv = crypto.getRandomValues(new Uint8Array(12));\r\n  const key = await getKey(env);\r\n  const encoded = new TextEncoder().encode(text);\r\n  \r\n  const ciphertext = await crypto.subtle.encrypt(\r\n    { name: \"AES-GCM\", iv },\r\n    key,\r\n    encoded\r\n  );\r\n  \r\n  // Combine IV + ciphertext and encode as base64\r\n  const combined = new Uint8Array(iv.length + ciphertext.byteLength);\r\n  combined.set(iv, 0);\r\n  combined.set(new Uint8Array(ciphertext), iv.length);\r\n  \r\n  return btoa(String.fromCharCode(...combined));\r\n}\r\n\r\n/**\r\n * Decrypt sensitive text data\r\n * @param encryptedData - Base64 encoded encrypted data\r\n * @param env - Environment with ENCRYPTION_KEY\r\n * @returns Decrypted plain text\r\n */\r\nexport async function decryptPII(encryptedData: string, env: any): Promise<string> {\r\n  if (!encryptedData) return \"\";\r\n  \r\n  try {\r\n    const combined = Uint8Array.from(atob(encryptedData), c => c.charCodeAt(0));\r\n    const iv = combined.slice(0, 12);\r\n    const ciphertext = combined.slice(12);\r\n    \r\n    const key = await getKey(env);\r\n    const decrypted = await crypto.subtle.decrypt(\r\n      { name: \"AES-GCM\", iv },\r\n      key,\r\n      ciphertext\r\n    );\r\n    \r\n    return new TextDecoder().decode(decrypted);\r\n  } catch (error) {\r\n    console.error(\"Decryption failed:\", error);\r\n    return \"\";\r\n  }\r\n}\r\n\r\n/**\r\n * Encrypt SSN with formatting validation\r\n * @param ssn - Social Security Number (format: XXX-XX-XXXX or XXXXXXXXX)\r\n * @param env - Environment with ENCRYPTION_KEY\r\n * @returns Encrypted SSN\r\n */\r\nexport async function encryptSSN(ssn: string, env: any): Promise<string> {\r\n  if (!ssn) return \"\";\r\n  \r\n  // Remove dashes and validate\r\n  const cleanSSN = ssn.replace(/-/g, \"\");\r\n  if (!/^\\d{9}$/.test(cleanSSN)) {\r\n    throw new Error(\"Invalid SSN format\");\r\n  }\r\n  \r\n  return await encryptPII(cleanSSN, env);\r\n}\r\n\r\n/**\r\n * Decrypt and format SSN\r\n * @param encryptedSSN - Encrypted SSN data\r\n * @param env - Environment with ENCRYPTION_KEY\r\n * @param format - Return formatted (XXX-XX-XXXX) or plain\r\n * @returns Decrypted SSN\r\n */\r\nexport async function decryptSSN(encryptedSSN: string, env: any, format: boolean = false): Promise<string> {\r\n  const ssn = await decryptPII(encryptedSSN, env);\r\n  if (!ssn || !format) return ssn;\r\n  \r\n  // Format as XXX-XX-XXXX\r\n  return `${ssn.slice(0, 3)}-${ssn.slice(3, 5)}-${ssn.slice(5)}`;\r\n}\r\n\r\n/**\r\n * Mask SSN for display (show last 4 digits only)\r\n * @param encryptedSSN - Encrypted SSN data\r\n * @param env - Environment with ENCRYPTION_KEY\r\n * @returns Masked SSN (XXX-XX-1234)\r\n */\r\nexport async function maskSSN(encryptedSSN: string, env: any): Promise<string> {\r\n  const ssn = await decryptPII(encryptedSSN, env);\r\n  if (!ssn || ssn.length < 4) return \"XXX-XX-XXXX\";\r\n  \r\n  const last4 = ssn.slice(-4);\r\n  return `XXX-XX-${last4}`;\r\n}\r\n\r\n/**\r\n * Encrypt phone number\r\n * @param phone - Phone number (any format)\r\n * @param env - Environment with ENCRYPTION_KEY\r\n * @returns Encrypted phone number\r\n */\r\nexport async function encryptPhone(phone: string, env: any): Promise<string> {\r\n  if (!phone) return \"\";\r\n  \r\n  // Remove all non-numeric characters\r\n  const cleanPhone = phone.replace(/\\D/g, \"\");\r\n  return await encryptPII(cleanPhone, env);\r\n}\r\n\r\n/**\r\n * Decrypt phone number\r\n * @param encryptedPhone - Encrypted phone data\r\n * @param env - Environment with ENCRYPTION_KEY\r\n * @param format - Return formatted (XXX) XXX-XXXX or plain\r\n * @returns Decrypted phone number\r\n */\r\nexport async function decryptPhone(encryptedPhone: string, env: any, format: boolean = false): Promise<string> {\r\n  const phone = await decryptPII(encryptedPhone, env);\r\n  if (!phone || !format || phone.length !== 10) return phone;\r\n  \r\n  // Format as (XXX) XXX-XXXX\r\n  return `(${phone.slice(0, 3)}) ${phone.slice(3, 6)}-${phone.slice(6)}`;\r\n}\r\n\r\n/**\r\n * Bulk encrypt object fields\r\n * @param obj - Object with fields to encrypt\r\n * @param fields - Array of field names to encrypt\r\n * @param env - Environment with ENCRYPTION_KEY\r\n * @returns New object with encrypted fields\r\n */\r\nexport async function encryptFields(obj: any, fields: string[], env: any): Promise<any> {\r\n  const encrypted = { ...obj };\r\n  \r\n  for (const field of fields) {\r\n    if (obj[field]) {\r\n      encrypted[field] = await encryptPII(obj[field], env);\r\n    }\r\n  }\r\n  \r\n  return encrypted;\r\n}\r\n\r\n/**\r\n * Bulk decrypt object fields\r\n * @param obj - Object with encrypted fields\r\n * @param fields - Array of field names to decrypt\r\n * @param env - Environment with ENCRYPTION_KEY\r\n * @returns New object with decrypted fields\r\n */\r\nexport async function decryptFields(obj: any, fields: string[], env: any): Promise<any> {\r\n  const decrypted = { ...obj };\r\n  \r\n  for (const field of fields) {\r\n    if (obj[field]) {\r\n      decrypted[field] = await decryptPII(obj[field], env);\r\n    }\r\n  }\r\n  \r\n  return decrypted;\r\n}\r\n", "// src/routes/crm.ts\r\n// CRM API with authentication + encryption for sensitive data\r\n\r\nimport { requireStaff } from \"../middleware/auth\";\r\nimport { encryptPII, decryptPII } from \"../utils/encryption\";\r\nimport { logAudit } from \"../utils/audit\";\r\n\r\nexport interface IntakeRecord {\r\n  id: string;\r\n  full_name: string;\r\n  email: string;\r\n  phone: string;\r\n  service: string;\r\n  notes: string;\r\n  ip: string;\r\n  created_at: string;\r\n}\r\n\r\n/**\r\n * GET /api/crm/intakes - List all client intakes (staff/admin only)\r\n */\r\nexport async function handleCrmIntakes(req: Request, env: any): Promise<Response> {\r\n  // Require staff or admin authentication\r\n  const authResult = await requireStaff(req, env);\r\n  if (authResult instanceof Response) {\r\n    return authResult; // Unauthorized\r\n  }\r\n  const user = authResult;\r\n\r\n  try {\r\n    const { results } = await env.DB.prepare(\r\n      \"SELECT * FROM intakes ORDER BY created_at DESC LIMIT 500\"\r\n    ).all();\r\n\r\n    // Decrypt sensitive fields before returning\r\n    const decryptedResults = await Promise.all(\r\n      (results || []).map(async (row: any) => {\r\n        try {\r\n          return {\r\n            ...row,\r\n            full_name: row.full_name ? await decryptPII(row.full_name, env) : row.full_name,\r\n            email: row.email ? await decryptPII(row.email, env) : row.email,\r\n            phone: row.phone ? await decryptPII(row.phone, env) : row.phone,\r\n            notes: row.notes ? await decryptPII(row.notes, env) : row.notes,\r\n          };\r\n        } catch {\r\n          // If decryption fails, return as-is (legacy unencrypted data)\r\n          return row;\r\n        }\r\n      })\r\n    );\r\n\r\n    // Audit log\r\n    await logAudit(env, {\r\n      action: \"crm_intakes_view\",\r\n      user_id: user.id,\r\n      user_email: user.email,\r\n      entity: \"intakes\",\r\n      details: JSON.stringify({ count: decryptedResults.length }),\r\n    });\r\n\r\n    return new Response(JSON.stringify(decryptedResults), {\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"CRM intakes error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to fetch intakes\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/crm/intakes/:id - Get a single intake (staff/admin only)\r\n */\r\nexport async function handleCrmIntakeById(req: Request, env: any, id: string): Promise<Response> {\r\n  const authResult = await requireStaff(req, env);\r\n  if (authResult instanceof Response) {\r\n    return authResult;\r\n  }\r\n  const user = authResult;\r\n\r\n  try {\r\n    const row = await env.DB.prepare(\"SELECT * FROM intakes WHERE id = ?\").bind(id).first();\r\n    if (!row) {\r\n      return new Response(JSON.stringify({ error: \"Intake not found\" }), {\r\n        status: 404,\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      });\r\n    }\r\n\r\n    // Decrypt sensitive fields\r\n    let decrypted = row;\r\n    try {\r\n      decrypted = {\r\n        ...row,\r\n        full_name: row.full_name ? await decryptPII(row.full_name, env) : row.full_name,\r\n        email: row.email ? await decryptPII(row.email, env) : row.email,\r\n        phone: row.phone ? await decryptPII(row.phone, env) : row.phone,\r\n        notes: row.notes ? await decryptPII(row.notes, env) : row.notes,\r\n      };\r\n    } catch {\r\n      // Legacy unencrypted data\r\n    }\r\n\r\n    await logAudit(env, {\r\n      action: \"crm_intake_view\",\r\n      user_id: user.id,\r\n      user_email: user.email,\r\n      entity: \"intakes\",\r\n      entity_id: id,\r\n    });\r\n\r\n    return new Response(JSON.stringify(decrypted), {\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"CRM intake by id error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to fetch intake\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * POST /api/crm/intakes - Create a new intake (encrypts sensitive data)\r\n */\r\nexport async function handleCrmIntakeCreate(req: Request, env: any): Promise<Response> {\r\n  try {\r\n    const body = await req.json() as { full_name?: string; email?: string; phone?: string; service?: string; notes?: string };\r\n    const { full_name, email, phone, service, notes } = body;\r\n\r\n    if (!full_name || !email) {\r\n      return new Response(JSON.stringify({ error: \"Name and email are required\" }), {\r\n        status: 400,\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      });\r\n    }\r\n\r\n    const ip = req.headers.get(\"CF-Connecting-IP\") || \"unknown\";\r\n    const id = crypto.randomUUID();\r\n    const created_at = new Date().toISOString();\r\n\r\n    // Encrypt sensitive fields\r\n    const encFullName = await encryptPII(full_name, env);\r\n    const encEmail = await encryptPII(email, env);\r\n    const encPhone = phone ? await encryptPII(phone, env) : null;\r\n    const encNotes = notes ? await encryptPII(notes, env) : null;\r\n\r\n    await env.DB.prepare(\r\n      `INSERT INTO intakes (id, full_name, email, phone, service, notes, ip, created_at)\r\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`\r\n    )\r\n      .bind(id, encFullName, encEmail, encPhone, service || null, encNotes, ip, created_at)\r\n      .run();\r\n\r\n    await logAudit(env, {\r\n      action: \"crm_intake_create\",\r\n      entity: \"intakes\",\r\n      entity_id: id,\r\n      details: JSON.stringify({ service }),\r\n    });\r\n\r\n    return new Response(JSON.stringify({ ok: true, id }), {\r\n      status: 201,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"CRM intake create error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to create intake\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * DELETE /api/crm/intakes/:id - Delete an intake (admin only)\r\n */\r\nexport async function handleCrmIntakeDelete(req: Request, env: any, id: string): Promise<Response> {\r\n  const authResult = await requireStaff(req, env);\r\n  if (authResult instanceof Response) {\r\n    return authResult;\r\n  }\r\n  const user = authResult;\r\n\r\n  // Only admin can delete\r\n  if (user.role !== \"admin\") {\r\n    return new Response(JSON.stringify({ error: \"Forbidden: Admin only\" }), {\r\n      status: 403,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n\r\n  try {\r\n    await env.DB.prepare(\"DELETE FROM intakes WHERE id = ?\").bind(id).run();\r\n\r\n    await logAudit(env, {\r\n      action: \"crm_intake_delete\",\r\n      user_id: user.id,\r\n      user_email: user.email,\r\n      entity: \"intakes\",\r\n      entity_id: id,\r\n    });\r\n\r\n    return new Response(JSON.stringify({ ok: true }), {\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"CRM intake delete error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to delete intake\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n}\r\n", "/**\r\n * Request Validation Middleware\r\n * Validates and sanitizes API request inputs\r\n */\r\n\r\nexport interface ValidationError {\r\n  field: string;\r\n  message: string;\r\n}\r\n\r\n/**\r\n * Validate email format\r\n */\r\nexport function isValidEmail(email: string): boolean {\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n  return emailRegex.test(email);\r\n}\r\n\r\n/**\r\n * Validate phone number (US format)\r\n */\r\nexport function isValidPhone(phone: string): boolean {\r\n  const cleanPhone = phone.replace(/\\D/g, \"\");\r\n  return cleanPhone.length === 10 || cleanPhone.length === 11;\r\n}\r\n\r\n/**\r\n * Validate SSN format\r\n */\r\nexport function isValidSSN(ssn: string): boolean {\r\n  const cleanSSN = ssn.replace(/-/g, \"\");\r\n  return /^\\d{9}$/.test(cleanSSN);\r\n}\r\n\r\n/**\r\n * Validate password strength\r\n */\r\nexport function isStrongPassword(password: string): { valid: boolean; errors: string[] } {\r\n  const errors: string[] = [];\r\n  \r\n  if (password.length < 8) {\r\n    errors.push(\"Password must be at least 8 characters long\");\r\n  }\r\n  if (!/[A-Z]/.test(password)) {\r\n    errors.push(\"Password must contain at least one uppercase letter\");\r\n  }\r\n  if (!/[a-z]/.test(password)) {\r\n    errors.push(\"Password must contain at least one lowercase letter\");\r\n  }\r\n  if (!/[0-9]/.test(password)) {\r\n    errors.push(\"Password must contain at least one number\");\r\n  }\r\n  if (!/[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]/.test(password)) {\r\n    errors.push(\"Password must contain at least one special character\");\r\n  }\r\n  \r\n  return {\r\n    valid: errors.length === 0,\r\n    errors\r\n  };\r\n}\r\n\r\n/**\r\n * Sanitize string input (remove potential XSS)\r\n */\r\nexport function sanitizeString(input: string): string {\r\n  return input\r\n    .replace(/</g, \"&lt;\")\r\n    .replace(/>/g, \"&gt;\")\r\n    .replace(/\"/g, \"&quot;\")\r\n    .replace(/'/g, \"&#x27;\")\r\n    .replace(/\\//g, \"&#x2F;\");\r\n}\r\n\r\n/**\r\n * Validate required fields in request body\r\n */\r\nexport function validateRequiredFields(\r\n  body: any,\r\n  requiredFields: string[]\r\n): { valid: boolean; errors: ValidationError[] } {\r\n  const errors: ValidationError[] = [];\r\n  \r\n  for (const field of requiredFields) {\r\n    if (!body[field] || body[field] === \"\") {\r\n      errors.push({\r\n        field,\r\n        message: `${field} is required`\r\n      });\r\n    }\r\n  }\r\n  \r\n  return {\r\n    valid: errors.length === 0,\r\n    errors\r\n  };\r\n}\r\n\r\n/**\r\n * Validate registration request\r\n */\r\nexport function validateRegistration(body: any): { valid: boolean; errors: ValidationError[] } {\r\n  const errors: ValidationError[] = [];\r\n  \r\n  // Check required fields\r\n  const required = validateRequiredFields(body, [\"name\", \"email\", \"password\"]);\r\n  if (!required.valid) {\r\n    errors.push(...required.errors);\r\n  }\r\n  \r\n  // Validate email\r\n  if (body.email && !isValidEmail(body.email)) {\r\n    errors.push({\r\n      field: \"email\",\r\n      message: \"Invalid email format\"\r\n    });\r\n  }\r\n  \r\n  // Validate password strength\r\n  if (body.password) {\r\n    const passwordCheck = isStrongPassword(body.password);\r\n    if (!passwordCheck.valid) {\r\n      errors.push({\r\n        field: \"password\",\r\n        message: passwordCheck.errors.join(\", \")\r\n      });\r\n    }\r\n  }\r\n  \r\n  // Validate phone if provided\r\n  if (body.phone && !isValidPhone(body.phone)) {\r\n    errors.push({\r\n      field: \"phone\",\r\n      message: \"Invalid phone number format\"\r\n    });\r\n  }\r\n  \r\n  return {\r\n    valid: errors.length === 0,\r\n    errors\r\n  };\r\n}\r\n\r\n/**\r\n * Validate login request\r\n */\r\nexport function validateLogin(body: any): { valid: boolean; errors: ValidationError[] } {\r\n  const errors: ValidationError[] = [];\r\n  \r\n  const required = validateRequiredFields(body, [\"email\", \"password\"]);\r\n  if (!required.valid) {\r\n    errors.push(...required.errors);\r\n  }\r\n  \r\n  if (body.email && !isValidEmail(body.email)) {\r\n    errors.push({\r\n      field: \"email\",\r\n      message: \"Invalid email format\"\r\n    });\r\n  }\r\n  \r\n  return {\r\n    valid: errors.length === 0,\r\n    errors\r\n  };\r\n}\r\n\r\n/**\r\n * Validate client data\r\n */\r\nexport function validateClientData(body: any): { valid: boolean; errors: ValidationError[] } {\r\n  const errors: ValidationError[] = [];\r\n  \r\n  if (body.email && !isValidEmail(body.email)) {\r\n    errors.push({\r\n      field: \"email\",\r\n      message: \"Invalid email format\"\r\n    });\r\n  }\r\n  \r\n  if (body.phone && !isValidPhone(body.phone)) {\r\n    errors.push({\r\n      field: \"phone\",\r\n      message: \"Invalid phone number format\"\r\n    });\r\n  }\r\n  \r\n  if (body.ssn && !isValidSSN(body.ssn)) {\r\n    errors.push({\r\n      field: \"ssn\",\r\n      message: \"Invalid SSN format (must be 9 digits)\"\r\n    });\r\n  }\r\n  \r\n  return {\r\n    valid: errors.length === 0,\r\n    errors\r\n  };\r\n}\r\n\r\n/**\r\n * Validate payment request\r\n */\r\nexport function validatePayment(body: any): { valid: boolean; errors: ValidationError[] } {\r\n  const errors: ValidationError[] = [];\r\n  \r\n  const required = validateRequiredFields(body, [\"amount\", \"provider\", \"customer_email\"]);\r\n  if (!required.valid) {\r\n    errors.push(...required.errors);\r\n  }\r\n  \r\n  if (body.amount && (isNaN(body.amount) || body.amount <= 0)) {\r\n    errors.push({\r\n      field: \"amount\",\r\n      message: \"Amount must be a positive number\"\r\n    });\r\n  }\r\n  \r\n  if (body.provider && ![\"stripe\", \"square\", \"bank\"].includes(body.provider)) {\r\n    errors.push({\r\n      field: \"provider\",\r\n      message: \"Provider must be 'stripe', 'square', or 'bank'\"\r\n    });\r\n  }\r\n  \r\n  if (body.customer_email && !isValidEmail(body.customer_email)) {\r\n    errors.push({\r\n      field: \"customer_email\",\r\n      message: \"Invalid email format\"\r\n    });\r\n  }\r\n  \r\n  return {\r\n    valid: errors.length === 0,\r\n    errors\r\n  };\r\n}\r\n\r\n/**\r\n * Validate file upload\r\n */\r\nexport function validateFileUpload(\r\n  filename: string,\r\n  contentType: string,\r\n  maxSizeMB: number = 10\r\n): { valid: boolean; errors: ValidationError[] } {\r\n  const errors: ValidationError[] = [];\r\n  \r\n  // Allowed file types\r\n  const allowedTypes = [\r\n    \"application/pdf\",\r\n    \"image/jpeg\",\r\n    \"image/png\",\r\n    \"image/jpg\",\r\n    \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\r\n    \"application/vnd.ms-excel\",\r\n    \"application/msword\",\r\n    \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\"\r\n  ];\r\n  \r\n  if (!allowedTypes.includes(contentType)) {\r\n    errors.push({\r\n      field: \"file\",\r\n      message: \"Invalid file type. Allowed types: PDF, JPG, PNG, Excel, Word\"\r\n    });\r\n  }\r\n  \r\n  // Validate filename\r\n  if (!/^[a-zA-Z0-9_\\-\\.]+$/.test(filename)) {\r\n    errors.push({\r\n      field: \"filename\",\r\n      message: \"Filename contains invalid characters\"\r\n    });\r\n  }\r\n  \r\n  return {\r\n    valid: errors.length === 0,\r\n    errors\r\n  };\r\n}\r\n\r\n/**\r\n * Middleware to validate request body\r\n */\r\nexport function validateRequest(\r\n  body: any,\r\n  validator: (body: any) => { valid: boolean; errors: ValidationError[] }\r\n): Response | null {\r\n  const result = validator(body);\r\n  \r\n  if (!result.valid) {\r\n    return new Response(\r\n      JSON.stringify({\r\n        error: \"Validation failed\",\r\n        details: result.errors\r\n      }),\r\n      {\r\n        status: 400,\r\n        headers: { \"Content-Type\": \"application/json\" }\r\n      }\r\n    );\r\n  }\r\n  \r\n  return null;\r\n}\r\n", "import { Router } from 'itty-router';\r\nimport { requireStaff } from '../middleware/auth';\r\nimport { isValidEmail, validateRequiredFields } from '../middleware/validation';\r\nimport { logAudit } from '../utils/audit';\r\n\r\nconst lmsRouter = Router();\r\n\r\n// In-memory LMS data (replace with DB in production)\r\nconst courses = [\r\n  {\r\n    id: 'c1',\r\n    title: 'Tax Preparer Onboarding',\r\n    modules: [\r\n      { id: 'm1', title: 'Compliance & Ethics', duration: '30m', status: 'Live' },\r\n      { id: 'm2', title: 'Client Intake & KYC', duration: '20m', status: 'Live' },\r\n      { id: 'm3', title: 'E-File Procedures', duration: '25m', status: 'Live' },\r\n      { id: 'm4', title: 'Data Security', duration: '15m', status: 'Live' }\r\n    ]\r\n  }\r\n];\r\nconst students = [\r\n  { id: 's1', name: 'Jane Doe', email: 'jane@example.com', courses: ['c1'] }\r\n];\r\nconst enrollments = [\r\n  { id: 'e1', studentId: 's1', courseId: 'c1', status: 'active' }\r\n];\r\n\r\n// Theme/branding config\r\nlet lmsConfig = {\r\n  theme: {\r\n    primary: '#11233B',\r\n    accent: '#C9A24D',\r\n    background: '#F5F5F5',\r\n    font: 'Inter, Arial, sans-serif',\r\n    logo: '/public/rtb-logo.png'\r\n  },\r\n  orgName: 'Ross Tax Prep & Bookkeeping',\r\n  compliance: ['IRS', 'SOC2', 'ADA'],\r\n  year: 2026\r\n};\r\n\r\n// GET /api/lms/courses\r\nlmsRouter.get('/courses', (req, env) => {\r\n  return new Response(JSON.stringify(courses), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n\r\n// GET /api/lms/courses/:id\r\nlmsRouter.get('/courses/:id', (req, env) => {\r\n  const course = courses.find(c => c.id === req.params.id);\r\n  if (!course) return new Response('Not found', { status: 404 });\r\n  return new Response(JSON.stringify(course), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n\r\n// POST /api/lms/courses\r\nlmsRouter.post('/courses', async (req, env) => {\r\n  try {\r\n    const body = await req.json();\r\n    const { valid, errors } = validateRequiredFields(body, ['title']);\r\n    if (!valid) return new Response(JSON.stringify({ error: errors }), { status: 400 });\r\n    const id = 'c' + (courses.length + 1);\r\n    const course = { id, title: body.title, modules: [] };\r\n    courses.push(course);\r\n    await logAudit(env, { action: 'lms_course_create', entity: 'courses', entity_id: id });\r\n    return new Response(JSON.stringify(course), { headers: { 'Content-Type': 'application/json' } });\r\n  } catch (error) {\r\n    console.error('LMS create course error:', error);\r\n    return new Response(JSON.stringify({ error: 'Failed to create course' }), { status: 500 });\r\n  }\r\n});\r\n\r\n// PUT /api/lms/courses/:id\r\nlmsRouter.put('/courses/:id', async (req, env) => {\r\n  try {\r\n    const body = await req.json();\r\n    const course = courses.find(c => c.id === req.params.id);\r\n    if (!course) return new Response(JSON.stringify({ error: 'Not found' }), { status: 404 });\r\n    course.title = body.title || course.title;\r\n    course.modules = body.modules || course.modules;\r\n    await logAudit(env, { action: 'lms_course_update', entity: 'courses', entity_id: course.id });\r\n    return new Response(JSON.stringify(course), { headers: { 'Content-Type': 'application/json' } });\r\n  } catch (error) {\r\n    console.error('LMS update course error:', error);\r\n    return new Response(JSON.stringify({ error: 'Failed to update course' }), { status: 500 });\r\n  }\r\n});\r\n\r\n// DELETE /api/lms/courses/:id\r\nlmsRouter.delete('/courses/:id', async (req, env) => {\r\n  try {\r\n    const idx = courses.findIndex(c => c.id === req.params.id);\r\n    if (idx === -1) return new Response(JSON.stringify({ error: 'Not found' }), { status: 404 });\r\n    const [removed] = courses.splice(idx, 1);\r\n    await logAudit(env, { action: 'lms_course_delete', entity: 'courses', entity_id: removed.id });\r\n    return new Response(JSON.stringify({ success: true }));\r\n  } catch (error) {\r\n    console.error('LMS delete course error:', error);\r\n    return new Response(JSON.stringify({ error: 'Failed to delete course' }), { status: 500 });\r\n  }\r\n});\r\n\r\n// GET /api/lms/students\r\nlmsRouter.get('/students', (req, env) => {\r\n  return new Response(JSON.stringify(students), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n\r\n// GET /api/lms/students/:id\r\nlmsRouter.get('/students/:id', (req, env) => {\r\n  const student = students.find(s => s.id === req.params.id);\r\n  if (!student) return new Response('Not found', { status: 404 });\r\n  return new Response(JSON.stringify(student), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n\r\n// POST /api/lms/students\r\nlmsRouter.post('/students', async (req, env) => {\r\n  try {\r\n    const body = (await req.json()) as { name: string; email: string };\r\n    const { valid, errors } = validateRequiredFields(body, ['name', 'email']);\r\n    if (!valid || !isValidEmail(body.email)) return new Response(JSON.stringify({ error: errors }), { status: 400 });\r\n    const studentId = 's' + (students.length + 1);\r\n    const student = { id: studentId, name: body.name, email: body.email, courses: [] };\r\n    students.push(student);\r\n    await logAudit(env, { action: 'lms_student_create', entity: 'students', entity_id: studentId });\r\n    return new Response(JSON.stringify(student), { headers: { 'Content-Type': 'application/json' } });\r\n  } catch (error) {\r\n    console.error('LMS create student error:', error);\r\n    return new Response(JSON.stringify({ error: 'Failed to create student' }), { status: 500 });\r\n  }\r\n});\r\n\r\n// PATCH /api/lms/students/:id\r\nlmsRouter.patch('/students/:id', async (req, env) => {\r\n  try {\r\n    const body = (await req.json()) as { name?: string; email?: string; courses?: any[] };\r\n    const student = students.find(s => s.id === req.params.id);\r\n    if (!student) return new Response(JSON.stringify({ error: 'Not found' }), { status: 404 });\r\n    student.name = body.name || student.name;\r\n    student.email = body.email || student.email;\r\n    student.courses = body.courses || student.courses;\r\n    await logAudit(env, { action: 'lms_student_update', entity: 'students', entity_id: student.id });\r\n    return new Response(JSON.stringify(student), { headers: { 'Content-Type': 'application/json' } });\r\n  } catch (error) {\r\n    console.error('LMS update student error:', error);\r\n    return new Response(JSON.stringify({ error: 'Failed to update student' }), { status: 500 });\r\n  }\r\n});\r\n\r\n// DELETE /api/lms/students/:id\r\nlmsRouter.delete('/students/:id', async (req, env) => {\r\n  try {\r\n    const idx = students.findIndex(s => s.id === req.params.id);\r\n    if (idx === -1) return new Response(JSON.stringify({ error: 'Not found' }), { status: 404 });\r\n    const [removed] = students.splice(idx, 1);\r\n    await logAudit(env, { action: 'lms_student_delete', entity: 'students', entity_id: removed.id });\r\n    return new Response(JSON.stringify({ success: true }));\r\n  } catch (error) {\r\n    console.error('LMS delete student error:', error);\r\n    return new Response(JSON.stringify({ error: 'Failed to delete student' }), { status: 500 });\r\n  }\r\n});\r\n\r\n// POST /api/lms/enroll\r\nlmsRouter.post('/enroll', async (req, env) => {\r\n  try {\r\n    const body = (await req.json()) as { name?: string; email?: string; studentId?: string; courseId?: string };\r\n    // Support both student creation and enrollment\r\n    if (body.name && body.email) {\r\n      const { valid, errors } = validateRequiredFields(body, ['name', 'email']);\r\n      if (!valid || !isValidEmail(body.email)) return new Response(JSON.stringify({ error: errors }), { status: 400 });\r\n      const id = 's' + (students.length + 1);\r\n      const student = { id, name: body.name, email: body.email, courses: [] };\r\n      students.push(student);\r\n      await logAudit(env, { action: 'lms_student_create', entity: 'students', entity_id: id });\r\n      return new Response(JSON.stringify(student), { headers: { 'Content-Type': 'application/json' } });\r\n    }\r\n    if (body.studentId && body.courseId) {\r\n      const enrollmentId = 'e' + (enrollments.length + 1);\r\n      enrollments.push({ id: enrollmentId, studentId: body.studentId, courseId: body.courseId, status: 'active' });\r\n      await logAudit(env, { action: 'lms_enroll', entity: 'enrollments', entity_id: enrollmentId });\r\n      return new Response(JSON.stringify({ success: true, id: enrollmentId }), { headers: { 'Content-Type': 'application/json' } });\r\n    }\r\n    return new Response(JSON.stringify({ error: 'Missing required fields' }), { status: 400 });\r\n  } catch (error) {\r\n    console.error('LMS enroll error:', error);\r\n    return new Response(JSON.stringify({ error: 'Failed to enroll student' }), { status: 500 });\r\n  }\r\n});\r\n\r\n// GET /api/lms/enrollments\r\nlmsRouter.get('/enrollments', (req, env) => {\r\n  return new Response(JSON.stringify(enrollments), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n\r\n// GET /api/lms/enrollments/:id\r\nlmsRouter.get('/enrollments/:id', (req, env) => {\r\n  const enr = enrollments.find(e => e.id === req.params.id);\r\n  if (!enr) return new Response('Not found', { status: 404 });\r\n  return new Response(JSON.stringify(enr), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n\r\n// LMS THEME/CONFIGURATION ENDPOINT\r\n// GET /api/lms/config\r\nlmsRouter.get('/config', (req, env) => {\r\n  return new Response(JSON.stringify(lmsConfig), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n// PUT /api/lms/config (staff only)\r\nlmsRouter.put('/config', requireStaff, async (req, env) => {\r\n  const body = (await req.json()) as Partial<typeof lmsConfig>;\r\n  lmsConfig = { ...lmsConfig, ...(typeof body === 'object' && body !== null ? body : {}) };\r\n  await logAudit(env, { action: 'lms_config_update', entity: 'lms_config', entity_id: 'lms' });\r\n  return new Response(JSON.stringify(lmsConfig), { headers: { 'Content-Type': 'application/json' } });\r\n});\r\n\r\nexport default lmsRouter;\r\n", "import { Router } from 'itty-router';\r\nimport { isValidEmail, isStrongPassword, sanitizeString } from '../middleware/validation';\r\nimport { encryptPII } from '../utils/encryption';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nconst portalRouter = Router();\r\n\r\n// POST /api/portal/register\r\nportalRouter.post('/register', async (req, env) => {\r\n  try {\r\n    const body = await req.json();\r\n    const name = sanitizeString(body.name || \"\");\r\n    const email = sanitizeString(body.email || \"\");\r\n    const password = body.password || \"\";\r\n    if (!name || !isValidEmail(email) || !isStrongPassword(password).valid) {\r\n      return new Response(JSON.stringify({ error: \"Invalid input\" }), { status: 400 });\r\n    }\r\n    // Check for existing user\r\n    const exists = await env.DB.prepare('SELECT id FROM clients WHERE email = ?').bind(email).first();\r\n    if (exists) return new Response(JSON.stringify({ error: \"Email already registered\" }), { status: 409 });\r\n    // Hash password\r\n    const hash = await bcrypt.hash(password, 10);\r\n    // Encrypt PII\r\n    const encName = await encryptPII(name, env);\r\n    const encEmail = await encryptPII(email, env);\r\n    // Insert user\r\n    const result = await env.DB.prepare('INSERT INTO clients (full_name, email, password_hash, created_at) VALUES (?, ?, ?, CURRENT_TIMESTAMP)').bind(encName, encEmail, hash).run();\r\n    return new Response(JSON.stringify({ success: true, id: result.lastRowId }), { headers: { 'Content-Type': 'application/json' } });\r\n  } catch (err) {\r\n    return new Response(JSON.stringify({ error: 'Registration failed' }), { status: 500 });\r\n  }\r\n});\r\n\r\nexport default portalRouter;\r\n", "import { Router } from 'itty-router';\r\nimport { isValidEmail, sanitizeString } from '../middleware/validation';\r\nimport { decryptPII } from '../utils/encryption';\r\nimport bcrypt from 'bcryptjs';\r\nimport jwt from '@tsndr/cloudflare-worker-jwt';\r\n\r\nconst portalAuthRouter = Router();\r\n\r\n// POST /api/portal/login\r\nportalAuthRouter.post('/login', async (req, env) => {\r\n  try {\r\n    const body = await req.json();\r\n    const email = sanitizeString(body.email || \"\");\r\n    const password = body.password || \"\";\r\n    if (!isValidEmail(email) || !password) {\r\n      return new Response(JSON.stringify({ error: \"Invalid credentials\" }), { status: 400 });\r\n    }\r\n    // Find user by email (encrypted in DB)\r\n    const clientRows = await env.DB.prepare('SELECT id, full_name, email, password_hash FROM clients').all();\r\n    let user = null;\r\n    for (const row of clientRows.results) {\r\n      const decEmail = await decryptPII(row.email, env);\r\n      if (decEmail === email) {\r\n        user = row;\r\n        break;\r\n      }\r\n    }\r\n    if (!user) return new Response(JSON.stringify({ error: \"Invalid credentials\" }), { status: 401 });\r\n    // Check password\r\n    const valid = await bcrypt.compare(password, user.password_hash);\r\n    if (!valid) return new Response(JSON.stringify({ error: \"Invalid credentials\" }), { status: 401 });\r\n    // Issue JWT\r\n    const payload = {\r\n      id: user.id,\r\n      email,\r\n      role: 'client',\r\n      name: user.full_name ? await decryptPII(user.full_name, env) : undefined\r\n    };\r\n    const token = await jwt.sign(payload, env.JWT_SECRET || \"change-this-secret-in-production\", { expiresIn: '7d' });\r\n    return new Response(JSON.stringify({ success: true, token }), { headers: { 'Content-Type': 'application/json' } });\r\n  } catch (err) {\r\n    return new Response(JSON.stringify({ error: 'Login failed' }), { status: 500 });\r\n  }\r\n});\r\n\r\nexport default portalAuthRouter;\r\n", "// src/routes/certificates.ts\r\n// Generate and issue digital certificates and licenses for compliance\r\n\r\nimport { requireAdmin } from \"../middleware/auth\";\r\nimport { logAudit } from \"../utils/audit\";\r\n\r\nexport interface Certificate {\r\n  id: string;\r\n  type: string;\r\n  title: string;\r\n  issuer: string;\r\n  issuedTo: string;\r\n  issuedAt: string;\r\n  expiresAt?: string;\r\n  status: \"active\" | \"expired\" | \"revoked\";\r\n  credentials: Record<string, string>;\r\n  signature: string;\r\n}\r\n\r\n// Predefined certificate templates\r\nconst CERTIFICATE_TEMPLATES: Record<string, Partial<Certificate>> = {\r\n  EFIN: {\r\n    type: \"EFIN\",\r\n    title: \"IRS Electronic Filing Identification Number\",\r\n    issuer: \"Internal Revenue Service\",\r\n  },\r\n  PTIN: {\r\n    type: \"PTIN\",\r\n    title: \"Preparer Tax Identification Number\",\r\n    issuer: \"Internal Revenue Service\",\r\n  },\r\n  CAF: {\r\n    type: \"CAF\",\r\n    title: \"Centralized Authorization File Number\",\r\n    issuer: \"Internal Revenue Service\",\r\n  },\r\n  ETIN: {\r\n    type: \"ETIN\",\r\n    title: \"Electronic Transmitter Identification Number\",\r\n    issuer: \"Internal Revenue Service\",\r\n  },\r\n  BUSINESS_LICENSE: {\r\n    type: \"BUSINESS_LICENSE\",\r\n    title: \"Business License\",\r\n    issuer: \"State of Texas\",\r\n  },\r\n  ERO_CERTIFICATE: {\r\n    type: \"ERO_CERTIFICATE\",\r\n    title: \"Authorized IRS E-File Provider (ERO)\",\r\n    issuer: \"Internal Revenue Service\",\r\n  },\r\n  SOFTWARE_DEVELOPER: {\r\n    type: \"SOFTWARE_DEVELOPER\",\r\n    title: \"IRS MeF Software Developer Certification\",\r\n    issuer: \"Internal Revenue Service\",\r\n  },\r\n  DATA_SECURITY: {\r\n    type: \"DATA_SECURITY\",\r\n    title: \"Data Security Compliance Certificate\",\r\n    issuer: \"Ross Tax Prep & Bookkeeping\",\r\n  },\r\n  STAFF_TRAINING: {\r\n    type: \"STAFF_TRAINING\",\r\n    title: \"Staff Training & Compliance Completion\",\r\n    issuer: \"Ross Tax Prep & Bookkeeping\",\r\n  },\r\n};\r\n\r\n/**\r\n * Generate a digital signature for a certificate\r\n */\r\nasync function generateCertificateSignature(cert: Partial<Certificate>, env: any): Promise<string> {\r\n  const data = JSON.stringify({\r\n    type: cert.type,\r\n    issuedTo: cert.issuedTo,\r\n    issuedAt: cert.issuedAt,\r\n    credentials: cert.credentials,\r\n  });\r\n  const encoder = new TextEncoder();\r\n  const dataBuffer = encoder.encode(data + (env.CERT_SECRET || \"cert-signing-key\"));\r\n  const hashBuffer = await crypto.subtle.digest(\"SHA-256\", dataBuffer);\r\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n  return hashArray.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n}\r\n\r\n/**\r\n * GET /api/certificates - List all certificates (admin only)\r\n */\r\nexport async function handleListCertificates(req: Request, env: any): Promise<Response> {\r\n  const authResult = await requireAdmin(req, env);\r\n  if (authResult instanceof Response) {\r\n    return authResult;\r\n  }\r\n  const user = authResult;\r\n\r\n  try {\r\n    const { results } = await env.DB.prepare(\r\n      \"SELECT * FROM certificates ORDER BY issued_at DESC\"\r\n    ).all();\r\n\r\n    await logAudit(env, {\r\n      action: \"certificates_list\",\r\n      user_id: user.id,\r\n      user_email: user.email,\r\n      entity: \"certificates\",\r\n    });\r\n\r\n    return new Response(JSON.stringify(results || []), {\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"List certificates error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to list certificates\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * POST /api/certificates/issue - Issue a new certificate (admin only)\r\n */\r\nexport async function handleIssueCertificate(req: Request, env: any): Promise<Response> {\r\n  const authResult = await requireAdmin(req, env);\r\n  if (authResult instanceof Response) {\r\n    return authResult;\r\n  }\r\n  const user = authResult;\r\n\r\n  try {\r\n    const body = await req.json() as { type?: string; issuedTo?: string; credentials?: Record<string, string>; expiresAt?: string };\r\n    const { type, issuedTo, credentials, expiresAt } = body;\r\n\r\n    if (!type || !issuedTo) {\r\n      return new Response(JSON.stringify({ error: \"type and issuedTo are required\" }), {\r\n        status: 400,\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      });\r\n    }\r\n\r\n    const template = CERTIFICATE_TEMPLATES[type];\r\n    if (!template) {\r\n      return new Response(\r\n        JSON.stringify({\r\n          error: \"Invalid certificate type\",\r\n          validTypes: Object.keys(CERTIFICATE_TEMPLATES),\r\n        }),\r\n        { status: 400, headers: { \"Content-Type\": \"application/json\" } }\r\n      );\r\n    }\r\n\r\n    const id = crypto.randomUUID();\r\n    const issuedAt = new Date().toISOString();\r\n\r\n    const cert: Certificate = {\r\n      id,\r\n      type,\r\n      title: template.title!,\r\n      issuer: template.issuer!,\r\n      issuedTo,\r\n      issuedAt,\r\n      expiresAt: expiresAt ?? undefined,\r\n      status: \"active\",\r\n      credentials: credentials || {},\r\n      signature: \"\",\r\n    };\r\n\r\n    cert.signature = await generateCertificateSignature(cert, env);\r\n\r\n    await env.DB.prepare(\r\n      `INSERT INTO certificates (id, type, title, issuer, issued_to, issued_at, expires_at, status, credentials_json, signature)\r\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\r\n    )\r\n      .bind(\r\n        cert.id,\r\n        cert.type,\r\n        cert.title,\r\n        cert.issuer,\r\n        cert.issuedTo,\r\n        cert.issuedAt,\r\n        cert.expiresAt,\r\n        cert.status,\r\n        JSON.stringify(cert.credentials),\r\n        cert.signature\r\n      )\r\n      .run();\r\n\r\n    await logAudit(env, {\r\n      action: \"certificate_issue\",\r\n      user_id: user.id,\r\n      user_email: user.email,\r\n      entity: \"certificates\",\r\n      entity_id: id,\r\n      details: JSON.stringify({ type, issuedTo }),\r\n    });\r\n\r\n    return new Response(JSON.stringify({ ok: true, certificate: cert }), {\r\n      status: 201,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"Issue certificate error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to issue certificate\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/certificates/:id - Get a certificate by ID\r\n */\r\nexport async function handleGetCertificate(req: Request, env: any, id: string): Promise<Response> {\r\n  const authResult = await requireAdmin(req, env);\r\n  if (authResult instanceof Response) {\r\n    return authResult;\r\n  }\r\n\r\n  try {\r\n    const row = await env.DB.prepare(\"SELECT * FROM certificates WHERE id = ?\").bind(id).first();\r\n    if (!row) {\r\n      return new Response(JSON.stringify({ error: \"Certificate not found\" }), {\r\n        status: 404,\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      });\r\n    }\r\n\r\n    const cert = {\r\n      ...row,\r\n      credentials: row.credentials_json ? JSON.parse(row.credentials_json) : {},\r\n    };\r\n\r\n    return new Response(JSON.stringify(cert), {\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"Get certificate error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to get certificate\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * POST /api/certificates/:id/revoke - Revoke a certificate (admin only)\r\n */\r\nexport async function handleRevokeCertificate(req: Request, env: any, id: string): Promise<Response> {\r\n  const authResult = await requireAdmin(req, env);\r\n  if (authResult instanceof Response) {\r\n    return authResult;\r\n  }\r\n  const user = authResult;\r\n\r\n  try {\r\n    await env.DB.prepare(\"UPDATE certificates SET status = 'revoked' WHERE id = ?\").bind(id).run();\r\n\r\n    await logAudit(env, {\r\n      action: \"certificate_revoke\",\r\n      user_id: user.id,\r\n      user_email: user.email,\r\n      entity: \"certificates\",\r\n      entity_id: id,\r\n    });\r\n\r\n    return new Response(JSON.stringify({ ok: true }), {\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"Revoke certificate error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to revoke certificate\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/certificates/:id/download - Download certificate as JSON (for PDF generation client-side)\r\n */\r\nexport async function handleDownloadCertificate(req: Request, env: any, id: string): Promise<Response> {\r\n  const authResult = await requireAdmin(req, env);\r\n  if (authResult instanceof Response) {\r\n    return authResult;\r\n  }\r\n\r\n  try {\r\n    const row = await env.DB.prepare(\"SELECT * FROM certificates WHERE id = ?\").bind(id).first();\r\n    if (!row) {\r\n      return new Response(JSON.stringify({ error: \"Certificate not found\" }), {\r\n        status: 404,\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      });\r\n    }\r\n\r\n    const cert = {\r\n      ...row,\r\n      credentials: row.credentials_json ? JSON.parse(row.credentials_json) : {},\r\n    };\r\n\r\n    // Return as downloadable JSON\r\n    return new Response(JSON.stringify(cert, null, 2), {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"Content-Disposition\": `attachment; filename=\"certificate-${cert.type}-${cert.id}.json\"`,\r\n      },\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"Download certificate error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to download certificate\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/certificates/types - List available certificate types\r\n */\r\nexport async function handleCertificateTypes(req: Request, env: any): Promise<Response> {\r\n  return new Response(\r\n    JSON.stringify(\r\n      Object.entries(CERTIFICATE_TEMPLATES).map(([key, val]) => ({\r\n        type: key,\r\n        title: val.title,\r\n        issuer: val.issuer,\r\n      }))\r\n    ),\r\n    { headers: { \"Content-Type\": \"application/json\" } }\r\n  );\r\n}\r\n", "// src/routes/team.ts\r\n// Meet the Team API endpoint\r\n\r\nexport interface TeamMember {\r\n  id: string;\r\n  name: string;\r\n  title: string;\r\n  role: string;\r\n  region: string;\r\n  phone: string;\r\n  email: string;\r\n  photo?: string;\r\n  bio?: string;\r\n  credentials?: string[];\r\n  active: boolean;\r\n}\r\n\r\n// Static team data - can be moved to D1 database later\r\nconst TEAM_MEMBERS: TeamMember[] = [\r\n  {\r\n    id: \"andreaa-channel\",\r\n    name: \"Andreaa Chan'nel\",\r\n    title: \"Owner | Resolution Manager\",\r\n    role: \"owner\",\r\n    region: \"Crowley, LA\",\r\n    phone: \"254-394-7438\",\r\n    email: \"Info@RossTaxPrep.com\",\r\n    photo: \"/assets/andreaa.png\",\r\n    bio: \"Started doing taxes at 17 back in 2017. Author + Illustrator of 'How-To' Tax Pro Textbook. Built tax software supporting IRS e-file workflow and transmission processes.\",\r\n    credentials: [\"PTIN\", \"EFIN\", \"ETIN\"],\r\n    active: true,\r\n  },\r\n  {\r\n    id: \"zavya-brown\",\r\n    name: \"Zavya Brown, MBA\",\r\n    title: \"Lead Tax Associate\",\r\n    role: \"lead\",\r\n    region: \"Central Texas Area\",\r\n    phone: \"512-489-6749\",\r\n    email: \"Info@RossTaxPrep.com\",\r\n    photo: \"/assets/zavya.png\",\r\n    bio: \"MBA graduate with expertise in individual and business tax preparation.\",\r\n    credentials: [\"PTIN\"],\r\n    active: true,\r\n  },\r\n  {\r\n    id: \"sharleana-mathes\",\r\n    name: \"Sharleana Mathes\",\r\n    title: \"Tax Associate | Experience Manager\",\r\n    role: \"associate\",\r\n    region: \"Central Texas Region\",\r\n    phone: \"512-489-6749\",\r\n    email: \"Manager@RossTaxPrep.com\",\r\n    photo: \"/assets/sharleana.png\",\r\n    bio: \"Dedicated to providing exceptional client experience and accurate tax preparation.\",\r\n    credentials: [\"PTIN\"],\r\n    active: true,\r\n  },\r\n  {\r\n    id: \"paul-okpulor\",\r\n    name: \"Paul C. Okpulor\",\r\n    title: \"Tax Associate\",\r\n    role: \"associate\",\r\n    region: \"Dallas Region\",\r\n    phone: \"512-489-6749\",\r\n    email: \"Info@RossTaxPrep.com\",\r\n    photo: \"/assets/paul.png\",\r\n    bio: \"Serving the Dallas region with professional tax preparation services.\",\r\n    credentials: [\"PTIN\"],\r\n    active: true,\r\n  },\r\n];\r\n\r\n/**\r\n * GET /api/team - List all active team members\r\n */\r\nexport async function handleListTeam(req: Request, env: any): Promise<Response> {\r\n  const url = new URL(req.url);\r\n  const region = url.searchParams.get(\"region\");\r\n  const role = url.searchParams.get(\"role\");\r\n\r\n  let members = TEAM_MEMBERS.filter((m) => m.active);\r\n\r\n  // Filter by region if specified\r\n  if (region) {\r\n    members = members.filter((m) =>\r\n      m.region.toLowerCase().includes(region.toLowerCase())\r\n    );\r\n  }\r\n\r\n  // Filter by role if specified\r\n  if (role) {\r\n    members = members.filter((m) => m.role === role);\r\n  }\r\n\r\n  return new Response(JSON.stringify(members), {\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n  });\r\n}\r\n\r\n/**\r\n * GET /api/team/:id - Get a specific team member\r\n */\r\nexport async function handleGetTeamMember(\r\n  req: Request,\r\n  env: any,\r\n  id: string\r\n): Promise<Response> {\r\n  const member = TEAM_MEMBERS.find((m) => m.id === id && m.active);\r\n\r\n  if (!member) {\r\n    return new Response(JSON.stringify({ error: \"Team member not found\" }), {\r\n      status: 404,\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n    });\r\n  }\r\n\r\n  return new Response(JSON.stringify(member), {\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n  });\r\n}\r\n\r\n/**\r\n * GET /api/team/regions - List all regions with team members\r\n */\r\nexport async function handleListRegions(req: Request, env: any): Promise<Response> {\r\n  const regions = [...new Set(TEAM_MEMBERS.filter((m) => m.active).map((m) => m.region))];\r\n\r\n  return new Response(JSON.stringify(regions), {\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n  });\r\n}\r\n", "// src/routes/compliance.ts\r\n// Comprehensive compliance checking and certificate management\r\n\r\nimport { requireAdmin, requireStaff } from \"../middleware/auth\";\r\nimport { logAudit } from \"../utils/audit\";\r\n\r\n// Required certificates for IRS-compliant tax prep business\r\nconst REQUIRED_CERTIFICATES = [\r\n  {\r\n    type: \"EFIN\",\r\n    title: \"IRS Electronic Filing Identification Number\",\r\n    issuer: \"Internal Revenue Service\",\r\n    required: true,\r\n    description: \"Required for all Authorized IRS e-file Providers to transmit returns\",\r\n    renewalPeriod: \"Annual\",\r\n    category: \"IRS\"\r\n  },\r\n  {\r\n    type: \"PTIN\",\r\n    title: \"Preparer Tax Identification Number\",\r\n    issuer: \"Internal Revenue Service\",\r\n    required: true,\r\n    description: \"Required for all paid tax preparers\",\r\n    renewalPeriod: \"Annual (Dec 31)\",\r\n    category: \"IRS\"\r\n  },\r\n  {\r\n    type: \"ETIN\",\r\n    title: \"Electronic Transmitter Identification Number\",\r\n    issuer: \"Internal Revenue Service\",\r\n    required: true,\r\n    description: \"Required for software developers/transmitters in IRS e-file program\",\r\n    renewalPeriod: \"Annual\",\r\n    category: \"IRS\"\r\n  },\r\n  {\r\n    type: \"CAF\",\r\n    title: \"Centralized Authorization File Number\",\r\n    issuer: \"Internal Revenue Service\",\r\n    required: false,\r\n    description: \"Required for third-party authorization (Form 2848, 8821)\",\r\n    renewalPeriod: \"As needed\",\r\n    category: \"IRS\"\r\n  },\r\n  {\r\n    type: \"ERO_CERTIFICATE\",\r\n    title: \"Authorized IRS E-File Provider (ERO)\",\r\n    issuer: \"Internal Revenue Service\",\r\n    required: true,\r\n    description: \"Electronic Return Originator status confirmation\",\r\n    renewalPeriod: \"Annual\",\r\n    category: \"IRS\"\r\n  },\r\n  {\r\n    type: \"BUSINESS_LICENSE\",\r\n    title: \"Business License\",\r\n    issuer: \"State of Louisiana / Texas\",\r\n    required: true,\r\n    description: \"State business operating license\",\r\n    renewalPeriod: \"Annual\",\r\n    category: \"State\"\r\n  },\r\n  {\r\n    type: \"SOFTWARE_DEVELOPER\",\r\n    title: \"IRS MeF Software Developer Certification\",\r\n    issuer: \"Internal Revenue Service\",\r\n    required: true,\r\n    description: \"Certification for custom tax software development\",\r\n    renewalPeriod: \"Annual\",\r\n    category: \"IRS\"\r\n  },\r\n  {\r\n    type: \"DATA_SECURITY\",\r\n    title: \"Data Security Compliance Certificate\",\r\n    issuer: \"Ross Tax Prep & Bookkeeping\",\r\n    required: true,\r\n    description: \"IRS Publication 4557 / FTC Safeguards Rule compliance\",\r\n    renewalPeriod: \"Annual\",\r\n    category: \"Security\"\r\n  },\r\n  {\r\n    type: \"STAFF_TRAINING\",\r\n    title: \"Staff Training & Compliance Completion\",\r\n    issuer: \"Ross Tax Prep & Bookkeeping\",\r\n    required: true,\r\n    description: \"Annual Circular 230 and security awareness training\",\r\n    renewalPeriod: \"Annual\",\r\n    category: \"Training\"\r\n  }\r\n];\r\n\r\n// Compliance requirements checklist\r\nconst COMPLIANCE_REQUIREMENTS = {\r\n  irs: [\r\n    { id: \"efin_active\", name: \"EFIN Active\", description: \"Electronic Filing Identification Number is active and current\" },\r\n    { id: \"ptin_current\", name: \"PTIN Current\", description: \"All preparers have valid PTINs\" },\r\n    { id: \"etin_active\", name: \"ETIN Active\", description: \"Electronic Transmitter ID is active\" },\r\n    { id: \"ero_status\", name: \"ERO Status\", description: \"Authorized IRS e-file Provider status confirmed\" },\r\n    { id: \"circular_230\", name: \"Circular 230\", description: \"Compliance with Treasury Circular 230\" },\r\n    { id: \"form_8879\", name: \"Form 8879\", description: \"E-file authorization forms properly executed\" }\r\n  ],\r\n  security: [\r\n    { id: \"pub_4557\", name: \"IRS Pub 4557\", description: \"Safeguarding Taxpayer Data compliance\" },\r\n    { id: \"ftc_safeguards\", name: \"FTC Safeguards Rule\", description: \"Written Information Security Plan (WISP)\" },\r\n    { id: \"encryption\", name: \"Data Encryption\", description: \"PII encrypted at rest and in transit\" },\r\n    { id: \"access_controls\", name: \"Access Controls\", description: \"Role-based access implemented\" },\r\n    { id: \"audit_logging\", name: \"Audit Logging\", description: \"All sensitive actions are logged\" },\r\n    { id: \"incident_response\", name: \"Incident Response\", description: \"Data breach response plan documented\" }\r\n  ],\r\n  state: [\r\n    { id: \"la_license\", name: \"Louisiana License\", description: \"State business license (if applicable)\" },\r\n    { id: \"tx_license\", name: \"Texas License\", description: \"State business license (if applicable)\" },\r\n    { id: \"local_permits\", name: \"Local Permits\", description: \"City/county business permits\" }\r\n  ],\r\n  operational: [\r\n    { id: \"e_o_insurance\", name: \"E&O Insurance\", description: \"Errors & Omissions professional liability\" },\r\n    { id: \"bond\", name: \"Surety Bond\", description: \"Tax preparer surety bond (if required)\" },\r\n    { id: \"record_retention\", name: \"Record Retention\", description: \"3-year minimum record retention policy\" },\r\n    { id: \"client_agreements\", name: \"Client Agreements\", description: \"Engagement letters and disclosures\" }\r\n  ]\r\n};\r\n\r\nexport interface ComplianceStatus {\r\n  overall: \"compliant\" | \"partial\" | \"non-compliant\";\r\n  score: number;\r\n  maxScore: number;\r\n  percentage: number;\r\n  certificates: {\r\n    type: string;\r\n    title: string;\r\n    status: \"active\" | \"expired\" | \"missing\" | \"revoked\";\r\n    issuedAt?: string;\r\n    expiresAt?: string;\r\n    required: boolean;\r\n  }[];\r\n  requirements: {\r\n    category: string;\r\n    items: {\r\n      id: string;\r\n      name: string;\r\n      status: \"pass\" | \"fail\" | \"warning\" | \"not-checked\";\r\n      notes?: string;\r\n    }[];\r\n  }[];\r\n  recommendations: string[];\r\n  lastChecked: string;\r\n}\r\n\r\n/**\r\n * GET /api/compliance/check - Run full compliance check\r\n */\r\nexport async function handleComplianceCheck(req: Request, env: any): Promise<Response> {\r\n  const authResult = await requireStaff(req, env);\r\n  if (authResult instanceof Response) {\r\n    return authResult;\r\n  }\r\n  const user = authResult;\r\n\r\n  try {\r\n    // Get all certificates from database\r\n    const { results: certs } = await env.DB.prepare(\r\n      \"SELECT * FROM certificates WHERE status != 'revoked'\"\r\n    ).all();\r\n\r\n    const certMap = new Map((certs || []).map((c: any) => [c.type, c]));\r\n    \r\n    // Check certificate status\r\n    const certificateStatus = REQUIRED_CERTIFICATES.map(req => {\r\n      const cert = certMap.get(req.type) as any;\r\n      let status: \"active\" | \"expired\" | \"missing\" | \"revoked\" = \"missing\";\r\n      \r\n      if (cert) {\r\n        if (cert.status === \"revoked\") {\r\n          status = \"revoked\";\r\n        } else if (cert.expires_at && new Date(cert.expires_at) < new Date()) {\r\n          status = \"expired\";\r\n        } else {\r\n          status = \"active\";\r\n        }\r\n      }\r\n\r\n      return {\r\n        type: req.type,\r\n        title: req.title,\r\n        issuer: req.issuer,\r\n        status,\r\n        issuedAt: cert?.issued_at,\r\n        expiresAt: cert?.expires_at,\r\n        required: req.required,\r\n        category: req.category,\r\n        description: req.description\r\n      };\r\n    });\r\n\r\n    // Calculate compliance score\r\n    let score = 0;\r\n    let maxScore = 0;\r\n    \r\n    certificateStatus.forEach(cert => {\r\n      if (cert.required) {\r\n        maxScore += 10;\r\n        if (cert.status === \"active\") score += 10;\r\n        else if (cert.status === \"expired\") score += 3;\r\n      } else {\r\n        maxScore += 5;\r\n        if (cert.status === \"active\") score += 5;\r\n      }\r\n    });\r\n\r\n    // Check requirements (simplified - would connect to actual checks in production)\r\n    const requirementStatus = Object.entries(COMPLIANCE_REQUIREMENTS).map(([category, items]) => ({\r\n      category,\r\n      items: items.map(item => ({\r\n        id: item.id,\r\n        name: item.name,\r\n        description: item.description,\r\n        status: determineRequirementStatus(item.id, env) as \"pass\" | \"fail\" | \"warning\" | \"not-checked\"\r\n      }))\r\n    }));\r\n\r\n    // Add requirement scores\r\n    requirementStatus.forEach(cat => {\r\n      cat.items.forEach(item => {\r\n        maxScore += 5;\r\n        if (item.status === \"pass\") score += 5;\r\n        else if (item.status === \"warning\") score += 2;\r\n      });\r\n    });\r\n\r\n    const percentage = Math.round((score / maxScore) * 100);\r\n    \r\n    // Generate recommendations\r\n    const recommendations: string[] = [];\r\n    \r\n    certificateStatus.forEach(cert => {\r\n      if (cert.status === \"missing\" && cert.required) {\r\n        recommendations.push(`\u26A0\uFE0F CRITICAL: Obtain ${cert.title} (${cert.type}) - Required for operations`);\r\n      } else if (cert.status === \"expired\") {\r\n        recommendations.push(`\uD83D\uDD04 RENEW: ${cert.title} has expired - Renew immediately`);\r\n      } else if (cert.status === \"missing\" && !cert.required) {\r\n        recommendations.push(`\uD83D\uDCCB OPTIONAL: Consider obtaining ${cert.title}`);\r\n      }\r\n    });\r\n\r\n    // Check for expiring soon (within 60 days)\r\n    const sixtyDaysFromNow = new Date();\r\n    sixtyDaysFromNow.setDate(sixtyDaysFromNow.getDate() + 60);\r\n    \r\n    certificateStatus.forEach(cert => {\r\n      if (cert.expiresAt && cert.status === \"active\") {\r\n        const expDate = new Date(cert.expiresAt);\r\n        if (expDate <= sixtyDaysFromNow) {\r\n          recommendations.push(`\u23F0 EXPIRING SOON: ${cert.title} expires on ${expDate.toLocaleDateString()}`);\r\n        }\r\n      }\r\n    });\r\n\r\n    const overall: \"compliant\" | \"partial\" | \"non-compliant\" = \r\n      percentage >= 90 ? \"compliant\" :\r\n      percentage >= 60 ? \"partial\" : \"non-compliant\";\r\n\r\n    const complianceStatus: ComplianceStatus = {\r\n      overall,\r\n      score,\r\n      maxScore,\r\n      percentage,\r\n      certificates: certificateStatus,\r\n      requirements: requirementStatus,\r\n      recommendations,\r\n      lastChecked: new Date().toISOString()\r\n    };\r\n\r\n    await logAudit(env, {\r\n      action: \"compliance_check\",\r\n      user_id: user.id,\r\n      user_email: user.email,\r\n      entity: \"compliance\",\r\n      details: JSON.stringify({ overall, percentage })\r\n    });\r\n\r\n    return new Response(JSON.stringify(complianceStatus), {\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Compliance check error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Compliance check failed\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/compliance/requirements - Get all compliance requirements\r\n */\r\nexport async function handleComplianceRequirements(req: Request, env: any): Promise<Response> {\r\n  return new Response(JSON.stringify({\r\n    certificates: REQUIRED_CERTIFICATES,\r\n    requirements: COMPLIANCE_REQUIREMENTS\r\n  }), {\r\n    headers: { \"Content-Type\": \"application/json\" }\r\n  });\r\n}\r\n\r\n/**\r\n * POST /api/compliance/issue-all - Issue all required certificates (admin only)\r\n */\r\nexport async function handleIssueAllCertificates(req: Request, env: any): Promise<Response> {\r\n  const authResult = await requireAdmin(req, env);\r\n  if (authResult instanceof Response) {\r\n    return authResult;\r\n  }\r\n  const user = authResult;\r\n\r\n  try {\r\n    const body = await req.json() as { issuedTo: string; credentials?: Record<string, Record<string, string>> };\r\n    const { issuedTo, credentials } = body;\r\n\r\n    if (!issuedTo) {\r\n      return new Response(JSON.stringify({ error: \"issuedTo is required\" }), {\r\n        status: 400,\r\n        headers: { \"Content-Type\": \"application/json\" }\r\n      });\r\n    }\r\n\r\n    const issued: any[] = [];\r\n    const errors: any[] = [];\r\n\r\n    // Calculate expiration (1 year from now for most)\r\n    const oneYearFromNow = new Date();\r\n    oneYearFromNow.setFullYear(oneYearFromNow.getFullYear() + 1);\r\n    const expiresAt = oneYearFromNow.toISOString();\r\n\r\n    for (const certReq of REQUIRED_CERTIFICATES) {\r\n      try {\r\n        // Check if certificate already exists and is active\r\n        const existing = await env.DB.prepare(\r\n          \"SELECT * FROM certificates WHERE type = ? AND status = 'active'\"\r\n        ).bind(certReq.type).first();\r\n\r\n        if (existing) {\r\n          issued.push({\r\n            type: certReq.type,\r\n            status: \"already_exists\",\r\n            id: existing.id\r\n          });\r\n          continue;\r\n        }\r\n\r\n        const id = crypto.randomUUID();\r\n        const issuedAt = new Date().toISOString();\r\n        const certCredentials = credentials?.[certReq.type] || generateDefaultCredentials(certReq.type);\r\n\r\n        // Generate signature\r\n        const signatureData = JSON.stringify({\r\n          type: certReq.type,\r\n          issuedTo,\r\n          issuedAt,\r\n          credentials: certCredentials\r\n        });\r\n        const encoder = new TextEncoder();\r\n        const dataBuffer = encoder.encode(signatureData + (env.CERT_SECRET || \"cert-signing-key\"));\r\n        const hashBuffer = await crypto.subtle.digest(\"SHA-256\", dataBuffer);\r\n        const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n        const signature = hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\");\r\n\r\n        await env.DB.prepare(\r\n          `INSERT INTO certificates (id, type, title, issuer, issued_to, issued_at, expires_at, status, credentials_json, signature)\r\n           VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\r\n        ).bind(\r\n          id,\r\n          certReq.type,\r\n          certReq.title,\r\n          certReq.issuer,\r\n          issuedTo,\r\n          issuedAt,\r\n          expiresAt,\r\n          \"active\",\r\n          JSON.stringify(certCredentials),\r\n          signature\r\n        ).run();\r\n\r\n        issued.push({\r\n          type: certReq.type,\r\n          status: \"issued\",\r\n          id,\r\n          title: certReq.title\r\n        });\r\n\r\n      } catch (err: any) {\r\n        errors.push({\r\n          type: certReq.type,\r\n          error: err.message\r\n        });\r\n      }\r\n    }\r\n\r\n    await logAudit(env, {\r\n      action: \"compliance_issue_all\",\r\n      user_id: user.id,\r\n      user_email: user.email,\r\n      entity: \"certificates\",\r\n      details: JSON.stringify({ issuedTo, count: issued.length })\r\n    });\r\n\r\n    return new Response(JSON.stringify({\r\n      ok: true,\r\n      issued,\r\n      errors,\r\n      summary: {\r\n        total: REQUIRED_CERTIFICATES.length,\r\n        newlyIssued: issued.filter(i => i.status === \"issued\").length,\r\n        alreadyExists: issued.filter(i => i.status === \"already_exists\").length,\r\n        failed: errors.length\r\n      }\r\n    }), {\r\n      status: 201,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Issue all certificates error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to issue certificates\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Generate default credentials for certificate types\r\n */\r\nfunction generateDefaultCredentials(type: string): Record<string, string> {\r\n  const now = new Date();\r\n  const year = now.getFullYear();\r\n  \r\n  switch (type) {\r\n    case \"EFIN\":\r\n      return {\r\n        efin_number: \"XXXXXX\", // Replace with actual\r\n        provider_type: \"ERO\",\r\n        application_date: now.toISOString().split('T')[0]\r\n      };\r\n    case \"PTIN\":\r\n      return {\r\n        ptin_number: \"P0XXXXXXX\", // Replace with actual\r\n        tax_year: year.toString(),\r\n        renewal_date: `${year}-12-31`\r\n      };\r\n    case \"ETIN\":\r\n      return {\r\n        etin_number: \"XXXXXX\", // Replace with actual\r\n        transmitter_type: \"Software Developer\",\r\n        mef_approved: \"Yes\"\r\n      };\r\n    case \"CAF\":\r\n      return {\r\n        caf_number: \"XXXXXXXXX\", // Replace with actual\r\n        authorization_type: \"Form 2848 / Form 8821\"\r\n      };\r\n    case \"ERO_CERTIFICATE\":\r\n      return {\r\n        provider_id: crypto.randomUUID().substring(0, 8).toUpperCase(),\r\n        status: \"Authorized\",\r\n        acceptance_agent: \"No\"\r\n      };\r\n    case \"BUSINESS_LICENSE\":\r\n      return {\r\n        license_number: `BL-${year}-${crypto.randomUUID().substring(0, 6).toUpperCase()}`,\r\n        state: \"Louisiana / Texas\",\r\n        business_type: \"Tax Preparation Services\"\r\n      };\r\n    case \"SOFTWARE_DEVELOPER\":\r\n      return {\r\n        developer_id: crypto.randomUUID().substring(0, 8).toUpperCase(),\r\n        software_name: \"Ross Tax Prep Cloud\",\r\n        mef_version: \"2024.1\",\r\n        test_status: \"Approved\"\r\n      };\r\n    case \"DATA_SECURITY\":\r\n      return {\r\n        wisp_version: \"2.0\",\r\n        last_audit: now.toISOString().split('T')[0],\r\n        pub_4557_compliant: \"Yes\",\r\n        ftc_safeguards_compliant: \"Yes\",\r\n        encryption_standard: \"AES-256-GCM\"\r\n      };\r\n    case \"STAFF_TRAINING\":\r\n      return {\r\n        training_type: \"Annual Compliance\",\r\n        circular_230: \"Completed\",\r\n        security_awareness: \"Completed\",\r\n        pii_handling: \"Completed\"\r\n      };\r\n    default:\r\n      return {\r\n        issued_date: now.toISOString().split('T')[0]\r\n      };\r\n  }\r\n}\r\n\r\n/**\r\n * Determine requirement status (simplified - would be more comprehensive in production)\r\n */\r\nfunction determineRequirementStatus(requirementId: string, env: any): string {\r\n  // In production, these would query actual system status\r\n  const passedRequirements = [\r\n    \"encryption\", \"access_controls\", \"audit_logging\",\r\n    \"circular_230\", \"form_8879\", \"record_retention\"\r\n  ];\r\n  \r\n  const warningRequirements = [\r\n    \"incident_response\", \"e_o_insurance\"\r\n  ];\r\n\r\n  if (passedRequirements.includes(requirementId)) return \"pass\";\r\n  if (warningRequirements.includes(requirementId)) return \"warning\";\r\n  return \"not-checked\";\r\n}\r\n\r\n/**\r\n * GET /api/compliance/report - Generate compliance report\r\n */\r\nexport async function handleComplianceReport(req: Request, env: any): Promise<Response> {\r\n  const authResult = await requireAdmin(req, env);\r\n  if (authResult instanceof Response) {\r\n    return authResult;\r\n  }\r\n\r\n  try {\r\n    const { results: certs } = await env.DB.prepare(\r\n      \"SELECT * FROM certificates ORDER BY type\"\r\n    ).all();\r\n\r\n    const { results: auditLogs } = await env.DB.prepare(\r\n      \"SELECT * FROM audit_log WHERE action LIKE 'compliance%' OR action LIKE 'certificate%' ORDER BY created_at DESC LIMIT 50\"\r\n    ).all();\r\n\r\n    const report = {\r\n      generatedAt: new Date().toISOString(),\r\n      business: {\r\n        name: \"Ross Tax Prep & Bookkeeping LLC\",\r\n        owner: \"Andreaa Chan'nel\",\r\n        locations: [\"Crowley, LA 70526\"],\r\n        phone: \"254-394-7438\",\r\n        email: \"Info@RossTaxPrep.com\"\r\n      },\r\n      certificates: certs || [],\r\n      requirements: REQUIRED_CERTIFICATES,\r\n      auditTrail: auditLogs || [],\r\n      certificationStatement: `\r\nThis compliance report certifies that Ross Tax Prep & Bookkeeping LLC \r\nmaintains active participation in the IRS e-file program and adheres to \r\nall applicable federal and state regulations for tax preparation services.\r\n\r\nAll personally identifiable information (PII) is encrypted using AES-256-GCM \r\nencryption in compliance with IRS Publication 4557 and the FTC Safeguards Rule.\r\n\r\nGenerated: ${new Date().toISOString()}\r\n      `.trim()\r\n    };\r\n\r\n    return new Response(JSON.stringify(report, null, 2), {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"Content-Disposition\": `attachment; filename=\"compliance-report-${new Date().toISOString().split('T')[0]}.json\"`\r\n      }\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Compliance report error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to generate report\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n}\r\n", "// --- Social Media Integration Handler ---\r\n// Manages posting, monitoring, and reviews across Instagram, X/Twitter, Facebook, and Google\r\n\r\nimport { SOCIAL_MEDIA_HANDLES } from \"../index\";\r\n\r\n// Business info structure - should match actual data in index.ts\r\nconst BUSINESS_INFO = {\r\n  display_name: \"Ross Tax Prep\",\r\n  legal_name: \"Ross Tax Preparation Services LLC\",\r\n  ein: \"XX-XXXXXXX\",\r\n  category: \"Tax Preparation Service\",\r\n  address: \"123 Main Street\",\r\n  city: \"Your City\",\r\n  state: \"ST\",\r\n  zip: \"12345\",\r\n  phone_formatted: \"(555) 123-4567\",\r\n  email: \"info@rosstaxprep.com\",\r\n  website_url: \"https://rosstaxprep.com\",\r\n  google_business_verified: true,\r\n  google_verification_date: \"2024-01-15\"\r\n};\r\n\r\nexport interface SocialPost {\r\n  id: string;\r\n  platform: \"instagram\" | \"twitter\" | \"facebook\" | \"google\";\r\n  content: string;\r\n  media_urls?: string[];\r\n  posted_at: string;\r\n  engagement_count?: number;\r\n  status: \"draft\" | \"scheduled\" | \"published\";\r\n}\r\n\r\nexport interface GoogleReview {\r\n  id: string;\r\n  reviewer_name: string;\r\n  reviewer_email?: string;\r\n  rating: number; // 1-5 stars\r\n  review_text: string;\r\n  review_date: string;\r\n  response?: string;\r\n  response_date?: string;\r\n  helpful_count?: number;\r\n}\r\n\r\nexport interface SocialMetrics {\r\n  platform: string;\r\n  followers: number;\r\n  engagement_rate: number;\r\n  posts_this_month: number;\r\n  top_post: string;\r\n  average_rating?: number;\r\n}\r\n\r\n/**\r\n * GET /api/social/google/reviews - Get Google reviews\r\n */\r\nexport async function handleGoogleReviews(req: Request, env: any): Promise<Response> {\r\n  const url = new URL(req.url);\r\n  const limit = Number(url.searchParams.get(\"limit\") ?? 20);\r\n  const rating = url.searchParams.get(\"rating\");\r\n\r\n  try {\r\n    // Mock Google reviews - in production, fetch from Google My Business API\r\n    let reviews: GoogleReview[] = [\r\n      {\r\n        id: \"gr-1\",\r\n        reviewer_name: \"Sarah Johnson\",\r\n        rating: 5,\r\n        review_text: \"Excellent service! They made tax season stress-free. Highly recommend!\",\r\n        review_date: new Date(Date.now() - 2 * 24 * 3600000).toISOString(),\r\n        helpful_count: 12\r\n      },\r\n      {\r\n        id: \"gr-2\",\r\n        reviewer_name: \"Mike Chen\",\r\n        rating: 5,\r\n        review_text: \"Professional, knowledgeable, and affordable. Best tax prep service in town.\",\r\n        review_date: new Date(Date.now() - 5 * 24 * 3600000).toISOString(),\r\n        helpful_count: 8\r\n      },\r\n      {\r\n        id: \"gr-3\",\r\n        reviewer_name: \"Jennifer Martinez\",\r\n        rating: 4,\r\n        review_text: \"Great service overall. Very organized and timely. Minor follow-up would have been better.\",\r\n        review_date: new Date(Date.now() - 8 * 24 * 3600000).toISOString(),\r\n        helpful_count: 5\r\n      },\r\n      {\r\n        id: \"gr-4\",\r\n        reviewer_name: \"David Wilson\",\r\n        rating: 5,\r\n        review_text: \"Finally found a tax prep service I can trust completely. Excellent attention to detail.\",\r\n        review_date: new Date(Date.now() - 12 * 24 * 3600000).toISOString(),\r\n        helpful_count: 15,\r\n        response: \"Thank you David! We appreciate your trust and look forward to serving you next year.\",\r\n        response_date: new Date(Date.now() - 11 * 24 * 3600000).toISOString()\r\n      }\r\n    ];\r\n\r\n    // Filter by rating if specified\r\n    if (rating) {\r\n      const ratingNum = parseInt(rating);\r\n      reviews = reviews.filter(r => r.rating === ratingNum);\r\n    }\r\n\r\n    return new Response(JSON.stringify({\r\n      total_reviews: reviews.length,\r\n      average_rating: (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1),\r\n      reviews: reviews.slice(0, limit)\r\n    }), {\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Google reviews error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to fetch Google reviews\" }), { status: 500 });\r\n  }\r\n}\r\n\r\n/**\r\n * POST /api/social/google/reply - Reply to a Google review\r\n */\r\nexport async function handleGoogleReplyReview(req: Request, env: any, user: any): Promise<Response> {\r\n  if (user.role !== \"admin\" && user.role !== \"staff\") {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const body = await req.json() as {\r\n      review_id: string;\r\n      reply_text: string;\r\n    };\r\n\r\n    if (!body.review_id || !body.reply_text) {\r\n      return new Response(JSON.stringify({ error: \"Missing required fields\" }), { status: 400 });\r\n    }\r\n\r\n    const replyId = crypto.randomUUID();\r\n    const now = new Date().toISOString();\r\n\r\n    if (env.DB) {\r\n      await env.DB.prepare(\r\n        `INSERT INTO google_review_replies (id, review_id, reply_text, created_by, created_at)\r\n         VALUES (?, ?, ?, ?, ?)`\r\n      ).bind(\r\n        replyId,\r\n        body.review_id,\r\n        body.reply_text,\r\n        user.id,\r\n        now\r\n      ).run();\r\n    }\r\n\r\n    return new Response(JSON.stringify({\r\n      success: true,\r\n      reply_id: replyId,\r\n      reply_date: now\r\n    }), {\r\n      status: 201,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Google reply error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to post review reply\" }), { status: 500 });\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/social/google/stats - Get Google Business stats\r\n */\r\nexport async function handleGoogleStats(req: Request, env: any): Promise<Response> {\r\n  try {\r\n    const stats = {\r\n      business_name: BUSINESS_INFO.display_name,\r\n      legal_name: BUSINESS_INFO.legal_name,\r\n      ein: BUSINESS_INFO.ein,\r\n      category: BUSINESS_INFO.category,\r\n      address: `${BUSINESS_INFO.address}, ${BUSINESS_INFO.city}, ${BUSINESS_INFO.state} ${BUSINESS_INFO.zip}`,\r\n      phone: BUSINESS_INFO.phone_formatted,\r\n      email: BUSINESS_INFO.email,\r\n      website: BUSINESS_INFO.website_url,\r\n      verified: BUSINESS_INFO.google_business_verified,\r\n      verification_date: BUSINESS_INFO.google_verification_date,\r\n      total_reviews: 47,\r\n      average_rating: 4.8,\r\n      rating_distribution: {\r\n        5: 42,\r\n        4: 4,\r\n        3: 1,\r\n        2: 0,\r\n        1: 0\r\n      },\r\n      views_this_month: 1240,\r\n      calls_this_month: 89,\r\n      directions_this_month: 156,\r\n      website_clicks: 234,\r\n      reviews_this_month: 7,\r\n      response_rate: 95,\r\n      average_response_time_hours: 4\r\n    };\r\n\r\n    return new Response(JSON.stringify(stats), {\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Google stats error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to fetch Google stats\" }), { status: 500 });\r\n  }\r\n}\r\n\r\n/**\r\n * POST /api/social/post - Create and post to social media\r\n * Supports cross-posting to multiple platforms\r\n */\r\nexport async function handleSocialPost(req: Request, env: any, user: any): Promise<Response> {\r\n  if (user.role !== \"admin\" && user.role !== \"staff\") {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const body = await req.json() as {\r\n      content: string;\r\n      platforms: (\"instagram\" | \"twitter\" | \"facebook\")[];\r\n      media_urls?: string[];\r\n      schedule_time?: string;\r\n    };\r\n\r\n    if (!body.content || !body.platforms || body.platforms.length === 0) {\r\n      return new Response(JSON.stringify({ error: \"Missing required fields: content, platforms\" }), { status: 400 });\r\n    }\r\n\r\n    const postId = crypto.randomUUID();\r\n    const now = new Date().toISOString();\r\n    const results: Record<string, any> = {};\r\n\r\n    // Post to each platform\r\n    for (const platform of body.platforms) {\r\n      try {\r\n        let postUrl = \"\";\r\n        let platformHandle = \"\";\r\n\r\n        switch (platform) {\r\n          case \"instagram\":\r\n            platformHandle = SOCIAL_MEDIA_HANDLES.INSTAGRAM;\r\n            postUrl = await postToInstagram(env, body.content, body.media_urls || []);\r\n            results.instagram = { success: true, url: postUrl };\r\n            break;\r\n          case \"twitter\":\r\n            platformHandle = SOCIAL_MEDIA_HANDLES.X_TWITTER;\r\n            postUrl = await postToTwitter(env, body.content, body.media_urls || []);\r\n            results.twitter = { success: true, url: postUrl };\r\n            break;\r\n          case \"facebook\":\r\n            platformHandle = SOCIAL_MEDIA_HANDLES.FACEBOOK;\r\n            postUrl = await postToFacebook(env, body.content, body.media_urls || []);\r\n            results.facebook = { success: true, url: postUrl };\r\n            break;\r\n        }\r\n\r\n        // Log to database if available\r\n        if (env.DB) {\r\n          await env.DB.prepare(\r\n            `INSERT INTO social_posts (id, platform, content, media_urls, posted_at, status, created_by)\r\n             VALUES (?, ?, ?, ?, ?, ?, ?)`\r\n          ).bind(\r\n            postId,\r\n            platform,\r\n            body.content,\r\n            body.media_urls ? JSON.stringify(body.media_urls) : null,\r\n            now,\r\n            \"published\",\r\n            user.id\r\n          ).run();\r\n        }\r\n      } catch (err) {\r\n        results[platform] = { success: false, error: String(err) };\r\n      }\r\n    }\r\n\r\n    return new Response(JSON.stringify({\r\n      success: true,\r\n      post_id: postId,\r\n      platforms: results\r\n    }), {\r\n      status: 201,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Social post error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to create social post\" }), { status: 500 });\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/social/feed - Get aggregated social media feed\r\n */\r\nexport async function handleSocialFeed(req: Request, env: any): Promise<Response> {\r\n  const url = new URL(req.url);\r\n  const platform = url.searchParams.get(\"platform\");\r\n  const limit = Number(url.searchParams.get(\"limit\") ?? 20);\r\n\r\n  try {\r\n    const feed: SocialPost[] = [];\r\n\r\n    if (!platform || platform === \"all\") {\r\n      // Get from all platforms\r\n      const instaFeed = await getInstagramFeed(env, limit);\r\n      const twitterFeed = await getTwitterFeed(env, limit);\r\n      const fbFeed = await getFacebookFeed(env, limit);\r\n      \r\n      feed.push(...instaFeed, ...twitterFeed, ...fbFeed);\r\n    } else {\r\n      // Get from specific platform\r\n      switch (platform) {\r\n        case \"instagram\":\r\n          return new Response(JSON.stringify(await getInstagramFeed(env, limit)), {\r\n            headers: { \"Content-Type\": \"application/json\" }\r\n          });\r\n        case \"twitter\":\r\n          return new Response(JSON.stringify(await getTwitterFeed(env, limit)), {\r\n            headers: { \"Content-Type\": \"application/json\" }\r\n          });\r\n        case \"facebook\":\r\n          return new Response(JSON.stringify(await getFacebookFeed(env, limit)), {\r\n            headers: { \"Content-Type\": \"application/json\" }\r\n          });\r\n      }\r\n    }\r\n\r\n    // Sort by date descending\r\n    feed.sort((a, b) => new Date(b.posted_at).getTime() - new Date(a.posted_at).getTime());\r\n\r\n    return new Response(JSON.stringify(feed.slice(0, limit)), {\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Social feed error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to fetch social feed\" }), { status: 500 });\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/social/metrics - Get social media metrics\r\n */\r\nexport async function handleSocialMetrics(req: Request, env: any): Promise<Response> {\r\n  try {\r\n    const metrics: SocialMetrics[] = [\r\n      {\r\n        platform: \"Instagram\",\r\n        followers: 1250,\r\n        engagement_rate: 4.2,\r\n        posts_this_month: 8,\r\n        top_post: \"Tax filing deadline reminders post\"\r\n      },\r\n      {\r\n        platform: \"Twitter/X\",\r\n        followers: 890,\r\n        engagement_rate: 3.8,\r\n        posts_this_month: 15,\r\n        top_post: \"IRS announcement retweet\"\r\n      },\r\n      {\r\n        platform: \"Facebook\",\r\n        followers: 2340,\r\n        engagement_rate: 5.1,\r\n        posts_this_month: 6,\r\n        top_post: \"Customer testimonial post\"\r\n      }\r\n    ];\r\n\r\n    return new Response(JSON.stringify({\r\n      timestamp: new Date().toISOString(),\r\n      metrics,\r\n      total_followers: metrics.reduce((sum, m) => sum + m.followers, 0),\r\n      average_engagement: (metrics.reduce((sum, m) => sum + m.engagement_rate, 0) / metrics.length).toFixed(1)\r\n    }), {\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Social metrics error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to fetch metrics\" }), { status: 500 });\r\n  }\r\n}\r\n\r\n/**\r\n * POST /api/social/schedule - Schedule a post for later\r\n */\r\nexport async function handleSchedulePost(req: Request, env: any, user: any): Promise<Response> {\r\n  if (user.role !== \"admin\" && user.role !== \"staff\") {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const body = await req.json() as {\r\n      content: string;\r\n      platforms: string[];\r\n      media_urls?: string[];\r\n      scheduled_for: string;\r\n    };\r\n\r\n    if (!body.content || !body.platforms || !body.scheduled_for) {\r\n      return new Response(JSON.stringify({ error: \"Missing required fields\" }), { status: 400 });\r\n    }\r\n\r\n    const postId = crypto.randomUUID();\r\n    const scheduledTime = new Date(body.scheduled_for).toISOString();\r\n\r\n    if (env.DB) {\r\n      await env.DB.prepare(\r\n        `INSERT INTO scheduled_social_posts (id, content, platforms, media_urls, scheduled_for, created_by)\r\n         VALUES (?, ?, ?, ?, ?, ?)`\r\n      ).bind(\r\n        postId,\r\n        body.content,\r\n        JSON.stringify(body.platforms),\r\n        body.media_urls ? JSON.stringify(body.media_urls) : null,\r\n        scheduledTime,\r\n        user.id\r\n      ).run();\r\n    }\r\n\r\n    return new Response(JSON.stringify({\r\n      success: true,\r\n      post_id: postId,\r\n      scheduled_for: scheduledTime\r\n    }), {\r\n      status: 201,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Schedule post error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to schedule post\" }), { status: 500 });\r\n  }\r\n}\r\n\r\n/**\r\n * GET /api/social/mentions - Get mentions across platforms\r\n */\r\nexport async function handleSocialMentions(req: Request, env: any): Promise<Response> {\r\n  try {\r\n    const mentions = [\r\n      {\r\n        platform: \"twitter\",\r\n        handle: \"@client123\",\r\n        text: \"Just filed my taxes with @rosstaxprep - great service!\",\r\n        timestamp: new Date(Date.now() - 2 * 3600000).toISOString(),\r\n        sentiment: \"positive\"\r\n      },\r\n      {\r\n        platform: \"instagram\",\r\n        handle: \"@localcpa\",\r\n        text: \"Love the quick turnaround from Ross Tax Prep!\",\r\n        timestamp: new Date(Date.now() - 4 * 3600000).toISOString(),\r\n        sentiment: \"positive\"\r\n      },\r\n      {\r\n        platform: \"facebook\",\r\n        handle: \"John Smith\",\r\n        text: \"Best tax service in town. Highly recommend!\",\r\n        timestamp: new Date(Date.now() - 6 * 3600000).toISOString(),\r\n        sentiment: \"positive\"\r\n      }\r\n    ];\r\n\r\n    return new Response(JSON.stringify({\r\n      total_mentions: mentions.length,\r\n      mentions,\r\n      sentiment_summary: {\r\n        positive: 3,\r\n        neutral: 0,\r\n        negative: 0\r\n      }\r\n    }), {\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Social mentions error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to fetch mentions\" }), { status: 500 });\r\n  }\r\n}\r\n\r\n/**\r\n * POST /api/social/reply - Reply to mentions/comments\r\n */\r\nexport async function handleSocialReply(req: Request, env: any, user: any): Promise<Response> {\r\n  if (user.role !== \"admin\" && user.role !== \"staff\") {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const body = await req.json() as {\r\n      platform: string;\r\n      mention_id: string;\r\n      reply_text: string;\r\n    };\r\n\r\n    if (!body.platform || !body.mention_id || !body.reply_text) {\r\n      return new Response(JSON.stringify({ error: \"Missing required fields\" }), { status: 400 });\r\n    }\r\n\r\n    const replyId = crypto.randomUUID();\r\n\r\n    if (env.DB) {\r\n      await env.DB.prepare(\r\n        `INSERT INTO social_replies (id, platform, mention_id, reply_text, created_by, created_at)\r\n         VALUES (?, ?, ?, ?, ?, ?)`\r\n      ).bind(\r\n        replyId,\r\n        body.platform,\r\n        body.mention_id,\r\n        body.reply_text,\r\n        user.id,\r\n        new Date().toISOString()\r\n      ).run();\r\n    }\r\n\r\n    return new Response(JSON.stringify({\r\n      success: true,\r\n      reply_id: replyId\r\n    }), {\r\n      status: 201,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Social reply error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to post reply\" }), { status: 500 });\r\n  }\r\n}\r\n\r\n// --- Helper Functions ---\r\n\r\nasync function postToInstagram(env: any, content: string, mediaUrls: string[]): Promise<string> {\r\n  // In production, this would call Instagram Graph API\r\n  if (!env.INSTAGRAM_TOKEN) throw new Error(\"Instagram not configured\");\r\n  \r\n  // Mock implementation - returns a post URL\r\n  const postId = crypto.randomUUID();\r\n  return `https://instagram.com/p/${postId}`;\r\n}\r\n\r\nasync function postToTwitter(env: any, content: string, mediaUrls: string[]): Promise<string> {\r\n  // In production, this would call Twitter/X API v2\r\n  if (!env.TWITTER_API_KEY) throw new Error(\"Twitter not configured\");\r\n  \r\n  // Mock implementation - returns a tweet URL\r\n  const tweetId = crypto.randomUUID();\r\n  return `https://twitter.com/${SOCIAL_MEDIA_HANDLES.X_TWITTER}/status/${tweetId}`;\r\n}\r\n\r\nasync function postToFacebook(env: any, content: string, mediaUrls: string[]): Promise<string> {\r\n  // In production, this would call Facebook Graph API\r\n  if (!env.FACEBOOK_TOKEN) throw new Error(\"Facebook not configured\");\r\n  \r\n  // Mock implementation - returns a post URL\r\n  const postId = crypto.randomUUID();\r\n  return `https://facebook.com/posts/${postId}`;\r\n}\r\n\r\nasync function getInstagramFeed(env: any, limit: number): Promise<SocialPost[]> {\r\n  // In production, fetch from API or database\r\n  return [\r\n    {\r\n      id: \"ig-1\",\r\n      platform: \"instagram\",\r\n      content: \"Tax season is here! File your taxes with confidence. #TaxPrep #AccountingServices\",\r\n      posted_at: new Date(Date.now() - 24 * 3600000).toISOString(),\r\n      engagement_count: 42,\r\n      status: \"published\"\r\n    }\r\n  ];\r\n}\r\n\r\nasync function getTwitterFeed(env: any, limit: number): Promise<SocialPost[]> {\r\n  // In production, fetch from API or database\r\n  return [\r\n    {\r\n      id: \"tw-1\",\r\n      platform: \"twitter\",\r\n      content: \"IRS announces extended e-file deadline for 2025 returns. Plan accordingly! #TaxNews\",\r\n      posted_at: new Date(Date.now() - 12 * 3600000).toISOString(),\r\n      engagement_count: 87,\r\n      status: \"published\"\r\n    }\r\n  ];\r\n}\r\n\r\nasync function getFacebookFeed(env: any, limit: number): Promise<SocialPost[]> {\r\n  // In production, fetch from API or database\r\n  return [\r\n    {\r\n      id: \"fb-1\",\r\n      platform: \"facebook\",\r\n      content: \"Happy to announce we're now offering virtual consultations for busy professionals!\",\r\n      posted_at: new Date(Date.now() - 48 * 3600000).toISOString(),\r\n      engagement_count: 156,\r\n      status: \"published\"\r\n    }\r\n  ];\r\n}\r\n", "// --- Instagram API Integration ---\r\n// Handles Instagram feed, reviews, analytics, posting, and DM functionality\r\n\r\nexport async function handleInstagramFeed(env) {\r\n  try {\r\n    const feed = {\r\n      posts: [\r\n        {\r\n          id: \"ig-1\",\r\n          caption: \"Tax season is here! Get your documents organized \uD83D\uDCCB #TaxPrep2026\",\r\n          image_url: \"https://placehold.co/400\",\r\n          likes: 245,\r\n          comments: 18,\r\n          timestamp: new Date(Date.now() - 3 * 24 * 3600000).toISOString()\r\n        },\r\n        {\r\n          id: \"ig-2\",\r\n          caption: \"Did you know? You can claim home office deductions! \uD83C\uDFE0\uD83D\uDCBC #TaxTips\",\r\n          image_url: \"https://placehold.co/400\",\r\n          likes: 189,\r\n          comments: 12,\r\n          timestamp: new Date(Date.now() - 5 * 24 * 3600000).toISOString()\r\n        },\r\n        {\r\n          id: \"ig-3\",\r\n          caption: \"Meet our team of expert tax preparers! \uD83D\uDC65 Ready to help you save! #RossTaxPrep\",\r\n          image_url: \"https://placehold.co/400\",\r\n          likes: 312,\r\n          comments: 24,\r\n          timestamp: new Date(Date.now() - 7 * 24 * 3600000).toISOString()\r\n        }\r\n      ]\r\n    };\r\n    return new Response(JSON.stringify(feed), {\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Instagram feed error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to fetch Instagram feed\" }), { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function handleInstagramReviews(env) {\r\n  try {\r\n    const reviews = {\r\n      total_reviews: 156,\r\n      average_rating: 4.7,\r\n      reviews: [\r\n        {\r\n          id: \"rev-1\",\r\n          reviewer: \"John Smith\",\r\n          rating: 5,\r\n          text: \"Excellent service! Got my refund quickly.\",\r\n          timestamp: new Date(Date.now() - 2 * 24 * 3600000).toISOString()\r\n        },\r\n        {\r\n          id: \"rev-2\",\r\n          reviewer: \"Maria Garcia\",\r\n          rating: 5,\r\n          text: \"Very professional and helpful team!\",\r\n          timestamp: new Date(Date.now() - 4 * 24 * 3600000).toISOString()\r\n        },\r\n        {\r\n          id: \"rev-3\",\r\n          reviewer: \"David Lee\",\r\n          rating: 4,\r\n          text: \"Great service, would recommend.\",\r\n          timestamp: new Date(Date.now() - 6 * 24 * 3600000).toISOString()\r\n        }\r\n      ]\r\n    };\r\n    return new Response(JSON.stringify(reviews), {\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Instagram reviews error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to fetch Instagram reviews\" }), { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function handleInstagramAnalytics(env) {\r\n  try {\r\n    const analytics = {\r\n      followers: 4250,\r\n      engagement_rate: 6.8,\r\n      reach_this_month: 12500,\r\n      impressions_this_month: 45300,\r\n      posts_this_month: 12,\r\n      saves_this_month: 834,\r\n      shares_this_month: 312,\r\n      profile_visits_this_month: 3400,\r\n      top_post: {\r\n        id: \"ig-3\",\r\n        engagement: 348,\r\n        reach: 2100\r\n      }\r\n    };\r\n    return new Response(JSON.stringify(analytics), {\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Instagram analytics error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to fetch Instagram analytics\" }), { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function handleInstagramPost(req, env, user) {\r\n  if (user.role !== \"admin\" && user.role !== \"staff\") {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const body = await req.json();\r\n    const { caption, imageUrl } = body;\r\n\r\n    if (!caption || !imageUrl) {\r\n      return new Response(JSON.stringify({ error: \"Missing caption or imageUrl\" }), { status: 400 });\r\n    }\r\n\r\n    // Mock Instagram API call\r\n    const postId = `ig-${Date.now()}`;\r\n    const response = {\r\n      success: true,\r\n      post_id: postId,\r\n      caption: caption,\r\n      image_url: imageUrl,\r\n      posted_at: new Date().toISOString(),\r\n      platform: \"instagram\"\r\n    };\r\n\r\n    // Log to database if available\r\n    if (env.DB) {\r\n      await env.DB.prepare(\r\n        `INSERT INTO social_posts (id, platform, content, media_urls, posted_at, status, created_by)\r\n         VALUES (?, ?, ?, ?, ?, ?, ?)`\r\n      ).bind(\r\n        postId,\r\n        \"instagram\",\r\n        caption,\r\n        JSON.stringify([imageUrl]),\r\n        new Date().toISOString(),\r\n        \"published\",\r\n        user.id\r\n      ).run();\r\n    }\r\n\r\n    return new Response(JSON.stringify(response), {\r\n      status: 201,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Instagram post error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to post to Instagram\" }), { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function handleInstagramDM(req, env, user) {\r\n  if (user.role !== \"admin\" && user.role !== \"staff\") {\r\n    return new Response(JSON.stringify({ error: \"Unauthorized\" }), { status: 403 });\r\n  }\r\n\r\n  try {\r\n    const body = await req.json();\r\n    const { recipient_id, message } = body;\r\n\r\n    if (!recipient_id || !message) {\r\n      return new Response(JSON.stringify({ error: \"Missing recipient_id or message\" }), { status: 400 });\r\n    }\r\n\r\n    // Mock Instagram DM API call\r\n    const dmId = `dm-${Date.now()}`;\r\n    const response = {\r\n      success: true,\r\n      dm_id: dmId,\r\n      recipient_id: recipient_id,\r\n      message: message,\r\n      sent_at: new Date().toISOString(),\r\n      platform: \"instagram\"\r\n    };\r\n\r\n    return new Response(JSON.stringify(response), {\r\n      status: 201,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Instagram DM error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Failed to send Instagram DM\" }), { status: 500 });\r\n  }\r\n}\r\n", "/**\r\n * Data Retention and Cleanup Utilities\r\n * Implements GDPR/GLBA compliance requirements for data lifecycle management\r\n */\r\n\r\nimport { logAudit } from './audit';\r\n\r\n/**\r\n * Scheduled cleanup handler for IRS sync\r\n */\r\nexport async function handleScheduledIRSSync(env: any, ctx: any): Promise<void> {\r\n  try {\r\n    console.log('Starting scheduled IRS sync...');\r\n    \r\n    // Sync IRS memos and regulations\r\n    // This would integrate with irsSync.ts\r\n    \r\n    const syncTimestamp = new Date().toISOString();\r\n    console.log(`IRS sync completed at ${syncTimestamp}`);\r\n    \r\n    // Store sync status in KV\r\n    if (env.KV_NAMESPACE) {\r\n      await env.KV_NAMESPACE.put('last_irs_sync', syncTimestamp);\r\n    }\r\n    \r\n    await logAudit(env, {\r\n      action: 'scheduled_irs_sync',\r\n      entity: 'system',\r\n      details: JSON.stringify({ timestamp: syncTimestamp })\r\n    });\r\n  } catch (error) {\r\n    console.error('IRS sync failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Scheduled cleanup handler for audit logs and old data\r\n */\r\nexport async function handleAuditLogProcessing(env: any, ctx: any): Promise<void> {\r\n  try {\r\n    console.log('Starting audit log processing and data retention cleanup...');\r\n    \r\n    // Archive old audit logs (older than 7 years per IRS requirements)\r\n    const sevenYearsAgo = new Date();\r\n    sevenYearsAgo.setFullYear(sevenYearsAgo.getFullYear() - 7);\r\n    \r\n    const auditResult = await env.DB.prepare(\r\n      `DELETE FROM audit_log WHERE created_at < ?`\r\n    ).bind(sevenYearsAgo.toISOString()).run();\r\n    \r\n    console.log(`Deleted ${auditResult.changes} old audit log entries`);\r\n    \r\n    // Delete old documents metadata (not R2 files yet - manual process)\r\n    const documentResult = await env.DB.prepare(\r\n      `DELETE FROM documents WHERE uploaded_at < ?`\r\n    ).bind(sevenYearsAgo.toISOString()).run();\r\n    \r\n    console.log(`Deleted ${documentResult.changes} old document records`);\r\n    \r\n    // Clean up expired MFA codes from KV\r\n    // KV handles TTL automatically, no action needed\r\n    \r\n    // Delete old returns (after 7 years)\r\n    const returnResult = await env.DB.prepare(\r\n      `DELETE FROM returns WHERE updated_at < ?`\r\n    ).bind(sevenYearsAgo.toISOString()).run();\r\n    \r\n    console.log(`Deleted ${returnResult.changes} old return records`);\r\n    \r\n    // Delete old messages (after 3 years)\r\n    const threeYearsAgo = new Date();\r\n    threeYearsAgo.setFullYear(threeYearsAgo.getFullYear() - 3);\r\n    \r\n    const messageResult = await env.DB.prepare(\r\n      `DELETE FROM messages WHERE created_at < ?`\r\n    ).bind(threeYearsAgo.toISOString()).run();\r\n    \r\n    console.log(`Deleted ${messageResult.changes} old message records`);\r\n    \r\n    const processTimestamp = new Date().toISOString();\r\n    console.log(`Data retention cleanup completed at ${processTimestamp}`);\r\n    \r\n    // Store cleanup status\r\n    if (env.KV_NAMESPACE) {\r\n      await env.KV_NAMESPACE.put('last_data_cleanup', processTimestamp);\r\n    }\r\n    \r\n    await logAudit(env, {\r\n      action: 'scheduled_data_cleanup',\r\n      entity: 'system',\r\n      details: JSON.stringify({\r\n        timestamp: processTimestamp,\r\n        audit_logs_deleted: auditResult.changes,\r\n        documents_deleted: documentResult.changes,\r\n        returns_deleted: returnResult.changes,\r\n        messages_deleted: messageResult.changes\r\n      })\r\n    });\r\n  } catch (error) {\r\n    console.error('Audit log processing failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Delete user data (GDPR right to deletion)\r\n */\r\nexport async function deleteUserData(env: any, userId: number, userType: 'staff' | 'client'): Promise<void> {\r\n  try {\r\n    const table = userType === 'staff' ? 'staff' : 'clients';\r\n    \r\n    // Delete user's messages\r\n    await env.DB.prepare(`DELETE FROM messages WHERE client_id = ?`).bind(userId).run();\r\n    \r\n    // Delete user's returns\r\n    await env.DB.prepare(`DELETE FROM returns WHERE client_id = ?`).bind(userId).run();\r\n    \r\n    // Delete user's documents metadata (R2 files require separate cleanup)\r\n    await env.DB.prepare(`DELETE FROM documents WHERE client_id = ?`).bind(userId).run();\r\n    \r\n    // Delete user's signatures\r\n    await env.DB.prepare(`DELETE FROM signatures WHERE client_id = ?`).bind(userId).run();\r\n    \r\n    // Anonymize audit logs (keep for compliance, but remove PII)\r\n    await env.DB.prepare(\r\n      `UPDATE audit_log SET user_email = 'deleted', details = 'User data deleted' WHERE user_id = ?`\r\n    ).bind(userId).run();\r\n    \r\n    // Delete the user account\r\n    await env.DB.prepare(`DELETE FROM ${table} WHERE id = ?`).bind(userId).run();\r\n    \r\n    await logAudit(env, {\r\n      action: 'user_data_deleted',\r\n      entity: 'user',\r\n      entity_id: userId.toString(),\r\n      details: JSON.stringify({ user_type: userType, reason: 'GDPR deletion request' })\r\n    });\r\n    \r\n    console.log(`User ${userId} (${userType}) data deleted successfully`);\r\n  } catch (error) {\r\n    console.error('Failed to delete user data:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Export user data (GDPR right to data portability)\r\n */\r\nexport async function exportUserData(env: any, userId: number, userType: 'staff' | 'client'): Promise<any> {\r\n  try {\r\n    const table = userType === 'staff' ? 'staff' : 'clients';\r\n    \r\n    // Get user profile\r\n    const user = await env.DB.prepare(`SELECT * FROM ${table} WHERE id = ?`).bind(userId).first();\r\n    \r\n    // Get user's messages\r\n    const messages = await env.DB.prepare(\r\n      `SELECT * FROM messages WHERE client_id = ?`\r\n    ).bind(userId).all();\r\n    \r\n    // Get user's returns\r\n    const returns = await env.DB.prepare(\r\n      `SELECT * FROM returns WHERE client_id = ?`\r\n    ).bind(userId).all();\r\n    \r\n    // Get user's documents\r\n    const documents = await env.DB.prepare(\r\n      `SELECT * FROM documents WHERE client_id = ?`\r\n    ).bind(userId).all();\r\n    \r\n    // Get user's audit log entries\r\n    const auditLogs = await env.DB.prepare(\r\n      `SELECT * FROM audit_log WHERE user_id = ? ORDER BY created_at DESC LIMIT 1000`\r\n    ).bind(userId).all();\r\n    \r\n    const exportData = {\r\n      user: user,\r\n      messages: messages.results,\r\n      returns: returns.results,\r\n      documents: documents.results,\r\n      audit_logs: auditLogs.results,\r\n      exported_at: new Date().toISOString()\r\n    };\r\n    \r\n    await logAudit(env, {\r\n      action: 'user_data_exported',\r\n      entity: 'user',\r\n      entity_id: userId.toString(),\r\n      details: JSON.stringify({ user_type: userType })\r\n    });\r\n    \r\n    return exportData;\r\n  } catch (error) {\r\n    console.error('Failed to export user data:', error);\r\n    throw error;\r\n  }\r\n}\r\n", "// IRS Acknowledgment Callback Handler\r\ninterface IrsCallbackBody {\r\n  submissionId?: string;\r\n  clientId?: number;\r\n  status?: string;\r\n  ackTimestamp?: string;\r\n  errors?: any;\r\n}\r\n\r\nexport async function handleIrsCallback(request: Request, env: any) {\r\n  try {\r\n    const body = await request.json() as IrsCallbackBody;\r\n    \r\n    // Validate the callback signature/authentication\r\n    const signature = request.headers.get(\"X-IRS-Signature\");\r\n    // TODO: Verify signature if needed\r\n    \r\n    // Extract acknowledgment data\r\n    const { submissionId, clientId, status, ackTimestamp, errors } = body;\r\n    \r\n    if (!submissionId) {\r\n      return new Response(JSON.stringify({ error: \"Missing submissionId\" }), {\r\n        status: 400,\r\n        headers: { \"Content-Type\": \"application/json\" }\r\n      });\r\n    }\r\n    \r\n    // If clientId not provided, query database to find it\r\n    let workflowClientId = clientId;\r\n    if (!workflowClientId && env.DB) {\r\n      try {\r\n        const submission = await env.DB.prepare(\r\n          \"SELECT client_id FROM efile_submissions WHERE submission_id = ?\"\r\n        ).bind(submissionId).first();\r\n        if (submission) {\r\n          workflowClientId = submission.client_id;\r\n        }\r\n      } catch (e) {\r\n        console.error(\"Failed to fetch client_id from DB:\", e);\r\n      }\r\n    }\r\n    \r\n    // Update submission status in database\r\n    if (!env.DB) {\r\n      console.warn(\"DB binding not available, skipping status update\");\r\n    } else {\r\n      try {\r\n        await env.DB.prepare(\r\n          `UPDATE efile_submissions \r\n           SET status = ?, ack_timestamp = ?, errors = ? \r\n           WHERE submission_id = ?`\r\n        ).bind(\r\n          status || \"acknowledged\",\r\n          ackTimestamp || new Date().toISOString(),\r\n          errors ? JSON.stringify(errors) : null,\r\n          submissionId\r\n        ).run();\r\n      } catch (dbError) {\r\n        console.error(\"Database update failed:\", dbError);\r\n        // Don't fail the entire request if DB update fails\r\n      }\r\n    }\r\n    \r\n    // Trigger workflow event if Workflow binding exists and clientId is available\r\n    if (env.MY_WORKFLOW && workflowClientId) {\r\n      try {\r\n        // Find the workflow instance waiting for this acknowledgment\r\n        const instance = await env.MY_WORKFLOW.get(workflowClientId.toString());\r\n        if (instance) {\r\n          await instance.resume(\"irs_ack\", {\r\n            status,\r\n            timestamp: ackTimestamp,\r\n            errors,\r\n            submissionId\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.error(\"Failed to resume workflow:\", e);\r\n      }\r\n    }\r\n    \r\n    return new Response(JSON.stringify({ success: true, submissionId, clientId: workflowClientId }), {\r\n      status: 200,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"IRS callback error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Internal server error\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n}\r\n", "// Payment Provider Webhook Handler\r\ninterface PaymentWebhookBody {\r\n  transactionId?: string;\r\n  clientId?: number;\r\n  amount?: number;\r\n  status?: string;\r\n  paymentMethod?: string;\r\n}\r\n\r\nexport async function handlePaymentWebhook(request: Request, env: any) {\r\n  try {\r\n    const body = await request.json() as PaymentWebhookBody;\r\n    \r\n    // Validate webhook signature (depends on payment provider)\r\n    const signature = request.headers.get(\"X-Payment-Signature\");\r\n    // TODO: Verify signature based on provider (Stripe, Square, etc.)\r\n    \r\n    // Extract payment data\r\n    const { transactionId, clientId, amount, status, paymentMethod } = body;\r\n    \r\n    if (!transactionId) {\r\n      return new Response(JSON.stringify({ error: \"Missing transactionId\" }), {\r\n        status: 400,\r\n        headers: { \"Content-Type\": \"application/json\" }\r\n      });\r\n    }\r\n    \r\n    // Record payment in database\r\n    if (!env.DB) {\r\n      console.warn(\"DB binding not available, skipping payment record\");\r\n    } else {\r\n      try {\r\n        await env.DB.prepare(\r\n          `INSERT INTO payments (id, client_id, transaction_id, amount, status, payment_method, created_at)\r\n           VALUES (?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)`\r\n        ).bind(\r\n          crypto.randomUUID(),\r\n          clientId,\r\n          transactionId,\r\n          amount,\r\n          status || \"completed\",\r\n          paymentMethod || \"card\"\r\n        ).run();\r\n      } catch (dbError) {\r\n        console.error(\"Failed to record payment in database:\", dbError);\r\n        // Don't fail the webhook if DB insert fails\r\n      }\r\n    }\r\n    \r\n    // Trigger workflow event if Workflow binding exists\r\n    if (env.MY_WORKFLOW && clientId) {\r\n      try {\r\n        // Find the workflow instance waiting for this payment\r\n        const instance = await env.MY_WORKFLOW.get(clientId);\r\n        if (instance) {\r\n          await instance.resume(\"payment_confirmed\", {\r\n            transactionId,\r\n            amount,\r\n            status,\r\n            timestamp: new Date().toISOString()\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.error(\"Failed to resume workflow:\", e);\r\n      }\r\n    }\r\n    \r\n    return new Response(JSON.stringify({ success: true, transactionId }), {\r\n      status: 200,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Payment webhook error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Internal server error\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n}\r\n", "// Credential Upload Handler\r\ninterface CredentialUploadBody {\r\n  clientId?: number;\r\n  credentialType?: string;\r\n  encryptedData?: string;\r\n  returnId?: number;\r\n}\r\n\r\nexport async function handleCredentialUpload(request: Request, env: any) {\r\n  try {\r\n    const body = await request.json() as CredentialUploadBody;\r\n    \r\n    // Extract credential data\r\n    const { clientId, credentialType, encryptedData, returnId } = body;\r\n    \r\n    if (!clientId || !credentialType || !encryptedData) {\r\n      return new Response(JSON.stringify({ \r\n        error: \"Missing required fields: clientId, credentialType, encryptedData\" \r\n      }), {\r\n        status: 400,\r\n        headers: { \"Content-Type\": \"application/json\" }\r\n      });\r\n    }\r\n    \r\n    // Store encrypted credentials in database\r\n    const credentialId = crypto.randomUUID();\r\n    if (!env.DB) {\r\n      console.warn(\"DB binding not available, skipping credential storage\");\r\n    } else {\r\n      try {\r\n        await env.DB.prepare(\r\n          `INSERT INTO client_credentials \r\n           (id, client_id, return_id, credential_type, encrypted_data, uploaded_at)\r\n           VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP)`\r\n        ).bind(\r\n          credentialId,\r\n          clientId,\r\n          returnId || null,\r\n          credentialType,\r\n          encryptedData\r\n        ).run();\r\n      } catch (dbError) {\r\n        console.error(\"Failed to store credentials in database:\", dbError);\r\n        // Don't fail the request if DB insert fails\r\n      }\r\n    }\r\n    \r\n    // Trigger workflow event if Workflow binding exists\r\n    if (env.MY_WORKFLOW) {\r\n      try {\r\n        // Find the workflow instance waiting for credentials\r\n        const instance = await env.MY_WORKFLOW.get(clientId);\r\n        if (instance) {\r\n          await instance.resume(\"credential_uploaded\", {\r\n            credentialId,\r\n            credentialType,\r\n            timestamp: new Date().toISOString()\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.error(\"Failed to resume workflow:\", e);\r\n      }\r\n    }\r\n    \r\n    return new Response(JSON.stringify({ \r\n      success: true, \r\n      credentialId \r\n    }), {\r\n      status: 200,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Credential upload error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Internal server error\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n}\r\n", "// IRS Real-time Schema and Memos Integration\r\n// Integration ID: 167c3ccd-56ce-4822-872f-711c5193f292\r\n\r\nconst IRS_REALTIME_PUBLIC_KEY = `-----BEGIN PUBLIC KEY-----\r\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAihr5PtCXRVCgjAlOcZi7\r\n0hX3c+4P2Kmp8Qqv+FFJmMhH0+dHSAqGfCUW8ZRq3jffrWFnPX1cTtGEudVFECLE\r\nN+nNFSh0Ed699Roly9g6tuvbse/bxOIVljgfMWTtTKbiDTRRj0mcwHekmxdOHu7p\r\nwMB+7ldF27u479ZtZ8Z7DaHgF37CMNMq1uwx0Px12AE0WzL70eLnXBAlIsotQAiU\r\ncErpTk7xf4uRcrM4lOX4c/GdkaiASEgNY/BPcWDXRugl0C86WuAYvdYyUMkvBJba\r\nbwH4tr0bwdjLrDF0DU+WHkJraDY0ESB3XLaYik+8c8U7GbUEyuARm51NvIexOswL\r\nowIDAQAB\r\n-----END PUBLIC KEY-----`;\r\n\r\nconst IRS_REALTIME_INTEGRATION_ID = \"167c3ccd-56ce-4822-872f-711c5193f292\";\r\n\r\ninterface IrsRealtimePayload {\r\n  type: \"schema_update\" | \"memo_published\" | \"memo_updated\";\r\n  timestamp: string;\r\n  data: any;\r\n  signature?: string;\r\n}\r\n\r\n// Verify IRS signature (if provided)\r\nasync function verifyIrsSignature(payload: string, signature: string): Promise<boolean> {\r\n  try {\r\n    // TODO: Implement RSA signature verification using IRS_REALTIME_PUBLIC_KEY\r\n    // For now, we'll accept all requests (implement proper verification in production)\r\n    return true;\r\n  } catch (error) {\r\n    console.error(\"Signature verification failed:\", error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Handle real-time schema updates from IRS\r\nexport async function handleIrsRealtimeSchema(request: Request, env: any) {\r\n  try {\r\n    const body: IrsRealtimePayload = await request.json();\r\n    \r\n    // Verify signature if provided\r\n    if (body.signature) {\r\n      const payloadStr = JSON.stringify({ type: body.type, timestamp: body.timestamp, data: body.data });\r\n      const isValid = await verifyIrsSignature(payloadStr, body.signature);\r\n      if (!isValid) {\r\n        return new Response(JSON.stringify({ error: \"Invalid signature\" }), {\r\n          status: 401,\r\n          headers: { \"Content-Type\": \"application/json\" }\r\n        });\r\n      }\r\n    }\r\n    \r\n    if (body.type === \"schema_update\") {\r\n      // Process schema update\r\n      const { formType, taxYear, fields } = body.data;\r\n      \r\n      if (!env.DB) {\r\n        console.warn(\"DB binding not available, skipping schema update\");\r\n      } else {\r\n        // Store schema fields in database\r\n        for (const field of fields || []) {\r\n          try {\r\n            await env.DB.prepare(\r\n              `INSERT OR REPLACE INTO irs_schema_fields \r\n               (id, form_type, tax_year, field_name, field_path, field_type, description, status, detected_at)\r\n               VALUES (?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)`\r\n            ).bind(\r\n              field.id || crypto.randomUUID(),\r\n              formType,\r\n              taxYear,\r\n              field.name,\r\n              field.path,\r\n              field.type || \"string\",\r\n              field.description || null,\r\n              \"active\"\r\n            ).run();\r\n          } catch (fieldError) {\r\n            console.error(`Failed to insert field ${field.name}:`, fieldError);\r\n          }\r\n        }\r\n      }\r\n      \r\n      console.log(`Processed schema update for ${formType} ${taxYear}: ${fields?.length || 0} fields`);\r\n    }\r\n    \r\n    return new Response(JSON.stringify({ \r\n      success: true, \r\n      integrationId: IRS_REALTIME_INTEGRATION_ID,\r\n      timestamp: new Date().toISOString()\r\n    }), {\r\n      status: 200,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"IRS realtime schema error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Internal server error\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n}\r\n\r\n// Handle real-time memo updates from IRS\r\nexport async function handleIrsRealtimeMemo(request: Request, env: any) {\r\n  try {\r\n    const body: IrsRealtimePayload = await request.json();\r\n    \r\n    // Verify signature if provided\r\n    if (body.signature) {\r\n      const payloadStr = JSON.stringify({ type: body.type, timestamp: body.timestamp, data: body.data });\r\n      const isValid = await verifyIrsSignature(payloadStr, body.signature);\r\n      if (!isValid) {\r\n        return new Response(JSON.stringify({ error: \"Invalid signature\" }), {\r\n          status: 401,\r\n          headers: { \"Content-Type\": \"application/json\" }\r\n        });\r\n      }\r\n    }\r\n    \r\n    if (body.type === \"memo_published\" || body.type === \"memo_updated\") {\r\n      // Process memo update\r\n      const { irsId, title, summary, fullText, publishedAt, url, tags, source } = body.data;\r\n      \r\n      if (!env.DB) {\r\n        console.warn(\"DB binding not available, skipping memo update\");\r\n      } else {\r\n        const memoId = crypto.randomUUID();\r\n        try {\r\n          await env.DB.prepare(\r\n            `INSERT OR REPLACE INTO irs_memos \r\n             (id, source, irs_id, title, summary, full_text, published_at, url, tags_json, status)\r\n             VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\r\n          ).bind(\r\n            memoId,\r\n            source || \"irs_realtime\",\r\n            irsId,\r\n            title,\r\n            summary || null,\r\n            fullText || null,\r\n            publishedAt || new Date().toISOString(),\r\n            url || null,\r\n            tags ? JSON.stringify(tags) : null,\r\n            \"active\"\r\n          ).run();\r\n        } catch (memoError) {\r\n          console.error(\"Failed to store memo in database:\", memoError);\r\n        }\r\n      }\r\n      \r\n      console.log(`Processed memo ${body.type}: ${irsId} - ${title}`);\r\n    }\r\n    \r\n    return new Response(JSON.stringify({ \r\n      success: true, \r\n      integrationId: IRS_REALTIME_INTEGRATION_ID,\r\n      timestamp: new Date().toISOString()\r\n    }), {\r\n      status: 200,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  } catch (error) {\r\n    console.error(\"IRS realtime memo error:\", error);\r\n    return new Response(JSON.stringify({ error: \"Internal server error\" }), {\r\n      status: 500,\r\n      headers: { \"Content-Type\": \"application/json\" }\r\n    });\r\n  }\r\n}\r\n\r\n// Health check for IRS realtime integration\r\nexport function getIrsRealtimeStatus() {\r\n  return {\r\n    integrationId: IRS_REALTIME_INTEGRATION_ID,\r\n    status: \"active\",\r\n    publicKeyFingerprint: \"SHA256:ihr5PtCXRVCgjAlOcZi7...\",\r\n    supportedEvents: [\"schema_update\", \"memo_published\", \"memo_updated\"]\r\n  };\r\n}\r\n", "import consultRouter from \"./routes/consult\";\r\nimport dizRouter from \"./routes/diz\";\r\nimport eroRouter from \"./routes/ero\";\r\n// --- All Imports at Top ---\r\nimport { healthRoute } from \"./health\";\r\nimport { cors } from \"./cors\";\r\nimport bcrypt from \"bcryptjs\";\r\nimport jwt from \"@tsndr/cloudflare-worker-jwt\";\r\nimport { v4 as uuid } from \"uuid\";\r\nimport { authRoute, mfaSetupRoute, mfaVerifyRoute } from \"./routes/auth\";\r\nimport { ERO_EFIN_PROFILE, BANK_PRODUCT_PROVIDERS, SUPPORTED_PAYMENT_METHODS } from \"./efileProviders\";\r\nimport { paymentRouter } from \"./payment\";\r\nimport { transmitEFile, checkSubmissionStatus, processNewAcknowledgments, getEFileStatusInfo } from \"./efile\";\r\nimport { fetchIrsSchema, fetchIrsMemos } from \"./irs\";\r\nimport { handleCrmIntakes, handleCrmIntakeById, handleCrmIntakeCreate, handleCrmIntakeDelete } from \"./routes/crm\";\r\nimport lmsRouter from \"./routes/lms\";\r\nimport portalRouter from \"./routes/portal\";\r\nimport portalAuthRouter from \"./routes/portalAuth\";\r\nimport { handleListCertificates, handleIssueCertificate, handleGetCertificate, handleRevokeCertificate, handleDownloadCertificate, handleCertificateTypes } from \"./routes/certificates\";\r\nimport { handleListTeam, handleGetTeamMember, handleListRegions } from \"./routes/team\";\r\nimport { handleComplianceCheck, handleComplianceRequirements, handleIssueAllCertificates, handleComplianceReport } from \"./routes/compliance\";\r\nimport { handleSocialPost, handleSocialFeed, handleSocialMetrics, handleSchedulePost, handleSocialMentions, handleSocialReply } from \"./routes/socialMedia\";\r\nimport { handleGoogleReviews, handleGoogleReplyReview, handleGoogleStats } from \"./routes/socialMedia\";\r\nimport {\r\n  handleInstagramFeed,\r\n  handleInstagramReviews,\r\n  handleInstagramAnalytics,\r\n  handleInstagramPost,\r\n  handleInstagramDM\r\n  // @ts-expect-error - Legacy Instagram JS module without TypeScript definitions\r\n} from \"./instagram.js\";\r\nimport { handleScheduledIRSSync, handleAuditLogProcessing } from \"./utils\";\r\nimport { handleIrsCallback } from \"./handlers/irs-callback\";\r\nimport { handlePaymentWebhook } from \"./handlers/payment-webhook\";\r\nimport { handleCredentialUpload } from \"./handlers/credential-upload\";\r\nimport { handleIrsRealtimeSchema, handleIrsRealtimeMemo, getIrsRealtimeStatus } from \"./handlers/irs-realtime\";\r\n\r\n// --- Global Configuration ---\r\nlet seeded = false;\r\n\r\nexport const SOCIAL_MEDIA_HANDLES = {\r\n  INSTAGRAM: \"@rosstaxprepandbookkeepingllc\",\r\n  X_TWITTER: \"@rosstaxprep\",\r\n  FACEBOOK: \"Ross tax prep and bookkeeping inc.\",\r\n  GOOGLE_BUSINESS: \"Ross Tax Prep and Bookkeeping\"\r\n};\r\n\r\nexport const BUSINESS_INFO = {\r\n  legal_name: \"Ross Tax Prep & Bookkeeping LLC\",\r\n  business_name: \"Ross Tax & Bookkeeping\",\r\n  display_name: \"Ross Tax Prep and Bookkeeping\",\r\n  ein: \"33-4891499\",\r\n  category: \"Tax Consultants\",\r\n  address: \"2509 Cody Poe Rd\",\r\n  city: \"Killeen\",\r\n  state: \"TX\",\r\n  zip: \"76549\",\r\n  phone: \"5124896749\",\r\n  phone_formatted: \"(512) 489-6749\",\r\n  email: \"info@rosstaxprepandbookkeeping.com\",\r\n  website_url: \"https://www.rosstaxprepandbookkeeping.com\",\r\n  google_business_verified: true,\r\n  google_verification_date: \"2026-01-28\",\r\n  location_id: \"ross-tax-killeen-tx\"\r\n};\r\n\r\n// --- Type Interfaces ---\r\ninterface AuthenticatedUser {\r\n  id: number;\r\n  email: string;\r\n  role: string;\r\n  name?: string;\r\n}\r\n\r\ninterface DocuSignEnvelope {\r\n  envelopeId: string;\r\n  [key: string]: any;\r\n}\r\n\r\ninterface IrsResponse {\r\n  access_token?: string;\r\n  url?: string;\r\n  [key: string]: any;\r\n}\r\n\r\nasync function verifyAuth(req: Request, env: any): Promise<AuthenticatedUser | null> {\r\n  const authHeader = req.headers.get(\"Authorization\");\r\n  if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n    return null;\r\n  }\r\n  \r\n  const token = authHeader.substring(7);\r\n  try {\r\n    const isValid = await jwt.verify(token, env.JWT_SECRET || \"change-this-secret-in-production\");\r\n    if (!isValid) return null;\r\n    \r\n    const { payload } = jwt.decode(token);\r\n    return payload as AuthenticatedUser;\r\n  } catch (error) {\r\n    console.error(\"JWT verification failed:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\nfunction unauthorized(): Response {\r\n  return new Response(JSON.stringify({ error: \"Unauthorized\" }), {\r\n    status: 401,\r\n    headers: { \"Content-Type\": \"application/json\" }\r\n  });\r\n}\r\n\r\nfunction forbidden(): Response {\r\n  return new Response(JSON.stringify({ error: \"Forbidden\" }), {\r\n    status: 403,\r\n    headers: { \"Content-Type\": \"application/json\" }\r\n  });\r\n}\r\n\r\n// --- Helper Functions ---\r\nasync function seedAdminIfNone(env: any) {\r\n  try {\r\n    if (!env.DB) {\r\n      console.log(\"env.DB is undefined! Available keys:\", Object.keys(env));\r\n      return;\r\n    }\r\n    const row = await env.DB.prepare(\"SELECT COUNT(*) AS count FROM staff\").first();\r\n    console.log(\"seedAdminIfNone row:\", row);\r\n    if (!row || typeof row.count !== \"number\") {\r\n      console.log(\"Staff table missing or unreadable. Skipping admin seed.\");\r\n      return;\r\n    }\r\n    if (row.count === 0) {\r\n      const password_hash = await bcrypt.hash(\"Admin123!\", 10);\r\n      await env.DB.prepare(\r\n        \"INSERT INTO staff (name, email, password_hash, role) VALUES (?, ?, ?, 'admin')\"\r\n      ).bind(\"Administrator\", \"admin@rosstaxprepandbookkeeping.com\", password_hash).run();\r\n      console.log(\"Admin user seeded.\");\r\n    }\r\n  } catch (e) {\r\n    console.log(\"seedAdminIfNone error:\", e);\r\n  }\r\n}\r\n\r\nfunction requireRole(user: any, roles: string[]) {\r\n  if (!user || !roles.includes(user.role)) throw new Response(\"Forbidden\", { status: 403 });\r\n}\r\n\r\nfunction validateDocuSignWebhookPayload(payload: any) {\r\n  if (!payload || typeof payload !== \"object\") return false;\r\n  if (!payload.envelopeId || typeof payload.envelopeId !== \"string\") return false;\r\n  if (!payload.status || typeof payload.status !== \"string\") return false;\r\n  return true;\r\n}\r\n\r\nasync function getDocuSignAccessToken(env: any) {\r\n  const jwtPayload = {\r\n    iss: env.DOCUSIGN_INTEGRATION_KEY,\r\n    sub: env.DOCUSIGN_IMPERSONATED_USER,\r\n    aud: \"account-d.docusign.com\",\r\n    scope: \"signature\"\r\n  };\r\n  const jwtToken = await jwt.sign(jwtPayload, env.DOCUSIGN_PRIVATE_KEY);\r\n  const res = await fetch(\"https://account-d.docusign.com/oauth/token\", {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n    body: `grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&assertion=${jwtToken}`\r\n  });\r\n  if (!res.ok) throw new Error(\"Failed to obtain DocuSign access token\");\r\n  const data = await res.json() as IrsResponse;\r\n  return data.access_token || \"\";\r\n}\r\n\r\n// --- Audit Log Handlers ---\r\nasync function handleAuditLog(req: Request, env: any) {\r\n  const url = new URL(req.url);\r\n  const q = url.searchParams.get(\"q\");\r\n  let sql = `SELECT * FROM audit_log`;\r\n  const params = [];\r\n  if (q) {\r\n    sql += ` WHERE action LIKE ? OR entity LIKE ? OR entity_id LIKE ? OR details LIKE ?`;\r\n    params.push(`%${q}%`, `%${q}%`, `%${q}%`, `%${q}%`);\r\n  }\r\n  sql += ` ORDER BY created_at DESC LIMIT 200`;\r\n  const rows = await env.DB.prepare(sql).bind(...params).all();\r\n  return new Response(JSON.stringify(rows.results), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function handleAuditAnalytics(req: Request, env: any) {\r\n  const actions = await env.DB.prepare(`SELECT action, COUNT(*) as count FROM audit_log GROUP BY action ORDER BY count DESC`).all();\r\n  const entities = await env.DB.prepare(`SELECT entity, COUNT(*) as count FROM audit_log GROUP BY entity ORDER BY count DESC`).all();\r\n  return new Response(JSON.stringify({ actions: actions.results, entities: entities.results }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\n// --- Refund Handlers ---\r\nasync function handleClientRefunds(req: Request, env: any, user: any) {\r\n  if (!user || user.role !== \"client\") return new Response(\"Forbidden\", { status: 403 });\r\n  const sql = `SELECT id, return_id, irs_refund_status, refund_method, refund_amount, refund_disbursed_at, refund_trace_id, refund_notes\r\n    FROM efile_transmissions WHERE client_id = ? ORDER BY updated_at DESC LIMIT 20`;\r\n  const rows = await env.DB.prepare(sql).bind(user.id).all();\r\n  return new Response(JSON.stringify(rows.results), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function handleMe(req: Request, env: any, user: any) {\r\n  if (!user) return new Response(JSON.stringify({ error: \"Not signed in\" }), { status: 401 });\r\n  return new Response(JSON.stringify({ user }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function handleAdminRefunds(req: Request, env: any) {\r\n  const url = new URL(req.url);\r\n  const q = url.searchParams.get(\"q\");\r\n  let sql = `SELECT t.id, t.return_id, t.irs_refund_status, t.refund_method, t.refund_amount, t.refund_disbursed_at, t.refund_trace_id, t.refund_notes, c.name as client_name\r\n    FROM efile_transmissions t\r\n    LEFT JOIN clients c ON t.client_id = c.id`;\r\n  const params = [];\r\n  if (q) {\r\n    sql += ` WHERE (c.name LIKE ? OR t.return_id LIKE ? OR t.irs_refund_status LIKE ? OR t.refund_method LIKE ?)`;\r\n    params.push(`%${q}%`, `%${q}%`, `%${q}%`, `%${q}%`);\r\n  }\r\n  sql += ` ORDER BY t.updated_at DESC LIMIT 100`;\r\n  const rows = await env.DB.prepare(sql).bind(...params).all();\r\n  return new Response(JSON.stringify(rows.results), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function handleGetRefundStatus(req: Request, env: any) {\r\n  const id = req.url.split(\"/\").pop();\r\n  const row = await env.DB.prepare(\"SELECT irs_refund_status, refund_method, refund_amount, refund_disbursed_at, refund_trace_id, refund_notes FROM efile_transmissions WHERE id = ?\").bind(id).first();\r\n  if (!row) return new Response(JSON.stringify({ error: \"Not found\" }), { status: 404 });\r\n  return new Response(JSON.stringify(row), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function handleUpdateRefundStatus(req: Request, env: any) {\r\n  const id = req.url.split(\"/\").pop();\r\n  const body = await req.json() as Record<string, any>;\r\n  const fields = [\"irs_refund_status\", \"refund_method\", \"refund_amount\", \"refund_disbursed_at\", \"refund_trace_id\", \"refund_notes\"];\r\n  const updates = [];\r\n  const params = [];\r\n  for (const f of fields) {\r\n    if (body[f] !== undefined) {\r\n      updates.push(`${f} = ?`);\r\n      params.push(body[f]);\r\n    }\r\n  }\r\n  if (!updates.length) return new Response(JSON.stringify({ error: \"No fields to update\" }), { status: 400 });\r\n  params.push(id);\r\n  await env.DB.prepare(`UPDATE efile_transmissions SET ${updates.join(\", \")}, updated_at = datetime('now') WHERE id = ?`).bind(...params).run();\r\n  return new Response(JSON.stringify({ success: true }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\n// --- IRS Memo Handlers ---\r\nasync function updateIrsMemo(request: Request, env: any) {\r\n  const id = request.url.split(\"/\")[4];\r\n  const body = await request.json() as Record<string, any>;\r\n  const fields = [\"title\", \"summary\", \"full_text\", \"url\", \"tags\", \"status\", \"published_at\"];\r\n  const updates = [];\r\n  const params = [];\r\n  for (const f of fields) {\r\n    if (body[f] !== undefined) {\r\n      if (f === \"tags\") {\r\n        updates.push(\"tags_json = ?\");\r\n        params.push(JSON.stringify(body.tags));\r\n      } else {\r\n        updates.push(`${f} = ?`);\r\n        params.push(body[f]);\r\n      }\r\n    }\r\n  }\r\n  if (!updates.length) return new Response(JSON.stringify({ error: \"No fields to update\" }), { status: 400 });\r\n  params.push(id);\r\n  await env.DB.prepare(`UPDATE irs_memos SET ${updates.join(\", \")} WHERE id = ?`).bind(...params).run();\r\n  await env.DB.prepare(`INSERT INTO audit_log (action, entity, entity_id, details, created_at) VALUES (?, ?, ?, ?, datetime('now'))`).bind(\r\n    \"update\", \"irs_memo\", id, JSON.stringify(body)\r\n  ).run();\r\n  return new Response(JSON.stringify({ success: true }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function deleteIrsMemo(request: Request, env: any) {\r\n  const id = request.url.split(\"/\")[4];\r\n  await env.DB.prepare(`UPDATE irs_memos SET status = 'deleted' WHERE id = ?`).bind(id).run();\r\n  await env.DB.prepare(`INSERT INTO audit_log (action, entity, entity_id, details, created_at) VALUES (?, ?, ?, ?, datetime('now'))`).bind(\r\n    \"delete\", \"irs_memo\", id, null\r\n  ).run();\r\n  return new Response(JSON.stringify({ success: true }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function unlinkIrsMemoLink(request: Request, env: any) {\r\n  const parts = request.url.split(\"/\");\r\n  const linkId = parts[6];\r\n  await env.DB.prepare(`DELETE FROM irs_memo_links WHERE id = ?`).bind(linkId).run();\r\n  await env.DB.prepare(`INSERT INTO audit_log (action, entity, entity_id, details, created_at) VALUES (?, ?, ?, ?, datetime('now'))`).bind(\r\n    \"unlink\", \"irs_memo_link\", linkId, null\r\n  ).run();\r\n  return new Response(JSON.stringify({ success: true }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function searchIrsMemos(request: Request, env: any) {\r\n  const url = new URL(request.url);\r\n  const text = url.searchParams.get(\"text\");\r\n  const from = url.searchParams.get(\"from\");\r\n  const to = url.searchParams.get(\"to\");\r\n  const tags = url.searchParams.getAll(\"tags\");\r\n  let query = \"SELECT * FROM irs_memos WHERE status = 'active'\";\r\n  const params = [];\r\n  if (text) {\r\n    query += \" AND (title LIKE ? OR summary LIKE ? OR full_text LIKE ?)\";\r\n    params.push(`%${text}%`, `%${text}%`, `%${text}%`);\r\n  }\r\n  if (from) {\r\n    query += \" AND published_at >= ?\";\r\n    params.push(from);\r\n  }\r\n  if (to) {\r\n    query += \" AND published_at <= ?\";\r\n    params.push(to);\r\n  }\r\n  for (const tag of tags) {\r\n    query += \" AND tags_json LIKE ?\";\r\n    params.push(`%${tag}%`);\r\n  }\r\n  query += \" ORDER BY published_at DESC LIMIT 100\";\r\n  const rows = await env.DB.prepare(query).bind(...params).all();\r\n  return new Response(JSON.stringify(rows.results), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function listIrsMemos(request: Request, env: any) {\r\n  const url = new URL(request.url);\r\n  const source = url.searchParams.get(\"source\");\r\n  const tag = url.searchParams.get(\"tag\");\r\n  const status = url.searchParams.get(\"status\") ?? \"active\";\r\n  const limit = Number(url.searchParams.get(\"limit\") ?? 50);\r\n  const offset = Number(url.searchParams.get(\"offset\") ?? 0);\r\n\r\n  let query = \"SELECT * FROM irs_memos WHERE status = ?\";\r\n  const params: any[] = [status];\r\n\r\n  if (source) {\r\n    query += \" AND source = ?\";\r\n    params.push(source);\r\n  }\r\n  if (tag) {\r\n    query += \" AND tags_json LIKE ?\";\r\n    params.push(`%${tag}%`);\r\n  }\r\n  query += \" ORDER BY published_at DESC LIMIT ? OFFSET ?\";\r\n  params.push(limit, offset);\r\n\r\n  const rows = await env.DB.prepare(query).bind(...params).all();\r\n  return new Response(JSON.stringify(rows.results), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function getIrsMemo(request: Request, env: any) {\r\n  const id = request.url.split(\"/\").pop();\r\n  const memo = await env.DB.prepare(\r\n    \"SELECT * FROM irs_memos WHERE id = ?\"\r\n  ).bind(id).first();\r\n  if (!memo) return new Response(JSON.stringify({ error: \"Not found\" }), { status: 404 });\r\n  const links = await env.DB.prepare(\r\n    \"SELECT * FROM irs_memo_links WHERE memo_id = ?\"\r\n  ).bind(id).all();\r\n  return new Response(JSON.stringify({ memo, links: links.results }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function linkIrsMemo(request: Request, env: any) {\r\n  const memoId = request.url.split(\"/\")[3];\r\n  const body = await request.json() as Record<string, any>;\r\n  const id = uuid();\r\n  await env.DB.prepare(\r\n    `INSERT INTO irs_memo_links \r\n     (id, memo_id, client_id, return_id, topic, note, created_by)\r\n     VALUES (?, ?, ?, ?, ?, ?, ?)`\r\n  )\r\n    .bind(\r\n      id,\r\n      memoId,\r\n      body.client_id ?? null,\r\n      body.return_id ?? null,\r\n      body.topic ?? null,\r\n      body.note ?? null,\r\n      body.staff_id ?? \"1\"\r\n    )\r\n    .run();\r\n  return new Response(JSON.stringify({ success: true, id }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function listIrsSchemaFields(request: Request, env: any) {\r\n  const url = new URL(request.url);\r\n  const type = url.searchParams.get(\"type\");\r\n  const status = url.searchParams.get(\"status\") ?? \"active\";\r\n  let query = \"SELECT * FROM irs_schema_fields WHERE status = ?\";\r\n  const params: any[] = [status];\r\n  if (type) {\r\n    query += \" AND schema_type = ?\";\r\n    params.push(type);\r\n  }\r\n  query += \" ORDER BY field_name ASC\";\r\n  const rows = await env.DB.prepare(query).bind(...params).all();\r\n  return new Response(JSON.stringify(rows.results), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\n// --- DocuSign Handlers ---\r\nasync function handleCreateEnvelope(request: Request, env: any, user: any) {\r\n  requireRole(user, [\"admin\", \"staff\"]);\r\n  const { client_id, name, email, documentBase64 } = await request.json() as Record<string, any>;\r\n  const accessToken = await getDocuSignAccessToken(env);\r\n  const envelopeBody = {\r\n    emailSubject: \"Ross Tax Prep \u2013 Engagement Letter\",\r\n    documents: [\r\n      {\r\n        documentBase64,\r\n        name: \"Engagement Letter\",\r\n        fileExtension: \"pdf\",\r\n        documentId: \"1\"\r\n      }\r\n    ],\r\n    recipients: {\r\n      signers: [\r\n        {\r\n          email,\r\n          name,\r\n          recipientId: \"1\",\r\n          routingOrder: \"1\",\r\n          clientUserId: client_id.toString()\r\n        }\r\n      ]\r\n    },\r\n    eventNotification: {\r\n      url: `${env.APP_URL}/api/docusign/webhook`,\r\n      loggingEnabled: \"true\",\r\n      requireAcknowledgment: \"true\",\r\n      includeDocuments: \"false\",\r\n      includeTimeZone: \"true\",\r\n      includeEnvelopeVoidReason: \"true\"\r\n    },\r\n    status: \"sent\"\r\n  };\r\n  const res = await fetch(\r\n    `${env.DOCUSIGN_BASE_URL}/v2.1/accounts/${env.DOCUSIGN_ACCOUNT_ID}/envelopes`,\r\n    {\r\n      method: \"POST\",\r\n      headers: {\r\n        Authorization: `Bearer ${accessToken}`,\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify(envelopeBody)\r\n    }\r\n  );\r\n  if (!res.ok) {\r\n    const err = await res.text();\r\n    return new Response(err, { status: 500 });\r\n  }\r\n  const envelope = await res.json() as DocuSignEnvelope;\r\n  await env.DB.prepare(\r\n    `INSERT INTO signatures (client_id, envelope_id, status)\r\n     VALUES (?, ?, ?)`\r\n  ).bind(client_id, envelope.envelopeId, \"sent\").run();\r\n  return Response.json({\r\n    success: true,\r\n    envelopeId: envelope.envelopeId\r\n  });\r\n}\r\n\r\nasync function handleEmbeddedSigningUrl(request: Request, env: any, user: any) {\r\n  requireRole(user, [\"admin\", \"staff\", \"client\"]);\r\n  const { envelopeId, client_id, name, email } = await request.json() as Record<string, any>;\r\n  const accessToken = await getDocuSignAccessToken(env);\r\n  const body = {\r\n    returnUrl: env.DOCUSIGN_REDIRECT_URL,\r\n    authenticationMethod: \"none\",\r\n    email,\r\n    userName: name,\r\n    clientUserId: client_id.toString()\r\n  };\r\n  const res = await fetch(\r\n    `${env.DOCUSIGN_BASE_URL}/v2.1/accounts/${env.DOCUSIGN_ACCOUNT_ID}/envelopes/${envelopeId}/views/recipient`,\r\n    {\r\n      method: \"POST\",\r\n      headers: {\r\n        Authorization: `Bearer ${accessToken}`,\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      body: JSON.stringify(body)\r\n    }\r\n  );\r\n  if (!res.ok) {\r\n    const err = await res.text();\r\n    return new Response(err, { status: 500 });\r\n  }\r\n  const data = await res.json() as Record<string, any>;\r\n  return Response.json({ url: data.url });\r\n}\r\n\r\nasync function handleDocuSignWebhook(req: Request, env: any) {\r\n  const secret = req.headers.get(\"X-DS-SECRET\");\r\n  if (secret !== env.DOCUSIGN_WEBHOOK_SECRET)\r\n    return new Response(\"Unauthorized\", { status: 401 });\r\n\r\n  let body: Record<string, any>;\r\n  try {\r\n    body = await req.json() as Record<string, any>;\r\n  } catch {\r\n    return new Response(\"Invalid JSON\", { status: 400 });\r\n  }\r\n\r\n  if (!validateDocuSignWebhookPayload(body))\r\n    return new Response(\"Invalid schema\", { status: 400 });\r\n\r\n  const { envelopeId, status } = body;\r\n\r\n  await env.DB.prepare(\r\n    `UPDATE signatures SET status = ?, updated_at = CURRENT_TIMESTAMP WHERE envelope_id = ?`\r\n  ).bind(status, envelopeId).run();\r\n\r\n  return new Response(\"OK\", { status: 200 });\r\n}\r\n\r\nasync function handleSignatures(request: Request, env: any, user: any) {\r\n  const url = new URL(request.url);\r\n  const scope = url.searchParams.get(\"scope\");\r\n  if (scope === \"client\") {\r\n    requireRole(user, [\"client\"]);\r\n    const rows = await env.DB.prepare(\r\n      \"SELECT * FROM signatures WHERE client_id = ? ORDER BY created_at DESC\"\r\n    ).bind(user.id).all();\r\n    return Response.json(rows.results);\r\n  }\r\n  requireRole(user, [\"admin\", \"staff\"]);\r\n  const rows = await env.DB.prepare(\r\n    \"SELECT * FROM signatures ORDER BY created_at DESC\"\r\n  ).all();\r\n  return Response.json(rows.results);\r\n}\r\n\r\n// --- Auth Handlers ---\r\nasync function handleRegisterStaff(req: Request, env: any) {\r\n  const { name, email, password, role } = await req.json() as Record<string, any>;\r\n  if (!name || !email || !password || !role) return new Response(\"Missing fields\", { status: 400 });\r\n  const password_hash = await bcrypt.hash(password, 10);\r\n  try {\r\n    await env.DB.prepare(\r\n      \"INSERT INTO staff (name, email, password_hash, role) VALUES (?, ?, ?, ?)\"\r\n    ).bind(name, email, password_hash, role).run();\r\n    return new Response(JSON.stringify({ ok: true }), { headers: { \"Content-Type\": \"application/json\" } });\r\n  } catch (e) {\r\n    return new Response(\"Email already exists\", { status: 409 });\r\n  }\r\n}\r\n\r\nasync function handleRegisterClient(req: Request, env: any) {\r\n  const { name, email, password, phone } = await req.json() as Record<string, any>;\r\n  if (!name || !email || !password) return new Response(\"Missing fields\", { status: 400 });\r\n  const password_hash = await bcrypt.hash(password, 10);\r\n  try {\r\n    await env.DB.prepare(\r\n      \"INSERT INTO clients (name, email, phone, password_hash) VALUES (?, ?, ?, ?)\"\r\n    ).bind(name, email, phone || null, password_hash).run();\r\n    return new Response(JSON.stringify({ ok: true }), { headers: { \"Content-Type\": \"application/json\" } });\r\n  } catch (e) {\r\n    return new Response(\"Email already exists\", { status: 409 });\r\n  }\r\n}\r\n\r\nasync function handleLoginStaff(req: Request, env: any) {\r\n  const { email, password } = await req.json() as Record<string, any>;\r\n  const user = await env.DB.prepare(\"SELECT * FROM staff WHERE email = ?\").bind(email).first();\r\n  if (!user) return new Response(\"Invalid credentials\", { status: 401 });\r\n  const valid = await bcrypt.compare(password, user.password_hash);\r\n  if (!valid) return new Response(\"Invalid credentials\", { status: 401 });\r\n  return new Response(JSON.stringify({ ok: true, user }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function handleLoginClient(req: Request, env: any) {\r\n  const { email, password } = await req.json() as Record<string, any>;\r\n  const user = await env.DB.prepare(\"SELECT * FROM clients WHERE email = ?\").bind(email).first();\r\n  if (!user) return new Response(\"Invalid credentials\", { status: 401 });\r\n  const valid = await bcrypt.compare(password, user.password_hash);\r\n  if (!valid) return new Response(\"Invalid credentials\", { status: 401 });\r\n  return new Response(JSON.stringify({ ok: true, user }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\n// --- Training Handlers ---\r\nasync function listTrainingCourses(request: Request, env: any) {\r\n  const rows = await env.DB.prepare(\"SELECT * FROM training_courses ORDER BY created_at DESC\").all();\r\n  return new Response(JSON.stringify(rows.results), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\nasync function enrollTrainingCourse(request: Request, env: any) {\r\n  const body = await request.json() as Record<string, any>;\r\n  const id = uuid();\r\n  await env.DB.prepare(\r\n    `INSERT INTO training_enrollments (id, course_id, student_email, student_name, notes)\r\n     VALUES (?, ?, ?, ?, ?)`\r\n  ).bind(id, body.course_id, body.email, body.name ?? null, body.notes ?? null).run();\r\n  return new Response(JSON.stringify({ success: true, id }), { headers: { \"Content-Type\": \"application/json\" } });\r\n}\r\n\r\n// --- Export Default Worker ---\r\nexport default {\r\n  async fetch(req: Request, env: any, ctx: any): Promise<Response> {\r\n    if (!seeded) {\r\n      await seedAdminIfNone(env);\r\n      seeded = true;\r\n    }\r\n    const url = new URL(req.url);\r\n\r\n    // --- Consultation Booking API Route (all /api/consult/* endpoints) ---\r\n    if (url.pathname.startsWith(\"/api/consult\")) {\r\n      const reqPath = url.pathname.replace(/^\\/api\\/consult/, \"\");\r\n      const consultReq = new Request(reqPath || \"/\", req);\r\n      Object.defineProperty(consultReq, \"params\", { value: {} });\r\n      const resp = await consultRouter.handle(consultReq, env);\r\n      return cors(resp);\r\n    }\r\n\r\n    // --- DIZ Client Workflow API Route (all /api/diz/* endpoints) ---\r\n    if (url.pathname.startsWith(\"/api/diz\")) {\r\n      const reqPath = url.pathname.replace(/^\\/api\\/diz/, \"\");\r\n      const dizReq = new Request(reqPath || \"/\", req);\r\n      Object.defineProperty(dizReq, \"params\", { value: {} });\r\n      const resp = await dizRouter.handle(dizReq, env);\r\n      return cors(resp);\r\n    }\r\n\r\n    // --- ERO Workflow API Route (all /api/ero/* endpoints) ---\r\n    if (url.pathname.startsWith(\"/api/ero\")) {\r\n      const reqPath = url.pathname.replace(/^\\/api\\/ero/, \"\");\r\n      const eroReq = new Request(reqPath || \"/\", req);\r\n      Object.defineProperty(eroReq, \"params\", { value: {} });\r\n      const resp = await eroRouter.handle(eroReq, env);\r\n      return cors(resp);\r\n    }\r\n\r\n    // --- Client Portal Auth Route (all /api/portal/login) ---\r\n    if (url.pathname.startsWith(\"/api/portal/login\")) {\r\n      const reqPath = url.pathname.replace(/^\\/api\\/portal/, \"\");\r\n      const portalAuthReq = new Request(reqPath || \"/\", req);\r\n      Object.defineProperty(portalAuthReq, \"params\", { value: {} });\r\n      const resp = await portalAuthRouter.handle(portalAuthReq, env);\r\n      return cors(resp);\r\n    }\r\n\r\n    // --- Consultation Booking API Route (all /api/consult/* endpoints) ---\r\n    if (url.pathname.startsWith(\"/api/consult\")) {\r\n      const reqPath = url.pathname.replace(/^\\/api\\/consult/, \"\");\r\n      const consultReq = new Request(reqPath || \"/\", req);\r\n      Object.defineProperty(consultReq, \"params\", { value: {} });\r\n      const resp = await consultRouter.handle(consultReq, env);\r\n      return cors(resp);\r\n    }\r\n\r\n    // --- DIZ Client Workflow API Route (all /api/diz/* endpoints) ---\r\n    if (url.pathname.startsWith(\"/api/diz\")) {\r\n      const reqPath = url.pathname.replace(/^\\/api\\/diz/, \"\");\r\n      const dizReq = new Request(reqPath || \"/\", req);\r\n      Object.defineProperty(dizReq, \"params\", { value: {} });\r\n      const resp = await dizRouter.handle(dizReq, env);\r\n      return cors(resp);\r\n    }\r\n\r\n    // --- ERO Workflow API Route (all /api/ero/* endpoints) ---\r\n    if (url.pathname.startsWith(\"/api/ero\")) {\r\n      const reqPath = url.pathname.replace(/^\\/api\\/ero/, \"\");\r\n      const eroReq = new Request(reqPath || \"/\", req);\r\n      Object.defineProperty(eroReq, \"params\", { value: {} });\r\n      const resp = await eroRouter.handle(eroReq, env);\r\n      return cors(resp);\r\n    }\r\n\r\n    // Scheduled event: weekly Instagram tip post\r\n    if (ctx && ctx.event && ctx.event.type === \"scheduled\") {\r\n      const tipImageUrl = env.WEEKLY_TIP_IMAGE_URL;\r\n      const tipCaption = env.WEEKLY_TIP_CAPTION;\r\n      if (tipImageUrl && tipCaption) {\r\n        const user = { role: \"admin\", id: 1 };\r\n        await handleInstagramPost({\r\n          json: async () => ({ caption: tipCaption, imageUrl: tipImageUrl })\r\n        }, env, user);\r\n      }\r\n      return new Response(\"Scheduled Instagram tip posted\", { status: 200 });\r\n    }\r\n\r\n    // Health check\r\n    if (url.pathname === \"/health\") {\r\n      return cors(healthRoute());\r\n    }\r\n\r\n    // --- Audit Log Endpoints (Admin only) ---\r\n    if (url.pathname === \"/api/admin/audit-log\" && req.method === \"GET\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      if (user.role !== \"admin\") return cors(forbidden());\r\n      return await handleAuditLog(req, env);\r\n    }\r\n    if (url.pathname === \"/api/admin/audit-analytics\" && req.method === \"GET\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      if (user.role !== \"admin\") return cors(forbidden());\r\n      return await handleAuditAnalytics(req, env);\r\n    }\r\n\r\n    // --- X (Twitter) API Integration Endpoints ---\r\n    if (url.pathname === \"/api/x/brand-monitoring\") {\r\n      return new Response(JSON.stringify({ mentions: [\r\n        `${SOCIAL_MEDIA_HANDLES.X_TWITTER} mentioned in #TaxSeason2026`,\r\n        `Great service from ${SOCIAL_MEDIA_HANDLES.X_TWITTER}!`,\r\n        \"Ross Tax & Bookkeeping trending in local news.\"\r\n      ] }), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n    if (url.pathname === \"/api/x/events\") {\r\n      return new Response(JSON.stringify({ events: [\r\n        \"IRS e-file opens Feb 1.\",\r\n        \"Tax law update webinar Jan 30.\",\r\n        \"Refund tracker feature launch.\"\r\n      ] }), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n    if (url.pathname === \"/api/x/customer-care\") {\r\n      return new Response(JSON.stringify({ cases: [\r\n        `@client123: Quick response from ${SOCIAL_MEDIA_HANDLES.X_TWITTER}!`,\r\n        \"Resolved: E-file submission issue.\",\r\n        `${SOCIAL_MEDIA_HANDLES.X_TWITTER}: Thank you for your feedback!`\r\n      ] }), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n    if (url.pathname === \"/api/x/market-insights\") {\r\n      return new Response(JSON.stringify({ insights: [\r\n        \"EITC trending in #TaxTwitter.\",\r\n        \"Clients prefer direct deposit refunds.\",\r\n        \"Increased demand for virtual tax prep.\"\r\n      ] }), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n\r\n    // --- MFA Authentication Endpoints ---\r\n    if (url.pathname === \"/api/auth/login\" && req.method === \"POST\") {\r\n      return await authRoute(req, env);\r\n    }\r\n    if (url.pathname === \"/api/auth/mfa/setup\" && req.method === \"POST\") {\r\n      return await mfaSetupRoute(req, env);\r\n    }\r\n    if (url.pathname === \"/api/auth/mfa/verify\" && req.method === \"POST\") {\r\n      return await mfaVerifyRoute(req, env);\r\n    }\r\n\r\n    // --- Workflow Callback Handlers ---\r\n    if (url.pathname === \"/api/irs-callback\" && req.method === \"POST\") {\r\n      return cors(await handleIrsCallback(req, env));\r\n    }\r\n    if (url.pathname === \"/api/payment-webhook\" && req.method === \"POST\") {\r\n      return cors(await handlePaymentWebhook(req, env));\r\n    }\r\n    if (url.pathname === \"/api/credential-upload\" && req.method === \"POST\") {\r\n      return cors(await handleCredentialUpload(req, env));\r\n    }\r\n\r\n    // --- IRS Real-time Integration Endpoints ---\r\n    if (url.pathname === \"/api/irs/realtime/schema\" && req.method === \"POST\") {\r\n      return cors(await handleIrsRealtimeSchema(req, env));\r\n    }\r\n    if (url.pathname === \"/api/irs/realtime/memo\" && req.method === \"POST\") {\r\n      return cors(await handleIrsRealtimeMemo(req, env));\r\n    }\r\n    if (url.pathname === \"/api/irs/realtime/status\" && req.method === \"GET\") {\r\n      return cors(new Response(JSON.stringify(getIrsRealtimeStatus()), {\r\n        headers: { \"Content-Type\": \"application/json\" }\r\n      }));\r\n    }\r\n\r\n    // --- Client Refund Tracker Endpoints ---\r\n    if (url.pathname === \"/api/client/refunds\" && req.method === \"GET\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      return await handleClientRefunds(req, env, user);\r\n    }\r\n\r\n    // User info endpoint for portal\r\n    if (url.pathname === \"/api/me\" && req.method === \"GET\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      return await handleMe(req, env, user);\r\n    }\r\n\r\n    // Admin refund tracker list/search endpoint\r\n    if (url.pathname === \"/api/admin/refunds\" && req.method === \"GET\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      if (user.role !== \"admin\" && user.role !== \"staff\") return cors(forbidden());\r\n      return await handleAdminRefunds(req, env);\r\n    }\r\n\r\n    // --- Refund Tracker Endpoints ---\r\n    if (url.pathname.startsWith(\"/api/efile/refund/\") && req.method === \"GET\") {\r\n      return await handleGetRefundStatus(req, env);\r\n    }\r\n    if (url.pathname.startsWith(\"/api/efile/refund/\") && req.method === \"PATCH\") {\r\n      return await handleUpdateRefundStatus(req, env);\r\n    }\r\n\r\n    // --- Payment API ---\r\n    if (url.pathname.startsWith(\"/api/payment\")) {\r\n      return await paymentRouter.fetch(req, env, ctx);\r\n    }\r\n\r\n    // --- E-file Provider Endpoints ---\r\n    if (url.pathname === \"/api/efile/efin-profile\" && req.method === \"GET\") {\r\n      return new Response(JSON.stringify(ERO_EFIN_PROFILE), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n    if (url.pathname === \"/api/efile/bank-products\" && req.method === \"GET\") {\r\n      return new Response(JSON.stringify(BANK_PRODUCT_PROVIDERS), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n    if (url.pathname === \"/api/efile/payment-methods\" && req.method === \"GET\") {\r\n      return new Response(JSON.stringify(SUPPORTED_PAYMENT_METHODS), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n\r\n    // PATCH /api/efile/transmit/:id \u2014 Update e-file with bank product/payment info\r\n    if (url.pathname.startsWith(\"/api/efile/transmit/\") && req.method === \"PATCH\") {\r\n      const id = url.pathname.split(\"/\").pop();\r\n      const body = await req.json() as Record<string, any>;\r\n      await env.DB.prepare(\r\n        `UPDATE efile_transmissions SET bank_product_id = ?, payment_method = ?, payment_details_json = ?, updated_at = ? WHERE id = ?`\r\n      ).bind(\r\n        body.bank_product_id ?? null,\r\n        body.payment_method ?? null,\r\n        body.payment_details ? JSON.stringify(body.payment_details) : null,\r\n        new Date().toISOString(),\r\n        id\r\n      ).run();\r\n      return new Response(JSON.stringify({ success: true }), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n\r\n    // POST /api/efile/transmit \u2014 Initiate e-file transmission\r\n    if (url.pathname === \"/api/efile/transmit\" && req.method === \"POST\") {\r\n      const body = await req.json() as Record<string, any>;\r\n      const id = uuid();\r\n      const now = new Date().toISOString();\r\n      const transmission = {\r\n        id,\r\n        return_id: body.return_id,\r\n        client_id: body.client_id,\r\n        preparer_id: body.preparer_id ?? null,\r\n        method: body.method,\r\n        status: \"pending\" as const,\r\n        created_at: now,\r\n        updated_at: now,\r\n      };\r\n      await env.DB.prepare(\r\n        `INSERT INTO efile_transmissions (id, return_id, client_id, preparer_id, method, status, created_at, updated_at)\r\n         VALUES (?, ?, ?, ?, ?, ?, ?, ?)`\r\n      ).bind(\r\n        id,\r\n        body.return_id,\r\n        body.client_id,\r\n        body.preparer_id ?? null,\r\n        body.method,\r\n        \"pending\",\r\n        now,\r\n        now\r\n      ).run();\r\n      \r\n      // Transmit via MeF integration\r\n      const result = await transmitEFile(\r\n        env, \r\n        transmission, \r\n        body.returnXml,  // Optional: XML return data\r\n        body.returnType || \"1040\",\r\n        body.taxYear || \"2025\"\r\n      );\r\n      \r\n      // Update database with transmission result\r\n      await env.DB.prepare(\r\n        `UPDATE efile_transmissions \r\n         SET status = ?, irs_submission_id = ?, ack_code = ?, ack_message = ?, efin = ?, etin = ?, environment = ?, updated_at = ? \r\n         WHERE id = ?`\r\n      ).bind(\r\n        result.transmission.status,\r\n        result.transmission.irs_submission_id ?? null,\r\n        result.transmission.ack_code ?? null,\r\n        result.transmission.ack_message ?? null,\r\n        result.transmission.efin ?? null,\r\n        result.transmission.etin ?? null,\r\n        result.transmission.environment ?? null,\r\n        result.transmission.updated_at,\r\n        id\r\n      ).run();\r\n      \r\n      return new Response(JSON.stringify(result), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n\r\n    // GET /api/efile/status/:id \u2014 Get e-file transmission status\r\n    if (url.pathname.startsWith(\"/api/efile/status/\") && req.method === \"GET\") {\r\n      const id = url.pathname.split(\"/\").pop();\r\n      const row = await env.DB.prepare(\"SELECT * FROM efile_transmissions WHERE id = ?\").bind(id).first();\r\n      if (!row) return new Response(JSON.stringify({ error: \"Not found\" }), { status: 404 });\r\n      \r\n      // If pending, check with IRS for updates\r\n      if (row.status === \"pending\" && row.irs_submission_id) {\r\n        try {\r\n          const statusUpdate = await checkSubmissionStatus(env, row.irs_submission_id);\r\n          if (statusUpdate.acknowledgment) {\r\n            // Update database with new status\r\n            await env.DB.prepare(\r\n              `UPDATE efile_transmissions SET status = ?, ack_code = ?, ack_message = ?, dcn = ?, updated_at = ? WHERE id = ?`\r\n            ).bind(\r\n              statusUpdate.acknowledgment.status.toLowerCase(),\r\n              statusUpdate.acknowledgment.status === \"Accepted\" ? \"A0000\" : \"R0000\",\r\n              statusUpdate.acknowledgment.status === \"Accepted\" ? \"Accepted by IRS\" : (statusUpdate.acknowledgment.errors?.[0]?.errorMessage || \"Rejected\"),\r\n              statusUpdate.acknowledgment.dcn || null,\r\n              new Date().toISOString(),\r\n              id\r\n            ).run();\r\n            \r\n            // Fetch updated row\r\n            const updatedRow = await env.DB.prepare(\"SELECT * FROM efile_transmissions WHERE id = ?\").bind(id).first();\r\n            return new Response(JSON.stringify(updatedRow), { headers: { \"Content-Type\": \"application/json\" } });\r\n          }\r\n        } catch (err) {\r\n          console.error(\"Error checking submission status:\", err);\r\n        }\r\n      }\r\n      \r\n      return new Response(JSON.stringify(row), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n    \r\n    // GET /api/efile/config \u2014 Get e-file configuration info\r\n    if (url.pathname === \"/api/efile/config\" && req.method === \"GET\") {\r\n      const config = getEFileStatusInfo();\r\n      return new Response(JSON.stringify(config), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n    \r\n    // POST /api/efile/acknowledgments/process \u2014 Process new acknowledgments from IRS\r\n    if (url.pathname === \"/api/efile/acknowledgments/process\" && req.method === \"POST\") {\r\n      const acks = await processNewAcknowledgments(env);\r\n      return new Response(JSON.stringify({ \r\n        success: true, \r\n        processed: acks.length,\r\n        acknowledgments: acks \r\n      }), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n\r\n    // --- IRS Memo Admin Endpoints ---\r\n    if (url.pathname.startsWith(\"/admin/irs/memos/\") && req.method === \"PATCH\") {\r\n      return await updateIrsMemo(req, env);\r\n    }\r\n    if (url.pathname.startsWith(\"/admin/irs/memos/\") && req.method === \"DELETE\") {\r\n      return await deleteIrsMemo(req, env);\r\n    }\r\n    if (url.pathname.startsWith(\"/admin/irs/memos/\") && url.pathname.includes(\"/link/\") && req.method === \"DELETE\") {\r\n      return await unlinkIrsMemoLink(req, env);\r\n    }\r\n    if (url.pathname === \"/admin/irs/memos/search\" && req.method === \"GET\") {\r\n      return await searchIrsMemos(req, env);\r\n    }\r\n\r\n    // --- IRS Admin API Routes ---\r\n    if (url.pathname === \"/admin/irs/memos\" && req.method === \"GET\") {\r\n      return await listIrsMemos(req, env);\r\n    }\r\n    if (url.pathname.startsWith(\"/admin/irs/memos/\") && req.method === \"GET\") {\r\n      return await getIrsMemo(req, env);\r\n    }\r\n    if (url.pathname.startsWith(\"/admin/irs/memos/\") && url.pathname.endsWith(\"/link\") && req.method === \"POST\") {\r\n      return await linkIrsMemo(req, env);\r\n    }\r\n    if (url.pathname.startsWith(\"/admin/clients/\") && url.pathname.endsWith(\"/irs-memos\") && req.method === \"GET\") {\r\n      const clientId = url.pathname.split(\"/\")[3];\r\n      const sql = `SELECT m.* FROM irs_memos m JOIN irs_memo_links l ON m.id = l.memo_id WHERE l.client_id = ? ORDER BY m.published_at DESC`;\r\n      const rows = await env.DB.prepare(sql).bind(clientId).all();\r\n      const memos = rows.results.map((memo: any) => ({ ...memo, tags: memo.tags_json ? JSON.parse(memo.tags_json) : [] }));\r\n      return new Response(JSON.stringify(memos), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n    if (url.pathname.startsWith(\"/admin/returns/\") && url.pathname.endsWith(\"/irs-memos\") && req.method === \"GET\") {\r\n      const returnId = url.pathname.split(\"/\")[3];\r\n      const sql = `SELECT m.* FROM irs_memos m JOIN irs_memo_links l ON m.id = l.memo_id WHERE l.return_id = ? ORDER BY m.published_at DESC`;\r\n      const rows = await env.DB.prepare(sql).bind(returnId).all();\r\n      const memos = rows.results.map((memo: any) => ({ ...memo, tags: memo.tags_json ? JSON.parse(memo.tags_json) : [] }));\r\n      return new Response(JSON.stringify(memos), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n    if (url.pathname === \"/admin/irs/schema\" && req.method === \"GET\") {\r\n      return await listIrsSchemaFields(req, env);\r\n    }\r\n\r\n    // --- IRS Public API Endpoints ---\r\n    if (url.pathname === \"/api/irs/memos/db\") {\r\n      try {\r\n        const rows = await env.DB.prepare(\"SELECT * FROM irs_memos WHERE status = 'active' ORDER BY published_at DESC LIMIT 20\").all();\r\n        const memos = rows.results.map((memo: any) => ({\r\n          ...memo,\r\n          tags: memo.tags_json ? JSON.parse(memo.tags_json) : []\r\n        }));\r\n        return new Response(JSON.stringify(memos), { headers: { \"Content-Type\": \"application/json\" } });\r\n      } catch (e) {\r\n        return new Response(\"Failed to fetch IRS memos from DB\", { status: 500 });\r\n      }\r\n    }\r\n\r\n    if (url.pathname === \"/api/irs/schema/fields\") {\r\n      try {\r\n        const rows = await env.DB.prepare(\"SELECT * FROM irs_schema_fields WHERE status = 'active' ORDER BY detected_at DESC LIMIT 100\").all();\r\n        return new Response(JSON.stringify(rows.results), { headers: { \"Content-Type\": \"application/json\" } });\r\n      } catch (e) {\r\n        return new Response(\"Failed to fetch IRS schema fields from DB\", { status: 500 });\r\n      }\r\n    }\r\n\r\n    if (url.pathname === \"/api/irs/memo/latest\") {\r\n      return new Response(JSON.stringify({\r\n        source: \"irb\",\r\n        irs_id: \"IRB 2025-10\",\r\n        title: \"...\",\r\n        summary: \"...\",\r\n        full_text: \"...\",\r\n        published_at: \"...\",\r\n        url: \"...\",\r\n        tags: [\"EITC\", \"individual\"]\r\n      }), { headers: { \"Content-Type\": \"application/json\" } });\r\n    }\r\n\r\n    if (url.pathname === \"/api/irs/schema\") {\r\n      try {\r\n        const schema = await fetchIrsSchema();\r\n        return new Response(schema, { headers: { \"Content-Type\": \"application/xml\" } });\r\n      } catch (e) {\r\n        return new Response(\"Failed to fetch IRS schema\", { status: 500 });\r\n      }\r\n    }\r\n\r\n    if (url.pathname === \"/api/irs/memos\") {\r\n      try {\r\n        const memos = await fetchIrsMemos();\r\n        return new Response(memos, { headers: { \"Content-Type\": \"application/xml\" } });\r\n      } catch (e) {\r\n        return new Response(\"Failed to fetch IRS memos\", { status: 500 });\r\n      }\r\n    }\r\n\r\n    // --- Instagram API Endpoints ---\r\n    if (url.pathname === \"/api/instagram/feed\") {\r\n      return await handleInstagramFeed(env);\r\n    }\r\n    if (url.pathname === \"/api/instagram/reviews\") {\r\n      return await handleInstagramReviews(env);\r\n    }\r\n    if (url.pathname === \"/api/instagram/analytics\") {\r\n      return await handleInstagramAnalytics(env);\r\n    }\r\n    if (url.pathname === \"/api/instagram/post\" && req.method === \"POST\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      if (user.role !== \"admin\" && user.role !== \"staff\") return cors(forbidden());\r\n      return await handleInstagramPost(req, env, user);\r\n    }\r\n    if (url.pathname === \"/api/instagram/dm\" && req.method === \"POST\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      if (user.role !== \"admin\" && user.role !== \"staff\") return cors(forbidden());\r\n      return await handleInstagramDM(req, env, user);\r\n    }\r\n\r\n    // --- DocuSign Endpoints ---\r\n    if (url.pathname === \"/api/docusign/create-envelope\" && req.method === \"POST\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      if (user.role !== \"admin\" && user.role !== \"staff\") return cors(forbidden());\r\n      return await handleCreateEnvelope(req, env, user);\r\n    }\r\n    if (url.pathname === \"/api/docusign/embedded-url\" && req.method === \"POST\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      if (user.role !== \"admin\" && user.role !== \"staff\") return cors(forbidden());\r\n      return await handleEmbeddedSigningUrl(req, env, user);\r\n    }\r\n    if (url.pathname === \"/api/docusign/webhook\" && req.method === \"POST\") {\r\n      return await handleDocuSignWebhook(req, env);\r\n    }\r\n    if (url.pathname.startsWith(\"/api/signatures\")) {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      return await handleSignatures(req, env, user);\r\n    }\r\n\r\n    // --- Auth Endpoints ---\r\n    if (url.pathname === \"/register/staff\" && req.method === \"POST\") {\r\n      return cors(await handleRegisterStaff(req, env));\r\n    }\r\n    if (url.pathname === \"/register/client\" && req.method === \"POST\") {\r\n      return cors(await handleRegisterClient(req, env));\r\n    }\r\n    if (url.pathname === \"/login/staff\" && req.method === \"POST\") {\r\n      return cors(await handleLoginStaff(req, env));\r\n    }\r\n    if (url.pathname === \"/login/client\" && req.method === \"POST\") {\r\n      return cors(await handleLoginClient(req, env));\r\n    }\r\n\r\n    // --- Training API Endpoints ---\r\n    if (url.pathname === \"/api/training/courses\" && req.method === \"GET\") {\r\n      return await listTrainingCourses(req, env);\r\n    }\r\n    if (url.pathname === \"/api/training/enroll\" && req.method === \"POST\") {\r\n      return await enrollTrainingCourse(req, env);\r\n    }\r\n\r\n    // --- CRM API Endpoints (Staff/Admin only, encrypted PII) ---\r\n    if (url.pathname === \"/api/crm/intakes\" && req.method === \"GET\") {\r\n      return cors(await handleCrmIntakes(req, env));\r\n    }\r\n    if (url.pathname === \"/api/crm/intakes\" && req.method === \"POST\") {\r\n      return cors(await handleCrmIntakeCreate(req, env));\r\n    }\r\n    if (url.pathname.startsWith(\"/api/crm/intakes/\") && req.method === \"GET\") {\r\n      const id = url.pathname.split(\"/\").pop()!;\r\n      return cors(await handleCrmIntakeById(req, env, id));\r\n    }\r\n    if (url.pathname.startsWith(\"/api/crm/intakes/\") && req.method === \"DELETE\") {\r\n      const id = url.pathname.split(\"/\").pop()!;\r\n      return cors(await handleCrmIntakeDelete(req, env, id));\r\n    }\r\n\r\n    // --- Certificates & Licenses API Endpoints (Admin only) ---\r\n    if (url.pathname === \"/api/certificates/types\" && req.method === \"GET\") {\r\n      return cors(await handleCertificateTypes(req, env));\r\n    }\r\n    if (url.pathname === \"/api/certificates\" && req.method === \"GET\") {\r\n      return cors(await handleListCertificates(req, env));\r\n    }\r\n    if (url.pathname === \"/api/certificates/issue\" && req.method === \"POST\") {\r\n      return cors(await handleIssueCertificate(req, env));\r\n    }\r\n    if (url.pathname.match(/^\\/api\\/certificates\\/[^\\/]+\\/download$/) && req.method === \"GET\") {\r\n      const id = url.pathname.split(\"/\")[3];\r\n      return cors(await handleDownloadCertificate(req, env, id));\r\n    }\r\n    if (url.pathname.match(/^\\/api\\/certificates\\/[^\\/]+\\/revoke$/) && req.method === \"POST\") {\r\n      const id = url.pathname.split(\"/\")[3];\r\n      return cors(await handleRevokeCertificate(req, env, id));\r\n    }\r\n    if (url.pathname.match(/^\\/api\\/certificates\\/[^\\/]+$/) && req.method === \"GET\") {\r\n      const id = url.pathname.split(\"/\").pop()!;\r\n      return cors(await handleGetCertificate(req, env, id));\r\n    }\r\n\r\n    // --- Meet the Team API Endpoints ---\r\n    if (url.pathname === \"/api/team\" && req.method === \"GET\") {\r\n      return cors(await handleListTeam(req, env));\r\n    }\r\n    if (url.pathname === \"/api/team/regions\" && req.method === \"GET\") {\r\n      return cors(await handleListRegions(req, env));\r\n    }\r\n    if (url.pathname.match(/^\\/api\\/team\\/[^\\/]+$/) && req.method === \"GET\") {\r\n      const id = url.pathname.split(\"/\").pop()!;\r\n      return cors(await handleGetTeamMember(req, env, id));\r\n    }\r\n\r\n    // --- Compliance API Endpoints ---\r\n    if (url.pathname === \"/api/compliance/check\" && req.method === \"GET\") {\r\n      return cors(await handleComplianceCheck(req, env));\r\n    }\r\n    if (url.pathname === \"/api/compliance/requirements\" && req.method === \"GET\") {\r\n      return cors(await handleComplianceRequirements(req, env));\r\n    }\r\n    if (url.pathname === \"/api/compliance/issue-all\" && req.method === \"POST\") {\r\n      return cors(await handleIssueAllCertificates(req, env));\r\n    }\r\n    if (url.pathname === \"/api/compliance/report\" && req.method === \"GET\") {\r\n      return cors(await handleComplianceReport(req, env));\r\n    }\r\n\r\n    // --- Social Media Integration Endpoints ---\r\n    if (url.pathname === \"/api/social/post\" && req.method === \"POST\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      return cors(await handleSocialPost(req, env, user));\r\n    }\r\n    if (url.pathname === \"/api/social/feed\" && req.method === \"GET\") {\r\n      return cors(await handleSocialFeed(req, env));\r\n    }\r\n    if (url.pathname === \"/api/social/metrics\" && req.method === \"GET\") {\r\n      return cors(await handleSocialMetrics(req, env));\r\n    }\r\n    if (url.pathname === \"/api/social/schedule\" && req.method === \"POST\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      return cors(await handleSchedulePost(req, env, user));\r\n    }\r\n    if (url.pathname === \"/api/social/mentions\" && req.method === \"GET\") {\r\n      return cors(await handleSocialMentions(req, env));\r\n    }\r\n    if (url.pathname === \"/api/social/reply\" && req.method === \"POST\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      return cors(await handleSocialReply(req, env, user));\r\n    }\r\n\r\n    // --- Google Business Integration Endpoints ---\r\n    if (url.pathname === \"/api/social/google/reviews\" && req.method === \"GET\") {\r\n      return cors(await handleGoogleReviews(req, env));\r\n    }\r\n    if (url.pathname === \"/api/social/google/reply\" && req.method === \"POST\") {\r\n      const user = await verifyAuth(req, env);\r\n      if (!user) return cors(unauthorized());\r\n      return cors(await handleGoogleReplyReview(req, env, user));\r\n    }\r\n    if (url.pathname === \"/api/social/google/stats\" && req.method === \"GET\") {\r\n      return cors(await handleGoogleStats(req, env));\r\n    }\r\n\r\n\r\n\r\n    // --- Client Portal API Route (all /api/portal/* endpoints) ---\r\n    if (url.pathname.startsWith(\"/api/portal\")) {\r\n      const reqPath = url.pathname.replace(/^\\/api\\/portal/, \"\");\r\n      const portalReq = new Request(reqPath || \"/\", req);\r\n      Object.defineProperty(portalReq, \"params\", { value: {} });\r\n      const resp = await portalRouter.handle(portalReq, env);\r\n      return cors(resp);\r\n    }\r\n\r\n    // --- LMS API Route (all /api/lms/* endpoints) ---\r\n    if (url.pathname.startsWith(\"/api/lms\")) {\r\n      // itty-router expects the path only (no query)\r\n      const reqPath = url.pathname.replace(/^\\/api\\/lms/, \"\");\r\n      // Patch req.url for itty-router\r\n      const lmsReq = new Request(reqPath || \"/\", req);\r\n      // Attach params for itty-router\r\n      Object.defineProperty(lmsReq, \"params\", { value: {} });\r\n      // Route\r\n      const resp = await lmsRouter.handle(lmsReq, env);\r\n      return cors(resp);\r\n    }\r\n\r\n    // LMS Payment Gateway\r\n    if (url.pathname === \"/api/lms/payment\" && request.method === \"POST\") {\r\n      return await lmsPaymentRouter.handle(request, event.target.env);\r\n    }\r\n\r\n    return new Response(\"Not Found\", { status: 404 });\r\n  },\r\n\r\n  // Scheduled handler for IRS sync and data retention\r\n  async scheduled(event: any, env: any, ctx: any) {\r\n    console.log(\"Running scheduled tasks...\");\r\n    await handleScheduledIRSSync(env, ctx);\r\n    await handleAuditLogProcessing(env, ctx);\r\n  }\r\n};\r\n"],
  "mappings": "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AA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAC5D;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AACtC;AAOA,IAAI,SAAS;AAAA,EACX;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAC9D;AAUA,SAAS,UAAU,IAAI,KAAK,GAAG,GAAG;AAEhC,MAAI,GACF,IAAI,GAAG,GAAG,GACVC,KAAI,GAAG,MAAM,CAAC;AAEhB,OAAK,EAAE,CAAC;AAoBR,MAAI,EAAE,MAAM,EAAE;AACd,OAAK,EAAE,MAAU,KAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAU,KAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAAS,IAAI,GAAK;AACzB,EAAAA,MAAK,IAAI,EAAE,CAAC;AACZ,MAAI,EAAEA,OAAM,EAAE;AACd,OAAK,EAAE,MAAUA,MAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAUA,MAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAASA,KAAI,GAAK;AACzB,OAAK,IAAI,EAAE,CAAC;AAEZ,MAAI,EAAE,MAAM,EAAE;AACd,OAAK,EAAE,MAAU,KAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAU,KAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAAS,IAAI,GAAK;AACzB,EAAAA,MAAK,IAAI,EAAE,CAAC;AACZ,MAAI,EAAEA,OAAM,EAAE;AACd,OAAK,EAAE,MAAUA,MAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAUA,MAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAASA,KAAI,GAAK;AACzB,OAAK,IAAI,EAAE,CAAC;AAEZ,MAAI,EAAE,MAAM,EAAE;AACd,OAAK,EAAE,MAAU,KAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAU,KAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAAS,IAAI,GAAK;AACzB,EAAAA,MAAK,IAAI,EAAE,CAAC;AACZ,MAAI,EAAEA,OAAM,EAAE;AACd,OAAK,EAAE,MAAUA,MAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAUA,MAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAASA,KAAI,GAAK;AACzB,OAAK,IAAI,EAAE,CAAC;AAEZ,MAAI,EAAE,MAAM,EAAE;AACd,OAAK,EAAE,MAAU,KAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAU,KAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAAS,IAAI,GAAK;AACzB,EAAAA,MAAK,IAAI,EAAE,CAAC;AACZ,MAAI,EAAEA,OAAM,EAAE;AACd,OAAK,EAAE,MAAUA,MAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAUA,MAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAASA,KAAI,GAAK;AACzB,OAAK,IAAI,EAAE,CAAC;AAEZ,MAAI,EAAE,MAAM,EAAE;AACd,OAAK,EAAE,MAAU,KAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAU,KAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAAS,IAAI,GAAK;AACzB,EAAAA,MAAK,IAAI,EAAE,CAAC;AACZ,MAAI,EAAEA,OAAM,EAAE;AACd,OAAK,EAAE,MAAUA,MAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAUA,MAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAASA,KAAI,GAAK;AACzB,OAAK,IAAI,EAAE,EAAE;AAEb,MAAI,EAAE,MAAM,EAAE;AACd,OAAK,EAAE,MAAU,KAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAU,KAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAAS,IAAI,GAAK;AACzB,EAAAA,MAAK,IAAI,EAAE,EAAE;AACb,MAAI,EAAEA,OAAM,EAAE;AACd,OAAK,EAAE,MAAUA,MAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAUA,MAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAASA,KAAI,GAAK;AACzB,OAAK,IAAI,EAAE,EAAE;AAEb,MAAI,EAAE,MAAM,EAAE;AACd,OAAK,EAAE,MAAU,KAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAU,KAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAAS,IAAI,GAAK;AACzB,EAAAA,MAAK,IAAI,EAAE,EAAE;AACb,MAAI,EAAEA,OAAM,EAAE;AACd,OAAK,EAAE,MAAUA,MAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAUA,MAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAASA,KAAI,GAAK;AACzB,OAAK,IAAI,EAAE,EAAE;AAEb,MAAI,EAAE,MAAM,EAAE;AACd,OAAK,EAAE,MAAU,KAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAU,KAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAAS,IAAI,GAAK;AACzB,EAAAA,MAAK,IAAI,EAAE,EAAE;AACb,MAAI,EAAEA,OAAM,EAAE;AACd,OAAK,EAAE,MAAUA,MAAK,KAAM,GAAK;AACjC,OAAK,EAAE,MAAUA,MAAK,IAAK,GAAK;AAChC,OAAK,EAAE,MAASA,KAAI,GAAK;AACzB,OAAK,IAAI,EAAE,EAAE;AAEb,KAAG,GAAG,IAAIA,KAAI,EAAE,sBAAsB,CAAC;AACvC,KAAG,MAAM,CAAC,IAAI;AACd,SAAO;AACT;AArHS;AA6HT,SAAS,cAAc,MAAM,MAAM;AACjC,WAAS,IAAI,GAAG,OAAO,GAAG,IAAI,GAAG,EAAE;AACjC,IAAC,OAAQ,QAAQ,IAAM,KAAK,IAAI,IAAI,KACjC,QAAQ,OAAO,KAAK,KAAK;AAC9B,SAAO,EAAE,KAAK,MAAM,KAAW;AACjC;AALS;AAaT,SAAS,KAAK,KAAK,GAAG,GAAG;AACvB,MAAI,SAAS,GACX,KAAK,CAAC,GAAG,CAAC,GACV,OAAO,EAAE,QACT,OAAO,EAAE,QACT;AACF,WAAS,IAAI,GAAG,IAAI,MAAM;AACxB,IAAC,KAAK,cAAc,KAAK,MAAM,GAC5B,SAAS,GAAG,MACZ,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,GAAG;AACtB,OAAK,IAAI,GAAG,IAAI,MAAM,KAAK;AACzB,IAAC,KAAK,UAAU,IAAI,GAAG,GAAG,CAAC,GAAK,EAAE,CAAC,IAAI,GAAG,CAAC,GAAK,EAAE,IAAI,CAAC,IAAI,GAAG,CAAC;AACjE,OAAK,IAAI,GAAG,IAAI,MAAM,KAAK;AACzB,IAAC,KAAK,UAAU,IAAI,GAAG,GAAG,CAAC,GAAK,EAAE,CAAC,IAAI,GAAG,CAAC,GAAK,EAAE,IAAI,CAAC,IAAI,GAAG,CAAC;AACnE;AAdS;AAwBT,SAAS,QAAQ,MAAM,KAAK,GAAG,GAAG;AAChC,MAAI,OAAO,GACT,KAAK,CAAC,GAAG,CAAC,GACV,OAAO,EAAE,QACT,OAAO,EAAE,QACT;AACF,WAAS,IAAI,GAAG,IAAI,MAAM;AACxB,IAAC,KAAK,cAAc,KAAK,IAAI,GAAK,OAAO,GAAG,MAAQ,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,GAAG;AACvE,SAAO;AACP,OAAK,IAAI,GAAG,IAAI,MAAM,KAAK;AACzB,IAAC,KAAK,cAAc,MAAM,IAAI,GAC3B,OAAO,GAAG,MACV,GAAG,CAAC,KAAK,GAAG,KACZ,KAAK,cAAc,MAAM,IAAI,GAC7B,OAAO,GAAG,MACV,GAAG,CAAC,KAAK,GAAG,KACZ,KAAK,UAAU,IAAI,GAAG,GAAG,CAAC,GAC1B,EAAE,CAAC,IAAI,GAAG,CAAC,GACX,EAAE,IAAI,CAAC,IAAI,GAAG,CAAC;AACpB,OAAK,IAAI,GAAG,IAAI,MAAM,KAAK;AACzB,IAAC,KAAK,cAAc,MAAM,IAAI,GAC3B,OAAO,GAAG,MACV,GAAG,CAAC,KAAK,GAAG,KACZ,KAAK,cAAc,MAAM,IAAI,GAC7B,OAAO,GAAG,MACV,GAAG,CAAC,KAAK,GAAG,KACZ,KAAK,UAAU,IAAI,GAAG,GAAG,CAAC,GAC1B,EAAE,CAAC,IAAI,GAAG,CAAC,GACX,EAAE,IAAI,CAAC,IAAI,GAAG,CAAC;AACtB;AA7BS;AA0CT,SAAS,OAAO,GAAG,MAAM,QAAQ,UAAU,kBAAkB;AAC3D,MAAI,QAAQ,OAAO,MAAM,GACvB,OAAO,MAAM,QACb;AAGF,MAAI,SAAS,KAAK,SAAS,IAAI;AAC7B,UAAM,MAAM,sCAAsC,MAAM;AACxD,QAAI,UAAU;AACZ,eAAS,SAAS,KAAK,MAAM,GAAG,CAAC;AACjC;AAAA,IACF,MAAO,OAAM;AAAA,EACf;AACA,MAAI,KAAK,WAAW,iBAAiB;AACnC,UAAM;AAAA,MACJ,0BAA0B,KAAK,SAAS,SAAS;AAAA,IACnD;AACA,QAAI,UAAU;AACZ,eAAS,SAAS,KAAK,MAAM,GAAG,CAAC;AACjC;AAAA,IACF,MAAO,OAAM;AAAA,EACf;AACA,WAAU,KAAK,WAAY;AAE3B,MAAI,GACF,GACA,IAAI,GACJ;AAGF,MAAI,OAAO,eAAe,YAAY;AACpC,QAAI,IAAI,WAAW,MAAM;AACzB,QAAI,IAAI,WAAW,MAAM;AAAA,EAC3B,OAAO;AACL,QAAI,OAAO,MAAM;AACjB,QAAI,OAAO,MAAM;AAAA,EACnB;AAEA,UAAQ,MAAM,GAAG,GAAG,CAAC;AAOrB,WAAS,OAAO;AACd,QAAI,iBAAkB,kBAAiB,IAAI,MAAM;AACjD,QAAI,IAAI,QAAQ;AACd,UAAI,QAAQ,KAAK,IAAI;AACrB,aAAO,IAAI,UAAU;AACnB,YAAI,IAAI;AACR,aAAK,GAAG,GAAG,CAAC;AACZ,aAAK,MAAM,GAAG,CAAC;AACf,YAAI,KAAK,IAAI,IAAI,QAAQ,mBAAoB;AAAA,MAC/C;AAAA,IACF,OAAO;AACL,WAAK,IAAI,GAAG,IAAI,IAAI;AAClB,aAAK,IAAI,GAAG,IAAI,QAAQ,GAAG,IAAK,WAAU,OAAO,KAAK,GAAG,GAAG,CAAC;AAC/D,UAAI,MAAM,CAAC;AACX,WAAK,IAAI,GAAG,IAAI,MAAM;AACpB,YAAI,MAAO,MAAM,CAAC,KAAK,KAAM,SAAU,CAAC,GACtC,IAAI,MAAO,MAAM,CAAC,KAAK,KAAM,SAAU,CAAC,GACxC,IAAI,MAAO,MAAM,CAAC,KAAK,IAAK,SAAU,CAAC,GACvC,IAAI,MAAM,MAAM,CAAC,IAAI,SAAU,CAAC;AACpC,UAAI,UAAU;AACZ,iBAAS,MAAM,GAAG;AAClB;AAAA,MACF,MAAO,QAAO;AAAA,IAChB;AACA,QAAI,SAAU,UAAS,IAAI;AAAA,EAC7B;AAzBS;AA4BT,MAAI,OAAO,aAAa,aAAa;AACnC,SAAK;AAAA,EAGP,OAAO;AACL,QAAI;AACJ,WAAO,KAAM,KAAI,QAAQ,MAAM,KAAK,OAAO,YAAa,QAAO,OAAO,CAAC;AAAA,EACzE;AACF;AAjFS;AA6FT,SAAS,MAAM,UAAU,MAAM,UAAU,kBAAkB;AACzD,MAAI;AACJ,MAAI,OAAO,aAAa,YAAY,OAAO,SAAS,UAAU;AAC5D,UAAM,MAAM,qCAAqC;AACjD,QAAI,UAAU;AACZ,eAAS,SAAS,KAAK,MAAM,GAAG,CAAC;AACjC;AAAA,IACF,MAAO,OAAM;AAAA,EACf;AAGA,MAAI,OAAO;AACX,MAAI,KAAK,OAAO,CAAC,MAAM,OAAO,KAAK,OAAO,CAAC,MAAM,KAAK;AACpD,UAAM,MAAM,2BAA2B,KAAK,UAAU,GAAG,CAAC,CAAC;AAC3D,QAAI,UAAU;AACZ,eAAS,SAAS,KAAK,MAAM,GAAG,CAAC;AACjC;AAAA,IACF,MAAO,OAAM;AAAA,EACf;AACA,MAAI,KAAK,OAAO,CAAC,MAAM,IAAK,CAAC,QAAQ,OAAO,aAAa,CAAC,GAAK,SAAS;AAAA,OACnE;AACH,YAAQ,KAAK,OAAO,CAAC;AACrB,QACG,UAAU,OAAO,UAAU,OAAO,UAAU,OAC7C,KAAK,OAAO,CAAC,MAAM,KACnB;AACA,YAAM,MAAM,4BAA4B,KAAK,UAAU,GAAG,CAAC,CAAC;AAC5D,UAAI,UAAU;AACZ,iBAAS,SAAS,KAAK,MAAM,GAAG,CAAC;AACjC;AAAA,MACF,MAAO,OAAM;AAAA,IACf;AACA,aAAS;AAAA,EACX;AAGA,MAAI,KAAK,OAAO,SAAS,CAAC,IAAI,KAAK;AACjC,UAAM,MAAM,qBAAqB;AACjC,QAAI,UAAU;AACZ,eAAS,SAAS,KAAK,MAAM,GAAG,CAAC;AACjC;AAAA,IACF,MAAO,OAAM;AAAA,EACf;AACA,MAAI,KAAK,SAAS,KAAK,UAAU,QAAQ,SAAS,CAAC,GAAG,EAAE,IAAI,IAC1D,KAAK,SAAS,KAAK,UAAU,SAAS,GAAG,SAAS,CAAC,GAAG,EAAE,GACxD,SAAS,KAAK,IACd,YAAY,KAAK,UAAU,SAAS,GAAG,SAAS,EAAE;AACpD,cAAY,SAAS,MAAM,OAAS;AAEpC,MAAI,YAAY,UAAU,QAAQ,GAChC,QAAQ,cAAc,WAAW,eAAe;AAQlD,WAAS,OAAO,OAAO;AACrB,QAAI,MAAM,CAAC;AACX,QAAI,KAAK,IAAI;AACb,QAAI,SAAS,IAAK,KAAI,KAAK,KAAK;AAChC,QAAI,KAAK,GAAG;AACZ,QAAI,SAAS,GAAI,KAAI,KAAK,GAAG;AAC7B,QAAI,KAAK,OAAO,SAAS,CAAC;AAC1B,QAAI,KAAK,GAAG;AACZ,QAAI,KAAK,cAAc,OAAO,MAAM,MAAM,CAAC;AAC3C,QAAI,KAAK,cAAc,OAAO,OAAO,SAAS,IAAI,CAAC,CAAC;AACpD,WAAO,IAAI,KAAK,EAAE;AAAA,EACpB;AAXS;AAcT,MAAI,OAAO,YAAY;AACrB,WAAO,OAAO,OAAO,WAAW,OAAO,MAAM,CAAC;AAAA,OAE3C;AACH;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA,SAAUC,MAAK,OAAO;AACpB,YAAIA,KAAK,UAASA,MAAK,IAAI;AAAA,YACtB,UAAS,MAAM,OAAO,KAAK,CAAC;AAAA,MACnC;AAAA,MACA;AAAA,IACF;AAAA,EACF;AACF;AAvFS;AAgGF,SAAS,aAAa,OAAO,QAAQ;AAC1C,SAAO,cAAc,OAAO,MAAM;AACpC;AAFgB;AAWT,SAAS,aAAa,QAAQ,QAAQ;AAC3C,SAAO,cAAc,QAAQ,MAAM;AACrC;AAFgB;AAIhB,IAAO,mBAAQ;AAAA,EACb;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;;;AC9nCI,IAAM,aAAa,wBAAC,QAAM;AAC1B,QAAM,MAAM,IAAI,YAAY,CAAC;AAC7B,QAAM,MAAM,IAAI,WAAW,GAAG;AAC9B,MAAI,MAAM;AACV,WAAQ,IAAI,GAAG,KAAK,GAAG,KAAI;AACvB,QAAI,QAAQ,EAAG;AACf,QAAI,CAAC,IAAI,MAAM;AACf,WAAO,IAAI,CAAC;AACZ,WAAO;AAAA,EACX;AACA,SAAO;AACX,GAXuB;AAsB+D,SAAS,QAAQ,GAAG;AACtG,SAAO,aAAa,cAAc,YAAY,OAAO,CAAC,KAAK,EAAE,YAAY,SAAS;AACtF;AAF+F;AAGjD,SAAS,QAAQ,GAAG;AAC9D,MAAI,CAAC,OAAO,cAAc,CAAC,KAAK,IAAI,EAAG,OAAM,IAAI,MAAM,oCAAoC,CAAC;AAChG;AAFuD;AAGf,SAAS,OAAO,MAAM,SAAS;AACnE,MAAI,CAAC,QAAQ,CAAC,EAAG,OAAM,IAAI,MAAM,qBAAqB;AACtD,MAAI,QAAQ,SAAS,KAAK,CAAC,QAAQ,SAAS,EAAE,MAAM,EAAG,OAAM,IAAI,MAAM,mCAAmC,UAAU,kBAAkB,EAAE,MAAM;AAClJ;AAHiD;AAIhB,SAAS,MAAMC,IAAG;AAC/C,MAAI,OAAOA,OAAM,cAAc,OAAOA,GAAE,WAAW,WAAY,OAAM,IAAI,MAAM,8CAA8C;AAC7H,UAAQA,GAAE,SAAS;AACnB,UAAQA,GAAE,QAAQ;AACtB;AAJ0C;AAKuB,SAAS,QAAQ,UAAU,gBAAgB,MAAM;AAC9G,MAAI,SAAS,UAAW,OAAM,IAAI,MAAM,kCAAkC;AAC1E,MAAI,iBAAiB,SAAS,SAAU,OAAM,IAAI,MAAM,uCAAuC;AACnG;AAH0E;AAIvB,SAAS,QAAQ,KAAK,UAAU;AAC/E,SAAO,GAAG;AACV,QAAM,MAAM,SAAS;AACrB,MAAI,IAAI,SAAS,KAAK;AAClB,UAAM,IAAI,MAAM,2DAA2D,GAAG;AAAA,EAClF;AACJ;AAN4D;AAOzB,SAAS,IAAI,KAAK;AACjD,SAAO,IAAI,YAAY,IAAI,QAAQ,IAAI,YAAY,KAAK,MAAM,IAAI,aAAa,CAAC,CAAC;AACrF;AAF4C;AAGqB,SAAS,SAAS,QAAQ;AACvF,WAAQ,IAAI,GAAG,IAAI,OAAO,QAAQ,KAAI;AAClC,WAAO,CAAC,EAAE,KAAK,CAAC;AAAA,EACpB;AACJ;AAJ0E;AAKL,SAAS,WAAW,KAAK;AAC1F,SAAO,IAAI,SAAS,IAAI,QAAQ,IAAI,YAAY,IAAI,UAAU;AAClE;AAF8E;AAGV,SAAS,KAAK,MAAM,OAAO;AAC3F,SAAO,QAAQ,KAAK,QAAQ,SAAS;AACzC;AAF6E;AAGX,SAAS,KAAK,MAAM,OAAO;AACzF,SAAO,QAAQ,QAAQ,SAAS,KAAK,UAAU;AACnD;AAF2E;AAGE,IAAM,OAAwB,uBAAI,IAAI,WAAW,IAAI,YAAY;AAAA,EACtI;AACJ,CAAC,EAAE,MAAM,EAAE,CAAC,MAAM,IAAM;AACc,SAAS,SAAS,MAAM;AAC9D,SAAO,QAAQ,KAAK,aAAa,QAAQ,IAAI,WAAW,SAAS,IAAI,QAAS,SAAS,KAAK;AAChG;AAFmD;AAGT,SAAS,WAAW,KAAK;AAC/D,WAAQ,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAI;AAC/B,QAAI,CAAC,IAAI,SAAS,IAAI,CAAC,CAAC;AAAA,EAC5B;AACA,SAAO;AACX;AALmD;AAMnD,IAAM,aAAa,OAAO,CAACC,OAAIA,KAAI;AAI/B,SAAS,YAAY,KAAK;AAC1B,MAAI,OAAO,QAAQ,SAAU,OAAM,IAAI,MAAM,iBAAiB;AAC9D,SAAO,IAAI,WAAW,IAAI,YAAY,EAAE,OAAO,GAAG,CAAC;AACvD;AAHa;AAQT,SAAS,QAAQ,MAAM;AACvB,MAAI,OAAO,SAAS,SAAU,QAAO,YAAY,IAAI;AACrD,SAAO,IAAI;AACX,SAAO;AACX;AAJa;AAK0C,IAAM,OAAN,MAAW;AAAA,EAtGlE,OAsGkE;AAAA;AAAA;AAClE;AAC+D,SAAS,aAAa,UAAU;AAC3F,QAAM,QAAQ,wBAAC,QAAM,SAAS,EAAE,OAAO,QAAQ,GAAG,CAAC,EAAE,OAAO,GAA9C;AACd,QAAM,MAAM,SAAS;AACrB,QAAM,YAAY,IAAI;AACtB,QAAM,WAAW,IAAI;AACrB,QAAM,SAAS,MAAI,SAAS;AAC5B,SAAO;AACX;AAPwE;AASxE,IAAM,OAAN,cAAmB,KAAK;AAAA,EAjHxB,OAiHwB;AAAA;AAAA;AAAA,EACpB,OAAO,KAAK;AACR,YAAQ,IAAI;AACZ,SAAK,MAAM,OAAO,GAAG;AACrB,WAAO;AAAA,EACX;AAAA,EACA,WAAW,KAAK;AACZ,YAAQ,IAAI;AACZ,WAAO,KAAK,KAAK,SAAS;AAC1B,SAAK,WAAW;AAChB,SAAK,MAAM,WAAW,GAAG;AACzB,SAAK,MAAM,OAAO,GAAG;AACrB,SAAK,MAAM,WAAW,GAAG;AACzB,SAAK,QAAQ;AAAA,EACjB;AAAA,EACA,SAAS;AACL,UAAM,MAAM,IAAI,WAAW,KAAK,MAAM,SAAS;AAC/C,SAAK,WAAW,GAAG;AACnB,WAAO;AAAA,EACX;AAAA,EACA,WAAW,IAAI;AAEX,WAAO,KAAK,OAAO,OAAO,OAAO,eAAe,IAAI,GAAG,CAAC,CAAC;AACzD,UAAM,EAAE,OAAO,OAAO,UAAU,WAAW,UAAU,UAAU,IAAI;AACnE,SAAK;AACL,OAAG,WAAW;AACd,OAAG,YAAY;AACf,OAAG,WAAW;AACd,OAAG,YAAY;AACf,OAAG,QAAQ,MAAM,WAAW,GAAG,KAAK;AACpC,OAAG,QAAQ,MAAM,WAAW,GAAG,KAAK;AACpC,WAAO;AAAA,EACX;AAAA,EACA,QAAQ;AACJ,WAAO,KAAK,WAAW;AAAA,EAC3B;AAAA,EACA,UAAU;AACN,SAAK,YAAY;AACjB,SAAK,MAAM,QAAQ;AACnB,SAAK,MAAM,QAAQ;AAAA,EACvB;AAAA,EACA,YAAYC,OAAMC,OAAK;AACnB,UAAM;AACN,SAAK,WAAW;AAChB,SAAK,YAAY;AACjB,UAAMD,KAAI;AACV,UAAM,MAAM,QAAQC,KAAI;AACxB,SAAK,QAAQD,MAAK,OAAO;AACzB,QAAI,OAAO,KAAK,MAAM,WAAW,WAAY,OAAM,IAAI,MAAM,qDAAqD;AAClH,SAAK,WAAW,KAAK,MAAM;AAC3B,SAAK,YAAY,KAAK,MAAM;AAC5B,UAAM,WAAW,KAAK;AACtB,UAAM,MAAM,IAAI,WAAW,QAAQ;AAEnC,QAAI,IAAI,IAAI,SAAS,WAAWA,MAAK,OAAO,EAAE,OAAO,GAAG,EAAE,OAAO,IAAI,GAAG;AACxE,aAAQ,IAAI,GAAG,IAAI,IAAI,QAAQ,IAAI,KAAI,CAAC,KAAK;AAC7C,SAAK,MAAM,OAAO,GAAG;AAErB,SAAK,QAAQA,MAAK,OAAO;AAEzB,aAAQ,IAAI,GAAG,IAAI,IAAI,QAAQ,IAAI,KAAI,CAAC,KAAK,KAAO;AACpD,SAAK,MAAM,OAAO,GAAG;AACrB,UAAM,GAAG;AAAA,EACb;AACJ;AAUI,IAAM,OAAO,wBAACA,OAAM,KAAK,YAAU,IAAI,KAAKA,OAAM,GAAG,EAAE,OAAO,OAAO,EAAE,OAAO,GAAjE;AACjB,KAAK,SAAS,CAACA,OAAM,QAAM,IAAI,KAAKA,OAAM,GAAG;AAEoD,SAAS,aAAa,MAAM,YAAY,OAAOE,OAAM;AAClJ,MAAI,OAAO,KAAK,iBAAiB,WAAY,QAAO,KAAK,aAAa,YAAY,OAAOA,KAAI;AAC7F,QAAMC,QAAO,OAAO,EAAE;AACtB,QAAM,WAAW,OAAO,UAAU;AAClC,QAAM,KAAK,OAAO,SAASA,QAAO,QAAQ;AAC1C,QAAM,KAAK,OAAO,QAAQ,QAAQ;AAClC,QAAML,KAAII,QAAO,IAAI;AACrB,QAAM,IAAIA,QAAO,IAAI;AACrB,OAAK,UAAU,aAAaJ,IAAG,IAAII,KAAI;AACvC,OAAK,UAAU,aAAa,GAAG,IAAIA,KAAI;AAC3C;AAV0G;AAWjF,SAAS,IAAI,GAAG,GAAG,GAAG;AAC3C,SAAO,IAAI,IAAI,CAAC,IAAI;AACxB;AAFkC;AAGwB,SAAS,IAAI,GAAG,GAAG,GAAG;AAC5E,SAAO,IAAI,IAAI,IAAI,IAAI,IAAI;AAC/B;AAFmE;AAM/D,IAAM,SAAN,cAAqB,KAAK;AAAA,EAlN9B,OAkN8B;AAAA;AAAA;AAAA,EAC1B,OAAO,MAAM;AACT,YAAQ,IAAI;AACZ,WAAO,QAAQ,IAAI;AACnB,WAAO,IAAI;AACX,UAAM,EAAE,MAAM,QAAQ,SAAS,IAAI;AACnC,UAAM,MAAM,KAAK;AACjB,aAAQ,MAAM,GAAG,MAAM,OAAK;AACxB,YAAM,OAAO,KAAK,IAAI,WAAW,KAAK,KAAK,MAAM,GAAG;AAEpD,UAAI,SAAS,UAAU;AACnB,cAAM,WAAW,WAAW,IAAI;AAChC,eAAM,YAAY,MAAM,KAAK,OAAO,SAAS,MAAK,QAAQ,UAAU,GAAG;AACvE;AAAA,MACJ;AACA,aAAO,IAAI,KAAK,SAAS,KAAK,MAAM,IAAI,GAAG,KAAK,GAAG;AACnD,WAAK,OAAO;AACZ,aAAO;AACP,UAAI,KAAK,QAAQ,UAAU;AACvB,aAAK,QAAQ,MAAM,CAAC;AACpB,aAAK,MAAM;AAAA,MACf;AAAA,IACJ;AACA,SAAK,UAAU,KAAK;AACpB,SAAK,WAAW;AAChB,WAAO;AAAA,EACX;AAAA,EACA,WAAW,KAAK;AACZ,YAAQ,IAAI;AACZ,YAAQ,KAAK,IAAI;AACjB,SAAK,WAAW;AAIhB,UAAM,EAAE,QAAQ,MAAM,UAAU,MAAAA,MAAK,IAAI;AACzC,QAAI,EAAE,IAAI,IAAI;AAEd,WAAO,KAAK,IAAI;AAChB,UAAM,KAAK,OAAO,SAAS,GAAG,CAAC;AAG/B,QAAI,KAAK,YAAY,WAAW,KAAK;AACjC,WAAK,QAAQ,MAAM,CAAC;AACpB,YAAM;AAAA,IACV;AAEA,aAAQ,IAAI,KAAK,IAAI,UAAU,IAAI,QAAO,CAAC,IAAI;AAI/C,iBAAa,MAAM,WAAW,GAAG,OAAO,KAAK,SAAS,CAAC,GAAGA,KAAI;AAC9D,SAAK,QAAQ,MAAM,CAAC;AACpB,UAAM,QAAQ,WAAW,GAAG;AAC5B,UAAM,MAAM,KAAK;AAEjB,QAAI,MAAM,EAAG,OAAM,IAAI,MAAM,6CAA6C;AAC1E,UAAM,SAAS,MAAM;AACrB,UAAM,QAAQ,KAAK,IAAI;AACvB,QAAI,SAAS,MAAM,OAAQ,OAAM,IAAI,MAAM,oCAAoC;AAC/E,aAAQ,IAAI,GAAG,IAAI,QAAQ,IAAI,OAAM,UAAU,IAAI,GAAG,MAAM,CAAC,GAAGA,KAAI;AAAA,EACxE;AAAA,EACA,SAAS;AACL,UAAM,EAAE,QAAQ,UAAU,IAAI;AAC9B,SAAK,WAAW,MAAM;AACtB,UAAM,MAAM,OAAO,MAAM,GAAG,SAAS;AACrC,SAAK,QAAQ;AACb,WAAO;AAAA,EACX;AAAA,EACA,WAAW,IAAI;AACX,WAAO,KAAK,IAAI,KAAK,YAAY;AACjC,OAAG,IAAI,GAAG,KAAK,IAAI,CAAC;AACpB,UAAM,EAAE,UAAU,QAAQ,QAAQ,UAAU,WAAW,IAAI,IAAI;AAC/D,OAAG,YAAY;AACf,OAAG,WAAW;AACd,OAAG,SAAS;AACZ,OAAG,MAAM;AACT,QAAI,SAAS,SAAU,IAAG,OAAO,IAAI,MAAM;AAC3C,WAAO;AAAA,EACX;AAAA,EACA,QAAQ;AACJ,WAAO,KAAK,WAAW;AAAA,EAC3B;AAAA,EACA,YAAY,UAAU,WAAW,WAAWA,OAAK;AAC7C,UAAM;AACN,SAAK,WAAW;AAChB,SAAK,SAAS;AACd,SAAK,MAAM;AACX,SAAK,YAAY;AACjB,SAAK,WAAW;AAChB,SAAK,YAAY;AACjB,SAAK,YAAY;AACjB,SAAK,OAAOA;AACZ,SAAK,SAAS,IAAI,WAAW,QAAQ;AACrC,SAAK,OAAO,WAAW,KAAK,MAAM;AAAA,EACtC;AACJ;AAIiF,IAAM,YAA4B,4BAAY,KAAK;AAAA,EAChI;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACJ,CAAC;AAC8E,IAAM,YAA4B,4BAAY,KAAK;AAAA,EAC9H;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACJ,CAAC;AAC6E,IAAM,YAA4B,4BAAY,KAAK;AAAA,EAC7H;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACJ,CAAC;AAC4E,IAAM,YAA4B,4BAAY,KAAK;AAAA,EAC5H;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACJ,CAAC;AAEyB,IAAM,UAA0B,4BAAY,KAAK;AAAA,EACvE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACJ,CAAC;AAED,IAAM,SAAyB,oBAAI,YAAY,EAAE;AAClB,IAAM,OAAN,cAAmB,OAAO;AAAA,EAvXzD,OAuXyD;AAAA;AAAA;AAAA,EACrD,MAAM;AACF,UAAM,EAAE,GAAG,GAAG,GAAG,GAAG,EAAE,IAAI;AAC1B,WAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACJ;AAAA,EACJ;AAAA,EACA,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG;AACf,SAAK,IAAI,IAAI;AACb,SAAK,IAAI,IAAI;AACb,SAAK,IAAI,IAAI;AACb,SAAK,IAAI,IAAI;AACb,SAAK,IAAI,IAAI;AAAA,EACjB;AAAA,EACA,QAAQ,MAAM,QAAQ;AAClB,aAAQ,IAAI,GAAG,IAAI,IAAI,KAAK,UAAU,EAAE,QAAO,CAAC,IAAI,KAAK,UAAU,QAAQ,KAAK;AAChF,aAAQ,IAAI,IAAI,IAAI,IAAI,IAAI,QAAO,CAAC,IAAI,KAAK,OAAO,IAAI,CAAC,IAAI,OAAO,IAAI,CAAC,IAAI,OAAO,IAAI,EAAE,IAAI,OAAO,IAAI,EAAE,GAAG,CAAC;AAE/G,QAAI,EAAE,GAAG,GAAG,GAAG,GAAG,EAAE,IAAI;AACxB,aAAQ,IAAI,GAAG,IAAI,IAAI,KAAI;AACvB,UAAI,GAAG;AACP,UAAI,IAAI,IAAI;AACR,YAAI,IAAI,GAAG,GAAG,CAAC;AACf,YAAI;AAAA,MACR,WAAW,IAAI,IAAI;AACf,YAAI,IAAI,IAAI;AACZ,YAAI;AAAA,MACR,WAAW,IAAI,IAAI;AACf,YAAI,IAAI,GAAG,GAAG,CAAC;AACf,YAAI;AAAA,MACR,OAAO;AACH,YAAI,IAAI,IAAI;AACZ,YAAI;AAAA,MACR;AACA,YAAM,IAAI,KAAK,GAAG,CAAC,IAAI,IAAI,IAAI,IAAI,OAAO,CAAC,IAAI;AAC/C,UAAI;AACJ,UAAI;AACJ,UAAI,KAAK,GAAG,EAAE;AACd,UAAI;AACJ,UAAI;AAAA,IACR;AAEA,QAAI,IAAI,KAAK,IAAI;AACjB,QAAI,IAAI,KAAK,IAAI;AACjB,QAAI,IAAI,KAAK,IAAI;AACjB,QAAI,IAAI,KAAK,IAAI;AACjB,QAAI,IAAI,KAAK,IAAI;AACjB,SAAK,IAAI,GAAG,GAAG,GAAG,GAAG,CAAC;AAAA,EAC1B;AAAA,EACA,aAAa;AACT,UAAM,MAAM;AAAA,EAChB;AAAA,EACA,UAAU;AACN,SAAK,IAAI,GAAG,GAAG,GAAG,GAAG,CAAC;AACtB,UAAM,KAAK,MAAM;AAAA,EACrB;AAAA,EACA,cAAa;AACT,UAAM,IAAI,IAAI,GAAG,KAAK;AACtB,SAAK,IAAI,QAAQ,CAAC,IAAI;AACtB,SAAK,IAAI,QAAQ,CAAC,IAAI;AACtB,SAAK,IAAI,QAAQ,CAAC,IAAI;AACtB,SAAK,IAAI,QAAQ,CAAC,IAAI;AACtB,SAAK,IAAI,QAAQ,CAAC,IAAI;AAAA,EAC1B;AACJ;AAC8E,IAAM,OAAuB,6BAAa,MAAI,IAAI,KAAK,CAAC;AAMlI,IAAM,aAA6B,uBAAO,KAAK,KAAK,CAAC;AACzD,IAAM,OAAuB,uBAAO,EAAE;AACtC,SAAS,QAAQ,GAAG,KAAK,OAAO;AAC5B,MAAI,GAAI,QAAO;AAAA,IACX,GAAG,OAAO,IAAI,UAAU;AAAA,IACxB,GAAG,OAAO,KAAK,OAAO,UAAU;AAAA,EACpC;AACA,SAAO;AAAA,IACH,GAAG,OAAO,KAAK,OAAO,UAAU,IAAI;AAAA,IACpC,GAAG,OAAO,IAAI,UAAU,IAAI;AAAA,EAChC;AACJ;AATS;AAUT,SAAS,MAAM,KAAK,KAAK,OAAO;AAC5B,QAAM,MAAM,IAAI;AAChB,MAAI,KAAK,IAAI,YAAY,GAAG;AAC5B,MAAI,KAAK,IAAI,YAAY,GAAG;AAC5B,WAAQ,IAAI,GAAG,IAAI,KAAK,KAAI;AACxB,UAAM,EAAE,GAAAJ,IAAG,EAAE,IAAI,QAAQ,IAAI,CAAC,GAAG,EAAE;AACnC,KAAC,GAAG,CAAC,GAAG,GAAG,CAAC,CAAC,IAAI;AAAA,MACbA;AAAA,MACA;AAAA,IACJ;AAAA,EACJ;AACA,SAAO;AAAA,IACH;AAAA,IACA;AAAA,EACJ;AACJ;AAfS;AAiBT,IAAM,QAAQ,wBAACA,IAAG,IAAI,MAAIA,OAAM,GAAlB;AACd,IAAM,QAAQ,wBAACA,IAAG,GAAG,MAAIA,MAAK,KAAK,IAAI,MAAM,GAA/B;AAEd,IAAM,SAAS,wBAACA,IAAG,GAAG,MAAIA,OAAM,IAAI,KAAK,KAAK,GAA/B;AACf,IAAM,SAAS,wBAACA,IAAG,GAAG,MAAIA,MAAK,KAAK,IAAI,MAAM,GAA/B;AAEf,IAAM,SAAS,wBAACA,IAAG,GAAG,MAAIA,MAAK,KAAK,IAAI,MAAM,IAAI,IAAnC;AACf,IAAM,SAAS,wBAACA,IAAG,GAAG,MAAIA,OAAM,IAAI,KAAK,KAAK,KAAK,GAApC;AAEf,IAAM,SAAS,wBAACA,IAAG,GAAG,MAAIA,MAAK,IAAI,MAAM,KAAK,GAA/B;AACf,IAAM,SAAS,wBAACA,IAAG,GAAG,MAAI,KAAK,IAAIA,OAAM,KAAK,GAA/B;AAEf,IAAM,SAAS,wBAACA,IAAG,GAAG,MAAI,KAAK,IAAI,KAAKA,OAAM,KAAK,GAApC;AACf,IAAM,SAAS,wBAACA,IAAG,GAAG,MAAIA,MAAK,IAAI,KAAK,MAAM,KAAK,GAApC;AAGf,SAAS,IAAI,IAAI,IAAI,IAAI,IAAI;AACzB,QAAM,KAAK,OAAO,MAAM,OAAO;AAC/B,SAAO;AAAA,IACH,GAAG,KAAK,MAAM,IAAI,KAAK,KAAK,KAAK;AAAA,IACjC,GAAG,IAAI;AAAA,EACX;AACJ;AANS;AAQT,IAAM,QAAQ,wBAAC,IAAI,IAAI,QAAM,OAAO,MAAM,OAAO,MAAM,OAAO,IAAhD;AACd,IAAM,QAAQ,wBAAC,KAAK,IAAI,IAAI,OAAK,KAAK,KAAK,MAAM,MAAM,KAAK,KAAK,KAAK,GAAxD;AACd,IAAM,QAAQ,wBAAC,IAAI,IAAI,IAAI,QAAM,OAAO,MAAM,OAAO,MAAM,OAAO,MAAM,OAAO,IAAjE;AACd,IAAM,QAAQ,wBAAC,KAAK,IAAI,IAAI,IAAI,OAAK,KAAK,KAAK,KAAK,MAAM,MAAM,KAAK,KAAK,KAAK,GAAjE;AACd,IAAM,QAAQ,wBAAC,IAAI,IAAI,IAAI,IAAI,QAAM,OAAO,MAAM,OAAO,MAAM,OAAO,MAAM,OAAO,MAAM,OAAO,IAAlF;AACd,IAAM,QAAQ,wBAAC,KAAK,IAAI,IAAI,IAAI,IAAI,OAAK,KAAK,KAAK,KAAK,KAAK,MAAM,MAAM,KAAK,KAAK,KAAK,GAA1E;AAMd,IAAM,WAA2B,4BAAY,KAAK;AAAA,EAC9C;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACJ,CAAC;AAC+D,IAAM,WAA2B,oBAAI,YAAY,EAAE;AACnH,IAAM,SAAN,cAAqB,OAAO;AAAA,EArkB5B,OAqkB4B;AAAA;AAAA;AAAA,EACxB,MAAM;AACF,UAAM,EAAE,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE,IAAI;AACnC,WAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACJ;AAAA,EACJ;AAAA;AAAA,EAEA,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG;AACxB,SAAK,IAAI,IAAI;AACb,SAAK,IAAI,IAAI;AACb,SAAK,IAAI,IAAI;AACb,SAAK,IAAI,IAAI;AACb,SAAK,IAAI,IAAI;AACb,SAAK,IAAI,IAAI;AACb,SAAK,IAAI,IAAI;AACb,SAAK,IAAI,IAAI;AAAA,EACjB;AAAA,EACA,QAAQ,MAAM,QAAQ;AAElB,aAAQ,IAAI,GAAG,IAAI,IAAI,KAAK,UAAU,EAAE,UAAS,CAAC,IAAI,KAAK,UAAU,QAAQ,KAAK;AAClF,aAAQ,IAAI,IAAI,IAAI,IAAI,KAAI;AACxB,YAAM,MAAM,SAAS,IAAI,EAAE;AAC3B,YAAM,KAAK,SAAS,IAAI,CAAC;AACzB,YAAM,KAAK,KAAK,KAAK,CAAC,IAAI,KAAK,KAAK,EAAE,IAAI,QAAQ;AAClD,YAAM,KAAK,KAAK,IAAI,EAAE,IAAI,KAAK,IAAI,EAAE,IAAI,OAAO;AAChD,eAAS,CAAC,IAAI,KAAK,SAAS,IAAI,CAAC,IAAI,KAAK,SAAS,IAAI,EAAE,IAAI;AAAA,IACjE;AAEA,QAAI,EAAE,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,EAAE,IAAI;AACjC,aAAQ,IAAI,GAAG,IAAI,IAAI,KAAI;AACvB,YAAM,SAAS,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,EAAE,IAAI,KAAK,GAAG,EAAE;AACpD,YAAM,KAAK,IAAI,SAAS,IAAI,GAAG,GAAG,CAAC,IAAI,SAAS,CAAC,IAAI,SAAS,CAAC,IAAI;AACnE,YAAM,SAAS,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,EAAE,IAAI,KAAK,GAAG,EAAE;AACpD,YAAM,KAAK,SAAS,IAAI,GAAG,GAAG,CAAC,IAAI;AACnC,UAAI;AACJ,UAAI;AACJ,UAAI;AACJ,UAAI,IAAI,KAAK;AACb,UAAI;AACJ,UAAI;AACJ,UAAI;AACJ,UAAI,KAAK,KAAK;AAAA,IAClB;AAEA,QAAI,IAAI,KAAK,IAAI;AACjB,QAAI,IAAI,KAAK,IAAI;AACjB,QAAI,IAAI,KAAK,IAAI;AACjB,QAAI,IAAI,KAAK,IAAI;AACjB,QAAI,IAAI,KAAK,IAAI;AACjB,QAAI,IAAI,KAAK,IAAI;AACjB,QAAI,IAAI,KAAK,IAAI;AACjB,QAAI,IAAI,KAAK,IAAI;AACjB,SAAK,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,CAAC;AAAA,EACnC;AAAA,EACA,aAAa;AACT,UAAM,QAAQ;AAAA,EAClB;AAAA,EACA,UAAU;AACN,SAAK,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,CAAC;AAC/B,UAAM,KAAK,MAAM;AAAA,EACrB;AAAA,EACA,YAAY,YAAY,IAAG;AACvB,UAAM,IAAI,WAAW,GAAG,KAAK;AAG7B,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AAAA,EAC5B;AACJ;AACA,IAAM,SAAN,cAAqB,OAAO;AAAA,EAxpB5B,OAwpB4B;AAAA;AAAA;AAAA,EACxB,cAAa;AACT,UAAM,EAAE;AACR,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AACxB,SAAK,IAAI,UAAU,CAAC,IAAI;AAAA,EAC5B;AACJ;AAKA,IAAM,OAAwB,uBAAI,MAAM;AAAA,EAChC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACJ,EAAE,IAAI,CAAC,MAAI,OAAO,CAAC,CAAC,CAAC,GAAG;AAC5B,IAAM,YAA6B,uBAAI,KAAK,CAAC,GAAG;AAChD,IAAM,YAA6B,uBAAI,KAAK,CAAC,GAAG;AAEhD,IAAM,aAA6B,oBAAI,YAAY,EAAE;AACrD,IAAM,aAA6B,oBAAI,YAAY,EAAE;AACrD,IAAM,SAAN,cAAqB,OAAO;AAAA,EAhwB5B,OAgwB4B;AAAA;AAAA;AAAA;AAAA,EAExB,MAAM;AACF,UAAM,EAAE,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI;AAC3E,WAAO;AAAA,MACH;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACJ;AAAA,EACJ;AAAA;AAAA,EAEA,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI;AAChE,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AACf,SAAK,KAAK,KAAK;AAAA,EACnB;AAAA,EACA,QAAQ,MAAM,QAAQ;AAElB,aAAQ,IAAI,GAAG,IAAI,IAAI,KAAK,UAAU,GAAE;AACpC,iBAAW,CAAC,IAAI,KAAK,UAAU,MAAM;AACrC,iBAAW,CAAC,IAAI,KAAK,UAAU,UAAU,CAAC;AAAA,IAC9C;AACA,aAAQ,IAAI,IAAI,IAAI,IAAI,KAAI;AAExB,YAAM,OAAO,WAAW,IAAI,EAAE,IAAI;AAClC,YAAM,OAAO,WAAW,IAAI,EAAE,IAAI;AAClC,YAAM,MAAM,OAAO,MAAM,MAAM,CAAC,IAAI,OAAO,MAAM,MAAM,CAAC,IAAI,MAAM,MAAM,MAAM,CAAC;AAC/E,YAAM,MAAM,OAAO,MAAM,MAAM,CAAC,IAAI,OAAO,MAAM,MAAM,CAAC,IAAI,MAAM,MAAM,MAAM,CAAC;AAE/E,YAAM,MAAM,WAAW,IAAI,CAAC,IAAI;AAChC,YAAM,MAAM,WAAW,IAAI,CAAC,IAAI;AAChC,YAAM,MAAM,OAAO,KAAK,KAAK,EAAE,IAAI,OAAO,KAAK,KAAK,EAAE,IAAI,MAAM,KAAK,KAAK,CAAC;AAC3E,YAAM,MAAM,OAAO,KAAK,KAAK,EAAE,IAAI,OAAO,KAAK,KAAK,EAAE,IAAI,MAAM,KAAK,KAAK,CAAC;AAE3E,YAAM,OAAO,MAAM,KAAK,KAAK,WAAW,IAAI,CAAC,GAAG,WAAW,IAAI,EAAE,CAAC;AAClE,YAAM,OAAO,MAAM,MAAM,KAAK,KAAK,WAAW,IAAI,CAAC,GAAG,WAAW,IAAI,EAAE,CAAC;AACxE,iBAAW,CAAC,IAAI,OAAO;AACvB,iBAAW,CAAC,IAAI,OAAO;AAAA,IAC3B;AACA,QAAI,EAAE,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI;AAEzE,aAAQ,IAAI,GAAG,IAAI,IAAI,KAAI;AAEvB,YAAM,UAAU,OAAO,IAAI,IAAI,EAAE,IAAI,OAAO,IAAI,IAAI,EAAE,IAAI,OAAO,IAAI,IAAI,EAAE;AAC3E,YAAM,UAAU,OAAO,IAAI,IAAI,EAAE,IAAI,OAAO,IAAI,IAAI,EAAE,IAAI,OAAO,IAAI,IAAI,EAAE;AAE3E,YAAM,OAAO,KAAK,KAAK,CAAC,KAAK;AAC7B,YAAM,OAAO,KAAK,KAAK,CAAC,KAAK;AAG7B,YAAM,OAAO,MAAM,IAAI,SAAS,MAAM,UAAU,CAAC,GAAG,WAAW,CAAC,CAAC;AACjE,YAAM,MAAM,MAAM,MAAM,IAAI,SAAS,MAAM,UAAU,CAAC,GAAG,WAAW,CAAC,CAAC;AACtE,YAAM,MAAM,OAAO;AAEnB,YAAM,UAAU,OAAO,IAAI,IAAI,EAAE,IAAI,OAAO,IAAI,IAAI,EAAE,IAAI,OAAO,IAAI,IAAI,EAAE;AAC3E,YAAM,UAAU,OAAO,IAAI,IAAI,EAAE,IAAI,OAAO,IAAI,IAAI,EAAE,IAAI,OAAO,IAAI,IAAI,EAAE;AAC3E,YAAM,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK;AACtC,YAAM,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK;AACtC,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,OAAC,EAAE,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,KAAK,GAAG,KAAK,GAAG,MAAM,GAAG,MAAM,CAAC;AACxD,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,WAAK,KAAK;AACV,YAAM,MAAM,MAAM,KAAK,SAAS,IAAI;AACpC,WAAK,MAAM,KAAK,KAAK,SAAS,IAAI;AAClC,WAAK,MAAM;AAAA,IACf;AAEA,KAAC,EAAE,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,GAAG,KAAK,GAAG,KAAK,CAAC;AAChE,KAAC,EAAE,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,GAAG,KAAK,GAAG,KAAK,CAAC;AAChE,KAAC,EAAE,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,GAAG,KAAK,GAAG,KAAK,CAAC;AAChE,KAAC,EAAE,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,GAAG,KAAK,GAAG,KAAK,CAAC;AAChE,KAAC,EAAE,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,GAAG,KAAK,GAAG,KAAK,CAAC;AAChE,KAAC,EAAE,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,GAAG,KAAK,GAAG,KAAK,CAAC;AAChE,KAAC,EAAE,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,GAAG,KAAK,GAAG,KAAK,CAAC;AAChE,KAAC,EAAE,GAAG,IAAI,GAAG,GAAG,IAAI,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,GAAG,KAAK,GAAG,KAAK,CAAC;AAChE,SAAK,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,EAAE;AAAA,EAC3E;AAAA,EACA,aAAa;AACT,UAAM,YAAY,UAAU;AAAA,EAChC;AAAA,EACA,UAAU;AACN,UAAM,KAAK,MAAM;AACjB,SAAK,IAAI,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,CAAC;AAAA,EAC3D;AAAA,EACA,YAAY,YAAY,IAAG;AACvB,UAAM,KAAK,WAAW,IAAI,KAAK;AAI/B,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,EAAE,IAAI;AAC1B,SAAK,KAAK,UAAU,EAAE,IAAI;AAC1B,SAAK,KAAK,UAAU,EAAE,IAAI;AAC1B,SAAK,KAAK,UAAU,EAAE,IAAI;AAC1B,SAAK,KAAK,UAAU,EAAE,IAAI;AAC1B,SAAK,KAAK,UAAU,EAAE,IAAI;AAAA,EAC9B;AACJ;AACA,IAAM,SAAN,cAAqB,OAAO;AAAA,EA94B5B,OA84B4B;AAAA;AAAA;AAAA,EACxB,cAAa;AACT,UAAM,EAAE;AACR,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,CAAC,IAAI;AACzB,SAAK,KAAK,UAAU,EAAE,IAAI;AAC1B,SAAK,KAAK,UAAU,EAAE,IAAI;AAC1B,SAAK,KAAK,UAAU,EAAE,IAAI;AAC1B,SAAK,KAAK,UAAU,EAAE,IAAI;AAC1B,SAAK,KAAK,UAAU,EAAE,IAAI;AAC1B,SAAK,KAAK,UAAU,EAAE,IAAI;AAAA,EAC9B;AACJ;AAOI,IAAM,SAAyB,6BAAa,MAAI,IAAI,OAAO,CAAC;AACpB,IAAM,SAAyB,6BAAa,MAAI,IAAI,OAAO,CAAC;AAC3D,IAAM,SAAyB,6BAAa,MAAI,IAAI,OAAO,CAAC;AAC5D,IAAM,SAAyB,6BAAa,MAAI,IAAI,OAAO,CAAC;AAKzG,IAAM,MAAM,OAAO,CAAC;AACpB,IAAM,MAAM,OAAO,CAAC;AACpB,IAAM,MAAM,OAAO,CAAC;AACpB,IAAM,MAAM,OAAO,CAAC;AACpB,IAAM,QAAQ,OAAO,GAAG;AACxB,IAAM,SAAS,OAAO,GAAI;AAC1B,IAAM,UAAU,CAAC;AACjB,IAAM,YAAY,CAAC;AACnB,IAAM,aAAa,CAAC;AACpB,SAAQ,QAAQ,GAAG,IAAI,KAAK,IAAI,GAAG,IAAI,GAAG,QAAQ,IAAI,SAAQ;AAE1D,GAAC,GAAG,CAAC,IAAI;AAAA,IACL;AAAA,KACC,IAAI,IAAI,IAAI,KAAK;AAAA,EACtB;AACA,UAAQ,KAAK,KAAK,IAAI,IAAI,EAAE;AAE5B,YAAU,MAAM,QAAQ,MAAM,QAAQ,KAAK,IAAI,EAAE;AAEjD,MAAIM,KAAI;AACR,WAAQ,IAAI,GAAG,IAAI,GAAG,KAAI;AACtB,SAAK,KAAK,OAAO,KAAK,OAAO,UAAU;AACvC,QAAI,IAAI,IAAK,CAAAA,MAAK,QAAQ,OAAuB,uBAAO,CAAC,KAAK;AAAA,EAClE;AACA,aAAW,KAAKA,EAAC;AACrB;AACA,IAAM,QAAQ,MAAM,YAAY,IAAI;AACpC,IAAM,cAAc,MAAM,CAAC;AAC3B,IAAM,cAAc,MAAM,CAAC;AAE3B,IAAM,QAAQ,wBAACN,IAAG,GAAG,MAAI,IAAI,KAAK,OAAOA,IAAG,GAAG,CAAC,IAAI,OAAOA,IAAG,GAAG,CAAC,GAApD;AACd,IAAM,QAAQ,wBAACA,IAAG,GAAG,MAAI,IAAI,KAAK,OAAOA,IAAG,GAAG,CAAC,IAAI,OAAOA,IAAG,GAAG,CAAC,GAApD;AACqE,SAAS,QAAQ,GAAG,SAAS,IAAI;AAChH,QAAM,IAAI,IAAI,YAAY,IAAI,CAAC;AAE/B,WAAQ,QAAQ,KAAK,QAAQ,QAAQ,IAAI,SAAQ;AAE7C,aAAQ,IAAI,GAAG,IAAI,IAAI,IAAI,GAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE;AACrF,aAAQ,IAAI,GAAG,IAAI,IAAI,KAAK,GAAE;AAC1B,YAAM,QAAQ,IAAI,KAAK;AACvB,YAAM,QAAQ,IAAI,KAAK;AACvB,YAAM,KAAK,EAAE,IAAI;AACjB,YAAM,KAAK,EAAE,OAAO,CAAC;AACrB,YAAM,KAAK,MAAM,IAAI,IAAI,CAAC,IAAI,EAAE,IAAI;AACpC,YAAM,KAAK,MAAM,IAAI,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC;AACxC,eAAQ,IAAI,GAAG,IAAI,IAAI,KAAK,IAAG;AAC3B,UAAE,IAAI,CAAC,KAAK;AACZ,UAAE,IAAI,IAAI,CAAC,KAAK;AAAA,MACpB;AAAA,IACJ;AAEA,QAAI,OAAO,EAAE,CAAC;AACd,QAAI,OAAO,EAAE,CAAC;AACd,aAAQM,KAAI,GAAGA,KAAI,IAAIA,MAAI;AACvB,YAAM,QAAQ,UAAUA,EAAC;AACzB,YAAM,KAAK,MAAM,MAAM,MAAM,KAAK;AAClC,YAAM,KAAK,MAAM,MAAM,MAAM,KAAK;AAClC,YAAM,KAAK,QAAQA,EAAC;AACpB,aAAO,EAAE,EAAE;AACX,aAAO,EAAE,KAAK,CAAC;AACf,QAAE,EAAE,IAAI;AACR,QAAE,KAAK,CAAC,IAAI;AAAA,IAChB;AAEA,aAAQ,IAAI,GAAG,IAAI,IAAI,KAAK,IAAG;AAC3B,eAAQ,IAAI,GAAG,IAAI,IAAI,IAAI,GAAE,CAAC,IAAI,EAAE,IAAI,CAAC;AACzC,eAAQ,IAAI,GAAG,IAAI,IAAI,IAAI,GAAE,IAAI,CAAC,KAAK,CAAC,GAAG,IAAI,KAAK,EAAE,IAAI,GAAG,IAAI,KAAK,EAAE;AAAA,IAC5E;AAEA,MAAE,CAAC,KAAK,YAAY,KAAK;AACzB,MAAE,CAAC,KAAK,YAAY,KAAK;AAAA,EAC7B;AACA,QAAM,CAAC;AACX;AAzC4F;AA0C7D,IAAM,SAAN,MAAM,gBAAe,KAAK;AAAA,EA3/BzD,OA2/ByD;AAAA;AAAA;AAAA,EACrD,QAAQ;AACJ,WAAO,KAAK,WAAW;AAAA,EAC3B;AAAA,EACA,SAAS;AACL,eAAW,KAAK,OAAO;AACvB,YAAQ,KAAK,SAAS,KAAK,MAAM;AACjC,eAAW,KAAK,OAAO;AACvB,SAAK,SAAS;AACd,SAAK,MAAM;AAAA,EACf;AAAA,EACA,OAAO,MAAM;AACT,YAAQ,IAAI;AACZ,WAAO,QAAQ,IAAI;AACnB,WAAO,IAAI;AACX,UAAM,EAAE,UAAU,MAAM,IAAI;AAC5B,UAAM,MAAM,KAAK;AACjB,aAAQ,MAAM,GAAG,MAAM,OAAK;AACxB,YAAM,OAAO,KAAK,IAAI,WAAW,KAAK,KAAK,MAAM,GAAG;AACpD,eAAQ,IAAI,GAAG,IAAI,MAAM,IAAI,OAAM,KAAK,KAAK,KAAK,KAAK,KAAK;AAC5D,UAAI,KAAK,QAAQ,SAAU,MAAK,OAAO;AAAA,IAC3C;AACA,WAAO;AAAA,EACX;AAAA,EACA,SAAS;AACL,QAAI,KAAK,SAAU;AACnB,SAAK,WAAW;AAChB,UAAM,EAAE,OAAO,QAAQ,KAAK,SAAS,IAAI;AAEzC,UAAM,GAAG,KAAK;AACd,SAAK,SAAS,SAAU,KAAK,QAAQ,WAAW,EAAG,MAAK,OAAO;AAC/D,UAAM,WAAW,CAAC,KAAK;AACvB,SAAK,OAAO;AAAA,EAChB;AAAA,EACA,UAAU,KAAK;AACX,YAAQ,MAAM,KAAK;AACnB,WAAO,GAAG;AACV,SAAK,OAAO;AACZ,UAAM,YAAY,KAAK;AACvB,UAAM,EAAE,SAAS,IAAI;AACrB,aAAQ,MAAM,GAAG,MAAM,IAAI,QAAQ,MAAM,OAAK;AAC1C,UAAI,KAAK,UAAU,SAAU,MAAK,OAAO;AACzC,YAAM,OAAO,KAAK,IAAI,WAAW,KAAK,QAAQ,MAAM,GAAG;AACvD,UAAI,IAAI,UAAU,SAAS,KAAK,QAAQ,KAAK,SAAS,IAAI,GAAG,GAAG;AAChE,WAAK,UAAU;AACf,aAAO;AAAA,IACX;AACA,WAAO;AAAA,EACX;AAAA,EACA,QAAQ,KAAK;AAET,QAAI,CAAC,KAAK,UAAW,OAAM,IAAI,MAAM,uCAAuC;AAC5E,WAAO,KAAK,UAAU,GAAG;AAAA,EAC7B;AAAA,EACA,IAAI,OAAO;AACP,YAAQ,KAAK;AACb,WAAO,KAAK,QAAQ,IAAI,WAAW,KAAK,CAAC;AAAA,EAC7C;AAAA,EACA,WAAW,KAAK;AACZ,YAAQ,KAAK,IAAI;AACjB,QAAI,KAAK,SAAU,OAAM,IAAI,MAAM,6BAA6B;AAChE,SAAK,UAAU,GAAG;AAClB,SAAK,QAAQ;AACb,WAAO;AAAA,EACX;AAAA,EACA,SAAS;AACL,WAAO,KAAK,WAAW,IAAI,WAAW,KAAK,SAAS,CAAC;AAAA,EACzD;AAAA,EACA,UAAU;AACN,SAAK,YAAY;AACjB,UAAM,KAAK,KAAK;AAAA,EACpB;AAAA,EACA,WAAW,IAAI;AACX,UAAM,EAAE,UAAU,QAAQ,WAAW,QAAQ,UAAU,IAAI;AAC3D,WAAO,KAAK,IAAI,QAAO,UAAU,QAAQ,WAAW,WAAW,MAAM;AACrE,OAAG,QAAQ,IAAI,KAAK,OAAO;AAC3B,OAAG,MAAM,KAAK;AACd,OAAG,SAAS,KAAK;AACjB,OAAG,WAAW,KAAK;AACnB,OAAG,SAAS;AAEZ,OAAG,SAAS;AACZ,OAAG,YAAY;AACf,OAAG,YAAY;AACf,OAAG,YAAY,KAAK;AACpB,WAAO;AAAA,EACX;AAAA;AAAA,EAEA,YAAY,UAAU,QAAQ,WAAW,YAAY,OAAO,SAAS,IAAG;AACpE,UAAM;AACN,SAAK,MAAM;AACX,SAAK,SAAS;AACd,SAAK,WAAW;AAChB,SAAK,YAAY;AACjB,SAAK,YAAY;AACjB,SAAK,WAAW;AAChB,SAAK,SAAS;AACd,SAAK,YAAY;AACjB,SAAK,YAAY;AACjB,SAAK,SAAS;AAEd,YAAQ,SAAS;AAGjB,QAAI,EAAE,IAAI,YAAY,WAAW,KAAM,OAAM,IAAI,MAAM,yCAAyC;AAChG,SAAK,QAAQ,IAAI,WAAW,GAAG;AAC/B,SAAK,UAAU,IAAI,KAAK,KAAK;AAAA,EACjC;AACJ;AACA,IAAM,MAAM,wBAAC,QAAQ,UAAU,cAAY,aAAa,MAAI,IAAI,OAAO,UAAU,QAAQ,SAAS,CAAC,GAAvF;AACmB,IAAM,WAA4B,uBAAI,IAAI,GAAM,KAAK,MAAM,CAAC,GAAG;AACpC,IAAM,WAA4B,uBAAI,IAAI,GAAM,KAAK,MAAM,CAAC,GAAG;AAC1F,IAAM,WAA4B,uBAAI,IAAI,GAAM,KAAK,MAAM,CAAC,GAAG;AAC/D,IAAM,WAA4B,uBAAI,IAAI,GAAM,IAAI,MAAM,CAAC,GAAG;AAMzF,IAAM,eAAe,MAAI;AACzB,MAAI,OAAO,eAAe,SAAU,QAAO;AAAA,OACtC;AACD,WAAO,eAAe,OAAO,WAAW,kBAAkB;AAAA,MACtD,MAAO;AACH,eAAO;AAAA,MACX;AAAA,MACA,cAAc;AAAA,IAClB,CAAC;AACD,QAAI;AAGA,UAAI,OAAO,mBAAmB,YAAa,QAAO;AAAA,IACtD,UAAE;AAEE,aAAO,OAAO,UAAU;AAAA,IAC5B;AAAA,EACJ;AAEA,MAAI,OAAO,SAAS,YAAa,QAAO;AAAA,WAC/B,OAAO,WAAW,YAAa,QAAO;AAAA,WACtC,OAAO,WAAW,YAAa,QAAO;AAC/C,SAAO;AACX,GAAG;AAKC,IAAM,cAAc;AAAA,EACpB,MAAM;AAAA,EACN,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,QAAQ;AAAA,EACR,YAAY;AAAA,EACZ,YAAY;AAAA,EACZ,YAAY;AAAA,EACZ,YAAY;AAChB;AAKI,IAAM,wBAAwB,wBAAC,cAAY;AAC3C,UAAO,MAAK;AAAA,IACR,KAAK,0BAA0B,KAAK,SAAS;AACzC,aAAO;AAAA,IACX,KAAK,oBAAoB,KAAK,SAAS;AACnC,aAAO;AAAA,IACX,KAAK,oBAAoB,KAAK,SAAS;AACnC,aAAO;AAAA,IACX,KAAK,oBAAoB,KAAK,SAAS;AACnC,aAAO;AAAA,IACX,KAAK,oBAAoB,KAAK,SAAS;AACnC,aAAO;AAAA,IACX,KAAK,cAAc,KAAK,SAAS;AAC7B,aAAO;AAAA,IACX,KAAK,cAAc,KAAK,SAAS;AAC7B,aAAO;AAAA,IACX,KAAK,cAAc,KAAK,SAAS;AAC7B,aAAO;AAAA,IACX,KAAK,cAAc,KAAK,SAAS;AAC7B,aAAO;AAAA,IACX;AACI,YAAM,IAAI,UAAU,2BAA2B,SAAS,EAAE;AAAA,EAClE;AACJ,GAvBkC;AA8B9B,IAAM,aAAa,wBAAC,WAAW,KAAK,YAAU;AAC9C,MAAI,MAAM;AACN,UAAMJ,QAAO,YAAY,SAAS,KAAK,YAAY,sBAAsB,SAAS,CAAC;AACnF,WAAO,KAAKA,OAAM,KAAK,OAAO;AAAA,EAClC,OAAO;AACH,UAAM,IAAI,MAAM,uBAAuB;AAAA,EAC3C;AACJ,GAPuB;AAYnB,IAAM,WAAW;AAMjB,IAAM,eAAe,wBAAC,QAAM;AAE5B,QAAM,IAAI,QAAQ,MAAM,EAAE;AAE1B,MAAI,MAAM,IAAI;AACd,SAAM,IAAI,MAAM,CAAC,MAAM,IAAI,GAAE;AAC7B,SAAO,MAAM,IAAI,SAAS,IAAI,UAAU,GAAG,GAAG,IAAI,KAAK,YAAY;AACnE,QAAM,MAAM,IAAI,YAAY,IAAI,SAAS,IAAI,IAAI,CAAC;AAClD,QAAM,MAAM,IAAI,WAAW,GAAG;AAC9B,MAAI,OAAO;AACX,MAAI,QAAQ;AACZ,MAAI,QAAQ;AACZ,WAAQ,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAI;AAC/B,UAAM,MAAM,SAAS,QAAQ,IAAI,CAAC,CAAC;AACnC,QAAI,QAAQ,GAAI,OAAM,IAAI,UAAU,4BAA4B,IAAI,CAAC,CAAC,EAAE;AACxE,YAAQ,SAAS,IAAI;AACrB,YAAQ;AACR,QAAI,QAAQ,GAAG;AACX,cAAQ;AACR,UAAI,OAAO,IAAI,UAAU;AAAA,IAC7B;AAAA,EACJ;AACA,SAAO;AACX,GAvByB;AA6BrB,IAAM,eAAe,wBAAC,QAAM;AAC5B,MAAI,OAAO;AACX,MAAI,QAAQ;AACZ,MAAI,MAAM;AACV,WAAQ,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAI;AAC/B,YAAQ,SAAS,IAAI,IAAI,CAAC;AAC1B,YAAQ;AACR,WAAM,QAAQ,GAAE;AACZ,aAAO,SAAS,UAAU,OAAO,IAAI,EAAE;AACvC,cAAQ;AAAA,IACZ;AAAA,EACJ;AACA,MAAI,OAAO,GAAG;AACV,WAAO,SAAS,SAAS,IAAI,OAAO,EAAE;AAAA,EAC1C;AACA,SAAO;AACX,GAhByB;AAsBrB,IAAM,YAAY,wBAAC,QAAM;AAEzB,QAAM,IAAI,QAAQ,MAAM,EAAE;AAC1B,QAAM,MAAM,IAAI,YAAY,IAAI,SAAS,CAAC;AAC1C,QAAM,MAAM,IAAI,WAAW,GAAG;AAC9B,WAAQ,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAK,GAAE;AAClC,QAAI,IAAI,CAAC,IAAI,SAAS,IAAI,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE;AAAA,EACrD;AACA,SAAO;AACX,GATsB;AAclB,IAAM,YAAY,wBAAC,QAAM;AACzB,MAAI,MAAM;AACV,WAAQ,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAI;AAC/B,UAAM,MAAM,IAAI,CAAC,EAAE,SAAS,EAAE;AAC9B,QAAI,IAAI,WAAW,EAAG,QAAO;AAC7B,WAAO;AAAA,EACX;AACA,SAAO,IAAI,YAAY;AAC3B,GARsB;AAclB,IAAM,eAAe,wBAAC,QAAM;AAC5B,QAAM,MAAM,IAAI,YAAY,IAAI,MAAM;AACtC,QAAM,MAAM,IAAI,WAAW,GAAG;AAC9B,WAAQ,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAI;AAC/B,QAAI,CAAC,IAAI,IAAI,WAAW,CAAC,IAAI;AAAA,EACjC;AACA,SAAO;AACX,GAPyB;AAYrB,IAAM,eAAe,wBAAC,QAAM;AAC5B,MAAI,MAAM;AACV,WAAQ,IAAI,GAAG,IAAI,IAAI,QAAQ,KAAI;AAC/B,WAAO,OAAO,aAAa,IAAI,CAAC,CAAC;AAAA,EACrC;AACA,SAAO;AACX,GANyB;AAWrB,IAAM,UAAU,YAAY,cAAc,IAAI,YAAY,YAAY,IAAI;AAI1E,IAAM,UAAU,YAAY,cAAc,IAAI,YAAY,YAAY,IAAI;AAK1E,IAAM,aAAa,wBAAC,QAAM;AAC1B,MAAI,CAAC,SAAS;AACV,UAAM,IAAI,MAAM,4BAA4B;AAAA,EAChD;AACA,SAAO,QAAQ,OAAO,GAAG;AAC7B,GALuB;AAUnB,IAAM,aAAa,wBAAC,QAAM;AAC1B,MAAI,CAAC,SAAS;AACV,UAAM,IAAI,MAAM,4BAA4B;AAAA,EAChD;AACA,SAAO,QAAQ,OAAO,GAAG;AAC7B,GALuB;AAWnB,IAAMK,eAAc,wBAAC,SAAO;AAC5B,MAAI,YAAY,QAAQ,iBAAiB;AACrC,WAAO,YAAY,OAAO,gBAAgB,IAAI,WAAW,IAAI,CAAC;AAAA,EAClE,OAAO;AACH,UAAM,IAAI,MAAM,gCAAgC;AAAA,EACpD;AACJ,GANwB;AAUpB,IAAM,SAAN,MAAM,QAAO;AAAA,EA31CjB,OA21CiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAKX,OAAO,WAAW,KAAK;AACrB,WAAO,IAAI,QAAO;AAAA,MACd,QAAQ,aAAa,GAAG,EAAE;AAAA,IAC9B,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAKE,OAAO,SAAS,KAAK;AACnB,WAAO,IAAI,QAAO;AAAA,MACd,QAAQ,WAAW,GAAG,EAAE;AAAA,IAC5B,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAKE,OAAO,WAAW,KAAK;AACrB,WAAO,IAAI,QAAO;AAAA,MACd,QAAQ,aAAa,GAAG,EAAE;AAAA,IAC9B,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAKE,OAAO,QAAQ,KAAK;AAClB,WAAO,IAAI,QAAO;AAAA,MACd,QAAQ,UAAU,GAAG,EAAE;AAAA,IAC3B,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAKE,IAAI,SAAS;AACX,WAAO,KAAK,MAAM;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA;AAAA,EAIE,IAAI,SAAS;AACX,WAAO,eAAe,MAAM,UAAU;AAAA,MAClC,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,cAAc;AAAA,MACd,OAAO,aAAa,KAAK,KAAK;AAAA,IAClC,CAAC;AACD,WAAO,KAAK;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA,EAIE,IAAI,OAAO;AACT,WAAO,eAAe,MAAM,QAAQ;AAAA,MAChC,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,cAAc;AAAA,MACd,OAAO,WAAW,KAAK,KAAK;AAAA,IAChC,CAAC;AACD,WAAO,KAAK;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA,EAIE,IAAI,SAAS;AACX,WAAO,eAAe,MAAM,UAAU;AAAA,MAClC,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,cAAc;AAAA,MACd,OAAO,aAAa,KAAK,KAAK;AAAA,IAClC,CAAC;AACD,WAAO,KAAK;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA,EAIE,IAAI,MAAM;AACR,WAAO,eAAe,MAAM,OAAO;AAAA,MAC/B,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,cAAc;AAAA,MACd,OAAO,UAAU,KAAK,KAAK;AAAA,IAC/B,CAAC;AACD,WAAO,KAAK;AAAA,EAChB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,YAAY,EAAE,QAAQ,OAAO,GAAG,IAAI,CAAC,GAAE;AAKrC,SAAK,QAAQ,OAAO,WAAW,cAAcA,aAAY,IAAI,IAAI,IAAI,WAAW,MAAM;AAEtF,WAAO,eAAe,MAAM,SAAS;AAAA,MACjC,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,cAAc;AAAA,MACd,OAAO,KAAK;AAAA,IAChB,CAAC;AAAA,EACL;AACJ;AAOI,IAAM,kBAAkB,wBAAC,GAAG,MAAI;AAChC;AACI,QAAI,EAAE,WAAW,EAAE,QAAQ;AACvB,YAAM,IAAI,UAAU,yCAAyC;AAAA,IACjE;AACA,QAAI,IAAI;AACR,QAAI,MAAM;AACV,WAAM,EAAE,IAAI,EAAE,QAAO;AACjB,aAAO,EAAE,WAAW,CAAC,IAAI,EAAE,WAAW,CAAC;AAAA,IAC3C;AACA,WAAO,QAAQ;AAAA,EACnB;AACJ,GAZ4B;AAiBxB,IAAM,OAAN,MAAM,MAAK;AAAA,EAl+Cf,OAk+Ce;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYT,WAAW,WAAW;AACpB,WAAO;AAAA,MACH,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,eAAe;AAAA,MACf,WAAW;AAAA,MACX,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,QAAQ;AAAA,IACZ;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASE,OAAO,SAAS,EAAE,QAAQ,YAAY,MAAK,SAAS,WAAW,SAAS,MAAK,SAAS,QAAQ,UAAU,MAAK,SAAS,QAAQ,GAAG;AAC/H,UAAM,SAAS,WAAW,WAAW,OAAO,OAAO,WAAW,OAAO,CAAC;AACtE,UAAM,SAAS,OAAO,OAAO,aAAa,CAAC,IAAI;AAC/C,UAAM,QAAQ,OAAO,MAAM,IAAI,QAAQ,MAAM,OAAO,SAAS,CAAC,IAAI,QAAQ,MAAM,OAAO,SAAS,CAAC,IAAI,QAAQ,IAAI,OAAO,SAAS,CAAC,IAAI,OAAO,MAAM;AACnJ,WAAO,IAAI,SAAS,EAAE,SAAS,QAAQ,GAAG;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,SAAS,EAAE,UAAU,KAAK,UAAU,IAAI,CAAC,GAAG;AAC1C,WAAO,MAAK,SAAS;AAAA,MACjB,QAAQ,KAAK;AAAA,MACb,WAAW,KAAK;AAAA,MAChB,QAAQ,KAAK;AAAA,MACb;AAAA,IACJ,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWE,OAAO,SAAS,EAAE,OAAO,QAAQ,WAAW,SAAS,MAAK,SAAS,QAAQ,UAAU,MAAK,SAAS,SAAS,QAAAC,UAAS,MAAK,SAAS,OAAO,GAAG;AAE3I,QAAI,MAAM,WAAW,OAAQ,QAAO;AACpC,QAAI,QAAQ;AACZ,UAAM,QAAQ,wBAAuB,MAAI;AACrC,YAAM,iBAAiB,MAAK,SAAS;AAAA,QACjC;AAAA,QACA;AAAA,QACA;AAAA,QACA,SAAS;AAAA,MACb,CAAC;AACD,UAAI,gBAAgB,OAAO,cAAc,GAAG;AACxC,gBAAQ,IAAI;AAAA,MAChB;AAAA,IACJ,GAVc;AAWd,UAAM,OAAO;AACb,aAAQ,IAAI,GAAG,KAAKA,WAAU,UAAU,MAAM,EAAE,GAAE;AAC9C,YAAM,UAAU,CAAC;AACjB,UAAI,UAAU,KAAM;AACpB,YAAM,UAAU,CAAC;AACjB,UAAI,UAAU,KAAM;AAAA,IACxB;AACA,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQE,SAAS,EAAE,OAAO,UAAU,KAAK,SAAS,QAAAA,QAAO,GAAG;AAClD,WAAO,MAAK,SAAS;AAAA,MACjB;AAAA,MACA,QAAQ,KAAK;AAAA,MACb,WAAW,KAAK;AAAA,MAChB,QAAQ,KAAK;AAAA,MACb;AAAA,MACA,QAAAA;AAAA,IACJ,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA,EAIE,WAAW;AACT,UAAM,IAAI;AACV,WAAO,kBAAuB,KAAK,OAAO,SAAS,IAAI,KAAK,gBAAgB,GAAG,EAAE,KAAK,MAAM,CAAC,IAAI,EAAE,KAAK,KAAK,CAAC,WAAW,EAAE,KAAK,MAAM,CAAC,MAAM,GAAG,EAAE,KAAK,KAAK,CAAC,WAAW,EAAE,KAAK,MAAM,CAAC,MAAM,GAAG,EAAE,KAAK,KAAK,CAAC,GAAG,UAAe,EAAE,KAAK,OAAO,MAAM,CAAC,cAAmB,EAAE,KAAK,SAAS,CAAC,WAAgB,EAAE,KAAK,MAAM,CAAC,YAAiB,EAAE,KAAK,OAAO,CAAC;AAAA,EACzV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWE,YAAY,EAAE,SAAS,MAAK,SAAS,QAAQ,QAAQ,MAAK,SAAS,OAAO,gBAAgB,MAAK,SAAS,eAAe,SAAS,IAAI,OAAO,GAAG,YAAY,MAAK,SAAS,WAAW,SAAS,MAAK,SAAS,QAAQ,UAAU,MAAK,SAAS,QAAQ,IAAI,CAAC,GAAE;AAIvP,SAAK,SAAS;AAId,SAAK,QAAQ;AAIb,SAAK,gBAAgB;AAIrB,SAAK,SAAS,OAAO,WAAW,WAAW,OAAO,WAAW,MAAM,IAAI;AAIvE,SAAK,YAAY,sBAAsB,SAAS;AAIhD,SAAK,SAAS;AAId,SAAK,UAAU;AAAA,EACnB;AACJ;AAKI,IAAM,OAAN,MAAM,MAAK;AAAA,EA3nDf,OA2nDe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYT,WAAW,WAAW;AACpB,WAAO;AAAA,MACH,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,eAAe;AAAA,MACf,WAAW;AAAA,MACX,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,QAAQ;AAAA,IACZ;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,OAAO,QAAQ,EAAE,SAAS,MAAK,SAAS,QAAQ,YAAY,KAAK,IAAI,EAAE,IAAI,CAAC,GAAG;AAC7E,WAAO,KAAK,MAAM,YAAY,MAAO,MAAM;AAAA,EAC/C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,QAAQ,EAAE,YAAY,KAAK,IAAI,EAAE,IAAI,CAAC,GAAG;AACvC,WAAO,MAAK,QAAQ;AAAA,MAChB,QAAQ,KAAK;AAAA,MACb;AAAA,IACJ,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOE,OAAO,UAAU,EAAE,SAAS,MAAK,SAAS,QAAQ,YAAY,KAAK,IAAI,EAAE,IAAI,CAAC,GAAG;AAC/E,WAAO,SAAS,MAAO,aAAa,SAAS;AAAA,EACjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,UAAU,EAAE,YAAY,KAAK,IAAI,EAAE,IAAI,CAAC,GAAG;AACzC,WAAO,MAAK,UAAU;AAAA,MAClB,QAAQ,KAAK;AAAA,MACb;AAAA,IACJ,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUE,OAAO,SAAS,EAAE,QAAQ,WAAW,QAAQ,SAAS,MAAK,SAAS,QAAQ,YAAY,KAAK,IAAI,EAAE,GAAG;AACpG,WAAO,KAAK,SAAS;AAAA,MACjB;AAAA,MACA;AAAA,MACA;AAAA,MACA,SAAS,MAAK,QAAQ;AAAA,QAClB;AAAA,QACA;AAAA,MACJ,CAAC;AAAA,IACL,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAME,SAAS,EAAE,YAAY,KAAK,IAAI,EAAE,IAAI,CAAC,GAAG;AACxC,WAAO,MAAK,SAAS;AAAA,MACjB,QAAQ,KAAK;AAAA,MACb,WAAW,KAAK;AAAA,MAChB,QAAQ,KAAK;AAAA,MACb,QAAQ,KAAK;AAAA,MACb;AAAA,IACJ,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYE,OAAO,SAAS,EAAE,OAAO,QAAQ,WAAW,QAAQ,SAAS,MAAK,SAAS,QAAQ,YAAY,KAAK,IAAI,GAAG,QAAAA,QAAO,GAAG;AACnH,WAAO,KAAK,SAAS;AAAA,MACjB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,SAAS,MAAK,QAAQ;AAAA,QAClB;AAAA,QACA;AAAA,MACJ,CAAC;AAAA,MACD,QAAAA;AAAA,IACJ,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQE,SAAS,EAAE,OAAO,WAAW,QAAAA,QAAO,GAAG;AACrC,WAAO,MAAK,SAAS;AAAA,MACjB;AAAA,MACA,QAAQ,KAAK;AAAA,MACb,WAAW,KAAK;AAAA,MAChB,QAAQ,KAAK;AAAA,MACb,QAAQ,KAAK;AAAA,MACb;AAAA,MACA,QAAAA;AAAA,IACJ,CAAC;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA,EAIE,WAAW;AACT,UAAM,IAAI;AACV,WAAO,kBAAuB,KAAK,OAAO,SAAS,IAAI,KAAK,gBAAgB,GAAG,EAAE,KAAK,MAAM,CAAC,IAAI,EAAE,KAAK,KAAK,CAAC,WAAW,EAAE,KAAK,MAAM,CAAC,MAAM,GAAG,EAAE,KAAK,KAAK,CAAC,WAAW,EAAE,KAAK,MAAM,CAAC,MAAM,GAAG,EAAE,KAAK,KAAK,CAAC,GAAG,UAAe,EAAE,KAAK,OAAO,MAAM,CAAC,cAAmB,EAAE,KAAK,SAAS,CAAC,WAAgB,EAAE,KAAK,MAAM,CAAC,WAAgB,EAAE,KAAK,MAAM,CAAC;AAAA,EACvV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWE,YAAY,EAAE,SAAS,MAAK,SAAS,QAAQ,QAAQ,MAAK,SAAS,OAAO,gBAAgB,MAAK,SAAS,eAAe,SAAS,IAAI,OAAO,GAAG,YAAY,MAAK,SAAS,WAAW,SAAS,MAAK,SAAS,QAAQ,SAAS,MAAK,SAAS,OAAO,IAAI,CAAC,GAAE;AAIrP,SAAK,SAAS;AAId,SAAK,QAAQ;AAIb,SAAK,gBAAgB;AAIrB,SAAK,SAAS,OAAO,WAAW,WAAW,OAAO,WAAW,MAAM,IAAI;AAIvE,SAAK,YAAY,sBAAsB,SAAS;AAIhD,SAAK,SAAS;AAId,SAAK,SAAS;AAAA,EAClB;AACJ;;;AC9yDA,SAAS,WAAW,QAAgB,OAAwB;AAC1D,QAAM,OAAO,IAAY,KAAK;AAAA,IAC5B,QAAgB,OAAO,WAAW,MAAM;AAAA,IACxC,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,QAAQ;AAAA,EACV,CAAC;AACD,SAAO,KAAK,SAAS,EAAE,OAAO,QAAQ,EAAE,CAAC,MAAM;AACjD;AARS;AAUT,SAAS,qBAA6B;AACpC,QAAM,SAAS,IAAY,OAAO,EAAE,MAAM,GAAG,CAAC;AAC9C,SAAO,OAAO;AAChB;AAHS;AAMT,eAAe,OAAO,KAAU;AAC9B,QAAM,UAAU,IAAI,YAAY,EAAE,OAAO,IAAI,cAAc;AAC3D,SAAO,MAAM,OAAO,OAAO;AAAA,IACzB;AAAA,IACA;AAAA,IACA,EAAE,MAAM,UAAU;AAAA,IAClB;AAAA,IACA,CAAC,WAAW,SAAS;AAAA,EACvB;AACF;AATe;AAWf,eAAe,QAAQ,MAAc,KAAU;AAC7C,QAAM,KAAK,OAAO,gBAAgB,IAAI,WAAW,EAAE,CAAC;AACpD,QAAM,MAAM,MAAM,OAAO,GAAG;AAC5B,QAAM,UAAU,IAAI,YAAY,EAAE,OAAO,IAAI;AAC7C,QAAM,aAAa,MAAM,OAAO,OAAO;AAAA,IACrC,EAAE,MAAM,WAAW,GAAG;AAAA,IACtB;AAAA,IACA;AAAA,EACF;AACA,SAAO,KAAK,OAAO,aAAa,GAAG,EAAE,IAAI,OAAO,aAAa,GAAG,IAAI,WAAW,UAAU,CAAC,CAAC;AAC7F;AAVe;AAYf,eAAe,QAAQ,MAAc,KAAU;AAC7C,QAAMC,OAAM,KAAK,IAAI;AACrB,QAAM,KAAK,IAAI,WAAW,CAAC,GAAGA,IAAG,EAAE,MAAM,GAAG,EAAE,EAAE,IAAI,CAAC,MAAc,EAAE,WAAW,CAAC,CAAC,CAAC;AACnF,QAAM,aAAa,IAAI,WAAW,CAAC,GAAGA,IAAG,EAAE,MAAM,EAAE,EAAE,IAAI,CAAC,MAAc,EAAE,WAAW,CAAC,CAAC,CAAC;AACxF,QAAM,MAAM,MAAM,OAAO,GAAG;AAC5B,QAAM,YAAY,MAAM,OAAO,OAAO;AAAA,IACpC,EAAE,MAAM,WAAW,GAAG;AAAA,IACtB;AAAA,IACA;AAAA,EACF;AACA,SAAO,IAAI,YAAY,EAAE,OAAO,SAAS;AAC3C;AAXe;AAcf,eAAe,eAAe,KAAU,OAAe;AACrD,MAAI,OAAO,MAAM,IAAI,GAAG,QAAQ,qCAAqC,EAAE,KAAK,KAAK,EAAE,MAAM;AACzF,MAAI,CAAC,KAAM,QAAO,MAAM,IAAI,GAAG,QAAQ,uCAAuC,EAAE,KAAK,KAAK,EAAE,MAAM;AAClG,SAAO;AACT;AAJe;AAOf,eAAsB,UAAU,KAAc,KAAU;AACtD,MAAI,IAAI,WAAW,QAAQ;AACzB,WAAO,IAAI,SAAS,sBAAsB,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC3D;AACA,QAAM,EAAE,OAAO,UAAU,SAAS,IAAI,MAAM,IAAI,KAAK;AACrD,QAAM,OAAO,MAAM,eAAe,KAAK,KAAK;AAC5C,MAAI,CAAC,KAAM,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,sBAAsB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAGhG,QAAM,gBAAgB,MAAM,iBAAO,QAAQ,UAAU,KAAK,aAAa;AACvE,MAAI,CAAC,cAAe,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,sBAAsB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAEzG,MAAI,KAAK,aAAa;AACpB,QAAI,CAAC,UAAU;AACb,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,cAAc,MAAM,YAAY,KAAK,WAAW,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IAC1G;AAEA,QAAI,WAAW;AAEf,QAAI,KAAK,eAAe,QAAQ;AAC9B,UAAI,YAAY,KAAK;AACrB,UAAI,aAAa,CAAC,UAAU,WAAW,KAAK,GAAG;AAE7C,oBAAY,MAAM,QAAQ,WAAW,GAAG;AACxC,cAAO,IAAY,GAAG,QAAQ,UAAU,KAAK,OAAO,UAAU,SAAS,kCAAkC,EAAE,KAAK,WAAW,KAAK,EAAE,EAAE,IAAI;AAAA,MAC1I;AACA,YAAM,kBAAkB,MAAM,QAAQ,WAAW,GAAG;AACpD,iBAAW,mBAAmB,WAAW,iBAAiB,QAAQ;AAAA,IACpE,WAAW,KAAK,eAAe,WAAW,KAAK,eAAe,OAAO;AAEnE,YAAM,aAAa,MAAO,IAAY,cAAc,IAAI,OAAO,KAAK,EAAE,EAAE;AACxE,iBAAW,cAAc,eAAe;AACxC,UAAI,YAAa,IAAY,cAAc;AACzC,cAAO,IAAY,aAAa,OAAO,OAAO,KAAK,EAAE,EAAE;AAAA,MACzD;AAAA,IACF;AAGA,QAAI,CAAC,YAAY,KAAK,kBAAkB;AACtC,UAAI;AACF,cAAM,cAAc,KAAK,MAAM,KAAK,gBAAgB;AACpD,cAAM,YAAY,YAAY,UAAU,CAAC,SAAiB,SAAS,QAAQ;AAC3E,YAAI,cAAc,IAAI;AACpB,qBAAW;AAEX,sBAAY,OAAO,WAAW,CAAC;AAC/B,gBAAO,IAAY,GAAG,QAAQ,UAAU,KAAK,OAAO,UAAU,SAAS,wCAAwC,EAC5G,KAAK,KAAK,UAAU,WAAW,GAAG,KAAK,EAAE,EAAE,IAAI;AAAA,QACpD;AAAA,MACF,SAAS,GAAG;AACV,gBAAQ,MAAM,iCAAiC,CAAC;AAAA,MAClD;AAAA,IACF;AAEA,QAAI,CAAC,UAAU;AACb,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,mBAAmB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IACpF;AAAA,EACF;AAGA,QAAM,QAAQ,MAAM,cAAI;AAAA,IACtB;AAAA,MACE,IAAI,KAAK;AAAA,MACT,OAAO,KAAK;AAAA,MACZ,MAAM,KAAK,QAAQ;AAAA,MACnB,MAAM,KAAK;AAAA,MACX,KAAK,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI,IAAK,KAAK,KAAK;AAAA;AAAA,IAClD;AAAA,IACC,IAAY,cAAc;AAAA,EAC7B;AAGA,SAAO,IAAI,SAAS,KAAK,UAAU;AAAA,IACjC,SAAS;AAAA,IACT;AAAA,IACA,MAAM,EAAE,IAAI,KAAK,IAAI,OAAO,KAAK,OAAO,MAAM,KAAK,QAAQ,UAAU,MAAM,KAAK,KAAK;AAAA,EACvF,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACzD;AA7EsB;AAgFtB,eAAsB,cAAc,KAAc,KAAU;AAC1D,QAAM,EAAE,MAAM,IAAI,MAAM,IAAI,KAAK;AACjC,QAAM,OAAO,MAAM,eAAe,KAAK,KAAK;AAC5C,MAAI,CAAC,KAAM,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,iBAAiB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAC3F,QAAM,SAAS,mBAAmB;AAClC,QAAM,kBAAkB,MAAM,QAAQ,QAAQ,GAAG;AAEjD,QAAO,IAAY,GAAG,QAAQ,UAAU,KAAK,OAAO,UAAU,SAAS,kCAAkC,EAAE,KAAK,iBAAiB,KAAK,EAAE,EAAE,IAAI;AAE9I,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACrG;AAVsB;AAatB,eAAsB,eAAe,KAAc,KAAU;AAC3D,QAAM,EAAE,OAAO,KAAK,IAAI,MAAM,IAAI,KAAK;AACvC,QAAM,OAAO,MAAM,eAAe,KAAK,KAAK;AAC5C,MAAI,CAAC,QAAQ,CAAC,KAAK,WAAY,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,iCAAiC,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAC/H,QAAM,kBAAkB,MAAM,QAAQ,KAAK,YAAY,GAAG;AAC1D,MAAI,CAAC,WAAW,iBAAiB,IAAI,EAAG,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,eAAe,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AACtH,QAAO,IAAY,GAAG,QAAQ,UAAU,KAAK,OAAO,UAAU,SAAS,mCAAmC,EAAE,KAAK,KAAK,EAAE,EAAE,IAAI;AAC9H,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,KAAK,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAC5G;AARsB;;;AChGf,IAAM,wBAAqC;AAAA,EAChD,MAAM;AAAA;AAAA,EACN,WAAW;AAAA,EACX,WAAW;AAAA,EACX,YAAY;AAAA,EACZ,SAAS;AAAA,EACT,OAAO;AAAA,EACP,OAAO;AAAA,EACP,QAAQ;AAAA,EACR,gBAAgB,CAAC,QAAQ,MAAM;AAAA,EAC/B,kBAAkB,CAAC,OAAO,eAAe,KAAK;AAAA,EAC9C,6BAA6B;AAAA,EAC7B,MAAM;AACR;AAOO,IAAM,0BAAuC;AAAA,EAClD,MAAM;AAAA;AAAA,EACN,WAAW;AAAA,EACX,WAAW;AAAA,EACX,WAAW;AAAA,EACX,YAAY;AAAA,EACZ,SAAS;AAAA,EACT,OAAO;AAAA,EACP,OAAO;AAAA,EACP,QAAQ;AAAA,EACR,gBAAgB,CAAC,QAAQ,MAAM;AAAA,EAC/B,kBAAkB,CAAC,OAAO,eAAe,OAAO,oBAAoB;AAAA,EACpE,6BAA6B;AAAA;AAAA,EAC7B,MAAM;AAAA;AACR;AAUO,IAAM,mBAAmB;AAGzB,IAAM,gBAA6C;AAAA,EACxD,iBAAiB;AAAA,EACjB,uBAAuB;AACzB;AAUO,IAAM,aAAwB;AAAA;AAAA;AAAA;AAAA;AAAA,EAKnC,aAAa;AAAA;AAAA;AAAA,EAGb,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMhB,uBAAuB;AAAA;AAAA;AAAA,EAGvB,WAAW;AAAA,IACT,UAAU;AAAA,IACV,WAAW;AAAA,EACb;AAAA;AAAA,EAGA,WAAW;AAAA;AAAA,EAGX,UAAU;AAAA,IACR,iBAAiB;AAAA,IACjB,qBAAqB;AAAA,IACrB,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,YAAY;AAAA,EACd;AAAA;AAAA,EAGA,OAAO;AAAA,IACL,cAAc;AAAA,IACd,kBAAkB;AAAA,IAClB,cAAc;AAAA,IACd,oBAAoB;AAAA,EACtB;AAAA;AAAA,EAGA,UAAU;AAAA,IACR,eAAe;AAAA,IACf,SAAS;AAAA,EACX;AACF;AASO,SAAS,eAAe,SAAyB;AACtD,QAAM,UAAU,WAAW,gBAAgB,QACvC,WAAW,UAAU,WACrB,WAAW,UAAU;AACzB,SAAO,GAAG,OAAO,IAAI,WAAW,SAAS,IAAI,OAAO;AACtD;AALgB;AAUT,SAAS,gBAAwB;AACtC,QAAM,UAAU,cAAc,WAAW,cAAc;AACvD,MAAI,WAAW,gBAAgB,SAAS,QAAQ,WAAW;AACzD,WAAO,QAAQ;AAAA,EACjB;AACA,SAAO,QAAQ;AACjB;AANgB;AAWT,SAAS,mBAAgC;AAC9C,SAAO,cAAc,WAAW,cAAc;AAChD;AAFgB;AAQT,SAAS,wBAAiC;AAC/C,SAAO,WAAW;AACpB;AAFgB;AAOT,SAAS,eAAwB;AACtC,SAAO,WAAW,gBAAgB;AACpC;AAFgB;AAQT,SAAS,oCAAyE;AACvF,QAAM,UAAU,iBAAiB;AACjC,MAAI,CAAC,QAAQ,6BAA6B;AACxC,WAAO;AAAA,MACL,OAAO;AAAA,MACP,SAAS,WAAW,QAAQ,SAAS,WAAW,QAAQ,IAAI;AAAA,IAC9D;AAAA,EACF;AACA,MAAI,QAAQ,SAAS,sBAAsB;AACzC,WAAO;AAAA,MACL,OAAO;AAAA,MACP,SAAS,WAAW,QAAQ,SAAS,aAAa,QAAQ,IAAI;AAAA,IAChE;AAAA,EACF;AACA,SAAO;AAAA,IACL,OAAO;AAAA,IACP,SAAS,WAAW,QAAQ,SAAS,WAAW,QAAQ,IAAI;AAAA,EAC9D;AACF;AAlBgB;AAwBT,IAAM,yBAAgD;AAAA,EAC3D;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,SAAS;AAAA,IACT,oBAAoB,CAAC,mBAAmB,cAAc;AAAA,IACtD,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,SAAS;AAAA,IACT,oBAAoB,CAAC,mBAAmB,cAAc;AAAA,IACtD,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,SAAS;AAAA,IACT,oBAAoB,CAAC,mBAAmB,gBAAgB,cAAc;AAAA,IACtE,iBAAiB;AAAA,EACnB;AACF;AAEO,IAAM,4BAA4B;AAAA,EACvC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACF;;;ACzRA,IAAI,UAAU,wBAAC,YAAY,SAAS,eAAe;AACjD,SAAO,CAAC,SAAS,SAAS;AACxB,QAAI,QAAQ;AACZ,WAAO,SAAS,CAAC;AACjB,mBAAe,SAAS,GAAG;AACzB,UAAI,KAAK,OAAO;AACd,cAAM,IAAI,MAAM,8BAA8B;AAAA,MAChD;AACA,cAAQ;AACR,UAAI;AACJ,UAAI,UAAU;AACd,UAAI;AACJ,UAAI,WAAW,CAAC,GAAG;AACjB,kBAAU,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC;AAC5B,gBAAQ,IAAI,aAAa;AAAA,MAC3B,OAAO;AACL,kBAAU,MAAM,WAAW,UAAU,QAAQ;AAAA,MAC/C;AACA,UAAI,SAAS;AACX,YAAI;AACF,gBAAM,MAAM,QAAQ,SAAS,MAAM,SAAS,IAAI,CAAC,CAAC;AAAA,QACpD,SAAS,KAAK;AACZ,cAAI,eAAe,SAAS,SAAS;AACnC,oBAAQ,QAAQ;AAChB,kBAAM,MAAM,QAAQ,KAAK,OAAO;AAChC,sBAAU;AAAA,UACZ,OAAO;AACL,kBAAM;AAAA,UACR;AAAA,QACF;AAAA,MACF,OAAO;AACL,YAAI,QAAQ,cAAc,SAAS,YAAY;AAC7C,gBAAM,MAAM,WAAW,OAAO;AAAA,QAChC;AAAA,MACF;AACA,UAAI,QAAQ,QAAQ,cAAc,SAAS,UAAU;AACnD,gBAAQ,MAAM;AAAA,MAChB;AACA,aAAO;AAAA,IACT;AAnCe;AAAA,EAoCjB;AACF,GAzCc;;;ACAd,IAAI,mBAAmC,uBAAO;;;ACC9C,IAAI,YAAY,8BAAOC,UAAS,UAA0B,uBAAO,OAAO,IAAI,MAAM;AAChF,QAAM,EAAE,MAAM,OAAO,MAAM,MAAM,IAAI;AACrC,QAAM,UAAUA,oBAAmB,cAAcA,SAAQ,IAAI,UAAUA,SAAQ;AAC/E,QAAM,cAAc,QAAQ,IAAI,cAAc;AAC9C,MAAI,aAAa,WAAW,qBAAqB,KAAK,aAAa,WAAW,mCAAmC,GAAG;AAClH,WAAO,cAAcA,UAAS,EAAE,KAAK,IAAI,CAAC;AAAA,EAC5C;AACA,SAAO,CAAC;AACV,GARgB;AAShB,eAAe,cAAcA,UAAS,SAAS;AAC7C,QAAM,WAAW,MAAMA,SAAQ,SAAS;AACxC,MAAI,UAAU;AACZ,WAAO,0BAA0B,UAAU,OAAO;AAAA,EACpD;AACA,SAAO,CAAC;AACV;AANe;AAOf,SAAS,0BAA0B,UAAU,SAAS;AACpD,QAAM,OAAuB,uBAAO,OAAO,IAAI;AAC/C,WAAS,QAAQ,CAAC,OAAO,QAAQ;AAC/B,UAAM,uBAAuB,QAAQ,OAAO,IAAI,SAAS,IAAI;AAC7D,QAAI,CAAC,sBAAsB;AACzB,WAAK,GAAG,IAAI;AAAA,IACd,OAAO;AACL,6BAAuB,MAAM,KAAK,KAAK;AAAA,IACzC;AAAA,EACF,CAAC;AACD,MAAI,QAAQ,KAAK;AACf,WAAO,QAAQ,IAAI,EAAE,QAAQ,CAAC,CAAC,KAAK,KAAK,MAAM;AAC7C,YAAM,uBAAuB,IAAI,SAAS,GAAG;AAC7C,UAAI,sBAAsB;AACxB,kCAA0B,MAAM,KAAK,KAAK;AAC1C,eAAO,KAAK,GAAG;AAAA,MACjB;AAAA,IACF,CAAC;AAAA,EACH;AACA,SAAO;AACT;AApBS;AAqBT,IAAI,yBAAyB,wBAAC,MAAM,KAAK,UAAU;AACjD,MAAI,KAAK,GAAG,MAAM,QAAQ;AACxB,QAAI,MAAM,QAAQ,KAAK,GAAG,CAAC,GAAG;AAC5B;AACA,WAAK,GAAG,EAAE,KAAK,KAAK;AAAA,IACtB,OAAO;AACL,WAAK,GAAG,IAAI,CAAC,KAAK,GAAG,GAAG,KAAK;AAAA,IAC/B;AAAA,EACF,OAAO;AACL,QAAI,CAAC,IAAI,SAAS,IAAI,GAAG;AACvB,WAAK,GAAG,IAAI;AAAA,IACd,OAAO;AACL,WAAK,GAAG,IAAI,CAAC,KAAK;AAAA,IACpB;AAAA,EACF;AACF,GAf6B;AAgB7B,IAAI,4BAA4B,wBAAC,MAAM,KAAK,UAAU;AACpD,MAAI,aAAa;AACjB,QAAM,OAAO,IAAI,MAAM,GAAG;AAC1B,OAAK,QAAQ,CAAC,MAAM,UAAU;AAC5B,QAAI,UAAU,KAAK,SAAS,GAAG;AAC7B,iBAAW,IAAI,IAAI;AAAA,IACrB,OAAO;AACL,UAAI,CAAC,WAAW,IAAI,KAAK,OAAO,WAAW,IAAI,MAAM,YAAY,MAAM,QAAQ,WAAW,IAAI,CAAC,KAAK,WAAW,IAAI,aAAa,MAAM;AACpI,mBAAW,IAAI,IAAoB,uBAAO,OAAO,IAAI;AAAA,MACvD;AACA,mBAAa,WAAW,IAAI;AAAA,IAC9B;AAAA,EACF,CAAC;AACH,GAbgC;;;ACtDhC,IAAI,YAAY,wBAAC,SAAS;AACxB,QAAM,QAAQ,KAAK,MAAM,GAAG;AAC5B,MAAI,MAAM,CAAC,MAAM,IAAI;AACnB,UAAM,MAAM;AAAA,EACd;AACA,SAAO;AACT,GANgB;AAOhB,IAAI,mBAAmB,wBAAC,cAAc;AACpC,QAAM,EAAE,QAAQ,KAAK,IAAI,sBAAsB,SAAS;AACxD,QAAM,QAAQ,UAAU,IAAI;AAC5B,SAAO,kBAAkB,OAAO,MAAM;AACxC,GAJuB;AAKvB,IAAI,wBAAwB,wBAAC,SAAS;AACpC,QAAM,SAAS,CAAC;AAChB,SAAO,KAAK,QAAQ,cAAc,CAACC,QAAO,UAAU;AAClD,UAAM,OAAO,IAAI,KAAK;AACtB,WAAO,KAAK,CAAC,MAAMA,MAAK,CAAC;AACzB,WAAO;AAAA,EACT,CAAC;AACD,SAAO,EAAE,QAAQ,KAAK;AACxB,GAR4B;AAS5B,IAAI,oBAAoB,wBAAC,OAAO,WAAW;AACzC,WAAS,IAAI,OAAO,SAAS,GAAG,KAAK,GAAG,KAAK;AAC3C,UAAM,CAAC,IAAI,IAAI,OAAO,CAAC;AACvB,aAAS,IAAI,MAAM,SAAS,GAAG,KAAK,GAAG,KAAK;AAC1C,UAAI,MAAM,CAAC,EAAE,SAAS,IAAI,GAAG;AAC3B,cAAM,CAAC,IAAI,MAAM,CAAC,EAAE,QAAQ,MAAM,OAAO,CAAC,EAAE,CAAC,CAAC;AAC9C;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACA,SAAO;AACT,GAXwB;AAYxB,IAAI,eAAe,CAAC;AACpB,IAAI,aAAa,wBAAC,OAAO,SAAS;AAChC,MAAI,UAAU,KAAK;AACjB,WAAO;AAAA,EACT;AACA,QAAMA,SAAQ,MAAM,MAAM,6BAA6B;AACvD,MAAIA,QAAO;AACT,UAAM,WAAW,GAAG,KAAK,IAAI,IAAI;AACjC,QAAI,CAAC,aAAa,QAAQ,GAAG;AAC3B,UAAIA,OAAM,CAAC,GAAG;AACZ,qBAAa,QAAQ,IAAI,QAAQ,KAAK,CAAC,MAAM,OAAO,KAAK,CAAC,MAAM,MAAM,CAAC,UAAUA,OAAM,CAAC,GAAG,IAAI,OAAO,IAAIA,OAAM,CAAC,CAAC,OAAO,IAAI,GAAG,CAAC,IAAI,CAAC,OAAOA,OAAM,CAAC,GAAG,IAAI,OAAO,IAAIA,OAAM,CAAC,CAAC,GAAG,CAAC;AAAA,MACpL,OAAO;AACL,qBAAa,QAAQ,IAAI,CAAC,OAAOA,OAAM,CAAC,GAAG,IAAI;AAAA,MACjD;AAAA,IACF;AACA,WAAO,aAAa,QAAQ;AAAA,EAC9B;AACA,SAAO;AACT,GAjBiB;AAkBjB,IAAI,YAAY,wBAAC,KAAK,YAAY;AAChC,MAAI;AACF,WAAO,QAAQ,GAAG;AAAA,EACpB,QAAQ;AACN,WAAO,IAAI,QAAQ,yBAAyB,CAACA,WAAU;AACrD,UAAI;AACF,eAAO,QAAQA,MAAK;AAAA,MACtB,QAAQ;AACN,eAAOA;AAAA,MACT;AAAA,IACF,CAAC;AAAA,EACH;AACF,GAZgB;AAahB,IAAI,eAAe,wBAAC,QAAQ,UAAU,KAAK,SAAS,GAAjC;AACnB,IAAI,UAAU,wBAACC,aAAY;AACzB,QAAM,MAAMA,SAAQ;AACpB,QAAM,QAAQ,IAAI,QAAQ,KAAK,IAAI,QAAQ,GAAG,IAAI,CAAC;AACnD,MAAI,IAAI;AACR,SAAO,IAAI,IAAI,QAAQ,KAAK;AAC1B,UAAM,WAAW,IAAI,WAAW,CAAC;AACjC,QAAI,aAAa,IAAI;AACnB,YAAM,aAAa,IAAI,QAAQ,KAAK,CAAC;AACrC,YAAM,OAAO,IAAI,MAAM,OAAO,eAAe,KAAK,SAAS,UAAU;AACrE,aAAO,aAAa,KAAK,SAAS,KAAK,IAAI,KAAK,QAAQ,QAAQ,OAAO,IAAI,IAAI;AAAA,IACjF,WAAW,aAAa,IAAI;AAC1B;AAAA,IACF;AAAA,EACF;AACA,SAAO,IAAI,MAAM,OAAO,CAAC;AAC3B,GAfc;AAoBd,IAAI,kBAAkB,wBAACC,aAAY;AACjC,QAAM,SAAS,QAAQA,QAAO;AAC9B,SAAO,OAAO,SAAS,KAAK,OAAO,GAAG,EAAE,MAAM,MAAM,OAAO,MAAM,GAAG,EAAE,IAAI;AAC5E,GAHsB;AAItB,IAAI,YAAY,wBAAC,MAAM,QAAQ,SAAS;AACtC,MAAI,KAAK,QAAQ;AACf,UAAM,UAAU,KAAK,GAAG,IAAI;AAAA,EAC9B;AACA,SAAO,GAAG,OAAO,CAAC,MAAM,MAAM,KAAK,GAAG,GAAG,IAAI,GAAG,QAAQ,MAAM,KAAK,GAAG,MAAM,GAAG,EAAE,MAAM,MAAM,KAAK,GAAG,GAAG,MAAM,CAAC,MAAM,MAAM,IAAI,MAAM,CAAC,IAAI,GAAG,EAAE;AACjJ,GALgB;AAMhB,IAAI,yBAAyB,wBAAC,SAAS;AACrC,MAAI,KAAK,WAAW,KAAK,SAAS,CAAC,MAAM,MAAM,CAAC,KAAK,SAAS,GAAG,GAAG;AAClE,WAAO;AAAA,EACT;AACA,QAAM,WAAW,KAAK,MAAM,GAAG;AAC/B,QAAM,UAAU,CAAC;AACjB,MAAI,WAAW;AACf,WAAS,QAAQ,CAAC,YAAY;AAC5B,QAAI,YAAY,MAAM,CAAC,KAAK,KAAK,OAAO,GAAG;AACzC,kBAAY,MAAM;AAAA,IACpB,WAAW,KAAK,KAAK,OAAO,GAAG;AAC7B,UAAI,KAAK,KAAK,OAAO,GAAG;AACtB,YAAI,QAAQ,WAAW,KAAK,aAAa,IAAI;AAC3C,kBAAQ,KAAK,GAAG;AAAA,QAClB,OAAO;AACL,kBAAQ,KAAK,QAAQ;AAAA,QACvB;AACA,cAAM,kBAAkB,QAAQ,QAAQ,KAAK,EAAE;AAC/C,oBAAY,MAAM;AAClB,gBAAQ,KAAK,QAAQ;AAAA,MACvB,OAAO;AACL,oBAAY,MAAM;AAAA,MACpB;AAAA,IACF;AAAA,EACF,CAAC;AACD,SAAO,QAAQ,OAAO,CAAC,GAAG,GAAG,MAAM,EAAE,QAAQ,CAAC,MAAM,CAAC;AACvD,GA1B6B;AA2B7B,IAAI,aAAa,wBAAC,UAAU;AAC1B,MAAI,CAAC,OAAO,KAAK,KAAK,GAAG;AACvB,WAAO;AAAA,EACT;AACA,MAAI,MAAM,QAAQ,GAAG,MAAM,IAAI;AAC7B,YAAQ,MAAM,QAAQ,OAAO,GAAG;AAAA,EAClC;AACA,SAAO,MAAM,QAAQ,GAAG,MAAM,KAAK,UAAU,OAAO,mBAAmB,IAAI;AAC7E,GARiB;AASjB,IAAI,iBAAiB,wBAAC,KAAK,KAAK,aAAa;AAC3C,MAAI;AACJ,MAAI,CAAC,YAAY,OAAO,CAAC,OAAO,KAAK,GAAG,GAAG;AACzC,QAAI,YAAY,IAAI,QAAQ,KAAK,CAAC;AAClC,QAAI,cAAc,IAAI;AACpB,aAAO;AAAA,IACT;AACA,QAAI,CAAC,IAAI,WAAW,KAAK,YAAY,CAAC,GAAG;AACvC,kBAAY,IAAI,QAAQ,IAAI,GAAG,IAAI,YAAY,CAAC;AAAA,IAClD;AACA,WAAO,cAAc,IAAI;AACvB,YAAM,kBAAkB,IAAI,WAAW,YAAY,IAAI,SAAS,CAAC;AACjE,UAAI,oBAAoB,IAAI;AAC1B,cAAM,aAAa,YAAY,IAAI,SAAS;AAC5C,cAAM,WAAW,IAAI,QAAQ,KAAK,UAAU;AAC5C,eAAO,WAAW,IAAI,MAAM,YAAY,aAAa,KAAK,SAAS,QAAQ,CAAC;AAAA,MAC9E,WAAW,mBAAmB,MAAM,MAAM,eAAe,GAAG;AAC1D,eAAO;AAAA,MACT;AACA,kBAAY,IAAI,QAAQ,IAAI,GAAG,IAAI,YAAY,CAAC;AAAA,IAClD;AACA,cAAU,OAAO,KAAK,GAAG;AACzB,QAAI,CAAC,SAAS;AACZ,aAAO;AAAA,IACT;AAAA,EACF;AACA,QAAM,UAAU,CAAC;AACjB,cAAY,OAAO,KAAK,GAAG;AAC3B,MAAI,WAAW,IAAI,QAAQ,KAAK,CAAC;AACjC,SAAO,aAAa,IAAI;AACtB,UAAM,eAAe,IAAI,QAAQ,KAAK,WAAW,CAAC;AAClD,QAAI,aAAa,IAAI,QAAQ,KAAK,QAAQ;AAC1C,QAAI,aAAa,gBAAgB,iBAAiB,IAAI;AACpD,mBAAa;AAAA,IACf;AACA,QAAI,OAAO,IAAI;AAAA,MACb,WAAW;AAAA,MACX,eAAe,KAAK,iBAAiB,KAAK,SAAS,eAAe;AAAA,IACpE;AACA,QAAI,SAAS;AACX,aAAO,WAAW,IAAI;AAAA,IACxB;AACA,eAAW;AACX,QAAI,SAAS,IAAI;AACf;AAAA,IACF;AACA,QAAI;AACJ,QAAI,eAAe,IAAI;AACrB,cAAQ;AAAA,IACV,OAAO;AACL,cAAQ,IAAI,MAAM,aAAa,GAAG,iBAAiB,KAAK,SAAS,YAAY;AAC7E,UAAI,SAAS;AACX,gBAAQ,WAAW,KAAK;AAAA,MAC1B;AAAA,IACF;AACA,QAAI,UAAU;AACZ,UAAI,EAAE,QAAQ,IAAI,KAAK,MAAM,QAAQ,QAAQ,IAAI,CAAC,IAAI;AACpD,gBAAQ,IAAI,IAAI,CAAC;AAAA,MACnB;AACA;AACA,cAAQ,IAAI,EAAE,KAAK,KAAK;AAAA,IAC1B,OAAO;AACL,cAAQ,IAAI,MAAM;AAAA,IACpB;AAAA,EACF;AACA,SAAO,MAAM,QAAQ,GAAG,IAAI;AAC9B,GAlEqB;AAmErB,IAAI,gBAAgB;AACpB,IAAI,iBAAiB,wBAAC,KAAK,QAAQ;AACjC,SAAO,eAAe,KAAK,KAAK,IAAI;AACtC,GAFqB;AAGrB,IAAI,sBAAsB;;;ACvM1B,IAAI,wBAAwB,wBAAC,QAAQ,UAAU,KAAK,mBAAmB,GAA3C;AAC5B,IAAI,cAAc,MAAM;AAAA,EANxB,OAMwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAetB;AAAA,EACA;AAAA;AAAA,EAEA;AAAA,EACA,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAab;AAAA,EACA,YAAY,CAAC;AAAA,EACb,YAAYC,UAAS,OAAO,KAAK,cAAc,CAAC,CAAC,CAAC,GAAG;AACnD,SAAK,MAAMA;AACX,SAAK,OAAO;AACZ,SAAK,eAAe;AACpB,SAAK,iBAAiB,CAAC;AAAA,EACzB;AAAA,EACA,MAAM,KAAK;AACT,WAAO,MAAM,KAAK,iBAAiB,GAAG,IAAI,KAAK,qBAAqB;AAAA,EACtE;AAAA,EACA,iBAAiB,KAAK;AACpB,UAAM,WAAW,KAAK,aAAa,CAAC,EAAE,KAAK,UAAU,EAAE,CAAC,EAAE,GAAG;AAC7D,UAAM,QAAQ,KAAK,eAAe,QAAQ;AAC1C,WAAO,SAAS,KAAK,KAAK,KAAK,IAAI,sBAAsB,KAAK,IAAI;AAAA,EACpE;AAAA,EACA,uBAAuB;AACrB,UAAM,UAAU,CAAC;AACjB,UAAM,OAAO,OAAO,KAAK,KAAK,aAAa,CAAC,EAAE,KAAK,UAAU,EAAE,CAAC,CAAC;AACjE,eAAW,OAAO,MAAM;AACtB,YAAM,QAAQ,KAAK,eAAe,KAAK,aAAa,CAAC,EAAE,KAAK,UAAU,EAAE,CAAC,EAAE,GAAG,CAAC;AAC/E,UAAI,UAAU,QAAQ;AACpB,gBAAQ,GAAG,IAAI,KAAK,KAAK,KAAK,IAAI,sBAAsB,KAAK,IAAI;AAAA,MACnE;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EACA,eAAe,UAAU;AACvB,WAAO,KAAK,aAAa,CAAC,IAAI,KAAK,aAAa,CAAC,EAAE,QAAQ,IAAI;AAAA,EACjE;AAAA,EACA,MAAM,KAAK;AACT,WAAO,cAAc,KAAK,KAAK,GAAG;AAAA,EACpC;AAAA,EACA,QAAQ,KAAK;AACX,WAAO,eAAe,KAAK,KAAK,GAAG;AAAA,EACrC;AAAA,EACA,OAAO,MAAM;AACX,QAAI,MAAM;AACR,aAAO,KAAK,IAAI,QAAQ,IAAI,IAAI,KAAK;AAAA,IACvC;AACA,UAAM,aAAa,CAAC;AACpB,SAAK,IAAI,QAAQ,QAAQ,CAAC,OAAO,QAAQ;AACvC,iBAAW,GAAG,IAAI;AAAA,IACpB,CAAC;AACD,WAAO;AAAA,EACT;AAAA,EACA,MAAM,UAAU,SAAS;AACvB,WAAO,KAAK,UAAU,eAAe,MAAM,UAAU,MAAM,OAAO;AAAA,EACpE;AAAA,EACA,cAAc,wBAAC,QAAQ;AACrB,UAAM,EAAE,WAAW,KAAAC,KAAI,IAAI;AAC3B,UAAM,aAAa,UAAU,GAAG;AAChC,QAAI,YAAY;AACd,aAAO;AAAA,IACT;AACA,UAAM,eAAe,OAAO,KAAK,SAAS,EAAE,CAAC;AAC7C,QAAI,cAAc;AAChB,aAAO,UAAU,YAAY,EAAE,KAAK,CAAC,SAAS;AAC5C,YAAI,iBAAiB,QAAQ;AAC3B,iBAAO,KAAK,UAAU,IAAI;AAAA,QAC5B;AACA,eAAO,IAAI,SAAS,IAAI,EAAE,GAAG,EAAE;AAAA,MACjC,CAAC;AAAA,IACH;AACA,WAAO,UAAU,GAAG,IAAIA,KAAI,GAAG,EAAE;AAAA,EACnC,GAhBc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA6Bd,OAAO;AACL,WAAO,KAAK,YAAY,MAAM,EAAE,KAAK,CAAC,SAAS,KAAK,MAAM,IAAI,CAAC;AAAA,EACjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,OAAO;AACL,WAAO,KAAK,YAAY,MAAM;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,cAAc;AACZ,WAAO,KAAK,YAAY,aAAa;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,OAAO;AACL,WAAO,KAAK,YAAY,MAAM;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,WAAW;AACT,WAAO,KAAK,YAAY,UAAU;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,iBAAiB,QAAQ,MAAM;AAC7B,SAAK,eAAe,MAAM,IAAI;AAAA,EAChC;AAAA,EACA,MAAM,QAAQ;AACZ,WAAO,KAAK,eAAe,MAAM;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,IAAI,MAAM;AACR,WAAO,KAAK,IAAI;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,IAAI,SAAS;AACX,WAAO,KAAK,IAAI;AAAA,EAClB;AAAA,EACA,KAAK,gBAAgB,IAAI;AACvB,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA4BA,IAAI,gBAAgB;AAClB,WAAO,KAAK,aAAa,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,MAAM,KAAK;AAAA,EACxD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBA,IAAI,YAAY;AACd,WAAO,KAAK,aAAa,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,MAAM,KAAK,EAAE,KAAK,UAAU,EAAE;AAAA,EAC3E;AACF;;;AC7QA,IAAI,2BAA2B;AAAA,EAC7B,WAAW;AAAA,EACX,cAAc;AAAA,EACd,QAAQ;AACV;AACA,IAAI,MAAM,wBAAC,OAAO,cAAc;AAC9B,QAAM,gBAAgB,IAAI,OAAO,KAAK;AACtC,gBAAc,YAAY;AAC1B,gBAAc,YAAY;AAC1B,SAAO;AACT,GALU;AAgFV,IAAI,kBAAkB,8BAAO,KAAK,OAAO,mBAAmB,SAAS,WAAW;AAC9E,MAAI,OAAO,QAAQ,YAAY,EAAE,eAAe,SAAS;AACvD,QAAI,EAAE,eAAe,UAAU;AAC7B,YAAM,IAAI,SAAS;AAAA,IACrB;AACA,QAAI,eAAe,SAAS;AAC1B,YAAM,MAAM;AAAA,IACd;AAAA,EACF;AACA,QAAM,YAAY,IAAI;AACtB,MAAI,CAAC,WAAW,QAAQ;AACtB,WAAO,QAAQ,QAAQ,GAAG;AAAA,EAC5B;AACA,MAAI,QAAQ;AACV,WAAO,CAAC,KAAK;AAAA,EACf,OAAO;AACL,aAAS,CAAC,GAAG;AAAA,EACf;AACA,QAAM,SAAS,QAAQ,IAAI,UAAU,IAAI,CAAC,MAAM,EAAE,EAAE,OAAO,QAAQ,QAAQ,CAAC,CAAC,CAAC,EAAE;AAAA,IAC9E,CAAC,QAAQ,QAAQ;AAAA,MACf,IAAI,OAAO,OAAO,EAAE,IAAI,CAAC,SAAS,gBAAgB,MAAM,OAAO,OAAO,SAAS,MAAM,CAAC;AAAA,IACxF,EAAE,KAAK,MAAM,OAAO,CAAC,CAAC;AAAA,EACxB;AACA,MAAI,mBAAmB;AACrB,WAAO,IAAI,MAAM,QAAQ,SAAS;AAAA,EACpC,OAAO;AACL,WAAO;AAAA,EACT;AACF,GA5BsB;;;ACnFtB,IAAI,aAAa;AACjB,IAAI,wBAAwB,wBAAC,aAAa,YAAY;AACpD,SAAO;AAAA,IACL,gBAAgB;AAAA,IAChB,GAAG;AAAA,EACL;AACF,GAL4B;AAM5B,IAAI,UAAU,MAAM;AAAA,EAVpB,OAUoB;AAAA;AAAA;AAAA,EAClB;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,MAAM,CAAC;AAAA,EACP;AAAA,EACA,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgBZ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,YAAY,KAAK,SAAS;AACxB,SAAK,cAAc;AACnB,QAAI,SAAS;AACX,WAAK,gBAAgB,QAAQ;AAC7B,WAAK,MAAM,QAAQ;AACnB,WAAK,mBAAmB,QAAQ;AAChC,WAAK,QAAQ,QAAQ;AACrB,WAAK,eAAe,QAAQ;AAAA,IAC9B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAIA,IAAI,MAAM;AACR,SAAK,SAAS,IAAI,YAAY,KAAK,aAAa,KAAK,OAAO,KAAK,YAAY;AAC7E,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,IAAI,QAAQ;AACV,QAAI,KAAK,iBAAiB,iBAAiB,KAAK,eAAe;AAC7D,aAAO,KAAK;AAAA,IACd,OAAO;AACL,YAAM,MAAM,gCAAgC;AAAA,IAC9C;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,IAAI,eAAe;AACjB,QAAI,KAAK,eAAe;AACtB,aAAO,KAAK;AAAA,IACd,OAAO;AACL,YAAM,MAAM,sCAAsC;AAAA,IACpD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA,IAAI,MAAM;AACR,WAAO,KAAK,SAAS,IAAI,SAAS,MAAM;AAAA,MACtC,SAAS,KAAK,qBAAqB,IAAI,QAAQ;AAAA,IACjD,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,IAAI,IAAI,MAAM;AACZ,QAAI,KAAK,QAAQ,MAAM;AACrB,aAAO,IAAI,SAAS,KAAK,MAAM,IAAI;AACnC,iBAAW,CAAC,GAAG,CAAC,KAAK,KAAK,KAAK,QAAQ,QAAQ,GAAG;AAChD,YAAI,MAAM,gBAAgB;AACxB;AAAA,QACF;AACA,YAAI,MAAM,cAAc;AACtB,gBAAM,UAAU,KAAK,KAAK,QAAQ,aAAa;AAC/C,eAAK,QAAQ,OAAO,YAAY;AAChC,qBAAW,UAAU,SAAS;AAC5B,iBAAK,QAAQ,OAAO,cAAc,MAAM;AAAA,UAC1C;AAAA,QACF,OAAO;AACL,eAAK,QAAQ,IAAI,GAAG,CAAC;AAAA,QACvB;AAAA,MACF;AAAA,IACF;AACA,SAAK,OAAO;AACZ,SAAK,YAAY;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,SAAS,2BAAI,SAAS;AACpB,SAAK,cAAc,CAAC,YAAY,KAAK,KAAK,OAAO;AACjD,WAAO,KAAK,UAAU,GAAG,IAAI;AAAA,EAC/B,GAHS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUT,YAAY,wBAAC,WAAW,KAAK,UAAU,QAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMZ,YAAY,6BAAM,KAAK,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAsBZ,cAAc,wBAAC,aAAa;AAC1B,SAAK,YAAY;AAAA,EACnB,GAFc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBd,SAAS,wBAAC,MAAM,OAAO,YAAY;AACjC,QAAI,KAAK,WAAW;AAClB,WAAK,OAAO,IAAI,SAAS,KAAK,KAAK,MAAM,KAAK,IAAI;AAAA,IACpD;AACA,UAAM,UAAU,KAAK,OAAO,KAAK,KAAK,UAAU,KAAK,qBAAqB,IAAI,QAAQ;AACtF,QAAI,UAAU,QAAQ;AACpB,cAAQ,OAAO,IAAI;AAAA,IACrB,WAAW,SAAS,QAAQ;AAC1B,cAAQ,OAAO,MAAM,KAAK;AAAA,IAC5B,OAAO;AACL,cAAQ,IAAI,MAAM,KAAK;AAAA,IACzB;AAAA,EACF,GAZS;AAAA,EAaT,SAAS,wBAAC,WAAW;AACnB,SAAK,UAAU;AAAA,EACjB,GAFS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgBT,MAAM,wBAAC,KAAK,UAAU;AACpB,SAAK,SAAyB,oBAAI,IAAI;AACtC,SAAK,KAAK,IAAI,KAAK,KAAK;AAAA,EAC1B,GAHM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBN,MAAM,wBAAC,QAAQ;AACb,WAAO,KAAK,OAAO,KAAK,KAAK,IAAI,GAAG,IAAI;AAAA,EAC1C,GAFM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcN,IAAI,MAAM;AACR,QAAI,CAAC,KAAK,MAAM;AACd,aAAO,CAAC;AAAA,IACV;AACA,WAAO,OAAO,YAAY,KAAK,IAAI;AAAA,EACrC;AAAA,EACA,aAAa,MAAM,KAAK,SAAS;AAC/B,UAAM,kBAAkB,KAAK,OAAO,IAAI,QAAQ,KAAK,KAAK,OAAO,IAAI,KAAK,oBAAoB,IAAI,QAAQ;AAC1G,QAAI,OAAO,QAAQ,YAAY,aAAa,KAAK;AAC/C,YAAM,aAAa,IAAI,mBAAmB,UAAU,IAAI,UAAU,IAAI,QAAQ,IAAI,OAAO;AACzF,iBAAW,CAAC,KAAK,KAAK,KAAK,YAAY;AACrC,YAAI,IAAI,YAAY,MAAM,cAAc;AACtC,0BAAgB,OAAO,KAAK,KAAK;AAAA,QACnC,OAAO;AACL,0BAAgB,IAAI,KAAK,KAAK;AAAA,QAChC;AAAA,MACF;AAAA,IACF;AACA,QAAI,SAAS;AACX,iBAAW,CAAC,GAAG,CAAC,KAAK,OAAO,QAAQ,OAAO,GAAG;AAC5C,YAAI,OAAO,MAAM,UAAU;AACzB,0BAAgB,IAAI,GAAG,CAAC;AAAA,QAC1B,OAAO;AACL,0BAAgB,OAAO,CAAC;AACxB,qBAAW,MAAM,GAAG;AAClB,4BAAgB,OAAO,GAAG,EAAE;AAAA,UAC9B;AAAA,QACF;AAAA,MACF;AAAA,IACF;AACA,UAAM,SAAS,OAAO,QAAQ,WAAW,MAAM,KAAK,UAAU,KAAK;AACnE,WAAO,IAAI,SAAS,MAAM,EAAE,QAAQ,SAAS,gBAAgB,CAAC;AAAA,EAChE;AAAA,EACA,cAAc,2BAAI,SAAS,KAAK,aAAa,GAAG,IAAI,GAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAsBd,OAAO,wBAAC,MAAM,KAAK,YAAY,KAAK,aAAa,MAAM,KAAK,OAAO,GAA5D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaP,OAAO,wBAAC,MAAM,KAAK,YAAY;AAC7B,WAAO,CAAC,KAAK,oBAAoB,CAAC,KAAK,WAAW,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,YAAY,IAAI,SAAS,IAAI,IAAI,KAAK;AAAA,MAChH;AAAA,MACA;AAAA,MACA,sBAAsB,YAAY,OAAO;AAAA,IAC3C;AAAA,EACF,GANO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBP,OAAO,wBAAC,QAAQ,KAAK,YAAY;AAC/B,WAAO,KAAK;AAAA,MACV,KAAK,UAAU,MAAM;AAAA,MACrB;AAAA,MACA,sBAAsB,oBAAoB,OAAO;AAAA,IACnD;AAAA,EACF,GANO;AAAA,EAOP,OAAO,wBAAC,MAAM,KAAK,YAAY;AAC7B,UAAM,MAAM,wBAAC,UAAU,KAAK,aAAa,OAAO,KAAK,sBAAsB,4BAA4B,OAAO,CAAC,GAAnG;AACZ,WAAO,OAAO,SAAS,WAAW,gBAAgB,MAAM,yBAAyB,WAAW,OAAO,CAAC,CAAC,EAAE,KAAK,GAAG,IAAI,IAAI,IAAI;AAAA,EAC7H,GAHO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBP,WAAW,wBAAC,UAAU,WAAW;AAC/B,UAAM,iBAAiB,OAAO,QAAQ;AACtC,SAAK;AAAA,MACH;AAAA;AAAA;AAAA,MAGA,CAAC,eAAe,KAAK,cAAc,IAAI,iBAAiB,UAAU,cAAc;AAAA,IAClF;AACA,WAAO,KAAK,YAAY,MAAM,UAAU,GAAG;AAAA,EAC7C,GATW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAsBX,WAAW,6BAAM;AACf,SAAK,qBAAqB,MAAM,IAAI,SAAS;AAC7C,WAAO,KAAK,iBAAiB,IAAI;AAAA,EACnC,GAHW;AAIb;;;ACrZA,IAAI,kBAAkB;AACtB,IAAI,4BAA4B;AAChC,IAAI,UAAU,CAAC,OAAO,QAAQ,OAAO,UAAU,WAAW,OAAO;AACjE,IAAI,mCAAmC;AACvC,IAAI,uBAAuB,cAAc,MAAM;AAAA,EAL/C,OAK+C;AAAA;AAAA;AAC/C;;;ACLA,IAAI,mBAAmB;;;ACKvB,IAAI,kBAAkB,wBAAC,MAAM;AAC3B,SAAO,EAAE,KAAK,iBAAiB,GAAG;AACpC,GAFsB;AAGtB,IAAI,eAAe,wBAAC,KAAK,MAAM;AAC7B,MAAI,iBAAiB,KAAK;AACxB,UAAM,MAAM,IAAI,YAAY;AAC5B,WAAO,EAAE,YAAY,IAAI,MAAM,GAAG;AAAA,EACpC;AACA,UAAQ,MAAM,GAAG;AACjB,SAAO,EAAE,KAAK,yBAAyB,GAAG;AAC5C,GAPmB;AAQnB,IAAI,OAAO,MAAM,MAAM;AAAA,EAjBvB,OAiBuB;AAAA;AAAA;AAAA,EACrB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA,EAKA;AAAA,EACA;AAAA;AAAA,EAEA,YAAY;AAAA,EACZ,QAAQ;AAAA,EACR,SAAS,CAAC;AAAA,EACV,YAAY,UAAU,CAAC,GAAG;AACxB,UAAM,aAAa,CAAC,GAAG,SAAS,yBAAyB;AACzD,eAAW,QAAQ,CAAC,WAAW;AAC7B,WAAK,MAAM,IAAI,CAAC,UAAU,SAAS;AACjC,YAAI,OAAO,UAAU,UAAU;AAC7B,eAAK,QAAQ;AAAA,QACf,OAAO;AACL,eAAK,UAAU,QAAQ,KAAK,OAAO,KAAK;AAAA,QAC1C;AACA,aAAK,QAAQ,CAAC,YAAY;AACxB,eAAK,UAAU,QAAQ,KAAK,OAAO,OAAO;AAAA,QAC5C,CAAC;AACD,eAAO;AAAA,MACT;AAAA,IACF,CAAC;AACD,SAAK,KAAK,CAAC,QAAQ,SAAS,aAAa;AACvC,iBAAWC,MAAK,CAAC,IAAI,EAAE,KAAK,GAAG;AAC7B,aAAK,QAAQA;AACb,mBAAW,KAAK,CAAC,MAAM,EAAE,KAAK,GAAG;AAC/B,mBAAS,IAAI,CAAC,YAAY;AACxB,iBAAK,UAAU,EAAE,YAAY,GAAG,KAAK,OAAO,OAAO;AAAA,UACrD,CAAC;AAAA,QACH;AAAA,MACF;AACA,aAAO;AAAA,IACT;AACA,SAAK,MAAM,CAAC,SAAS,aAAa;AAChC,UAAI,OAAO,SAAS,UAAU;AAC5B,aAAK,QAAQ;AAAA,MACf,OAAO;AACL,aAAK,QAAQ;AACb,iBAAS,QAAQ,IAAI;AAAA,MACvB;AACA,eAAS,QAAQ,CAAC,YAAY;AAC5B,aAAK,UAAU,iBAAiB,KAAK,OAAO,OAAO;AAAA,MACrD,CAAC;AACD,aAAO;AAAA,IACT;AACA,UAAM,EAAE,QAAQ,GAAG,qBAAqB,IAAI;AAC5C,WAAO,OAAO,MAAM,oBAAoB;AACxC,SAAK,UAAU,UAAU,OAAO,QAAQ,WAAW,UAAU;AAAA,EAC/D;AAAA,EACA,SAAS;AACP,UAAM,QAAQ,IAAI,MAAM;AAAA,MACtB,QAAQ,KAAK;AAAA,MACb,SAAS,KAAK;AAAA,IAChB,CAAC;AACD,UAAM,eAAe,KAAK;AAC1B,UAAM,mBAAmB,KAAK;AAC9B,UAAM,SAAS,KAAK;AACpB,WAAO;AAAA,EACT;AAAA,EACA,mBAAmB;AAAA;AAAA,EAEnB,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBf,MAAM,MAAM,KAAK;AACf,UAAM,SAAS,KAAK,SAAS,IAAI;AACjC,QAAI,OAAO,IAAI,CAACC,OAAM;AACpB,UAAI;AACJ,UAAI,IAAI,iBAAiB,cAAc;AACrC,kBAAUA,GAAE;AAAA,MACd,OAAO;AACL,kBAAU,8BAAO,GAAG,UAAU,MAAM,QAAQ,CAAC,GAAG,IAAI,YAAY,EAAE,GAAG,MAAMA,GAAE,QAAQ,GAAG,IAAI,CAAC,GAAG,KAAtF;AACV,gBAAQ,gBAAgB,IAAIA,GAAE;AAAA,MAChC;AACA,aAAO,UAAUA,GAAE,QAAQA,GAAE,MAAM,OAAO;AAAA,IAC5C,CAAC;AACD,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,SAAS,MAAM;AACb,UAAM,SAAS,KAAK,OAAO;AAC3B,WAAO,YAAY,UAAU,KAAK,WAAW,IAAI;AACjD,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBA,UAAU,wBAAC,YAAY;AACrB,SAAK,eAAe;AACpB,WAAO;AAAA,EACT,GAHU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBV,WAAW,wBAAC,YAAY;AACtB,SAAK,mBAAmB;AACxB,WAAO;AAAA,EACT,GAHW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAoCX,MAAM,MAAM,oBAAoB,SAAS;AACvC,QAAI;AACJ,QAAI;AACJ,QAAI,SAAS;AACX,UAAI,OAAO,YAAY,YAAY;AACjC,wBAAgB;AAAA,MAClB,OAAO;AACL,wBAAgB,QAAQ;AACxB,YAAI,QAAQ,mBAAmB,OAAO;AACpC,2BAAiB,wBAACC,aAAYA,UAAb;AAAA,QACnB,OAAO;AACL,2BAAiB,QAAQ;AAAA,QAC3B;AAAA,MACF;AAAA,IACF;AACA,UAAM,aAAa,gBAAgB,CAAC,MAAM;AACxC,YAAM,WAAW,cAAc,CAAC;AAChC,aAAO,MAAM,QAAQ,QAAQ,IAAI,WAAW,CAAC,QAAQ;AAAA,IACvD,IAAI,CAAC,MAAM;AACT,UAAI,mBAAmB;AACvB,UAAI;AACF,2BAAmB,EAAE;AAAA,MACvB,QAAQ;AAAA,MACR;AACA,aAAO,CAAC,EAAE,KAAK,gBAAgB;AAAA,IACjC;AACA,wBAAoB,MAAM;AACxB,YAAM,aAAa,UAAU,KAAK,WAAW,IAAI;AACjD,YAAM,mBAAmB,eAAe,MAAM,IAAI,WAAW;AAC7D,aAAO,CAACA,aAAY;AAClB,cAAM,MAAM,IAAI,IAAIA,SAAQ,GAAG;AAC/B,YAAI,WAAW,IAAI,SAAS,MAAM,gBAAgB,KAAK;AACvD,eAAO,IAAI,QAAQ,KAAKA,QAAO;AAAA,MACjC;AAAA,IACF,GAAG;AACH,UAAM,UAAU,8BAAO,GAAG,SAAS;AACjC,YAAM,MAAM,MAAM,mBAAmB,eAAe,EAAE,IAAI,GAAG,GAAG,GAAG,WAAW,CAAC,CAAC;AAChF,UAAI,KAAK;AACP,eAAO;AAAA,MACT;AACA,YAAM,KAAK;AAAA,IACb,GANgB;AAOhB,SAAK,UAAU,iBAAiB,UAAU,MAAM,GAAG,GAAG,OAAO;AAC7D,WAAO;AAAA,EACT;AAAA,EACA,UAAU,QAAQ,MAAM,SAAS;AAC/B,aAAS,OAAO,YAAY;AAC5B,WAAO,UAAU,KAAK,WAAW,IAAI;AACrC,UAAMD,KAAI,EAAE,UAAU,KAAK,WAAW,MAAM,QAAQ,QAAQ;AAC5D,SAAK,OAAO,IAAI,QAAQ,MAAM,CAAC,SAASA,EAAC,CAAC;AAC1C,SAAK,OAAO,KAAKA,EAAC;AAAA,EACpB;AAAA,EACA,aAAa,KAAK,GAAG;AACnB,QAAI,eAAe,OAAO;AACxB,aAAO,KAAK,aAAa,KAAK,CAAC;AAAA,IACjC;AACA,UAAM;AAAA,EACR;AAAA,EACA,UAAUC,UAAS,cAAc,KAAK,QAAQ;AAC5C,QAAI,WAAW,QAAQ;AACrB,cAAQ,YAAY,IAAI,SAAS,MAAM,MAAM,KAAK,UAAUA,UAAS,cAAc,KAAK,KAAK,CAAC,GAAG;AAAA,IACnG;AACA,UAAM,OAAO,KAAK,QAAQA,UAAS,EAAE,IAAI,CAAC;AAC1C,UAAM,cAAc,KAAK,OAAO,MAAM,QAAQ,IAAI;AAClD,UAAM,IAAI,IAAI,QAAQA,UAAS;AAAA,MAC7B;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,iBAAiB,KAAK;AAAA,IACxB,CAAC;AACD,QAAI,YAAY,CAAC,EAAE,WAAW,GAAG;AAC/B,UAAI;AACJ,UAAI;AACF,cAAM,YAAY,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,YAAY;AAC3C,YAAE,MAAM,MAAM,KAAK,iBAAiB,CAAC;AAAA,QACvC,CAAC;AAAA,MACH,SAAS,KAAK;AACZ,eAAO,KAAK,aAAa,KAAK,CAAC;AAAA,MACjC;AACA,aAAO,eAAe,UAAU,IAAI;AAAA,QAClC,CAAC,aAAa,aAAa,EAAE,YAAY,EAAE,MAAM,KAAK,iBAAiB,CAAC;AAAA,MAC1E,EAAE,MAAM,CAAC,QAAQ,KAAK,aAAa,KAAK,CAAC,CAAC,IAAI,OAAO,KAAK,iBAAiB,CAAC;AAAA,IAC9E;AACA,UAAM,WAAW,QAAQ,YAAY,CAAC,GAAG,KAAK,cAAc,KAAK,gBAAgB;AACjF,YAAQ,YAAY;AAClB,UAAI;AACF,cAAM,UAAU,MAAM,SAAS,CAAC;AAChC,YAAI,CAAC,QAAQ,WAAW;AACtB,gBAAM,IAAI;AAAA,YACR;AAAA,UACF;AAAA,QACF;AACA,eAAO,QAAQ;AAAA,MACjB,SAAS,KAAK;AACZ,eAAO,KAAK,aAAa,KAAK,CAAC;AAAA,MACjC;AAAA,IACF,GAAG;AAAA,EACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,QAAQ,wBAACA,aAAY,SAAS;AAC5B,WAAO,KAAK,UAAUA,UAAS,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,SAAQ,MAAM;AAAA,EACjE,GAFQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAeR,UAAU,wBAAC,OAAO,aAAa,KAAK,iBAAiB;AACnD,QAAI,iBAAiB,SAAS;AAC5B,aAAO,KAAK,MAAM,cAAc,IAAI,QAAQ,OAAO,WAAW,IAAI,OAAO,KAAK,YAAY;AAAA,IAC5F;AACA,YAAQ,MAAM,SAAS;AACvB,WAAO,KAAK;AAAA,MACV,IAAI;AAAA,QACF,eAAe,KAAK,KAAK,IAAI,QAAQ,mBAAmB,UAAU,KAAK,KAAK,CAAC;AAAA,QAC7E;AAAA,MACF;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF,GAbU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA+BV,OAAO,6BAAM;AACX,qBAAiB,SAAS,CAACC,WAAU;AACnC,MAAAA,OAAM,YAAY,KAAK,UAAUA,OAAM,SAASA,QAAO,QAAQA,OAAM,QAAQ,MAAM,CAAC;AAAA,IACtF,CAAC;AAAA,EACH,GAJO;AAKT;;;ACpXA,IAAI,aAAa,CAAC;AAClB,SAAS,MAAM,QAAQ,MAAM;AAC3B,QAAM,WAAW,KAAK,iBAAiB;AACvC,QAAM,SAAU,yBAAC,SAAS,UAAU;AAClC,UAAM,UAAU,SAAS,OAAO,KAAK,SAAS,eAAe;AAC7D,UAAM,cAAc,QAAQ,CAAC,EAAE,KAAK;AACpC,QAAI,aAAa;AACf,aAAO;AAAA,IACT;AACA,UAAM,SAAS,MAAM,MAAM,QAAQ,CAAC,CAAC;AACrC,QAAI,CAAC,QAAQ;AACX,aAAO,CAAC,CAAC,GAAG,UAAU;AAAA,IACxB;AACA,UAAM,QAAQ,OAAO,QAAQ,IAAI,CAAC;AAClC,WAAO,CAAC,QAAQ,CAAC,EAAE,KAAK,GAAG,MAAM;AAAA,EACnC,IAZgB;AAahB,OAAK,QAAQ;AACb,SAAO,OAAO,QAAQ,IAAI;AAC5B;AAjBS;;;ACFT,IAAI,oBAAoB;AACxB,IAAI,4BAA4B;AAChC,IAAI,4BAA4B;AAChC,IAAI,aAA6B,uBAAO;AACxC,IAAI,kBAAkB,IAAI,IAAI,aAAa;AAC3C,SAAS,WAAW,GAAG,GAAG;AACxB,MAAI,EAAE,WAAW,GAAG;AAClB,WAAO,EAAE,WAAW,IAAI,IAAI,IAAI,KAAK,IAAI;AAAA,EAC3C;AACA,MAAI,EAAE,WAAW,GAAG;AAClB,WAAO;AAAA,EACT;AACA,MAAI,MAAM,6BAA6B,MAAM,2BAA2B;AACtE,WAAO;AAAA,EACT,WAAW,MAAM,6BAA6B,MAAM,2BAA2B;AAC7E,WAAO;AAAA,EACT;AACA,MAAI,MAAM,mBAAmB;AAC3B,WAAO;AAAA,EACT,WAAW,MAAM,mBAAmB;AAClC,WAAO;AAAA,EACT;AACA,SAAO,EAAE,WAAW,EAAE,SAAS,IAAI,IAAI,KAAK,IAAI,EAAE,SAAS,EAAE;AAC/D;AAlBS;AAmBT,IAAI,OAAO,MAAM,MAAM;AAAA,EAzBvB,OAyBuB;AAAA;AAAA;AAAA,EACrB;AAAA,EACA;AAAA,EACA,YAA4B,uBAAO,OAAO,IAAI;AAAA,EAC9C,OAAO,QAAQ,OAAO,UAAU,SAAS,oBAAoB;AAC3D,QAAI,OAAO,WAAW,GAAG;AACvB,UAAI,KAAK,WAAW,QAAQ;AAC1B,cAAM;AAAA,MACR;AACA,UAAI,oBAAoB;AACtB;AAAA,MACF;AACA,WAAK,SAAS;AACd;AAAA,IACF;AACA,UAAM,CAAC,OAAO,GAAG,UAAU,IAAI;AAC/B,UAAM,UAAU,UAAU,MAAM,WAAW,WAAW,IAAI,CAAC,IAAI,IAAI,yBAAyB,IAAI,CAAC,IAAI,IAAI,iBAAiB,IAAI,UAAU,OAAO,CAAC,IAAI,IAAI,yBAAyB,IAAI,MAAM,MAAM,6BAA6B;AAC9N,QAAI;AACJ,QAAI,SAAS;AACX,YAAM,OAAO,QAAQ,CAAC;AACtB,UAAI,YAAY,QAAQ,CAAC,KAAK;AAC9B,UAAI,QAAQ,QAAQ,CAAC,GAAG;AACtB,YAAI,cAAc,MAAM;AACtB,gBAAM;AAAA,QACR;AACA,oBAAY,UAAU,QAAQ,0BAA0B,KAAK;AAC7D,YAAI,YAAY,KAAK,SAAS,GAAG;AAC/B,gBAAM;AAAA,QACR;AAAA,MACF;AACA,aAAO,KAAK,UAAU,SAAS;AAC/B,UAAI,CAAC,MAAM;AACT,YAAI,OAAO,KAAK,KAAK,SAAS,EAAE;AAAA,UAC9B,CAAC,MAAM,MAAM,6BAA6B,MAAM;AAAA,QAClD,GAAG;AACD,gBAAM;AAAA,QACR;AACA,YAAI,oBAAoB;AACtB;AAAA,QACF;AACA,eAAO,KAAK,UAAU,SAAS,IAAI,IAAI,MAAM;AAC7C,YAAI,SAAS,IAAI;AACf,eAAK,YAAY,QAAQ;AAAA,QAC3B;AAAA,MACF;AACA,UAAI,CAAC,sBAAsB,SAAS,IAAI;AACtC,iBAAS,KAAK,CAAC,MAAM,KAAK,SAAS,CAAC;AAAA,MACtC;AAAA,IACF,OAAO;AACL,aAAO,KAAK,UAAU,KAAK;AAC3B,UAAI,CAAC,MAAM;AACT,YAAI,OAAO,KAAK,KAAK,SAAS,EAAE;AAAA,UAC9B,CAAC,MAAM,EAAE,SAAS,KAAK,MAAM,6BAA6B,MAAM;AAAA,QAClE,GAAG;AACD,gBAAM;AAAA,QACR;AACA,YAAI,oBAAoB;AACtB;AAAA,QACF;AACA,eAAO,KAAK,UAAU,KAAK,IAAI,IAAI,MAAM;AAAA,MAC3C;AAAA,IACF;AACA,SAAK,OAAO,YAAY,OAAO,UAAU,SAAS,kBAAkB;AAAA,EACtE;AAAA,EACA,iBAAiB;AACf,UAAM,YAAY,OAAO,KAAK,KAAK,SAAS,EAAE,KAAK,UAAU;AAC7D,UAAM,UAAU,UAAU,IAAI,CAAC,MAAM;AACnC,YAAM,IAAI,KAAK,UAAU,CAAC;AAC1B,cAAQ,OAAO,EAAE,cAAc,WAAW,IAAI,CAAC,KAAK,EAAE,SAAS,KAAK,gBAAgB,IAAI,CAAC,IAAI,KAAK,CAAC,KAAK,KAAK,EAAE,eAAe;AAAA,IAChI,CAAC;AACD,QAAI,OAAO,KAAK,WAAW,UAAU;AACnC,cAAQ,QAAQ,IAAI,KAAK,MAAM,EAAE;AAAA,IACnC;AACA,QAAI,QAAQ,WAAW,GAAG;AACxB,aAAO;AAAA,IACT;AACA,QAAI,QAAQ,WAAW,GAAG;AACxB,aAAO,QAAQ,CAAC;AAAA,IAClB;AACA,WAAO,QAAQ,QAAQ,KAAK,GAAG,IAAI;AAAA,EACrC;AACF;;;ACxGA,IAAI,OAAO,MAAM;AAAA,EAFjB,OAEiB;AAAA;AAAA;AAAA,EACf,WAAW,EAAE,UAAU,EAAE;AAAA,EACzB,QAAQ,IAAI,KAAK;AAAA,EACjB,OAAO,MAAM,OAAO,oBAAoB;AACtC,UAAM,aAAa,CAAC;AACpB,UAAM,SAAS,CAAC;AAChB,aAAS,IAAI,OAAO;AAClB,UAAI,WAAW;AACf,aAAO,KAAK,QAAQ,cAAc,CAAC,MAAM;AACvC,cAAM,OAAO,MAAM,CAAC;AACpB,eAAO,CAAC,IAAI,CAAC,MAAM,CAAC;AACpB;AACA,mBAAW;AACX,eAAO;AAAA,MACT,CAAC;AACD,UAAI,CAAC,UAAU;AACb;AAAA,MACF;AAAA,IACF;AACA,UAAM,SAAS,KAAK,MAAM,0BAA0B,KAAK,CAAC;AAC1D,aAAS,IAAI,OAAO,SAAS,GAAG,KAAK,GAAG,KAAK;AAC3C,YAAM,CAAC,IAAI,IAAI,OAAO,CAAC;AACvB,eAAS,IAAI,OAAO,SAAS,GAAG,KAAK,GAAG,KAAK;AAC3C,YAAI,OAAO,CAAC,EAAE,QAAQ,IAAI,MAAM,IAAI;AAClC,iBAAO,CAAC,IAAI,OAAO,CAAC,EAAE,QAAQ,MAAM,OAAO,CAAC,EAAE,CAAC,CAAC;AAChD;AAAA,QACF;AAAA,MACF;AAAA,IACF;AACA,SAAK,MAAM,OAAO,QAAQ,OAAO,YAAY,KAAK,UAAU,kBAAkB;AAC9E,WAAO;AAAA,EACT;AAAA,EACA,cAAc;AACZ,QAAI,SAAS,KAAK,MAAM,eAAe;AACvC,QAAI,WAAW,IAAI;AACjB,aAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAAA,IACtB;AACA,QAAI,eAAe;AACnB,UAAM,sBAAsB,CAAC;AAC7B,UAAM,sBAAsB,CAAC;AAC7B,aAAS,OAAO,QAAQ,yBAAyB,CAAC,GAAG,cAAc,eAAe;AAChF,UAAI,iBAAiB,QAAQ;AAC3B,4BAAoB,EAAE,YAAY,IAAI,OAAO,YAAY;AACzD,eAAO;AAAA,MACT;AACA,UAAI,eAAe,QAAQ;AACzB,4BAAoB,OAAO,UAAU,CAAC,IAAI,EAAE;AAC5C,eAAO;AAAA,MACT;AACA,aAAO;AAAA,IACT,CAAC;AACD,WAAO,CAAC,IAAI,OAAO,IAAI,MAAM,EAAE,GAAG,qBAAqB,mBAAmB;AAAA,EAC5E;AACF;;;AC7CA,IAAI,cAAc,CAAC,MAAM,CAAC,GAAmB,uBAAO,OAAO,IAAI,CAAC;AAChE,IAAI,sBAAsC,uBAAO,OAAO,IAAI;AAC5D,SAAS,oBAAoB,MAAM;AACjC,SAAO,oBAAoB,IAAI,MAAM,IAAI;AAAA,IACvC,SAAS,MAAM,KAAK,IAAI,KAAK;AAAA,MAC3B;AAAA,MACA,CAAC,GAAG,aAAa,WAAW,KAAK,QAAQ,KAAK;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AAPS;AAQT,SAAS,2BAA2B;AAClC,wBAAsC,uBAAO,OAAO,IAAI;AAC1D;AAFS;AAGT,SAAS,mCAAmC,QAAQ;AAClD,QAAM,OAAO,IAAI,KAAK;AACtB,QAAM,cAAc,CAAC;AACrB,MAAI,OAAO,WAAW,GAAG;AACvB,WAAO;AAAA,EACT;AACA,QAAM,2BAA2B,OAAO;AAAA,IACtC,CAAC,UAAU,CAAC,CAAC,SAAS,KAAK,MAAM,CAAC,CAAC,GAAG,GAAG,KAAK;AAAA,EAChD,EAAE;AAAA,IACA,CAAC,CAAC,WAAW,KAAK,GAAG,CAAC,WAAW,KAAK,MAAM,YAAY,IAAI,YAAY,KAAK,MAAM,SAAS,MAAM;AAAA,EACpG;AACA,QAAM,YAA4B,uBAAO,OAAO,IAAI;AACpD,WAAS,IAAI,GAAG,IAAI,IAAI,MAAM,yBAAyB,QAAQ,IAAI,KAAK,KAAK;AAC3E,UAAM,CAAC,oBAAoB,MAAM,QAAQ,IAAI,yBAAyB,CAAC;AACvE,QAAI,oBAAoB;AACtB,gBAAU,IAAI,IAAI,CAAC,SAAS,IAAI,CAAC,CAACC,EAAC,MAAM,CAACA,IAAmB,uBAAO,OAAO,IAAI,CAAC,CAAC,GAAG,UAAU;AAAA,IAChG,OAAO;AACL;AAAA,IACF;AACA,QAAI;AACJ,QAAI;AACF,mBAAa,KAAK,OAAO,MAAM,GAAG,kBAAkB;AAAA,IACtD,SAAS,GAAG;AACV,YAAM,MAAM,aAAa,IAAI,qBAAqB,IAAI,IAAI;AAAA,IAC5D;AACA,QAAI,oBAAoB;AACtB;AAAA,IACF;AACA,gBAAY,CAAC,IAAI,SAAS,IAAI,CAAC,CAACA,IAAG,UAAU,MAAM;AACjD,YAAM,gBAAgC,uBAAO,OAAO,IAAI;AACxD,oBAAc;AACd,aAAO,cAAc,GAAG,cAAc;AACpC,cAAM,CAAC,KAAK,KAAK,IAAI,WAAW,UAAU;AAC1C,sBAAc,GAAG,IAAI;AAAA,MACvB;AACA,aAAO,CAACA,IAAG,aAAa;AAAA,IAC1B,CAAC;AAAA,EACH;AACA,QAAM,CAAC,QAAQ,qBAAqB,mBAAmB,IAAI,KAAK,YAAY;AAC5E,WAAS,IAAI,GAAG,MAAM,YAAY,QAAQ,IAAI,KAAK,KAAK;AACtD,aAAS,IAAI,GAAG,OAAO,YAAY,CAAC,EAAE,QAAQ,IAAI,MAAM,KAAK;AAC3D,YAAM,MAAM,YAAY,CAAC,EAAE,CAAC,IAAI,CAAC;AACjC,UAAI,CAAC,KAAK;AACR;AAAA,MACF;AACA,YAAM,OAAO,OAAO,KAAK,GAAG;AAC5B,eAAS,IAAI,GAAG,OAAO,KAAK,QAAQ,IAAI,MAAM,KAAK;AACjD,YAAI,KAAK,CAAC,CAAC,IAAI,oBAAoB,IAAI,KAAK,CAAC,CAAC,CAAC;AAAA,MACjD;AAAA,IACF;AAAA,EACF;AACA,QAAM,aAAa,CAAC;AACpB,aAAW,KAAK,qBAAqB;AACnC,eAAW,CAAC,IAAI,YAAY,oBAAoB,CAAC,CAAC;AAAA,EACpD;AACA,SAAO,CAAC,QAAQ,YAAY,SAAS;AACvC;AAxDS;AAyDT,SAAS,eAAe,YAAY,MAAM;AACxC,MAAI,CAAC,YAAY;AACf,WAAO;AAAA,EACT;AACA,aAAW,KAAK,OAAO,KAAK,UAAU,EAAE,KAAK,CAAC,GAAG,MAAM,EAAE,SAAS,EAAE,MAAM,GAAG;AAC3E,QAAI,oBAAoB,CAAC,EAAE,KAAK,IAAI,GAAG;AACrC,aAAO,CAAC,GAAG,WAAW,CAAC,CAAC;AAAA,IAC1B;AAAA,EACF;AACA,SAAO;AACT;AAVS;AAWT,IAAI,eAAe,MAAM;AAAA,EA3FzB,OA2FyB;AAAA;AAAA;AAAA,EACvB,OAAO;AAAA,EACP;AAAA,EACA;AAAA,EACA,cAAc;AACZ,SAAK,cAAc,EAAE,CAAC,eAAe,GAAmB,uBAAO,OAAO,IAAI,EAAE;AAC5E,SAAK,UAAU,EAAE,CAAC,eAAe,GAAmB,uBAAO,OAAO,IAAI,EAAE;AAAA,EAC1E;AAAA,EACA,IAAI,QAAQ,MAAM,SAAS;AACzB,UAAM,aAAa,KAAK;AACxB,UAAM,SAAS,KAAK;AACpB,QAAI,CAAC,cAAc,CAAC,QAAQ;AAC1B,YAAM,IAAI,MAAM,gCAAgC;AAAA,IAClD;AACA,QAAI,CAAC,WAAW,MAAM,GAAG;AACvB;AACA,OAAC,YAAY,MAAM,EAAE,QAAQ,CAAC,eAAe;AAC3C,mBAAW,MAAM,IAAoB,uBAAO,OAAO,IAAI;AACvD,eAAO,KAAK,WAAW,eAAe,CAAC,EAAE,QAAQ,CAACC,OAAM;AACtD,qBAAW,MAAM,EAAEA,EAAC,IAAI,CAAC,GAAG,WAAW,eAAe,EAAEA,EAAC,CAAC;AAAA,QAC5D,CAAC;AAAA,MACH,CAAC;AAAA,IACH;AACA,QAAI,SAAS,MAAM;AACjB,aAAO;AAAA,IACT;AACA,UAAM,cAAc,KAAK,MAAM,MAAM,KAAK,CAAC,GAAG;AAC9C,QAAI,MAAM,KAAK,IAAI,GAAG;AACpB,YAAM,KAAK,oBAAoB,IAAI;AACnC,UAAI,WAAW,iBAAiB;AAC9B,eAAO,KAAK,UAAU,EAAE,QAAQ,CAAC,MAAM;AACrC,qBAAW,CAAC,EAAE,IAAI,MAAM,eAAe,WAAW,CAAC,GAAG,IAAI,KAAK,eAAe,WAAW,eAAe,GAAG,IAAI,KAAK,CAAC;AAAA,QACvH,CAAC;AAAA,MACH,OAAO;AACL,mBAAW,MAAM,EAAE,IAAI,MAAM,eAAe,WAAW,MAAM,GAAG,IAAI,KAAK,eAAe,WAAW,eAAe,GAAG,IAAI,KAAK,CAAC;AAAA,MACjI;AACA,aAAO,KAAK,UAAU,EAAE,QAAQ,CAAC,MAAM;AACrC,YAAI,WAAW,mBAAmB,WAAW,GAAG;AAC9C,iBAAO,KAAK,WAAW,CAAC,CAAC,EAAE,QAAQ,CAACA,OAAM;AACxC,eAAG,KAAKA,EAAC,KAAK,WAAW,CAAC,EAAEA,EAAC,EAAE,KAAK,CAAC,SAAS,UAAU,CAAC;AAAA,UAC3D,CAAC;AAAA,QACH;AAAA,MACF,CAAC;AACD,aAAO,KAAK,MAAM,EAAE,QAAQ,CAAC,MAAM;AACjC,YAAI,WAAW,mBAAmB,WAAW,GAAG;AAC9C,iBAAO,KAAK,OAAO,CAAC,CAAC,EAAE;AAAA,YACrB,CAACA,OAAM,GAAG,KAAKA,EAAC,KAAK,OAAO,CAAC,EAAEA,EAAC,EAAE,KAAK,CAAC,SAAS,UAAU,CAAC;AAAA,UAC9D;AAAA,QACF;AAAA,MACF,CAAC;AACD;AAAA,IACF;AACA,UAAM,QAAQ,uBAAuB,IAAI,KAAK,CAAC,IAAI;AACnD,aAAS,IAAI,GAAG,MAAM,MAAM,QAAQ,IAAI,KAAK,KAAK;AAChD,YAAM,QAAQ,MAAM,CAAC;AACrB,aAAO,KAAK,MAAM,EAAE,QAAQ,CAAC,MAAM;AACjC,YAAI,WAAW,mBAAmB,WAAW,GAAG;AAC9C,iBAAO,CAAC,EAAE,KAAK,MAAM;AAAA,YACnB,GAAG,eAAe,WAAW,CAAC,GAAG,KAAK,KAAK,eAAe,WAAW,eAAe,GAAG,KAAK,KAAK,CAAC;AAAA,UACpG;AACA,iBAAO,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,SAAS,aAAa,MAAM,IAAI,CAAC,CAAC;AAAA,QAC3D;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EACA,QAAQ;AAAA,EACR,mBAAmB;AACjB,UAAM,WAA2B,uBAAO,OAAO,IAAI;AACnD,WAAO,KAAK,KAAK,OAAO,EAAE,OAAO,OAAO,KAAK,KAAK,WAAW,CAAC,EAAE,QAAQ,CAAC,WAAW;AAClF,eAAS,MAAM,MAAM,KAAK,cAAc,MAAM;AAAA,IAChD,CAAC;AACD,SAAK,cAAc,KAAK,UAAU;AAClC,6BAAyB;AACzB,WAAO;AAAA,EACT;AAAA,EACA,cAAc,QAAQ;AACpB,UAAM,SAAS,CAAC;AAChB,QAAI,cAAc,WAAW;AAC7B,KAAC,KAAK,aAAa,KAAK,OAAO,EAAE,QAAQ,CAACC,OAAM;AAC9C,YAAM,WAAWA,GAAE,MAAM,IAAI,OAAO,KAAKA,GAAE,MAAM,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,MAAMA,GAAE,MAAM,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC;AAC9F,UAAI,SAAS,WAAW,GAAG;AACzB,wBAAgB;AAChB,eAAO,KAAK,GAAG,QAAQ;AAAA,MACzB,WAAW,WAAW,iBAAiB;AACrC,eAAO;AAAA,UACL,GAAG,OAAO,KAAKA,GAAE,eAAe,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,MAAMA,GAAE,eAAe,EAAE,IAAI,CAAC,CAAC;AAAA,QACnF;AAAA,MACF;AAAA,IACF,CAAC;AACD,QAAI,CAAC,aAAa;AAChB,aAAO;AAAA,IACT,OAAO;AACL,aAAO,mCAAmC,MAAM;AAAA,IAClD;AAAA,EACF;AACF;;;ACxLA,IAAI,cAAc,MAAM;AAAA,EAFxB,OAEwB;AAAA;AAAA;AAAA,EACtB,OAAO;AAAA,EACP,WAAW,CAAC;AAAA,EACZ,UAAU,CAAC;AAAA,EACX,YAAY,MAAM;AAChB,SAAK,WAAW,KAAK;AAAA,EACvB;AAAA,EACA,IAAI,QAAQ,MAAM,SAAS;AACzB,QAAI,CAAC,KAAK,SAAS;AACjB,YAAM,IAAI,MAAM,gCAAgC;AAAA,IAClD;AACA,SAAK,QAAQ,KAAK,CAAC,QAAQ,MAAM,OAAO,CAAC;AAAA,EAC3C;AAAA,EACA,MAAM,QAAQ,MAAM;AAClB,QAAI,CAAC,KAAK,SAAS;AACjB,YAAM,IAAI,MAAM,aAAa;AAAA,IAC/B;AACA,UAAM,UAAU,KAAK;AACrB,UAAM,SAAS,KAAK;AACpB,UAAM,MAAM,QAAQ;AACpB,QAAI,IAAI;AACR,QAAI;AACJ,WAAO,IAAI,KAAK,KAAK;AACnB,YAAM,SAAS,QAAQ,CAAC;AACxB,UAAI;AACF,iBAAS,KAAK,GAAG,OAAO,OAAO,QAAQ,KAAK,MAAM,MAAM;AACtD,iBAAO,IAAI,GAAG,OAAO,EAAE,CAAC;AAAA,QAC1B;AACA,cAAM,OAAO,MAAM,QAAQ,IAAI;AAAA,MACjC,SAAS,GAAG;AACV,YAAI,aAAa,sBAAsB;AACrC;AAAA,QACF;AACA,cAAM;AAAA,MACR;AACA,WAAK,QAAQ,OAAO,MAAM,KAAK,MAAM;AACrC,WAAK,WAAW,CAAC,MAAM;AACvB,WAAK,UAAU;AACf;AAAA,IACF;AACA,QAAI,MAAM,KAAK;AACb,YAAM,IAAI,MAAM,aAAa;AAAA,IAC/B;AACA,SAAK,OAAO,iBAAiB,KAAK,aAAa,IAAI;AACnD,WAAO;AAAA,EACT;AAAA,EACA,IAAI,eAAe;AACjB,QAAI,KAAK,WAAW,KAAK,SAAS,WAAW,GAAG;AAC9C,YAAM,IAAI,MAAM,2CAA2C;AAAA,IAC7D;AACA,WAAO,KAAK,SAAS,CAAC;AAAA,EACxB;AACF;;;ACnDA,IAAI,cAA8B,uBAAO,OAAO,IAAI;AACpD,IAAIC,QAAO,MAAMC,OAAM;AAAA,EAJvB,OAIuB;AAAA;AAAA;AAAA,EACrB;AAAA,EACA;AAAA,EACA;AAAA,EACA,SAAS;AAAA,EACT,UAAU;AAAA,EACV,YAAY,QAAQ,SAAS,UAAU;AACrC,SAAK,YAAY,YAA4B,uBAAO,OAAO,IAAI;AAC/D,SAAK,WAAW,CAAC;AACjB,QAAI,UAAU,SAAS;AACrB,YAAM,IAAoB,uBAAO,OAAO,IAAI;AAC5C,QAAE,MAAM,IAAI,EAAE,SAAS,cAAc,CAAC,GAAG,OAAO,EAAE;AAClD,WAAK,WAAW,CAAC,CAAC;AAAA,IACpB;AACA,SAAK,YAAY,CAAC;AAAA,EACpB;AAAA,EACA,OAAO,QAAQ,MAAM,SAAS;AAC5B,SAAK,SAAS,EAAE,KAAK;AACrB,QAAI,UAAU;AACd,UAAM,QAAQ,iBAAiB,IAAI;AACnC,UAAM,eAAe,CAAC;AACtB,aAAS,IAAI,GAAG,MAAM,MAAM,QAAQ,IAAI,KAAK,KAAK;AAChD,YAAMC,KAAI,MAAM,CAAC;AACjB,YAAM,QAAQ,MAAM,IAAI,CAAC;AACzB,YAAM,UAAU,WAAWA,IAAG,KAAK;AACnC,YAAM,MAAM,MAAM,QAAQ,OAAO,IAAI,QAAQ,CAAC,IAAIA;AAClD,UAAI,OAAO,QAAQ,WAAW;AAC5B,kBAAU,QAAQ,UAAU,GAAG;AAC/B,YAAI,SAAS;AACX,uBAAa,KAAK,QAAQ,CAAC,CAAC;AAAA,QAC9B;AACA;AAAA,MACF;AACA,cAAQ,UAAU,GAAG,IAAI,IAAID,OAAM;AACnC,UAAI,SAAS;AACX,gBAAQ,UAAU,KAAK,OAAO;AAC9B,qBAAa,KAAK,QAAQ,CAAC,CAAC;AAAA,MAC9B;AACA,gBAAU,QAAQ,UAAU,GAAG;AAAA,IACjC;AACA,YAAQ,SAAS,KAAK;AAAA,MACpB,CAAC,MAAM,GAAG;AAAA,QACR;AAAA,QACA,cAAc,aAAa,OAAO,CAAC,GAAG,GAAG,MAAM,EAAE,QAAQ,CAAC,MAAM,CAAC;AAAA,QACjE,OAAO,KAAK;AAAA,MACd;AAAA,IACF,CAAC;AACD,WAAO;AAAA,EACT;AAAA,EACA,gBAAgB,MAAM,QAAQ,YAAY,QAAQ;AAChD,UAAM,cAAc,CAAC;AACrB,aAAS,IAAI,GAAG,MAAM,KAAK,SAAS,QAAQ,IAAI,KAAK,KAAK;AACxD,YAAM,IAAI,KAAK,SAAS,CAAC;AACzB,YAAM,aAAa,EAAE,MAAM,KAAK,EAAE,eAAe;AACjD,YAAM,eAAe,CAAC;AACtB,UAAI,eAAe,QAAQ;AACzB,mBAAW,SAAyB,uBAAO,OAAO,IAAI;AACtD,oBAAY,KAAK,UAAU;AAC3B,YAAI,eAAe,eAAe,UAAU,WAAW,aAAa;AAClE,mBAAS,KAAK,GAAG,OAAO,WAAW,aAAa,QAAQ,KAAK,MAAM,MAAM;AACvE,kBAAM,MAAM,WAAW,aAAa,EAAE;AACtC,kBAAM,YAAY,aAAa,WAAW,KAAK;AAC/C,uBAAW,OAAO,GAAG,IAAI,SAAS,GAAG,KAAK,CAAC,YAAY,OAAO,GAAG,IAAI,WAAW,GAAG,KAAK,SAAS,GAAG;AACpG,yBAAa,WAAW,KAAK,IAAI;AAAA,UACnC;AAAA,QACF;AAAA,MACF;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA,EACA,OAAO,QAAQ,MAAM;AACnB,UAAM,cAAc,CAAC;AACrB,SAAK,UAAU;AACf,UAAM,UAAU;AAChB,QAAI,WAAW,CAAC,OAAO;AACvB,UAAM,QAAQ,UAAU,IAAI;AAC5B,UAAM,gBAAgB,CAAC;AACvB,aAAS,IAAI,GAAG,MAAM,MAAM,QAAQ,IAAI,KAAK,KAAK;AAChD,YAAM,OAAO,MAAM,CAAC;AACpB,YAAM,SAAS,MAAM,MAAM;AAC3B,YAAM,YAAY,CAAC;AACnB,eAAS,IAAI,GAAG,OAAO,SAAS,QAAQ,IAAI,MAAM,KAAK;AACrD,cAAM,OAAO,SAAS,CAAC;AACvB,cAAM,WAAW,KAAK,UAAU,IAAI;AACpC,YAAI,UAAU;AACZ,mBAAS,UAAU,KAAK;AACxB,cAAI,QAAQ;AACV,gBAAI,SAAS,UAAU,GAAG,GAAG;AAC3B,0BAAY;AAAA,gBACV,GAAG,KAAK,gBAAgB,SAAS,UAAU,GAAG,GAAG,QAAQ,KAAK,OAAO;AAAA,cACvE;AAAA,YACF;AACA,wBAAY,KAAK,GAAG,KAAK,gBAAgB,UAAU,QAAQ,KAAK,OAAO,CAAC;AAAA,UAC1E,OAAO;AACL,sBAAU,KAAK,QAAQ;AAAA,UACzB;AAAA,QACF;AACA,iBAAS,IAAI,GAAG,OAAO,KAAK,UAAU,QAAQ,IAAI,MAAM,KAAK;AAC3D,gBAAM,UAAU,KAAK,UAAU,CAAC;AAChC,gBAAM,SAAS,KAAK,YAAY,cAAc,CAAC,IAAI,EAAE,GAAG,KAAK,QAAQ;AACrE,cAAI,YAAY,KAAK;AACnB,kBAAM,UAAU,KAAK,UAAU,GAAG;AAClC,gBAAI,SAAS;AACX,0BAAY,KAAK,GAAG,KAAK,gBAAgB,SAAS,QAAQ,KAAK,OAAO,CAAC;AACvE,sBAAQ,UAAU;AAClB,wBAAU,KAAK,OAAO;AAAA,YACxB;AACA;AAAA,UACF;AACA,gBAAM,CAAC,KAAK,MAAM,OAAO,IAAI;AAC7B,cAAI,CAAC,QAAQ,EAAE,mBAAmB,SAAS;AACzC;AAAA,UACF;AACA,gBAAM,QAAQ,KAAK,UAAU,GAAG;AAChC,gBAAM,iBAAiB,MAAM,MAAM,CAAC,EAAE,KAAK,GAAG;AAC9C,cAAI,mBAAmB,QAAQ;AAC7B,kBAAM,IAAI,QAAQ,KAAK,cAAc;AACrC,gBAAI,GAAG;AACL,qBAAO,IAAI,IAAI,EAAE,CAAC;AAClB,0BAAY,KAAK,GAAG,KAAK,gBAAgB,OAAO,QAAQ,KAAK,SAAS,MAAM,CAAC;AAC7E,kBAAI,OAAO,KAAK,MAAM,SAAS,EAAE,QAAQ;AACvC,sBAAM,UAAU;AAChB,sBAAM,iBAAiB,EAAE,CAAC,EAAE,MAAM,IAAI,GAAG,UAAU;AACnD,sBAAM,iBAAiB,cAAc,cAAc,MAAM,CAAC;AAC1D,+BAAe,KAAK,KAAK;AAAA,cAC3B;AACA;AAAA,YACF;AAAA,UACF;AACA,cAAI,YAAY,QAAQ,QAAQ,KAAK,IAAI,GAAG;AAC1C,mBAAO,IAAI,IAAI;AACf,gBAAI,QAAQ;AACV,0BAAY,KAAK,GAAG,KAAK,gBAAgB,OAAO,QAAQ,QAAQ,KAAK,OAAO,CAAC;AAC7E,kBAAI,MAAM,UAAU,GAAG,GAAG;AACxB,4BAAY;AAAA,kBACV,GAAG,KAAK,gBAAgB,MAAM,UAAU,GAAG,GAAG,QAAQ,QAAQ,KAAK,OAAO;AAAA,gBAC5E;AAAA,cACF;AAAA,YACF,OAAO;AACL,oBAAM,UAAU;AAChB,wBAAU,KAAK,KAAK;AAAA,YACtB;AAAA,UACF;AAAA,QACF;AAAA,MACF;AACA,iBAAW,UAAU,OAAO,cAAc,MAAM,KAAK,CAAC,CAAC;AAAA,IACzD;AACA,QAAI,YAAY,SAAS,GAAG;AAC1B,kBAAY,KAAK,CAAC,GAAG,MAAM;AACzB,eAAO,EAAE,QAAQ,EAAE;AAAA,MACrB,CAAC;AAAA,IACH;AACA,WAAO,CAAC,YAAY,IAAI,CAAC,EAAE,SAAS,OAAO,MAAM,CAAC,SAAS,MAAM,CAAC,CAAC;AAAA,EACrE;AACF;;;AC3JA,IAAI,aAAa,MAAM;AAAA,EAHvB,OAGuB;AAAA;AAAA;AAAA,EACrB,OAAO;AAAA,EACP;AAAA,EACA,cAAc;AACZ,SAAK,QAAQ,IAAIE,MAAK;AAAA,EACxB;AAAA,EACA,IAAI,QAAQ,MAAM,SAAS;AACzB,UAAM,UAAU,uBAAuB,IAAI;AAC3C,QAAI,SAAS;AACX,eAAS,IAAI,GAAG,MAAM,QAAQ,QAAQ,IAAI,KAAK,KAAK;AAClD,aAAK,MAAM,OAAO,QAAQ,QAAQ,CAAC,GAAG,OAAO;AAAA,MAC/C;AACA;AAAA,IACF;AACA,SAAK,MAAM,OAAO,QAAQ,MAAM,OAAO;AAAA,EACzC;AAAA,EACA,MAAM,QAAQ,MAAM;AAClB,WAAO,KAAK,MAAM,OAAO,QAAQ,IAAI;AAAA,EACvC;AACF;;;ACjBA,IAAIC,QAAO,cAAc,KAAS;AAAA,EALlC,OAKkC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMhC,YAAY,UAAU,CAAC,GAAG;AACxB,UAAM,OAAO;AACb,SAAK,SAAS,QAAQ,UAAU,IAAI,YAAY;AAAA,MAC9C,SAAS,CAAC,IAAI,aAAa,GAAG,IAAI,WAAW,CAAC;AAAA,IAChD,CAAC;AAAA,EACH;AACF;;;ACVO,IAAM,gBAAgB,IAAIC,MAAK;AAiBtC,cAAc,KAAK,WAAW,OAAO,MAAM;AACzC,MAAI;AACF,UAAM,OAA6B,MAAM,EAAE,IAAI,KAAK;AACpD,UAAM,EAAE,QAAQ,WAAW,OAAO,UAAU,gBAAgB,aAAa,SAAS,IAAI;AAGtF,QAAI,CAAC,UAAU,CAAC,YAAY,CAAC,gBAAgB;AAC3C,aAAO,EAAE,KAAK,EAAE,OAAO,4DAA4D,GAAG,GAAG;AAAA,IAC3F;AAEA,QAAI,UAAU,GAAG;AACf,aAAO,EAAE,KAAK,EAAE,OAAO,gCAAgC,GAAG,GAAG;AAAA,IAC/D;AAEA,QAAI;AAEJ,YAAQ,UAAU;AAAA,MAChB,KAAK;AAEH,YAAI,CAAE,EAAE,IAAY,mBAAmB;AACrC,iBAAO,EAAE,KAAK,EAAE,OAAO,wBAAwB,GAAG,GAAG;AAAA,QACvD;AAEA,cAAM,iBAAiB,MAAM,MAAM,6CAA6C;AAAA,UAC9E,QAAQ;AAAA,UACR,SAAS;AAAA,YACP,iBAAiB,UAAW,EAAE,IAAY,iBAAiB;AAAA,YAC3D,gBAAgB;AAAA,UAClB;AAAA,UACA,MAAM,IAAI,gBAAgB;AAAA,YACxB,SAAS,SAAS,KAAK,SAAS;AAAA;AAAA,YAChC,UAAU,SAAS,YAAY;AAAA,YAC/B,4BAA4B;AAAA,YAC5B,yBAAyB,eAAe;AAAA,YACxC,GAAG,OAAO,QAAQ,YAAY,CAAC,CAAC,EAAE,OAAO,CAAC,KAAK,CAAC,KAAK,GAAG,OAAO;AAAA,cAC7D,GAAG;AAAA,cACH,CAAC,YAAY,GAAG,GAAG,GAAG;AAAA,YACxB,IAAI,CAAC,CAAC;AAAA,UACR,CAAC;AAAA,QACH,CAAC;AAED,YAAI,CAAC,eAAe,IAAI;AACtB,gBAAM,QAAQ,MAAM,eAAe,KAAK;AACxC,gBAAM,IAAI,MAAM,iBAAiB,MAAM,OAAO,WAAW,eAAe,EAAE;AAAA,QAC5E;AAEA,wBAAgB,MAAM,eAAe,KAAK;AAG1C,cAAM,OAAO,EAAE,IAAI,MAAM,KAAK,EAAE,IAAI,GAAG,OAAO,gBAAgB,MAAM,SAAS;AAC7E,cAAM,aAAc,EAAE,KAAa,cAAc,IAAI,QAAQ,MAAM,aAAa,EAAE,IAAI,GAAG;AAEzF,eAAO,EAAE,KAAK;AAAA,UACZ,SAAS;AAAA,UACT,eAAe,cAAc;AAAA,UAC7B,gBAAgB,cAAc;AAAA,UAC9B,UAAU;AAAA,QACZ,CAAC;AAAA,MAEH,KAAK;AAEH,YAAI,CAAE,EAAE,IAAY,uBAAuB,CAAE,EAAE,IAAY,oBAAoB;AAC7E,iBAAO,EAAE,KAAK,EAAE,OAAO,wBAAwB,GAAG,GAAG;AAAA,QACvD;AAEA,cAAM,iBAAiB,MAAM,MAAM,4CAA4C;AAAA,UAC7E,QAAQ;AAAA,UACR,SAAS;AAAA,YACP,iBAAiB,UAAW,EAAE,IAAY,mBAAmB;AAAA,YAC7D,gBAAgB;AAAA,YAChB,kBAAkB;AAAA,UACpB;AAAA,UACA,MAAM,KAAK,UAAU;AAAA,YACnB,iBAAiB,OAAO,WAAW;AAAA,YACnC,cAAc;AAAA,cACZ,QAAQ,SAAS;AAAA;AAAA,cACjB;AAAA,YACF;AAAA,YACA,WAAW;AAAA;AAAA,YACX,aAAc,EAAE,IAAY;AAAA,YAC5B;AAAA,YACA,MAAM,eAAe;AAAA,UACvB,CAAC;AAAA,QACH,CAAC;AAED,YAAI,CAAC,eAAe,IAAI;AACtB,gBAAM,QAAQ,MAAM,eAAe,KAAK;AACxC,gBAAM,IAAI,MAAM,iBAAiB,MAAM,SAAS,CAAC,GAAG,UAAU,eAAe,EAAE;AAAA,QACjF;AAEA,wBAAgB,MAAM,eAAe,KAAK;AAE1C,eAAO,EAAE,KAAK;AAAA,UACZ,SAAS;AAAA,UACT,gBAAgB,cAAc,QAAQ;AAAA,UACtC,UAAU;AAAA,UACV,QAAQ,cAAc,QAAQ;AAAA,QAChC,CAAC;AAAA,MAEH,KAAK;AAEH,eAAO,EAAE,KAAK;AAAA,UACZ,SAAS;AAAA,UACT,SAAS;AAAA,UACT,gBAAgB,QAAQ,KAAK,IAAI,CAAC;AAAA,UAClC,UAAU;AAAA,UACV,cAAc;AAAA,QAChB,CAAC;AAAA,MAEH;AACE,eAAO,EAAE,KAAK,EAAE,OAAO,+BAA+B,GAAG,GAAG;AAAA,IAChE;AAAA,EACF,SAAS,OAAY;AACnB,YAAQ,MAAM,yBAAyB,KAAK;AAC5C,WAAO,EAAE,KAAK,EAAE,OAAO,MAAM,WAAW,4BAA4B,GAAG,GAAG;AAAA,EAC5E;AACF,CAAC;AAGD,cAAc,KAAK,WAAW,OAAO,MAAM;AACzC,MAAI;AACF,UAAM,OAA6B,MAAM,EAAE,IAAI,KAAK;AACpD,UAAM,EAAE,gBAAgB,SAAS,IAAI;AAErC,QAAI,CAAC,kBAAkB,CAAC,UAAU;AAChC,aAAO,EAAE,KAAK,EAAE,OAAO,oDAAoD,GAAG,GAAG;AAAA,IACnF;AAEA,QAAI;AAEJ,YAAQ,UAAU;AAAA,MAChB,KAAK;AACH,YAAI,CAAE,EAAE,IAAY,mBAAmB;AACrC,iBAAO,EAAE,KAAK,EAAE,OAAO,wBAAwB,GAAG,GAAG;AAAA,QACvD;AAEA,cAAM,iBAAiB,MAAM,MAAM,6CAA6C,cAAc,IAAI;AAAA,UAChG,SAAS;AAAA,YACP,iBAAiB,UAAW,EAAE,IAAY,iBAAiB;AAAA,UAC7D;AAAA,QACF,CAAC;AAED,YAAI,CAAC,eAAe,IAAI;AACtB,gBAAM,QAAQ,MAAM,eAAe,KAAK;AACxC,gBAAM,IAAI,MAAM,iBAAiB,MAAM,OAAO,WAAW,eAAe,EAAE;AAAA,QAC5E;AAEA,wBAAgB,MAAM,eAAe,KAAK;AAG1C,cAAM,OAAO,EAAE,IAAI,MAAM,KAAK,EAAE,IAAI,GAAG,OAAO,WAAW,MAAM,SAAS;AACxE,cAAM,SAAS,cAAc,WAAW,cAAc,cAAc;AACpE,cAAM,aAAc,EAAE,KAAa,gBAAgB,cAAc,SAAS,KAAK,MAAM,QAAQ,EAAE,IAAI,GAAG;AAEtG,eAAO,EAAE,KAAK;AAAA,UACZ,SAAS;AAAA,UACT,QAAQ,cAAc;AAAA,UACtB,QAAQ,cAAc,SAAS;AAAA,UAC/B,UAAU,cAAc;AAAA,UACxB,UAAU,cAAc,WAAW;AAAA,QACrC,CAAC;AAAA,MAEH,KAAK;AACH,YAAI,CAAE,EAAE,IAAY,qBAAqB;AACvC,iBAAO,EAAE,KAAK,EAAE,OAAO,wBAAwB,GAAG,GAAG;AAAA,QACvD;AAEA,cAAM,iBAAiB,MAAM,MAAM,4CAA4C,cAAc,IAAI;AAAA,UAC/F,SAAS;AAAA,YACP,iBAAiB,UAAW,EAAE,IAAY,mBAAmB;AAAA,YAC7D,kBAAkB;AAAA,UACpB;AAAA,QACF,CAAC;AAED,YAAI,CAAC,eAAe,IAAI;AACtB,gBAAM,QAAQ,MAAM,eAAe,KAAK;AACxC,gBAAM,IAAI,MAAM,iBAAiB,MAAM,SAAS,CAAC,GAAG,UAAU,eAAe,EAAE;AAAA,QACjF;AAEA,wBAAgB,MAAM,eAAe,KAAK;AAE1C,eAAO,EAAE,KAAK;AAAA,UACZ,SAAS;AAAA,UACT,QAAQ,cAAc,QAAQ;AAAA,UAC9B,QAAQ,cAAc,QAAQ,aAAa,SAAS;AAAA,UACpD,UAAU,cAAc,QAAQ,aAAa;AAAA,UAC7C,UAAU,cAAc,QAAQ,WAAW;AAAA,QAC7C,CAAC;AAAA,MAEH,KAAK;AAEH,eAAO,EAAE,KAAK;AAAA,UACZ,SAAS;AAAA,UACT,QAAQ;AAAA,UACR,SAAS;AAAA,UACT,UAAU;AAAA,QACZ,CAAC;AAAA,MAEH;AACE,eAAO,EAAE,KAAK,EAAE,OAAO,+BAA+B,GAAG,GAAG;AAAA,IAChE;AAAA,EACF,SAAS,OAAY;AACnB,YAAQ,MAAM,+BAA+B,KAAK;AAClD,WAAO,EAAE,KAAK,EAAE,OAAO,MAAM,WAAW,8BAA8B,GAAG,GAAG;AAAA,EAC9E;AACF,CAAC;;;AC/FD,IAAM,YAAN,MAAgB;AAAA,EAtIhB,OAsIgB;AAAA;AAAA;AAAA,EACN,OAAsB,CAAC;AAAA,EACvB;AAAA,EAER,YAAY,KAAW;AACrB,SAAK,MAAM;AAAA,EACb;AAAA,EAEA,IAAI,OAAiB,WAAmB,SAAiB,SAA4C;AACnG,UAAM,QAAqB;AAAA,MACzB,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,MAClC;AAAA,MACA;AAAA,MACA,aAAa,WAAW;AAAA,MACxB;AAAA,MACA;AAAA,MACA,cAAc,SAAS;AAAA,IACzB;AAEA,SAAK,KAAK,KAAK,KAAK;AAGpB,UAAM,SAAS,SAAS,KAAK,KAAK,SAAS;AAC3C,YAAQ,IAAI,GAAG,MAAM,IAAI,OAAO,IAAI,UAAU,KAAK,UAAU,OAAO,IAAI,EAAE;AAG1E,SAAK,WAAW,KAAK;AAErB,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,WAAW,OAAoB;AAC3C,QAAI,KAAK,KAAK,IAAI;AAChB,UAAI;AACF,cAAM,KAAK,IAAI,GAAG,QAAQ;AAAA;AAAA;AAAA,SAGzB,EAAE;AAAA,UACD,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM,gBAAgB;AAAA,UACtB,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM,UAAU,KAAK,UAAU,MAAM,OAAO,IAAI;AAAA,QAClD,EAAE,IAAI;AAAA,MACR,SAAS,GAAG;AACV,gBAAQ,MAAM,8BAA8B,CAAC;AAAA,MAC/C;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAM,WAAmB,SAAiB,SAA+B;AACvE,WAAO,KAAK,IAAI,SAAS,WAAW,SAAS,OAAO;AAAA,EACtD;AAAA,EAEA,KAAK,WAAmB,SAAiB,SAA+B;AACtE,WAAO,KAAK,IAAI,QAAQ,WAAW,SAAS,OAAO;AAAA,EACrD;AAAA,EAEA,KAAK,WAAmB,SAAiB,SAA+B;AACtE,WAAO,KAAK,IAAI,QAAQ,WAAW,SAAS,OAAO;AAAA,EACrD;AAAA,EAEA,MAAM,WAAmB,SAAiB,SAA+B;AACvE,WAAO,KAAK,IAAI,SAAS,WAAW,SAAS,OAAO;AAAA,EACtD;AAAA,EAEA,cAAc,QAAgB,KAAoB;AAChD,WAAO,KAAK,KAAK,MAAM,CAAC,KAAK;AAAA,EAC/B;AACF;AAOA,IAAM,mCAA6D;AAAA,EACjE,QAAQ;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAAA,EACA,WAAW;AAAA,IACT;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AAAA,EACA,WAAW;AAAA,IACT;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;AAEO,SAAS,kBAAkB,KAAa,YAAsC;AACnF,QAAM,SAA4B,CAAC;AACnC,QAAM,WAA8B,CAAC;AAGrC,MAAI,CAAC,OAAO,IAAI,KAAK,EAAE,WAAW,GAAG;AACnC,WAAO,KAAK;AAAA,MACV,MAAM;AAAA,MACN,SAAS;AAAA,MACT,UAAU;AAAA,IACZ,CAAC;AACD,WAAO,EAAE,OAAO,OAAO,QAAQ,SAAS;AAAA,EAC1C;AAEA,MAAI,CAAC,IAAI,SAAS,OAAO,GAAG;AAC1B,WAAO,KAAK;AAAA,MACV,MAAM;AAAA,MACN,SAAS;AAAA,MACT,UAAU;AAAA,IACZ,CAAC;AAAA,EACH;AAGA,MAAI;AAEF,UAAM,WAAW,IAAI,MAAM,kBAAkB,KAAK,CAAC;AACnD,UAAM,YAAY,IAAI,MAAM,YAAY,KAAK,CAAC;AAC9C,QAAI,SAAS,WAAW,UAAU,QAAQ;AACxC,eAAS,KAAK;AAAA,QACZ,MAAM;AAAA,QACN,SAAS;AAAA,QACT,UAAU;AAAA,MACZ,CAAC;AAAA,IACH;AAAA,EACF,SAAS,GAAG;AACV,WAAO,KAAK;AAAA,MACV,MAAM;AAAA,MACN,SAAS;AAAA,MACT,UAAU;AAAA,IACZ,CAAC;AAAA,EACH;AAGA,QAAM,mBAAmB,iCAAiC,UAAU,KAAK,CAAC;AAC1E,aAAW,WAAW,kBAAkB;AACtC,UAAM,cAAc,QAAQ,MAAM,GAAG,EAAE,IAAI;AAC3C,QAAI,CAAC,IAAI,SAAS,WAAW,GAAG;AAC9B,aAAO,KAAK;AAAA,QACV,MAAM;AAAA,QACN,SAAS,6BAA6B,OAAO;AAAA,QAC7C,OAAO;AAAA,QACP,UAAU;AAAA,MACZ,CAAC;AAAA,IACH;AAAA,EACF;AAGA,QAAM,WAAW,IAAI,MAAM,uBAAuB;AAClD,MAAI,UAAU;AACZ,UAAM,MAAM,SAAS,CAAC;AACtB,QAAI,CAAC,UAAU,KAAK,GAAG,GAAG;AACxB,aAAO,KAAK;AAAA,QACV,MAAM;AAAA,QACN,SAAS;AAAA,QACT,OAAO;AAAA,QACP,UAAU;AAAA,MACZ,CAAC;AAAA,IACH;AAEA,QAAI,aAAa,KAAK,IAAI,WAAW,GAAG,GAAG;AACzC,aAAO,KAAK;AAAA,QACV,MAAM;AAAA,QACN,SAAS;AAAA,QACT,OAAO;AAAA,QACP,UAAU;AAAA,MACZ,CAAC;AAAA,IACH;AAAA,EACF;AAGA,QAAM,eAAe,IAAI,MAAM,yBAAyB;AACxD,MAAI,cAAc;AAChB,UAAM,OAAO,SAAS,aAAa,CAAC,CAAC;AACrC,QAAI,OAAO,QAAQ,QAAO,oBAAI,KAAK,GAAE,YAAY,GAAG;AAClD,eAAS,KAAK;AAAA,QACZ,MAAM;AAAA,QACN,SAAS,YAAY,IAAI;AAAA,QACzB,OAAO;AAAA,QACP,UAAU;AAAA,MACZ,CAAC;AAAA,IACH;AAAA,EACF;AAEA,SAAO;AAAA,IACL,OAAO,OAAO,WAAW;AAAA,IACzB;AAAA,IACA;AAAA,EACF;AACF;AAlGgB;AAwGhB,eAAe,UACb,WACA,eACA,QACY;AACZ,QAAM,EAAE,cAAc,kBAAkB,oBAAoB,aAAa,IAAI,WAAW;AAExF,MAAI,YAA0B;AAC9B,MAAI,QAAQ;AAEZ,WAAS,UAAU,GAAG,WAAW,cAAc,WAAW;AACxD,QAAI;AACF,aAAO,MAAM,eAAe,WAAW,OAAO,IAAI,YAAY,EAAE;AAChE,aAAO,MAAM,UAAU;AAAA,IACzB,SAAS,OAAY;AACnB,kBAAY;AACZ,aAAO,KAAK,eAAe,WAAW,OAAO,YAAY,MAAM,OAAO,IAAI;AAAA,QACxE;AAAA,QACA,aAAa;AAAA,QACb,OAAO,MAAM;AAAA,MACf,CAAC;AAED,UAAI,UAAU,cAAc;AAC1B,eAAO,MAAM,eAAe,WAAW,KAAK,iBAAiB;AAC7D,cAAM,IAAI,QAAQ,aAAW,WAAW,SAAS,KAAK,CAAC;AACvD,gBAAQ,KAAK,IAAI,QAAQ,oBAAoB,YAAY;AAAA,MAC3D;AAAA,IACF;AAAA,EACF;AAEA,QAAM,aAAa,IAAI,MAAM,gCAAgC;AAC/D;AA/Be;AAqCR,IAAM,YAAN,MAAgB;AAAA,EAzXvB,OAyXuB;AAAA;AAAA;AAAA,EACb;AAAA,EACA,aAAmC;AAAA,EACnC;AAAA,EACA;AAAA,EACA,gBAA6B,oBAAI,IAAI;AAAA;AAAA,EAE7C,YAAY,KAAW;AACrB,SAAK,SAAS;AACd,SAAK,MAAM;AACX,SAAK,SAAS,IAAI,UAAU,GAAG;AAI/B,UAAM,UAAU,CAAC,CAAC,KAAK;AACvB,UAAM,SAAS,CAAC,CAAC,KAAK;AACtB,UAAM,cAAc,CAAC,CAAC,KAAK;AAE3B,QAAI,WAAW,QAAQ;AACrB,WAAK,aAAa;AAAA,QAChB,eAAe,IAAI;AAAA,QACnB,cAAc,IAAI;AAAA,QAClB,aAAa,IAAI;AAAA,MACnB;AACA,UAAI,CAAC,aAAa;AAChB,aAAK,OAAO,KAAK,QAAQ,sDAAsD;AAAA,MACjF;AACA,WAAK,OAAO,KAAK,QAAQ,gEAAgE;AAAA,IAC3F,OAAO;AAEL,UAAI,CAAC,WAAW,CAAC,QAAQ;AACvB,aAAK,OAAO,MAAM,QAAQ,gFAAgF;AAAA,MAC5G,WAAW,CAAC,SAAS;AACnB,aAAK,OAAO,MAAM,QAAQ,wDAAwD;AAAA,MACpF,WAAW,CAAC,QAAQ;AAClB,aAAK,OAAO,MAAM,QAAQ,uDAAuD;AAAA,MACnF;AACA,WAAK,OAAO,KAAK,QAAQ,mFAAmF;AAAA,IAC9G;AAGA,UAAM,UAAU,iBAAiB;AACjC,SAAK,OAAO,KAAK,QAAQ,0BAA0B;AAAA,MACjD,aAAa,KAAK,OAAO;AAAA,MACzB,MAAM,QAAQ;AAAA,MACd,MAAM,cAAc;AAAA,MACpB,SAAS,QAAQ;AAAA,MACjB,sBAAsB,sBAAsB;AAAA,MAC5C,eAAe;AAAA,MACf,cAAc;AAAA,MACd;AAAA,IACF,CAAC;AAAA,EACH;AAAA;AAAA;AAAA;AAAA,EAKQ,YAA6C;AAEnD,QAAI,CAAC,sBAAsB,GAAG;AAC5B,aAAO,EAAE,IAAI,OAAO,OAAO,kDAAkD;AAAA,IAC/E;AAGA,UAAM,WAAW,kCAAkC;AACnD,QAAI,CAAC,SAAS,OAAO;AACnB,aAAO,EAAE,IAAI,OAAO,OAAO,SAAS,QAAQ;AAAA,IAC9C;AAEA,WAAO,EAAE,IAAI,KAAK;AAAA,EACpB;AAAA;AAAA;AAAA;AAAA,EAKA,uBAA+B;AAC7B,UAAM,UAAU,iBAAiB;AACjC,UAAM,YAAY,KAAK,IAAI,EAAE,SAAS,EAAE;AACxC,UAAM,SAAS,WAAK,EAAE,MAAM,GAAG,CAAC;AAChC,WAAO,GAAG,QAAQ,IAAI,IAAI,SAAS,IAAI,MAAM,GAAG,YAAY;AAAA,EAC9D;AAAA;AAAA;AAAA;AAAA,EAKQ,kBAAkB,WAAmB,SAAyB;AACpE,UAAM,UAAU,iBAAiB;AACjC,UAAM,OAAO,cAAc;AAE3B,WAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAMO,QAAQ,IAAI;AAAA,kBACZ,IAAI;AAAA,wBACC,oBAAI,KAAK,GAAE,YAAY,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,WAKpC,SAAS;AAAA,QACZ,OAAO;AAAA,YACH,SAAS;AAAA;AAAA;AAAA,EAGnB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,eACJ,WACA,YACA,SAC4C;AAC5C,UAAM,YAAY,KAAK,IAAI;AAC3B,UAAM,YAAY,WAAK;AACvB,UAAM,eAAe,KAAK,qBAAqB;AAE/C,SAAK,OAAO,KAAK,kBAAkB,uBAAuB;AAAA,MACxD;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF,CAAC;AAGD,UAAM,YAAY,KAAK,UAAU;AACjC,QAAI,CAAC,UAAU,IAAI;AACjB,WAAK,OAAO,MAAM,kBAAkB,UAAU,OAAQ,EAAE,WAAW,aAAa,CAAC;AACjF,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,UAAU;AAAA,QACjB;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IACF;AAGA,UAAM,aAAa,kBAAkB,WAAW,UAAU;AAC1D,QAAI,CAAC,WAAW,OAAO;AACrB,WAAK,OAAO,MAAM,kBAAkB,qBAAqB;AAAA,QACvD;AAAA,QACA;AAAA,QACA,QAAQ,WAAW;AAAA,MACrB,CAAC;AACD,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,sBAAsB,WAAW,OAAO,IAAI,OAAK,EAAE,OAAO,EAAE,KAAK,IAAI,CAAC;AAAA,QAC7E;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IACF;AAGA,QAAI,WAAW,SAAS,SAAS,GAAG;AAClC,WAAK,OAAO,KAAK,kBAAkB,uBAAuB;AAAA,QACxD;AAAA,QACA;AAAA,QACA,UAAU,WAAW;AAAA,MACvB,CAAC;AAAA,IACH;AAEA,UAAM,UAAU,iBAAiB;AACjC,UAAM,WAAW,eAAe,KAAK,OAAO,SAAS,eAAe;AAIpE,aAAS,SAAS,KAAa;AAC7B,UAAI,OAAO,SAAS,YAAY;AAAE,eAAO,KAAK,SAAS,mBAAmB,GAAG,CAAC,CAAC;AAAA,MAC/E,WAAW,OAAO,WAAW,aAAa;AACxC,eAAO,OAAO,KAAK,KAAK,OAAO,EAAE,SAAS,QAAQ;AAAA,MACpD,WAAW,OAAO,eAAe,eAAe,OAAO,WAAW,SAAS,YAAY;AACrF,eAAO,WAAW,KAAK,SAAS,mBAAmB,GAAG,CAAC,CAAC;AAAA,MAC1D,OAAO;AACL,cAAM,IAAI,MAAM,iDAAiD;AAAA,MACnE;AAAA,IACF;AATS;AAUT,UAAM,cAAc,KAAK,kBAAkB,mBAAmB;AAAA,0BACxC,YAAY;AAAA,wBACd,UAAU;AAAA,qBACb,OAAO;AAAA,wBACJ,SAAS,SAAS,CAAC;AAAA,KACtC;AAGD,QAAI,CAAC,KAAK,YAAY;AACpB,WAAK,OAAO,KAAK,kBAAkB,uCAAuC;AAAA,QACxE;AAAA,QACA;AAAA,MACF,CAAC;AAED,YAAM,aAA4B;AAAA,QAChC;AAAA,QACA,MAAM,QAAQ;AAAA,QACd,MAAM,cAAc;AAAA,QACpB,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,QAAQ;AAAA,QACR;AAAA,QACA;AAAA,QACA,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY;AAAA,MACd;AAGA,YAAM,KAAK,gBAAgB,UAAU;AAErC,aAAO;AAAA,QACL,SAAS;AAAA,QACT,MAAM;AAAA,QACN;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IACF;AAGA,QAAI;AACF,YAAM,WAAW,MAAM;AAAA,QACrB,YAAY;AACV,gBAAM,OAAO,MAAM,MAAM,UAAU;AAAA,YACjC,QAAQ;AAAA,YACR,SAAS;AAAA,cACP,gBAAgB;AAAA,cAChB,cAAc;AAAA,YAChB;AAAA,YACA,MAAM;AAAA,UACR,CAAC;AAED,cAAI,CAAC,KAAK,IAAI;AACZ,kBAAM,IAAI,MAAM,QAAQ,KAAK,MAAM,KAAK,KAAK,UAAU,EAAE;AAAA,UAC3D;AAEA,iBAAO,KAAK,KAAK;AAAA,QACnB;AAAA,QACA;AAAA,QACA,KAAK;AAAA,MACP;AAEA,WAAK,OAAO,KAAK,kBAAkB,gCAAgC;AAAA,QACjE;AAAA,QACA;AAAA,QACA,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B,CAAC;AAED,YAAM,aAA4B;AAAA,QAChC;AAAA,QACA,MAAM,QAAQ;AAAA,QACd,MAAM,cAAc;AAAA,QACpB,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,QAAQ;AAAA,QACR;AAAA,QACA;AAAA,QACA,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY;AAAA,QACZ,aAAa;AAAA,MACf;AAEA,YAAM,KAAK,gBAAgB,UAAU;AAErC,aAAO;AAAA,QACL,SAAS;AAAA,QACT,MAAM;AAAA,QACN;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IAEF,SAAS,OAAY;AACnB,WAAK,OAAO,MAAM,kBAAkB,qBAAqB;AAAA,QACvD;AAAA,QACA;AAAA,QACA,OAAO,MAAM;AAAA,MACf,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,MAAM;AAAA,QACb;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,oBAAoB,cAA8D;AACtF,UAAM,YAAY,KAAK,IAAI;AAC3B,UAAM,YAAY,WAAK;AAEvB,SAAK,OAAO,KAAK,aAAa,8BAA8B;AAAA,MAC1D;AAAA,MACA;AAAA,IACF,CAAC;AAED,UAAM,WAAW,eAAe,KAAK,OAAO,SAAS,mBAAmB;AACxE,UAAM,cAAc,KAAK,kBAAkB,uBAAuB;AAAA,0BAC5C,YAAY;AAAA,KACjC;AAGD,QAAI,CAAC,KAAK,YAAY;AAEpB,YAAM,eAAe,MAAM,KAAK,gBAAgB,YAAY;AAC5D,YAAM,SAAoB,gBAAgB;AAE1C,WAAK,OAAO,KAAK,aAAa,0CAA0C;AAAA,QACtE;AAAA,QACA;AAAA,QACA;AAAA,MACF,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,QACT,MAAM;AAAA,QACN;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IACF;AAEA,QAAI;AACF,YAAM,WAAW,MAAM;AAAA,QACrB,YAAY;AACV,gBAAM,OAAO,MAAM,MAAM,UAAU;AAAA,YACjC,QAAQ;AAAA,YACR,SAAS;AAAA,cACP,gBAAgB;AAAA,cAChB,cAAc;AAAA,YAChB;AAAA,YACA,MAAM;AAAA,UACR,CAAC;AAED,cAAI,CAAC,KAAK,IAAI;AACZ,kBAAM,IAAI,MAAM,QAAQ,KAAK,MAAM,KAAK,KAAK,UAAU,EAAE;AAAA,UAC3D;AAEA,iBAAO,KAAK,KAAK;AAAA,QACnB;AAAA,QACA;AAAA,QACA,KAAK;AAAA,MACP;AAGA,YAAM,cAAc,SAAS,MAAM,yBAAyB;AAC5D,YAAM,SAAqB,cAAc,CAAC,KAAmB;AAG7D,YAAM,KAAK,mBAAmB,cAAc,MAAM;AAElD,aAAO;AAAA,QACL,SAAS;AAAA,QACT,MAAM;AAAA,QACN;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IAEF,SAAS,OAAY;AACnB,WAAK,OAAO,MAAM,aAAa,uBAAuB;AAAA,QACpD;AAAA,QACA;AAAA,QACA,OAAO,MAAM;AAAA,MACf,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,MAAM;AAAA,QACb;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,kBAAkB,cAA6E;AACnG,UAAM,YAAY,KAAK,IAAI;AAC3B,UAAM,YAAY,WAAK;AAEvB,SAAK,OAAO,KAAK,UAAU,6BAA6B;AAAA,MACtD;AAAA,MACA;AAAA,IACF,CAAC;AAED,UAAM,WAAW,eAAe,KAAK,OAAO,SAAS,MAAM;AAC3D,UAAM,cAAc,KAAK,kBAAkB,UAAU;AAAA,0BAC/B,YAAY;AAAA,KACjC;AAGD,QAAI,CAAC,KAAK,YAAY;AACpB,YAAM,MAAyB;AAAA,QAC7B,OAAO,OAAO,YAAY;AAAA,QAC1B;AAAA,QACA,QAAQ;AAAA,QACR,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,KAAK,MAAM,KAAK,IAAI,CAAC;AAAA,MACvB;AAGA,UAAI,KAAK,cAAc,IAAI,IAAI,KAAK,GAAG;AACrC,aAAK,OAAO,KAAK,UAAU,2CAA2C;AAAA,UACpE;AAAA,UACA;AAAA,UACA,OAAO,IAAI;AAAA,QACb,CAAC;AAAA,MACH,OAAO;AACL,cAAM,KAAK,oBAAoB,GAAG;AAClC,aAAK,cAAc,IAAI,IAAI,KAAK;AAAA,MAClC;AAEA,aAAO;AAAA,QACL,SAAS;AAAA,QACT,MAAM;AAAA,QACN;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IACF;AAEA,QAAI;AACF,YAAM,WAAW,MAAM;AAAA,QACrB,YAAY;AACV,gBAAM,OAAO,MAAM,MAAM,UAAU;AAAA,YACjC,QAAQ;AAAA,YACR,SAAS;AAAA,cACP,gBAAgB;AAAA,cAChB,cAAc;AAAA,YAChB;AAAA,YACA,MAAM;AAAA,UACR,CAAC;AAED,cAAI,CAAC,KAAK,IAAI;AACZ,kBAAM,IAAI,MAAM,QAAQ,KAAK,MAAM,KAAK,KAAK,UAAU,EAAE;AAAA,UAC3D;AAEA,iBAAO,KAAK,KAAK;AAAA,QACnB;AAAA,QACA;AAAA,QACA,KAAK;AAAA,MACP;AAGA,YAAM,MAAM,KAAK,oBAAoB,UAAU,YAAY;AAE3D,UAAI,KAAK;AAEP,cAAM,cAAc,MAAM,KAAK,eAAe,IAAI,KAAK;AACvD,YAAI,CAAC,aAAa;AAChB,gBAAM,KAAK,oBAAoB,GAAG;AAClC,eAAK,cAAc,IAAI,IAAI,KAAK;AAAA,QAClC,OAAO;AACL,eAAK,OAAO,KAAK,UAAU,yBAAyB;AAAA,YAClD;AAAA,YACA,OAAO,IAAI;AAAA,UACb,CAAC;AAAA,QACH;AAAA,MACF;AAEA,aAAO;AAAA,QACL,SAAS;AAAA,QACT,MAAM;AAAA,QACN;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IAEF,SAAS,OAAY;AACnB,WAAK,OAAO,MAAM,UAAU,qCAAqC;AAAA,QAC/D;AAAA,QACA;AAAA,QACA,OAAO,MAAM;AAAA,MACf,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,MAAM;AAAA,QACb;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,wBAA0E;AAC9E,UAAM,YAAY,KAAK,IAAI;AAC3B,UAAM,YAAY,WAAK;AAEvB,SAAK,OAAO,KAAK,cAAc,kCAAkC,EAAE,UAAU,CAAC;AAE9E,UAAM,WAAW,eAAe,KAAK,OAAO,SAAS,UAAU;AAC/D,UAAM,cAAc,KAAK,kBAAkB,cAAc,EAAE;AAG3D,QAAI,CAAC,KAAK,YAAY;AACpB,aAAO;AAAA,QACL,SAAS;AAAA,QACT,MAAM,CAAC;AAAA,QACP;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IACF;AAEA,QAAI;AACF,YAAM,WAAW,MAAM;AAAA,QACrB,YAAY;AACV,gBAAM,OAAO,MAAM,MAAM,UAAU;AAAA,YACjC,QAAQ;AAAA,YACR,SAAS;AAAA,cACP,gBAAgB;AAAA,cAChB,cAAc;AAAA,YAChB;AAAA,YACA,MAAM;AAAA,UACR,CAAC;AAED,cAAI,CAAC,KAAK,IAAI;AACZ,kBAAM,IAAI,MAAM,QAAQ,KAAK,MAAM,KAAK,KAAK,UAAU,EAAE;AAAA,UAC3D;AAEA,iBAAO,KAAK,KAAK;AAAA,QACnB;AAAA,QACA;AAAA,QACA,KAAK;AAAA,MACP;AAGA,YAAM,OAAO,KAAK,qBAAqB,QAAQ;AAC/C,YAAM,UAA+B,CAAC;AAEtC,iBAAW,OAAO,MAAM;AAEtB,cAAM,cAAc,MAAM,KAAK,eAAe,IAAI,KAAK;AACvD,YAAI,CAAC,aAAa;AAChB,gBAAM,KAAK,oBAAoB,GAAG;AAClC,eAAK,cAAc,IAAI,IAAI,KAAK;AAChC,kBAAQ,KAAK,GAAG;AAAA,QAClB,OAAO;AACL,eAAK,OAAO,MAAM,cAAc,kCAAkC;AAAA,YAChE,OAAO,IAAI;AAAA,UACb,CAAC;AAAA,QACH;AAAA,MACF;AAEA,WAAK,OAAO,KAAK,cAAc,aAAa,QAAQ,MAAM,wBAAwB;AAAA,QAChF;AAAA,QACA,eAAe,KAAK;AAAA,QACpB,cAAc,QAAQ;AAAA,MACxB,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,QACT,MAAM;AAAA,QACN;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IAEF,SAAS,OAAY;AACnB,WAAK,OAAO,MAAM,cAAc,sCAAsC;AAAA,QACpE;AAAA,QACA,OAAO,MAAM;AAAA,MACf,CAAC;AAED,aAAO;AAAA,QACL,SAAS;AAAA,QACT,OAAO,MAAM;AAAA,QACb;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,aAAa,KAAK,OAAO;AAAA,QACzB,YAAY,KAAK,IAAI,IAAI;AAAA,MAC3B;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAMQ,oBAAoB,KAAa,cAAgD;AAEvF,UAAM,cAAc,IAAI,MAAM,yBAAyB;AACvD,UAAM,WAAW,IAAI,MAAM,qBAAqB;AAChD,UAAM,aAAa,IAAI,MAAM,yBAAyB;AAEtD,QAAI,CAAC,YAAa,QAAO;AAEzB,UAAM,MAAyB;AAAA,MAC7B,OAAO,aAAa,CAAC,KAAK,OAAO,YAAY,IAAI,KAAK,IAAI,CAAC;AAAA,MAC3D;AAAA,MACA,QAAQ,YAAY,CAAC;AAAA,MACrB,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,MAClC,KAAK,WAAW,CAAC;AAAA,IACnB;AAGA,QAAI,IAAI,WAAW,YAAY;AAC7B,YAAM,SAAqB,CAAC;AAC5B,YAAM,eAAe,IAAI,SAAS,+GAA+G;AAEjJ,iBAAWC,UAAS,cAAc;AAChC,eAAO,KAAK;AAAA,UACV,WAAWA,OAAM,CAAC;AAAA,UAClB,eAAe;AAAA,UACf,cAAcA,OAAM,CAAC;AAAA,QACvB,CAAC;AAAA,MACH;AAEA,UAAI,OAAO,SAAS,GAAG;AACrB,YAAI,SAAS;AAAA,MACf;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEQ,qBAAqB,KAAkC;AAC7D,UAAM,OAA4B,CAAC;AACnC,UAAM,aAAa,IAAI,SAAS,0FAA0F;AAE1H,eAAWA,UAAS,YAAY;AAC9B,YAAM,eAAeA,OAAM,CAAC;AAC5B,YAAM,MAAM,KAAK,oBAAoBA,OAAM,CAAC,GAAG,YAAY;AAC3D,UAAI,IAAK,MAAK,KAAK,GAAG;AAAA,IACxB;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,gBAAgB,YAA0C;AACtE,QAAI,CAAC,KAAK,KAAK,GAAI;AAEnB,QAAI;AACF,YAAM,KAAK,IAAI,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,OAKzB,EAAE;AAAA,QACD,WAAW;AAAA,QACX,WAAW;AAAA,QACX,WAAW;AAAA,QACX,WAAW;AAAA,QACX,WAAW;AAAA,QACX,WAAW;AAAA,QACX,WAAW;AAAA,QACX,WAAW;AAAA,QACX,WAAW,cAAc;AAAA,QACzB,WAAW,eAAe;AAAA,MAC5B,EAAE,IAAI;AAAA,IACR,SAAS,GAAG;AACV,WAAK,OAAO,MAAM,WAAW,8BAA8B,EAAE,OAAO,OAAO,CAAC,EAAE,CAAC;AAAA,IACjF;AAAA,EACF;AAAA,EAEA,MAAc,oBAAoB,KAAuC;AACvE,QAAI,CAAC,KAAK,KAAK,GAAI;AAEnB,QAAI;AACF,YAAM,KAAK,IAAI,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,OAKzB,EAAE;AAAA,QACD,WAAK;AAAA,QACL,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI;AAAA,QACJ,IAAI,OAAO;AAAA,QACX,IAAI,WAAW;AAAA,QACf,IAAI,cAAc;AAAA,QAClB,IAAI,SAAS,KAAK,UAAU,IAAI,MAAM,IAAI;AAAA,QAC1C,IAAI;AAAA,MACN,EAAE,IAAI;AAAA,IACR,SAAS,GAAG;AACV,WAAK,OAAO,MAAM,WAAW,kCAAkC,EAAE,OAAO,OAAO,CAAC,EAAE,CAAC;AAAA,IACrF;AAAA,EACF;AAAA,EAEA,MAAc,eAAe,OAAiC;AAC5D,QAAI,KAAK,cAAc,IAAI,KAAK,EAAG,QAAO;AAE1C,QAAI,KAAK,KAAK,IAAI;AAChB,UAAI;AACF,cAAM,MAAM,MAAM,KAAK,IAAI,GAAG;AAAA,UAC5B;AAAA,QACF,EAAE,KAAK,KAAK,EAAE,MAAM;AACpB,eAAO,CAAC,CAAC;AAAA,MACX,SAAS,GAAG;AACV,eAAO;AAAA,MACT;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,gBAAgB,cAAiD;AAC7E,QAAI,CAAC,KAAK,KAAK,GAAI,QAAO;AAE1B,QAAI;AACF,YAAM,MAAM,MAAM,KAAK,IAAI,GAAG;AAAA,QAC5B;AAAA,MACF,EAAE,KAAK,YAAY,EAAE,MAAM;AAC3B,aAAO,KAAK,UAAuB;AAAA,IACrC,SAAS,GAAG;AACV,aAAO;AAAA,IACT;AAAA,EACF;AAAA,EAEA,MAAc,mBAAmB,cAAsB,QAAkC;AACvF,QAAI,CAAC,KAAK,KAAK,GAAI;AAEnB,QAAI;AACF,YAAM,KAAK,IAAI,GAAG;AAAA,QAChB;AAAA,MACF,EAAE,KAAK,QAAQ,YAAY,EAAE,IAAI;AAAA,IACnC,SAAS,GAAG;AACV,WAAK,OAAO,MAAM,WAAW,2BAA2B,EAAE,OAAO,OAAO,CAAC,EAAE,CAAC;AAAA,IAC9E;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,UAAyB;AACvB,WAAO,KAAK,OAAO,cAAc;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,UAA+B;AAC7B,UAAM,UAAU,iBAAiB;AACjC,WAAO;AAAA,MACL,aAAa,KAAK,OAAO;AAAA,MACzB,MAAM,QAAQ;AAAA,MACd,MAAM,cAAc;AAAA,MACpB,SAAS,QAAQ;AAAA,MACjB,qBAAqB,QAAQ;AAAA,MAC7B,sBAAsB,sBAAsB;AAAA,MAC5C,iBAAiB,CAAC,CAAC,KAAK;AAAA,MACxB,cAAc,aAAa;AAAA,IAC7B;AAAA,EACF;AACF;AAMO,SAAS,gBAAgB,KAAsB;AACpD,SAAO,IAAI,UAAU,GAAG;AAC1B;AAFgB;AAQT,IAAM,kBAAkB;AAAA,EAC7B,KAAK;AAAA,IACH,MAAM;AAAA,IACN,SAAS,WAAW,UAAU;AAAA,IAC9B,aAAa;AAAA,EACf;AAAA,EACA,YAAY;AAAA,IACV,MAAM;AAAA,IACN,SAAS,WAAW,UAAU;AAAA,IAC9B,aAAa;AAAA,EACf;AACF;;;AC/jCA,IAAM,eAA+B;AAAA,EACnC;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,WAAW,WAAW,QAAQ,UAAU,UAAU,QAAQ,QAAQ,QAAQ,OAAO,KAAK;AAAA,IACtG,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,IAAI,KAAK,EAAE,WAAW,OAAO,GAAtC;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,WAAW,WAAW,QAAQ,UAAU,UAAU,QAAQ,QAAQ,QAAQ,OAAO,KAAK;AAAA,IACtG,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,eAAe,KAAK,GAAG,GAAhC;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,WAAW,WAAW,QAAQ,UAAU,UAAU,QAAQ,QAAQ,QAAQ,OAAO,KAAK;AAAA,IACtG,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,qBAAqB,KAAK,GAAG,GAAtC;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,WAAW,WAAW,QAAQ,UAAU,UAAU,QAAQ,QAAQ,QAAQ,OAAO,KAAK;AAAA,IACtG,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,wBAAwB,KAAK,GAAG,KAAK,4BAA4B,KAAK,GAAG,GAAlF;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,WAAW,WAAW,QAAQ,UAAU,UAAU,QAAQ,QAAQ,QAAQ,OAAO,KAAK;AAAA,IACtG,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,KAAK,QAAQ;AACtB,YAAMC,SAAQ,IAAI,MAAM,yBAAyB,KAAK,IAAI,MAAM,6BAA6B;AAC7F,UAAI,CAACA,OAAO,QAAO;AACnB,YAAM,OAAO,SAASA,OAAM,CAAC,CAAC;AAC9B,YAAM,eAAc,oBAAI,KAAK,GAAE,YAAY;AAC3C,aAAO,QAAQ,QAAQ,QAAQ;AAAA,IACjC,GANU;AAAA,IAOV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,WAAW,WAAW,QAAQ,UAAU,UAAU,QAAQ,QAAQ,OAAO,KAAK;AAAA,IAC9F,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,mBAAmB,KAAK,GAAG,GAApC;AAAA,IACV,cAAc;AAAA,EAChB;AACF;AAGA,IAAM,mBAAmC;AAAA,EACvC;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,WAAW,SAAS;AAAA,IACpC,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,kCAAkC,KAAK,GAAG,KAAK,oCAAoC,KAAK,GAAG,GAApG;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,WAAW,SAAS;AAAA,IACpC,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ;AACjB,YAAMA,SAAQ,IAAI,MAAM,uEAAuE;AAC/F,UAAI,CAACA,OAAO,QAAO;AACnB,YAAM,MAAMA,OAAM,CAAC;AACnB,aAAO,QAAQ,eAAe,CAAC,cAAc,KAAK,GAAG;AAAA,IACvD,GALU;AAAA,IAMV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,WAAW,SAAS;AAAA,IACpC,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,gBAAgB,KAAK,GAAG,KAAK,mBAAmB,KAAK,GAAG,GAAjE;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,WAAW,SAAS;AAAA,IACpC,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,aAAa,KAAK,GAAG,MAAM,cAAc,KAAK,GAAG,KAAK,kBAAkB,KAAK,GAAG,IAAzF;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,WAAW,SAAS;AAAA,IACpC,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,KAAK,QAAQ;AACtB,YAAMA,SAAQ,IAAI,MAAM,uEAAuE;AAC/F,UAAI,CAACA,OAAO,QAAO;AACnB,YAAM,MAAMA,OAAM,CAAC;AACnB,YAAM,YAAY,IAAI,WAAW,GAAG;AACpC,UAAI,IAAI,gBAAgB,gBAAgB,WAAW;AACjD,eAAO;AAAA,MACT;AACA,aAAO;AAAA,IACT,GATU;AAAA,IAUV,cAAc;AAAA,EAChB;AACF;AAGA,IAAM,oBAAoC;AAAA,EACxC;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,UAAU,QAAQ;AAAA,IAClC,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,oBAAoB,KAAK,GAAG,KAAK,sEAAsE,KAAK,GAAG,GAAxH;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,UAAU,QAAQ;AAAA,IAClC,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,qBAAqB,KAAK,GAAG,KAAK,qBAAqB,KAAK,GAAG,GAAxE;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ,QAAQ;AAAA,IACxB,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,mBAAmB,KAAK,GAAG,KAAK,qBAAqB,KAAK,GAAG,GAAtE;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,QAAQ;AAAA,IAChB,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,yBAAyB,KAAK,GAAG,KAAK,kBAAkB,KAAK,GAAG,GAAzE;AAAA,IACV,cAAc;AAAA,EAChB;AACF;AAGA,IAAM,oBAAoC;AAAA,EACxC;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,MAAM;AAAA,IACd,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,oBAAoB,KAAK,GAAG,GAArC;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,MAAM;AAAA,IACd,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,WAAW,KAAK,GAAG,KAAK,gBAAgB,KAAK,GAAG,KAAK,sBAAsB,KAAK,GAAG,GAA5F;AAAA,IACV,cAAc;AAAA,EAChB;AACF;AAGA,IAAM,qBAAqC;AAAA,EACzC;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,MAAM;AAAA,IACd,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,oBAAoB,KAAK,GAAG,GAArC;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,MAAM;AAAA,IACd,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,gBAAgB,KAAK,GAAG,KAAK,kBAAkB,KAAK,GAAG,KAAK,eAAe,KAAK,GAAG,KAAK,gBAAgB,KAAK,GAAG,GAAzH;AAAA,IACV,cAAc;AAAA,EAChB;AACF;AAGA,IAAM,kBAAkC;AAAA,EACtC;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,MAAM;AAAA,IACd,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,aAAa,KAAK,GAAG,KAAK,oBAAoB,KAAK,GAAG,GAA/D;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,MAAM;AAAA,IACd,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,gBAAgB,KAAK,GAAG,KAAK,YAAY,KAAK,GAAG,GAA1D;AAAA,IACV,cAAc;AAAA,EAChB;AACF;AAGA,IAAM,mBAAmC;AAAA,EACvC;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,OAAO,KAAK;AAAA,IACpB,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,WAAW,KAAK,GAAG,KAAK,OAAO,KAAK,GAAG,GAAhD;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,OAAO,OAAO,OAAO,OAAO,KAAK;AAAA,IACzC,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,cAAc,KAAK,GAAG,KAAK,aAAa,KAAK,GAAG,GAAzD;AAAA,IACV,cAAc;AAAA,EAChB;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,aAAa;AAAA,IACb,OAAO,CAAC,OAAO,KAAK;AAAA,IACpB,UAAU;AAAA,IACV,UAAU;AAAA,IACV,UAAU,wBAAC,QAAQ,qBAAqB,KAAK,GAAG,KAAK,eAAe,KAAK,GAAG,GAAlE;AAAA,IACV,cAAc;AAAA,EAChB;AACF;AAGA,IAAM,YAA4B;AAAA,EAChC,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AACL;AAMO,IAAM,kBAAN,MAAsB;AAAA,EAnY7B,OAmY6B;AAAA;AAAA;AAAA,EACnB;AAAA,EAER,cAAc;AACZ,SAAK,QAAQ;AAAA,EACf;AAAA;AAAA;AAAA;AAAA,EAKA,SACE,KACA,YACA,UAII,CAAC,GACa;AAClB,UAAM,UAA6B;AAAA,MACjC,SAAS,QAAQ,WAAW,KAAK,eAAe,GAAG,MAAK,oBAAI,KAAK,GAAE,YAAY,EAAE,SAAS;AAAA,MAC1F;AAAA,MACA,WAAW,QAAQ,aAAa,IAAI,SAAS,SAAS,KAAK,WAAW,SAAS,IAAI;AAAA,MACnF,aAAa,QAAQ,eAAe;AAAA,IACtC;AAEA,UAAM,SAA4B,CAAC;AACnC,UAAM,WAAgC,CAAC;AACvC,UAAM,aAAgC,CAAC;AAGvC,UAAM,kBAAkB,KAAK,MAAM;AAAA,MAAO,UACxC,KAAK,MAAM,SAAS,UAAU,KAAK,KAAK,MAAM,SAAS,WAAW,MAAM,GAAG,EAAE,CAAC,CAAe;AAAA,IAC/F;AAGA,eAAW,QAAQ,iBAAiB;AAClC,UAAI;AACF,cAAM,SAAS,KAAK,SAAS,KAAK,OAAO;AAEzC,mBAAW,KAAK;AAAA,UACd,QAAQ,KAAK;AAAA,UACb,UAAU,KAAK;AAAA,UACf;AAAA,UACA,SAAS,SAAS,SAAY,KAAK;AAAA,QACrC,CAAC;AAED,YAAI,CAAC,QAAQ;AACX,cAAI,KAAK,aAAa,YAAY,KAAK,aAAa,SAAS;AAC3D,mBAAO,KAAK;AAAA,cACV,MAAM,KAAK;AAAA,cACX,MAAM,KAAK;AAAA,cACX,SAAS,KAAK;AAAA,cACd,UAAU,KAAK;AAAA,cACf,UAAU,KAAK;AAAA,YACjB,CAAC;AAAA,UACH,OAAO;AACL,qBAAS,KAAK;AAAA,cACZ,MAAM,KAAK;AAAA,cACX,MAAM,KAAK;AAAA,cACX,SAAS,KAAK;AAAA,cACd,UAAU,KAAK;AAAA,YACjB,CAAC;AAAA,UACH;AAAA,QACF;AAAA,MACF,SAAS,GAAG;AAEV,eAAO,KAAK;AAAA,UACV,MAAM,KAAK;AAAA,UACX,MAAM,KAAK;AAAA,UACX,SAAS,yBAAyB,CAAC;AAAA,UACnC,UAAU;AAAA,UACV,UAAU;AAAA,QACZ,CAAC;AAAA,MACH;AAAA,IACF;AAEA,WAAO;AAAA,MACL,OAAO,OAAO,WAAW;AAAA,MACzB;AAAA,MACA;AAAA,MACA;AAAA,MACA,SAAS;AAAA,QACP,YAAY,gBAAgB;AAAA,QAC5B,QAAQ,WAAW,OAAO,CAAAC,OAAKA,GAAE,MAAM,EAAE;AAAA,QACzC,QAAQ,OAAO;AAAA,QACf,UAAU,SAAS;AAAA,MACrB;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,cAAc,KAAa,YAA8D;AACvF,UAAM,gBAAgB,KAAK,MAAM;AAAA,MAAO,CAAAA,OACtCA,GAAE,aAAa,YAAYA,GAAE,MAAM,SAAS,UAAU;AAAA,IACxD;AAEA,UAAM,SAAmB,CAAC;AAC1B,UAAM,UAA6B;AAAA,MACjC,SAAS,KAAK,eAAe,GAAG,MAAK,oBAAI,KAAK,GAAE,YAAY,EAAE,SAAS;AAAA,MACvE;AAAA,MACA,WAAW;AAAA,MACX,aAAa;AAAA,IACf;AAEA,eAAW,QAAQ,eAAe;AAChC,UAAI,CAAC,KAAK,SAAS,KAAK,OAAO,GAAG;AAChC,eAAO,KAAK,IAAI,KAAK,EAAE,KAAK,KAAK,YAAY,EAAE;AAAA,MACjD;AAAA,IACF;AAEA,WAAO,EAAE,OAAO,OAAO,WAAW,GAAG,OAAO;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA,EAKA,gBAAgB,YAAwC;AACtD,WAAO,KAAK,MAAM,OAAO,CAAAA,OAAKA,GAAE,MAAM,SAAS,UAAU,CAAC;AAAA,EAC5D;AAAA;AAAA;AAAA;AAAA,EAKA,oBAAkC;AAChC,UAAM,QAAQ,oBAAI,IAAgB;AAClC,SAAK,MAAM,QAAQ,CAAAA,OAAKA,GAAE,MAAM,QAAQ,CAAAC,OAAK,MAAM,IAAIA,EAAC,CAAC,CAAC;AAC1D,WAAO,MAAM,KAAK,KAAK;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKQ,eAAe,KAA4B;AACjD,UAAMF,SAAQ,IAAI,MAAM,yBAAyB,KAAK,IAAI,MAAM,6BAA6B;AAC7F,WAAOA,SAAQA,OAAM,CAAC,IAAI;AAAA,EAC5B;AACF;AA0DO,SAAS,wBAAyC;AACvD,SAAO,IAAI,gBAAgB;AAC7B;AAFgB;;;ACrhBhB,eAAsB,cACpB,KACA,cACA,WACA,aAAqB,QACrB,UAAkB,QACO;AACzB,QAAM,OAAM,oBAAI,KAAK,GAAE,YAAY;AACnC,QAAM,YAAY,gBAAgB,GAAG;AACrC,QAAM,kBAAkB,sBAAsB;AAE9C,UAAQ,IAAI,6CAA6C,aAAa,SAAS,EAAE;AACjF,UAAQ,IAAI,yBAAyB,WAAW,WAAW,EAAE;AAC7D,UAAQ,IAAI,qBAAqB,iBAAiB,SAAS,EAAE;AAC7D,UAAQ,IAAI,kBAAkB,iBAAiB,IAAI,WAAW,cAAc,CAAC,EAAE;AAG/E,MAAI,CAAC,sBAAsB,GAAG;AAC5B,YAAQ,IAAI,sDAAsD;AAClE,WAAO;AAAA,MACL,SAAS;AAAA,MACT,cAAc;AAAA,QACZ,GAAG;AAAA,QACH,QAAQ;AAAA,QACR,aAAa;AAAA,QACb,YAAY;AAAA,MACd;AAAA,MACA,QAAQ,CAAC,wBAAwB;AAAA,IACnC;AAAA,EACF;AAGA,MAAI,CAAC,WAAW;AACd,YAAQ,IAAI,wDAAwD;AAEpE,WAAO;AAAA,MACL,SAAS;AAAA,MACT,cAAc;AAAA,QACZ,GAAG;AAAA,QACH,QAAQ;AAAA,QACR,mBAAmB,UAAU,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,MAAM,GAAG,EAAE,EAAE,YAAY;AAAA,QACjF,UAAU;AAAA,QACV,aAAa;AAAA,QACb,MAAM,iBAAiB;AAAA,QACvB,MAAM,cAAc;AAAA,QACpB,aAAa,WAAW;AAAA,QACxB,YAAY;AAAA,MACd;AAAA,IACF;AAAA,EACF;AAGA,QAAM,aAAa,gBAAgB,SAAS,WAAW,YAA0B;AAAA,IAC/E;AAAA,IACA,aAAa,WAAW;AAAA,EAC1B,CAAC;AAED,MAAI,CAAC,WAAW,OAAO;AACrB,YAAQ,MAAM,sCAAsC,WAAW,MAAM;AACrE,WAAO;AAAA,MACL,SAAS;AAAA,MACT,cAAc;AAAA,QACZ,GAAG;AAAA,QACH,QAAQ;AAAA,QACR,aAAa,sBAAsB,WAAW,OAAO,IAAI,OAAK,EAAE,OAAO,EAAE,KAAK,IAAI,CAAC;AAAA,QACnF,YAAY;AAAA,MACd;AAAA,MACA,QAAQ,WAAW,OAAO,IAAI,OAAK,IAAI,EAAE,IAAI,KAAK,EAAE,OAAO,EAAE;AAAA,IAC/D;AAAA,EACF;AAGA,MAAI,WAAW,SAAS,SAAS,GAAG;AAClC,YAAQ,KAAK,wCAAwC,WAAW,QAAQ;AAAA,EAC1E;AAEA,MAAI;AAEF,iBAAa,SAAS;AACtB,iBAAa,aAAa;AAG1B,UAAM,YAAY,MAAM,UAAU,eAAe,WAAW,YAAY,OAAO;AAE/E,QAAI,CAAC,UAAU,WAAW,CAAC,UAAU,MAAM;AACzC,cAAQ,MAAM,mCAAmC,UAAU,KAAK;AAChE,aAAO;AAAA,QACL,SAAS;AAAA,QACT,cAAc;AAAA,UACZ,GAAG;AAAA,UACH,QAAQ;AAAA,UACR,aAAa,UAAU,SAAS;AAAA,UAChC,YAAY;AAAA,QACd;AAAA,QACA;AAAA,QACA,QAAQ,CAAC,UAAU,SAAS,eAAe;AAAA,MAC7C;AAAA,IACF;AAEA,YAAQ,IAAI,6BAA6B,UAAU,KAAK,YAAY,EAAE;AAGtE,UAAM,sBAAyC;AAAA,MAC7C,GAAG;AAAA,MACH,QAAQ,UAAU,KAAK,WAAW,aAAa,YAAY;AAAA,MAC3D,mBAAmB,UAAU,KAAK;AAAA,MAClC,MAAM,UAAU,KAAK;AAAA,MACrB,MAAM,UAAU,KAAK;AAAA,MACrB,aAAa,UAAU,KAAK;AAAA,MAC5B,aAAY,oBAAI,KAAK,GAAE,YAAY;AAAA,IACrC;AAEA,WAAO;AAAA,MACL,SAAS;AAAA,MACT,cAAc;AAAA,MACd;AAAA,IACF;AAAA,EAEF,SAAS,OAAY;AACnB,YAAQ,MAAM,iCAAiC,KAAK;AAEpD,WAAO;AAAA,MACL,SAAS;AAAA,MACT,cAAc;AAAA,QACZ,GAAG;AAAA,QACH,QAAQ;AAAA,QACR,aAAa,MAAM,WAAW;AAAA,QAC9B,YAAY;AAAA,MACd;AAAA,MACA,QAAQ,CAAC,MAAM,OAAO;AAAA,IACxB;AAAA,EACF;AACF;AApIsB;AAyItB,eAAsB,sBACpB,KACA,cACiE;AACjE,QAAM,YAAY,gBAAgB,GAAG;AAErC,UAAQ,IAAI,gCAAgC,YAAY,EAAE;AAE1D,QAAM,eAAe,MAAM,UAAU,oBAAoB,YAAY;AAErE,MAAI,CAAC,aAAa,WAAW,CAAC,aAAa,MAAM;AAC/C,WAAO,EAAE,QAAQ,QAAQ;AAAA,EAC3B;AAEA,QAAM,SAAS,aAAa;AAE5B,MAAI,WAAW,cAAc,WAAW,YAAY;AAClD,UAAM,YAAY,MAAM,UAAU,kBAAkB,YAAY;AAChE,WAAO;AAAA,MACL;AAAA,MACA,gBAAgB,UAAU,UAAU,UAAU,QAAQ,SAAY;AAAA,IACpE;AAAA,EACF;AAEA,SAAO,EAAE,OAAO;AAClB;AAzBsB;AA8BtB,eAAsB,0BAA0B,KAAwC;AACtF,QAAM,YAAY,gBAAgB,GAAG;AAErC,UAAQ,IAAI,yCAAyC;AAErD,QAAM,aAAa,MAAM,UAAU,sBAAsB;AAEzD,MAAI,CAAC,WAAW,WAAW,CAAC,WAAW,MAAM;AAC3C,YAAQ,MAAM,2CAA2C,WAAW,KAAK;AACzE,WAAO,CAAC;AAAA,EACV;AAEA,QAAM,OAAO,WAAW;AAExB,aAAW,OAAO,MAAM;AACtB,YAAQ,IAAI,4BAA4B,IAAI,KAAK,MAAM,IAAI,MAAM,EAAE;AAGnE,QAAI,IAAI,IAAI;AACV,YAAM,IAAI,GAAG,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAQpB,EAAE;AAAA,QACD,IAAI,OAAO,YAAY;AAAA,QACvB,IAAI,WAAW,aAAa,UAAU;AAAA,QACtC,IAAI,WAAW,aAAa,oBAAqB,IAAI,SAAS,CAAC,GAAG,gBAAgB;AAAA,QAClF,IAAI,OAAO;AAAA,SACX,oBAAI,KAAK,GAAE,YAAY;AAAA,QACvB,IAAI;AAAA,MACN,EAAE,IAAI;AAAA,IACR;AAAA,EACF;AAEA,SAAO;AACT;AAvCsB;AA4Cf,SAAS,qBAQd;AACA,SAAO;AAAA,IACL,aAAa,WAAW;AAAA,IACxB,SAAS,iBAAiB;AAAA,IAC1B,MAAM,iBAAiB;AAAA,IACvB,MAAM,cAAc;AAAA,IACpB,qBAAqB,iBAAiB;AAAA,IACtC,aAAa,WAAW,UAAU;AAAA,IAClC,cAAc,WAAW,UAAU;AAAA,EACrC;AACF;AAlBgB;;;ACnQhB,eAAsB,iBAA+B;AAGnD,QAAM,MAAM,MAAM,MAAM,8DAA8D;AACtF,MAAI,CAAC,IAAI,GAAI,OAAM,IAAI,MAAM,4BAA4B;AACzD,QAAM,aAAa,MAAM,IAAI,KAAK;AAClC,SAAO;AACT;AAPsB;AAStB,eAAsB,gBAA8B;AAGlD,QAAM,MAAM,MAAM,MAAM,qCAAqC;AAC7D,MAAI,CAAC,IAAI,GAAI,OAAM,IAAI,MAAM,2BAA2B;AACxD,QAAM,MAAM,MAAM,IAAI,KAAK;AAC3B,SAAO;AACT;AAPsB;;;ACHtB,eAAeG,QAAO,KAA8B;AAClD,QAAM,UAAU,IAAI,YAAY,EAAE,OAAO,IAAI,kBAAkB,gCAAgC;AAC/F,SAAO,MAAM,OAAO,OAAO;AAAA,IACzB;AAAA,IACA,QAAQ,MAAM,GAAG,EAAE;AAAA;AAAA,IACnB,EAAE,MAAM,UAAU;AAAA,IAClB;AAAA,IACA,CAAC,WAAW,SAAS;AAAA,EACvB;AACF;AATe,OAAAA,SAAA;AAiBf,eAAsB,WAAW,MAAc,KAA2B;AACxE,MAAI,CAAC,KAAM,QAAO;AAElB,QAAM,KAAK,OAAO,gBAAgB,IAAI,WAAW,EAAE,CAAC;AACpD,QAAM,MAAM,MAAMA,QAAO,GAAG;AAC5B,QAAM,UAAU,IAAI,YAAY,EAAE,OAAO,IAAI;AAE7C,QAAM,aAAa,MAAM,OAAO,OAAO;AAAA,IACrC,EAAE,MAAM,WAAW,GAAG;AAAA,IACtB;AAAA,IACA;AAAA,EACF;AAGA,QAAM,WAAW,IAAI,WAAW,GAAG,SAAS,WAAW,UAAU;AACjE,WAAS,IAAI,IAAI,CAAC;AAClB,WAAS,IAAI,IAAI,WAAW,UAAU,GAAG,GAAG,MAAM;AAElD,SAAO,KAAK,OAAO,aAAa,GAAG,QAAQ,CAAC;AAC9C;AAnBsB;AA2BtB,eAAsB,WAAW,eAAuB,KAA2B;AACjF,MAAI,CAAC,cAAe,QAAO;AAE3B,MAAI;AACF,UAAM,WAAW,WAAW,KAAK,KAAK,aAAa,GAAG,OAAK,EAAE,WAAW,CAAC,CAAC;AAC1E,UAAM,KAAK,SAAS,MAAM,GAAG,EAAE;AAC/B,UAAM,aAAa,SAAS,MAAM,EAAE;AAEpC,UAAM,MAAM,MAAMA,QAAO,GAAG;AAC5B,UAAM,YAAY,MAAM,OAAO,OAAO;AAAA,MACpC,EAAE,MAAM,WAAW,GAAG;AAAA,MACtB;AAAA,MACA;AAAA,IACF;AAEA,WAAO,IAAI,YAAY,EAAE,OAAO,SAAS;AAAA,EAC3C,SAAS,OAAO;AACd,YAAQ,MAAM,sBAAsB,KAAK;AACzC,WAAO;AAAA,EACT;AACF;AApBsB;;;AChCtB,eAAsB,iBAAiB,KAAc,KAA6B;AAEhF,QAAM,aAAa,MAAM,aAAa,KAAK,GAAG;AAC9C,MAAI,sBAAsB,UAAU;AAClC,WAAO;AAAA,EACT;AACA,QAAM,OAAO;AAEb,MAAI;AACF,UAAM,EAAE,QAAQ,IAAI,MAAM,IAAI,GAAG;AAAA,MAC/B;AAAA,IACF,EAAE,IAAI;AAGN,UAAM,mBAAmB,MAAM,QAAQ;AAAA,OACpC,WAAW,CAAC,GAAG,IAAI,OAAO,QAAa;AACtC,YAAI;AACF,iBAAO;AAAA,YACL,GAAG;AAAA,YACH,WAAW,IAAI,YAAY,MAAM,WAAW,IAAI,WAAW,GAAG,IAAI,IAAI;AAAA,YACtE,OAAO,IAAI,QAAQ,MAAM,WAAW,IAAI,OAAO,GAAG,IAAI,IAAI;AAAA,YAC1D,OAAO,IAAI,QAAQ,MAAM,WAAW,IAAI,OAAO,GAAG,IAAI,IAAI;AAAA,YAC1D,OAAO,IAAI,QAAQ,MAAM,WAAW,IAAI,OAAO,GAAG,IAAI,IAAI;AAAA,UAC5D;AAAA,QACF,QAAQ;AAEN,iBAAO;AAAA,QACT;AAAA,MACF,CAAC;AAAA,IACH;AAGA,UAAM,SAAS,KAAK;AAAA,MAClB,QAAQ;AAAA,MACR,SAAS,KAAK;AAAA,MACd,YAAY,KAAK;AAAA,MACjB,QAAQ;AAAA,MACR,SAAS,KAAK,UAAU,EAAE,OAAO,iBAAiB,OAAO,CAAC;AAAA,IAC5D,CAAC;AAED,WAAO,IAAI,SAAS,KAAK,UAAU,gBAAgB,GAAG;AAAA,MACpD,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAY;AACnB,YAAQ,MAAM,sBAAsB,KAAK;AACzC,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG;AAAA,MACxE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AAlDsB;AAuDtB,eAAsB,oBAAoB,KAAc,KAAU,IAA+B;AAC/F,QAAM,aAAa,MAAM,aAAa,KAAK,GAAG;AAC9C,MAAI,sBAAsB,UAAU;AAClC,WAAO;AAAA,EACT;AACA,QAAM,OAAO;AAEb,MAAI;AACF,UAAM,MAAM,MAAM,IAAI,GAAG,QAAQ,oCAAoC,EAAE,KAAK,EAAE,EAAE,MAAM;AACtF,QAAI,CAAC,KAAK;AACR,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,mBAAmB,CAAC,GAAG;AAAA,QACjE,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAGA,QAAI,YAAY;AAChB,QAAI;AACF,kBAAY;AAAA,QACV,GAAG;AAAA,QACH,WAAW,IAAI,YAAY,MAAM,WAAW,IAAI,WAAW,GAAG,IAAI,IAAI;AAAA,QACtE,OAAO,IAAI,QAAQ,MAAM,WAAW,IAAI,OAAO,GAAG,IAAI,IAAI;AAAA,QAC1D,OAAO,IAAI,QAAQ,MAAM,WAAW,IAAI,OAAO,GAAG,IAAI,IAAI;AAAA,QAC1D,OAAO,IAAI,QAAQ,MAAM,WAAW,IAAI,OAAO,GAAG,IAAI,IAAI;AAAA,MAC5D;AAAA,IACF,QAAQ;AAAA,IAER;AAEA,UAAM,SAAS,KAAK;AAAA,MAClB,QAAQ;AAAA,MACR,SAAS,KAAK;AAAA,MACd,YAAY,KAAK;AAAA,MACjB,QAAQ;AAAA,MACR,WAAW;AAAA,IACb,CAAC;AAED,WAAO,IAAI,SAAS,KAAK,UAAU,SAAS,GAAG;AAAA,MAC7C,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAY;AACnB,YAAQ,MAAM,2BAA2B,KAAK;AAC9C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,yBAAyB,CAAC,GAAG;AAAA,MACvE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AAhDsB;AAqDtB,eAAsB,sBAAsB,KAAc,KAA6B;AACrF,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,UAAM,EAAE,WAAW,OAAO,OAAO,SAAS,MAAM,IAAI;AAEpD,QAAI,CAAC,aAAa,CAAC,OAAO;AACxB,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,8BAA8B,CAAC,GAAG;AAAA,QAC5E,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAEA,UAAM,KAAK,IAAI,QAAQ,IAAI,kBAAkB,KAAK;AAClD,UAAM,KAAK,OAAO,WAAW;AAC7B,UAAM,cAAa,oBAAI,KAAK,GAAE,YAAY;AAG1C,UAAM,cAAc,MAAM,WAAW,WAAW,GAAG;AACnD,UAAM,WAAW,MAAM,WAAW,OAAO,GAAG;AAC5C,UAAM,WAAW,QAAQ,MAAM,WAAW,OAAO,GAAG,IAAI;AACxD,UAAM,WAAW,QAAQ,MAAM,WAAW,OAAO,GAAG,IAAI;AAExD,UAAM,IAAI,GAAG;AAAA,MACX;AAAA;AAAA,IAEF,EACG,KAAK,IAAI,aAAa,UAAU,UAAU,WAAW,MAAM,UAAU,IAAI,UAAU,EACnF,IAAI;AAEP,UAAM,SAAS,KAAK;AAAA,MAClB,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,WAAW;AAAA,MACX,SAAS,KAAK,UAAU,EAAE,QAAQ,CAAC;AAAA,IACrC,CAAC;AAED,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,IAAI,MAAM,GAAG,CAAC,GAAG;AAAA,MACpD,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAY;AACnB,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG;AAAA,MACxE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AA/CsB;AAoDtB,eAAsB,sBAAsB,KAAc,KAAU,IAA+B;AACjG,QAAM,aAAa,MAAM,aAAa,KAAK,GAAG;AAC9C,MAAI,sBAAsB,UAAU;AAClC,WAAO;AAAA,EACT;AACA,QAAM,OAAO;AAGb,MAAI,KAAK,SAAS,SAAS;AACzB,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,wBAAwB,CAAC,GAAG;AAAA,MACtE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AAEA,MAAI;AACF,UAAM,IAAI,GAAG,QAAQ,kCAAkC,EAAE,KAAK,EAAE,EAAE,IAAI;AAEtE,UAAM,SAAS,KAAK;AAAA,MAClB,QAAQ;AAAA,MACR,SAAS,KAAK;AAAA,MACd,YAAY,KAAK;AAAA,MACjB,QAAQ;AAAA,MACR,WAAW;AAAA,IACb,CAAC;AAED,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,IAAI,KAAK,CAAC,GAAG;AAAA,MAChD,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAY;AACnB,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG;AAAA,MACxE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AApCsB;;;ACxKf,SAAS,aAAa,OAAwB;AACnD,QAAM,aAAa;AACnB,SAAO,WAAW,KAAK,KAAK;AAC9B;AAHgB;AAwBT,SAAS,iBAAiB,UAAwD;AACvF,QAAM,SAAmB,CAAC;AAE1B,MAAI,SAAS,SAAS,GAAG;AACvB,WAAO,KAAK,6CAA6C;AAAA,EAC3D;AACA,MAAI,CAAC,QAAQ,KAAK,QAAQ,GAAG;AAC3B,WAAO,KAAK,qDAAqD;AAAA,EACnE;AACA,MAAI,CAAC,QAAQ,KAAK,QAAQ,GAAG;AAC3B,WAAO,KAAK,qDAAqD;AAAA,EACnE;AACA,MAAI,CAAC,QAAQ,KAAK,QAAQ,GAAG;AAC3B,WAAO,KAAK,2CAA2C;AAAA,EACzD;AACA,MAAI,CAAC,wCAAwC,KAAK,QAAQ,GAAG;AAC3D,WAAO,KAAK,sDAAsD;AAAA,EACpE;AAEA,SAAO;AAAA,IACL,OAAO,OAAO,WAAW;AAAA,IACzB;AAAA,EACF;AACF;AAvBgB;AA4BT,SAAS,eAAe,OAAuB;AACpD,SAAO,MACJ,QAAQ,MAAM,MAAM,EACpB,QAAQ,MAAM,MAAM,EACpB,QAAQ,MAAM,QAAQ,EACtB,QAAQ,MAAM,QAAQ,EACtB,QAAQ,OAAO,QAAQ;AAC5B;AAPgB;AAYT,SAAS,uBACd,MACA,gBAC+C;AAC/C,QAAM,SAA4B,CAAC;AAEnC,aAAW,SAAS,gBAAgB;AAClC,QAAI,CAAC,KAAK,KAAK,KAAK,KAAK,KAAK,MAAM,IAAI;AACtC,aAAO,KAAK;AAAA,QACV;AAAA,QACA,SAAS,GAAG,KAAK;AAAA,MACnB,CAAC;AAAA,IACH;AAAA,EACF;AAEA,SAAO;AAAA,IACL,OAAO,OAAO,WAAW;AAAA,IACzB;AAAA,EACF;AACF;AAnBgB;;;ACxEhB,IAAM,YAAY,EAAO;AAGzB,IAAM,UAAU;AAAA,EACd;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,SAAS;AAAA,MACP,EAAE,IAAI,MAAM,OAAO,uBAAuB,UAAU,OAAO,QAAQ,OAAO;AAAA,MAC1E,EAAE,IAAI,MAAM,OAAO,uBAAuB,UAAU,OAAO,QAAQ,OAAO;AAAA,MAC1E,EAAE,IAAI,MAAM,OAAO,qBAAqB,UAAU,OAAO,QAAQ,OAAO;AAAA,MACxE,EAAE,IAAI,MAAM,OAAO,iBAAiB,UAAU,OAAO,QAAQ,OAAO;AAAA,IACtE;AAAA,EACF;AACF;AACA,IAAM,WAAW;AAAA,EACf,EAAE,IAAI,MAAM,MAAM,YAAY,OAAO,oBAAoB,SAAS,CAAC,IAAI,EAAE;AAC3E;AACA,IAAM,cAAc;AAAA,EAClB,EAAE,IAAI,MAAM,WAAW,MAAM,UAAU,MAAM,QAAQ,SAAS;AAChE;AAGA,IAAI,YAAY;AAAA,EACd,OAAO;AAAA,IACL,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,MAAM;AAAA,IACN,MAAM;AAAA,EACR;AAAA,EACA,SAAS;AAAA,EACT,YAAY,CAAC,OAAO,QAAQ,KAAK;AAAA,EACjC,MAAM;AACR;AAGA,UAAU,IAAI,YAAY,CAAC,KAAK,QAAQ;AACtC,SAAO,IAAI,SAAS,KAAK,UAAU,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAClG,CAAC;AAGD,UAAU,IAAI,gBAAgB,CAAC,KAAK,QAAQ;AAC1C,QAAM,SAAS,QAAQ,KAAK,OAAK,EAAE,OAAO,IAAI,OAAO,EAAE;AACvD,MAAI,CAAC,OAAQ,QAAO,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AAC7D,SAAO,IAAI,SAAS,KAAK,UAAU,MAAM,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACjG,CAAC;AAGD,UAAU,KAAK,YAAY,OAAO,KAAK,QAAQ;AAC7C,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,UAAM,EAAE,OAAO,OAAO,IAAI,uBAAuB,MAAM,CAAC,OAAO,CAAC;AAChE,QAAI,CAAC,MAAO,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,OAAO,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAClF,UAAM,KAAK,OAAO,QAAQ,SAAS;AACnC,UAAM,SAAS,EAAE,IAAI,OAAO,KAAK,OAAO,SAAS,CAAC,EAAE;AACpD,YAAQ,KAAK,MAAM;AACnB,UAAM,SAAS,KAAK,EAAE,QAAQ,qBAAqB,QAAQ,WAAW,WAAW,GAAG,CAAC;AACrF,WAAO,IAAI,SAAS,KAAK,UAAU,MAAM,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,EACjG,SAAS,OAAO;AACd,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC3F;AACF,CAAC;AAGD,UAAU,IAAI,gBAAgB,OAAO,KAAK,QAAQ;AAChD,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,UAAM,SAAS,QAAQ,KAAK,OAAK,EAAE,OAAO,IAAI,OAAO,EAAE;AACvD,QAAI,CAAC,OAAQ,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,YAAY,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AACxF,WAAO,QAAQ,KAAK,SAAS,OAAO;AACpC,WAAO,UAAU,KAAK,WAAW,OAAO;AACxC,UAAM,SAAS,KAAK,EAAE,QAAQ,qBAAqB,QAAQ,WAAW,WAAW,OAAO,GAAG,CAAC;AAC5F,WAAO,IAAI,SAAS,KAAK,UAAU,MAAM,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,EACjG,SAAS,OAAO;AACd,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC3F;AACF,CAAC;AAGD,UAAU,OAAO,gBAAgB,OAAO,KAAK,QAAQ;AACnD,MAAI;AACF,UAAM,MAAM,QAAQ,UAAU,OAAK,EAAE,OAAO,IAAI,OAAO,EAAE;AACzD,QAAI,QAAQ,GAAI,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,YAAY,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAC3F,UAAM,CAAC,OAAO,IAAI,QAAQ,OAAO,KAAK,CAAC;AACvC,UAAM,SAAS,KAAK,EAAE,QAAQ,qBAAqB,QAAQ,WAAW,WAAW,QAAQ,GAAG,CAAC;AAC7F,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,KAAK,CAAC,CAAC;AAAA,EACvD,SAAS,OAAO;AACd,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC3F;AACF,CAAC;AAGD,UAAU,IAAI,aAAa,CAAC,KAAK,QAAQ;AACvC,SAAO,IAAI,SAAS,KAAK,UAAU,QAAQ,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACnG,CAAC;AAGD,UAAU,IAAI,iBAAiB,CAAC,KAAK,QAAQ;AAC3C,QAAM,UAAU,SAAS,KAAK,OAAK,EAAE,OAAO,IAAI,OAAO,EAAE;AACzD,MAAI,CAAC,QAAS,QAAO,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AAC9D,SAAO,IAAI,SAAS,KAAK,UAAU,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAClG,CAAC;AAGD,UAAU,KAAK,aAAa,OAAO,KAAK,QAAQ;AAC9C,MAAI;AACF,UAAM,OAAQ,MAAM,IAAI,KAAK;AAC7B,UAAM,EAAE,OAAO,OAAO,IAAI,uBAAuB,MAAM,CAAC,QAAQ,OAAO,CAAC;AACxE,QAAI,CAAC,SAAS,CAAC,aAAa,KAAK,KAAK,EAAG,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,OAAO,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAC/G,UAAM,YAAY,OAAO,SAAS,SAAS;AAC3C,UAAM,UAAU,EAAE,IAAI,WAAW,MAAM,KAAK,MAAM,OAAO,KAAK,OAAO,SAAS,CAAC,EAAE;AACjF,aAAS,KAAK,OAAO;AACrB,UAAM,SAAS,KAAK,EAAE,QAAQ,sBAAsB,QAAQ,YAAY,WAAW,UAAU,CAAC;AAC9F,WAAO,IAAI,SAAS,KAAK,UAAU,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,EAClG,SAAS,OAAO;AACd,YAAQ,MAAM,6BAA6B,KAAK;AAChD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,2BAA2B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC5F;AACF,CAAC;AAGD,UAAU,MAAM,iBAAiB,OAAO,KAAK,QAAQ;AACnD,MAAI;AACF,UAAM,OAAQ,MAAM,IAAI,KAAK;AAC7B,UAAM,UAAU,SAAS,KAAK,OAAK,EAAE,OAAO,IAAI,OAAO,EAAE;AACzD,QAAI,CAAC,QAAS,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,YAAY,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AACzF,YAAQ,OAAO,KAAK,QAAQ,QAAQ;AACpC,YAAQ,QAAQ,KAAK,SAAS,QAAQ;AACtC,YAAQ,UAAU,KAAK,WAAW,QAAQ;AAC1C,UAAM,SAAS,KAAK,EAAE,QAAQ,sBAAsB,QAAQ,YAAY,WAAW,QAAQ,GAAG,CAAC;AAC/F,WAAO,IAAI,SAAS,KAAK,UAAU,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,EAClG,SAAS,OAAO;AACd,YAAQ,MAAM,6BAA6B,KAAK;AAChD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,2BAA2B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC5F;AACF,CAAC;AAGD,UAAU,OAAO,iBAAiB,OAAO,KAAK,QAAQ;AACpD,MAAI;AACF,UAAM,MAAM,SAAS,UAAU,OAAK,EAAE,OAAO,IAAI,OAAO,EAAE;AAC1D,QAAI,QAAQ,GAAI,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,YAAY,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAC3F,UAAM,CAAC,OAAO,IAAI,SAAS,OAAO,KAAK,CAAC;AACxC,UAAM,SAAS,KAAK,EAAE,QAAQ,sBAAsB,QAAQ,YAAY,WAAW,QAAQ,GAAG,CAAC;AAC/F,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,KAAK,CAAC,CAAC;AAAA,EACvD,SAAS,OAAO;AACd,YAAQ,MAAM,6BAA6B,KAAK;AAChD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,2BAA2B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC5F;AACF,CAAC;AAGD,UAAU,KAAK,WAAW,OAAO,KAAK,QAAQ;AAC5C,MAAI;AACF,UAAM,OAAQ,MAAM,IAAI,KAAK;AAE7B,QAAI,KAAK,QAAQ,KAAK,OAAO;AAC3B,YAAM,EAAE,OAAO,OAAO,IAAI,uBAAuB,MAAM,CAAC,QAAQ,OAAO,CAAC;AACxE,UAAI,CAAC,SAAS,CAAC,aAAa,KAAK,KAAK,EAAG,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,OAAO,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAC/G,YAAM,KAAK,OAAO,SAAS,SAAS;AACpC,YAAM,UAAU,EAAE,IAAI,MAAM,KAAK,MAAM,OAAO,KAAK,OAAO,SAAS,CAAC,EAAE;AACtE,eAAS,KAAK,OAAO;AACrB,YAAM,SAAS,KAAK,EAAE,QAAQ,sBAAsB,QAAQ,YAAY,WAAW,GAAG,CAAC;AACvF,aAAO,IAAI,SAAS,KAAK,UAAU,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IAClG;AACA,QAAI,KAAK,aAAa,KAAK,UAAU;AACnC,YAAM,eAAe,OAAO,YAAY,SAAS;AACjD,kBAAY,KAAK,EAAE,IAAI,cAAc,WAAW,KAAK,WAAW,UAAU,KAAK,UAAU,QAAQ,SAAS,CAAC;AAC3G,YAAM,SAAS,KAAK,EAAE,QAAQ,cAAc,QAAQ,eAAe,WAAW,aAAa,CAAC;AAC5F,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,MAAM,IAAI,aAAa,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IAC9H;AACA,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC3F,SAAS,OAAO;AACd,YAAQ,MAAM,qBAAqB,KAAK;AACxC,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,2BAA2B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC5F;AACF,CAAC;AAGD,UAAU,IAAI,gBAAgB,CAAC,KAAK,QAAQ;AAC1C,SAAO,IAAI,SAAS,KAAK,UAAU,WAAW,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACtG,CAAC;AAGD,UAAU,IAAI,oBAAoB,CAAC,KAAK,QAAQ;AAC9C,QAAM,MAAM,YAAY,KAAK,OAAK,EAAE,OAAO,IAAI,OAAO,EAAE;AACxD,MAAI,CAAC,IAAK,QAAO,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AAC1D,SAAO,IAAI,SAAS,KAAK,UAAU,GAAG,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAC9F,CAAC;AAID,UAAU,IAAI,WAAW,CAAC,KAAK,QAAQ;AACrC,SAAO,IAAI,SAAS,KAAK,UAAU,SAAS,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACpG,CAAC;AAED,UAAU,IAAI,WAAW,cAAc,OAAO,KAAK,QAAQ;AACzD,QAAM,OAAQ,MAAM,IAAI,KAAK;AAC7B,cAAY,EAAE,GAAG,WAAW,GAAI,OAAO,SAAS,YAAY,SAAS,OAAO,OAAO,CAAC,EAAG;AACvF,QAAM,SAAS,KAAK,EAAE,QAAQ,qBAAqB,QAAQ,cAAc,WAAW,MAAM,CAAC;AAC3F,SAAO,IAAI,SAAS,KAAK,UAAU,SAAS,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACpG,CAAC;AAED,IAAO,cAAQ;;;AC/Mf,IAAM,eAAe,EAAO;AAG5B,aAAa,KAAK,aAAa,OAAO,KAAK,QAAQ;AACjD,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,UAAM,OAAO,eAAe,KAAK,QAAQ,EAAE;AAC3C,UAAM,QAAQ,eAAe,KAAK,SAAS,EAAE;AAC7C,UAAM,WAAW,KAAK,YAAY;AAClC,QAAI,CAAC,QAAQ,CAAC,aAAa,KAAK,KAAK,CAAC,iBAAiB,QAAQ,EAAE,OAAO;AACtE,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,gBAAgB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IACjF;AAEA,UAAM,SAAS,MAAM,IAAI,GAAG,QAAQ,wCAAwC,EAAE,KAAK,KAAK,EAAE,MAAM;AAChG,QAAI,OAAQ,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,2BAA2B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAEtG,UAAMC,QAAO,MAAM,iBAAO,KAAK,UAAU,EAAE;AAE3C,UAAM,UAAU,MAAM,WAAW,MAAM,GAAG;AAC1C,UAAM,WAAW,MAAM,WAAW,OAAO,GAAG;AAE5C,UAAM,SAAS,MAAM,IAAI,GAAG,QAAQ,uGAAuG,EAAE,KAAK,SAAS,UAAUA,KAAI,EAAE,IAAI;AAC/K,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,MAAM,IAAI,OAAO,UAAU,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,EAClI,SAAS,KAAK;AACZ,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,sBAAsB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EACvF;AACF,CAAC;AAED,IAAO,iBAAQ;;;AC3Bf,IAAM,mBAAmB,EAAO;AAGhC,iBAAiB,KAAK,UAAU,OAAO,KAAK,QAAQ;AAClD,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,UAAM,QAAQ,eAAe,KAAK,SAAS,EAAE;AAC7C,UAAM,WAAW,KAAK,YAAY;AAClC,QAAI,CAAC,aAAa,KAAK,KAAK,CAAC,UAAU;AACrC,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,sBAAsB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IACvF;AAEA,UAAM,aAAa,MAAM,IAAI,GAAG,QAAQ,yDAAyD,EAAE,IAAI;AACvG,QAAI,OAAO;AACX,eAAW,OAAO,WAAW,SAAS;AACpC,YAAM,WAAW,MAAM,WAAW,IAAI,OAAO,GAAG;AAChD,UAAI,aAAa,OAAO;AACtB,eAAO;AACP;AAAA,MACF;AAAA,IACF;AACA,QAAI,CAAC,KAAM,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,sBAAsB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAEhG,UAAM,QAAQ,MAAM,iBAAO,QAAQ,UAAU,KAAK,aAAa;AAC/D,QAAI,CAAC,MAAO,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,sBAAsB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAEjG,UAAM,UAAU;AAAA,MACd,IAAI,KAAK;AAAA,MACT;AAAA,MACA,MAAM;AAAA,MACN,MAAM,KAAK,YAAY,MAAM,WAAW,KAAK,WAAW,GAAG,IAAI;AAAA,IACjE;AACA,UAAM,QAAQ,MAAM,cAAI,KAAK,SAAS,IAAI,cAAc,oCAAoC,EAAE,WAAW,KAAK,CAAC;AAC/G,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,MAAM,MAAM,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,EACnH,SAAS,KAAK;AACZ,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,eAAe,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAChF;AACF,CAAC;AAED,IAAO,qBAAQ;;;ACzBf,IAAM,wBAA8D;AAAA,EAClE,MAAM;AAAA,IACJ,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA,MAAM;AAAA,IACJ,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA,KAAK;AAAA,IACH,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA,MAAM;AAAA,IACJ,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA,kBAAkB;AAAA,IAChB,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA,iBAAiB;AAAA,IACf,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA,oBAAoB;AAAA,IAClB,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA,eAAe;AAAA,IACb,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA,gBAAgB;AAAA,IACd,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AACF;AAKA,eAAe,6BAA6B,MAA4B,KAA2B;AACjG,QAAM,OAAO,KAAK,UAAU;AAAA,IAC1B,MAAM,KAAK;AAAA,IACX,UAAU,KAAK;AAAA,IACf,UAAU,KAAK;AAAA,IACf,aAAa,KAAK;AAAA,EACpB,CAAC;AACD,QAAM,UAAU,IAAI,YAAY;AAChC,QAAM,aAAa,QAAQ,OAAO,QAAQ,IAAI,eAAe,mBAAmB;AAChF,QAAM,aAAa,MAAM,OAAO,OAAO,OAAO,WAAW,UAAU;AACnE,QAAM,YAAY,MAAM,KAAK,IAAI,WAAW,UAAU,CAAC;AACvD,SAAO,UAAU,IAAI,CAAC,MAAM,EAAE,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG,CAAC,EAAE,KAAK,EAAE;AACtE;AAZe;AAiBf,eAAsB,uBAAuB,KAAc,KAA6B;AACtF,QAAM,aAAa,MAAM,aAAa,KAAK,GAAG;AAC9C,MAAI,sBAAsB,UAAU;AAClC,WAAO;AAAA,EACT;AACA,QAAM,OAAO;AAEb,MAAI;AACF,UAAM,EAAE,QAAQ,IAAI,MAAM,IAAI,GAAG;AAAA,MAC/B;AAAA,IACF,EAAE,IAAI;AAEN,UAAM,SAAS,KAAK;AAAA,MAClB,QAAQ;AAAA,MACR,SAAS,KAAK;AAAA,MACd,YAAY,KAAK;AAAA,MACjB,QAAQ;AAAA,IACV,CAAC;AAED,WAAO,IAAI,SAAS,KAAK,UAAU,WAAW,CAAC,CAAC,GAAG;AAAA,MACjD,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAY;AACnB,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,8BAA8B,CAAC,GAAG;AAAA,MAC5E,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AA7BsB;AAkCtB,eAAsB,uBAAuB,KAAc,KAA6B;AACtF,QAAM,aAAa,MAAM,aAAa,KAAK,GAAG;AAC9C,MAAI,sBAAsB,UAAU;AAClC,WAAO;AAAA,EACT;AACA,QAAM,OAAO;AAEb,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,UAAM,EAAE,MAAM,UAAU,aAAa,UAAU,IAAI;AAEnD,QAAI,CAAC,QAAQ,CAAC,UAAU;AACtB,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,iCAAiC,CAAC,GAAG;AAAA,QAC/E,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAEA,UAAM,WAAW,sBAAsB,IAAI;AAC3C,QAAI,CAAC,UAAU;AACb,aAAO,IAAI;AAAA,QACT,KAAK,UAAU;AAAA,UACb,OAAO;AAAA,UACP,YAAY,OAAO,KAAK,qBAAqB;AAAA,QAC/C,CAAC;AAAA,QACD,EAAE,QAAQ,KAAK,SAAS,EAAE,gBAAgB,mBAAmB,EAAE;AAAA,MACjE;AAAA,IACF;AAEA,UAAM,KAAK,OAAO,WAAW;AAC7B,UAAM,YAAW,oBAAI,KAAK,GAAE,YAAY;AAExC,UAAM,OAAoB;AAAA,MACxB;AAAA,MACA;AAAA,MACA,OAAO,SAAS;AAAA,MAChB,QAAQ,SAAS;AAAA,MACjB;AAAA,MACA;AAAA,MACA,WAAW,aAAa;AAAA,MACxB,QAAQ;AAAA,MACR,aAAa,eAAe,CAAC;AAAA,MAC7B,WAAW;AAAA,IACb;AAEA,SAAK,YAAY,MAAM,6BAA6B,MAAM,GAAG;AAE7D,UAAM,IAAI,GAAG;AAAA,MACX;AAAA;AAAA,IAEF,EACG;AAAA,MACC,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK,UAAU,KAAK,WAAW;AAAA,MAC/B,KAAK;AAAA,IACP,EACC,IAAI;AAEP,UAAM,SAAS,KAAK;AAAA,MAClB,QAAQ;AAAA,MACR,SAAS,KAAK;AAAA,MACd,YAAY,KAAK;AAAA,MACjB,QAAQ;AAAA,MACR,WAAW;AAAA,MACX,SAAS,KAAK,UAAU,EAAE,MAAM,SAAS,CAAC;AAAA,IAC5C,CAAC;AAED,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,IAAI,MAAM,aAAa,KAAK,CAAC,GAAG;AAAA,MACnE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAY;AACnB,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,8BAA8B,CAAC,GAAG;AAAA,MAC5E,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AArFsB;AA0FtB,eAAsB,qBAAqB,KAAc,KAAU,IAA+B;AAChG,QAAM,aAAa,MAAM,aAAa,KAAK,GAAG;AAC9C,MAAI,sBAAsB,UAAU;AAClC,WAAO;AAAA,EACT;AAEA,MAAI;AACF,UAAM,MAAM,MAAM,IAAI,GAAG,QAAQ,yCAAyC,EAAE,KAAK,EAAE,EAAE,MAAM;AAC3F,QAAI,CAAC,KAAK;AACR,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,wBAAwB,CAAC,GAAG;AAAA,QACtE,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAEA,UAAM,OAAO;AAAA,MACX,GAAG;AAAA,MACH,aAAa,IAAI,mBAAmB,KAAK,MAAM,IAAI,gBAAgB,IAAI,CAAC;AAAA,IAC1E;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU,IAAI,GAAG;AAAA,MACxC,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAY;AACnB,YAAQ,MAAM,0BAA0B,KAAK;AAC7C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,4BAA4B,CAAC,GAAG;AAAA,MAC1E,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AA9BsB;AAmCtB,eAAsB,wBAAwB,KAAc,KAAU,IAA+B;AACnG,QAAM,aAAa,MAAM,aAAa,KAAK,GAAG;AAC9C,MAAI,sBAAsB,UAAU;AAClC,WAAO;AAAA,EACT;AACA,QAAM,OAAO;AAEb,MAAI;AACF,UAAM,IAAI,GAAG,QAAQ,yDAAyD,EAAE,KAAK,EAAE,EAAE,IAAI;AAE7F,UAAM,SAAS,KAAK;AAAA,MAClB,QAAQ;AAAA,MACR,SAAS,KAAK;AAAA,MACd,YAAY,KAAK;AAAA,MACjB,QAAQ;AAAA,MACR,WAAW;AAAA,IACb,CAAC;AAED,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,IAAI,KAAK,CAAC,GAAG;AAAA,MAChD,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAY;AACnB,YAAQ,MAAM,6BAA6B,KAAK;AAChD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,+BAA+B,CAAC,GAAG;AAAA,MAC7E,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AA5BsB;AAiCtB,eAAsB,0BAA0B,KAAc,KAAU,IAA+B;AACrG,QAAM,aAAa,MAAM,aAAa,KAAK,GAAG;AAC9C,MAAI,sBAAsB,UAAU;AAClC,WAAO;AAAA,EACT;AAEA,MAAI;AACF,UAAM,MAAM,MAAM,IAAI,GAAG,QAAQ,yCAAyC,EAAE,KAAK,EAAE,EAAE,MAAM;AAC3F,QAAI,CAAC,KAAK;AACR,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,wBAAwB,CAAC,GAAG;AAAA,QACtE,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAEA,UAAM,OAAO;AAAA,MACX,GAAG;AAAA,MACH,aAAa,IAAI,mBAAmB,KAAK,MAAM,IAAI,gBAAgB,IAAI,CAAC;AAAA,IAC1E;AAGA,WAAO,IAAI,SAAS,KAAK,UAAU,MAAM,MAAM,CAAC,GAAG;AAAA,MACjD,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,uBAAuB,qCAAqC,KAAK,IAAI,IAAI,KAAK,EAAE;AAAA,MAClF;AAAA,IACF,CAAC;AAAA,EACH,SAAS,OAAY;AACnB,YAAQ,MAAM,+BAA+B,KAAK;AAClD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,iCAAiC,CAAC,GAAG;AAAA,MAC/E,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AAlCsB;AAuCtB,eAAsB,uBAAuB,KAAc,KAA6B;AACtF,SAAO,IAAI;AAAA,IACT,KAAK;AAAA,MACH,OAAO,QAAQ,qBAAqB,EAAE,IAAI,CAAC,CAAC,KAAK,GAAG,OAAO;AAAA,QACzD,MAAM;AAAA,QACN,OAAO,IAAI;AAAA,QACX,QAAQ,IAAI;AAAA,MACd,EAAE;AAAA,IACJ;AAAA,IACA,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE;AAAA,EACpD;AACF;AAXsB;;;AC7StB,IAAM,eAA6B;AAAA,EACjC;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,OAAO;AAAA,IACP,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,OAAO;AAAA,IACP,OAAO;AAAA,IACP,KAAK;AAAA,IACL,aAAa,CAAC,QAAQ,QAAQ,MAAM;AAAA,IACpC,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,OAAO;AAAA,IACP,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,OAAO;AAAA,IACP,OAAO;AAAA,IACP,KAAK;AAAA,IACL,aAAa,CAAC,MAAM;AAAA,IACpB,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,OAAO;AAAA,IACP,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,OAAO;AAAA,IACP,OAAO;AAAA,IACP,KAAK;AAAA,IACL,aAAa,CAAC,MAAM;AAAA,IACpB,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,MAAM;AAAA,IACN,OAAO;AAAA,IACP,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,OAAO;AAAA,IACP,OAAO;AAAA,IACP,KAAK;AAAA,IACL,aAAa,CAAC,MAAM;AAAA,IACpB,QAAQ;AAAA,EACV;AACF;AAKA,eAAsB,eAAe,KAAc,KAA6B;AAC9E,QAAM,MAAM,IAAI,IAAI,IAAI,GAAG;AAC3B,QAAM,SAAS,IAAI,aAAa,IAAI,QAAQ;AAC5C,QAAM,OAAO,IAAI,aAAa,IAAI,MAAM;AAExC,MAAI,UAAU,aAAa,OAAO,CAAC,MAAM,EAAE,MAAM;AAGjD,MAAI,QAAQ;AACV,cAAU,QAAQ;AAAA,MAAO,CAAC,MACxB,EAAE,OAAO,YAAY,EAAE,SAAS,OAAO,YAAY,CAAC;AAAA,IACtD;AAAA,EACF;AAGA,MAAI,MAAM;AACR,cAAU,QAAQ,OAAO,CAAC,MAAM,EAAE,SAAS,IAAI;AAAA,EACjD;AAEA,SAAO,IAAI,SAAS,KAAK,UAAU,OAAO,GAAG;AAAA,IAC3C,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,EAChD,CAAC;AACH;AAtBsB;AA2BtB,eAAsB,oBACpB,KACA,KACA,IACmB;AACnB,QAAM,SAAS,aAAa,KAAK,CAAC,MAAM,EAAE,OAAO,MAAM,EAAE,MAAM;AAE/D,MAAI,CAAC,QAAQ;AACX,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,wBAAwB,CAAC,GAAG;AAAA,MACtE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AAEA,SAAO,IAAI,SAAS,KAAK,UAAU,MAAM,GAAG;AAAA,IAC1C,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,EAChD,CAAC;AACH;AAjBsB;AAsBtB,eAAsB,kBAAkB,KAAc,KAA6B;AACjF,QAAM,UAAU,CAAC,GAAG,IAAI,IAAI,aAAa,OAAO,CAAC,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;AAEtF,SAAO,IAAI,SAAS,KAAK,UAAU,OAAO,GAAG;AAAA,IAC3C,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,EAChD,CAAC;AACH;AANsB;;;ACtHtB,IAAM,wBAAwB;AAAA,EAC5B;AAAA,IACE,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,aAAa;AAAA,IACb,eAAe;AAAA,IACf,UAAU;AAAA,EACZ;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,aAAa;AAAA,IACb,eAAe;AAAA,IACf,UAAU;AAAA,EACZ;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,aAAa;AAAA,IACb,eAAe;AAAA,IACf,UAAU;AAAA,EACZ;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,aAAa;AAAA,IACb,eAAe;AAAA,IACf,UAAU;AAAA,EACZ;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,aAAa;AAAA,IACb,eAAe;AAAA,IACf,UAAU;AAAA,EACZ;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,aAAa;AAAA,IACb,eAAe;AAAA,IACf,UAAU;AAAA,EACZ;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,aAAa;AAAA,IACb,eAAe;AAAA,IACf,UAAU;AAAA,EACZ;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,aAAa;AAAA,IACb,eAAe;AAAA,IACf,UAAU;AAAA,EACZ;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,aAAa;AAAA,IACb,eAAe;AAAA,IACf,UAAU;AAAA,EACZ;AACF;AAGA,IAAM,0BAA0B;AAAA,EAC9B,KAAK;AAAA,IACH,EAAE,IAAI,eAAe,MAAM,eAAe,aAAa,gEAAgE;AAAA,IACvH,EAAE,IAAI,gBAAgB,MAAM,gBAAgB,aAAa,iCAAiC;AAAA,IAC1F,EAAE,IAAI,eAAe,MAAM,eAAe,aAAa,sCAAsC;AAAA,IAC7F,EAAE,IAAI,cAAc,MAAM,cAAc,aAAa,kDAAkD;AAAA,IACvG,EAAE,IAAI,gBAAgB,MAAM,gBAAgB,aAAa,wCAAwC;AAAA,IACjG,EAAE,IAAI,aAAa,MAAM,aAAa,aAAa,+CAA+C;AAAA,EACpG;AAAA,EACA,UAAU;AAAA,IACR,EAAE,IAAI,YAAY,MAAM,gBAAgB,aAAa,wCAAwC;AAAA,IAC7F,EAAE,IAAI,kBAAkB,MAAM,uBAAuB,aAAa,2CAA2C;AAAA,IAC7G,EAAE,IAAI,cAAc,MAAM,mBAAmB,aAAa,uCAAuC;AAAA,IACjG,EAAE,IAAI,mBAAmB,MAAM,mBAAmB,aAAa,gCAAgC;AAAA,IAC/F,EAAE,IAAI,iBAAiB,MAAM,iBAAiB,aAAa,mCAAmC;AAAA,IAC9F,EAAE,IAAI,qBAAqB,MAAM,qBAAqB,aAAa,uCAAuC;AAAA,EAC5G;AAAA,EACA,OAAO;AAAA,IACL,EAAE,IAAI,cAAc,MAAM,qBAAqB,aAAa,yCAAyC;AAAA,IACrG,EAAE,IAAI,cAAc,MAAM,iBAAiB,aAAa,yCAAyC;AAAA,IACjG,EAAE,IAAI,iBAAiB,MAAM,iBAAiB,aAAa,+BAA+B;AAAA,EAC5F;AAAA,EACA,aAAa;AAAA,IACX,EAAE,IAAI,iBAAiB,MAAM,iBAAiB,aAAa,4CAA4C;AAAA,IACvG,EAAE,IAAI,QAAQ,MAAM,eAAe,aAAa,yCAAyC;AAAA,IACzF,EAAE,IAAI,oBAAoB,MAAM,oBAAoB,aAAa,yCAAyC;AAAA,IAC1G,EAAE,IAAI,qBAAqB,MAAM,qBAAqB,aAAa,qCAAqC;AAAA,EAC1G;AACF;AA+BA,eAAsB,sBAAsB,KAAc,KAA6B;AACrF,QAAM,aAAa,MAAM,aAAa,KAAK,GAAG;AAC9C,MAAI,sBAAsB,UAAU;AAClC,WAAO;AAAA,EACT;AACA,QAAM,OAAO;AAEb,MAAI;AAEF,UAAM,EAAE,SAAS,MAAM,IAAI,MAAM,IAAI,GAAG;AAAA,MACtC;AAAA,IACF,EAAE,IAAI;AAEN,UAAM,UAAU,IAAI,KAAK,SAAS,CAAC,GAAG,IAAI,CAAC,MAAW,CAAC,EAAE,MAAM,CAAC,CAAC,CAAC;AAGlE,UAAM,oBAAoB,sBAAsB,IAAI,CAAAC,SAAO;AACzD,YAAM,OAAO,QAAQ,IAAIA,KAAI,IAAI;AACjC,UAAI,SAAuD;AAE3D,UAAI,MAAM;AACR,YAAI,KAAK,WAAW,WAAW;AAC7B,mBAAS;AAAA,QACX,WAAW,KAAK,cAAc,IAAI,KAAK,KAAK,UAAU,IAAI,oBAAI,KAAK,GAAG;AACpE,mBAAS;AAAA,QACX,OAAO;AACL,mBAAS;AAAA,QACX;AAAA,MACF;AAEA,aAAO;AAAA,QACL,MAAMA,KAAI;AAAA,QACV,OAAOA,KAAI;AAAA,QACX,QAAQA,KAAI;AAAA,QACZ;AAAA,QACA,UAAU,MAAM;AAAA,QAChB,WAAW,MAAM;AAAA,QACjB,UAAUA,KAAI;AAAA,QACd,UAAUA,KAAI;AAAA,QACd,aAAaA,KAAI;AAAA,MACnB;AAAA,IACF,CAAC;AAGD,QAAI,QAAQ;AACZ,QAAI,WAAW;AAEf,sBAAkB,QAAQ,UAAQ;AAChC,UAAI,KAAK,UAAU;AACjB,oBAAY;AACZ,YAAI,KAAK,WAAW,SAAU,UAAS;AAAA,iBAC9B,KAAK,WAAW,UAAW,UAAS;AAAA,MAC/C,OAAO;AACL,oBAAY;AACZ,YAAI,KAAK,WAAW,SAAU,UAAS;AAAA,MACzC;AAAA,IACF,CAAC;AAGD,UAAM,oBAAoB,OAAO,QAAQ,uBAAuB,EAAE,IAAI,CAAC,CAAC,UAAU,KAAK,OAAO;AAAA,MAC5F;AAAA,MACA,OAAO,MAAM,IAAI,WAAS;AAAA,QACxB,IAAI,KAAK;AAAA,QACT,MAAM,KAAK;AAAA,QACX,aAAa,KAAK;AAAA,QAClB,QAAQ,2BAA2B,KAAK,IAAI,GAAG;AAAA,MACjD,EAAE;AAAA,IACJ,EAAE;AAGF,sBAAkB,QAAQ,SAAO;AAC/B,UAAI,MAAM,QAAQ,UAAQ;AACxB,oBAAY;AACZ,YAAI,KAAK,WAAW,OAAQ,UAAS;AAAA,iBAC5B,KAAK,WAAW,UAAW,UAAS;AAAA,MAC/C,CAAC;AAAA,IACH,CAAC;AAED,UAAM,aAAa,KAAK,MAAO,QAAQ,WAAY,GAAG;AAGtD,UAAM,kBAA4B,CAAC;AAEnC,sBAAkB,QAAQ,UAAQ;AAChC,UAAI,KAAK,WAAW,aAAa,KAAK,UAAU;AAC9C,wBAAgB,KAAK,iCAAuB,KAAK,KAAK,KAAK,KAAK,IAAI,6BAA6B;AAAA,MACnG,WAAW,KAAK,WAAW,WAAW;AACpC,wBAAgB,KAAK,oBAAa,KAAK,KAAK,kCAAkC;AAAA,MAChF,WAAW,KAAK,WAAW,aAAa,CAAC,KAAK,UAAU;AACtD,wBAAgB,KAAK,0CAAmC,KAAK,KAAK,EAAE;AAAA,MACtE;AAAA,IACF,CAAC;AAGD,UAAM,mBAAmB,oBAAI,KAAK;AAClC,qBAAiB,QAAQ,iBAAiB,QAAQ,IAAI,EAAE;AAExD,sBAAkB,QAAQ,UAAQ;AAChC,UAAI,KAAK,aAAa,KAAK,WAAW,UAAU;AAC9C,cAAM,UAAU,IAAI,KAAK,KAAK,SAAS;AACvC,YAAI,WAAW,kBAAkB;AAC/B,0BAAgB,KAAK,yBAAoB,KAAK,KAAK,eAAe,QAAQ,mBAAmB,CAAC,EAAE;AAAA,QAClG;AAAA,MACF;AAAA,IACF,CAAC;AAED,UAAM,UACJ,cAAc,KAAK,cACnB,cAAc,KAAK,YAAY;AAEjC,UAAM,mBAAqC;AAAA,MACzC;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,cAAc;AAAA,MACd,cAAc;AAAA,MACd;AAAA,MACA,cAAa,oBAAI,KAAK,GAAE,YAAY;AAAA,IACtC;AAEA,UAAM,SAAS,KAAK;AAAA,MAClB,QAAQ;AAAA,MACR,SAAS,KAAK;AAAA,MACd,YAAY,KAAK;AAAA,MACjB,QAAQ;AAAA,MACR,SAAS,KAAK,UAAU,EAAE,SAAS,WAAW,CAAC;AAAA,IACjD,CAAC;AAED,WAAO,IAAI,SAAS,KAAK,UAAU,gBAAgB,GAAG;AAAA,MACpD,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EAEH,SAAS,OAAY;AACnB,YAAQ,MAAM,2BAA2B,KAAK;AAC9C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG;AAAA,MACxE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AA5IsB;AAiJtB,eAAsB,6BAA6B,KAAc,KAA6B;AAC5F,SAAO,IAAI,SAAS,KAAK,UAAU;AAAA,IACjC,cAAc;AAAA,IACd,cAAc;AAAA,EAChB,CAAC,GAAG;AAAA,IACF,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,EAChD,CAAC;AACH;AAPsB;AAYtB,eAAsB,2BAA2B,KAAc,KAA6B;AAC1F,QAAM,aAAa,MAAM,aAAa,KAAK,GAAG;AAC9C,MAAI,sBAAsB,UAAU;AAClC,WAAO;AAAA,EACT;AACA,QAAM,OAAO;AAEb,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,UAAM,EAAE,UAAU,YAAY,IAAI;AAElC,QAAI,CAAC,UAAU;AACb,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,uBAAuB,CAAC,GAAG;AAAA,QACrE,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAEA,UAAM,SAAgB,CAAC;AACvB,UAAM,SAAgB,CAAC;AAGvB,UAAM,iBAAiB,oBAAI,KAAK;AAChC,mBAAe,YAAY,eAAe,YAAY,IAAI,CAAC;AAC3D,UAAM,YAAY,eAAe,YAAY;AAE7C,eAAW,WAAW,uBAAuB;AAC3C,UAAI;AAEF,cAAM,WAAW,MAAM,IAAI,GAAG;AAAA,UAC5B;AAAA,QACF,EAAE,KAAK,QAAQ,IAAI,EAAE,MAAM;AAE3B,YAAI,UAAU;AACZ,iBAAO,KAAK;AAAA,YACV,MAAM,QAAQ;AAAA,YACd,QAAQ;AAAA,YACR,IAAI,SAAS;AAAA,UACf,CAAC;AACD;AAAA,QACF;AAEA,cAAM,KAAK,OAAO,WAAW;AAC7B,cAAM,YAAW,oBAAI,KAAK,GAAE,YAAY;AACxC,cAAM,kBAAkB,cAAc,QAAQ,IAAI,KAAK,2BAA2B,QAAQ,IAAI;AAG9F,cAAM,gBAAgB,KAAK,UAAU;AAAA,UACnC,MAAM,QAAQ;AAAA,UACd;AAAA,UACA;AAAA,UACA,aAAa;AAAA,QACf,CAAC;AACD,cAAM,UAAU,IAAI,YAAY;AAChC,cAAM,aAAa,QAAQ,OAAO,iBAAiB,IAAI,eAAe,mBAAmB;AACzF,cAAM,aAAa,MAAM,OAAO,OAAO,OAAO,WAAW,UAAU;AACnE,cAAM,YAAY,MAAM,KAAK,IAAI,WAAW,UAAU,CAAC;AACvD,cAAM,YAAY,UAAU,IAAI,OAAK,EAAE,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG,CAAC,EAAE,KAAK,EAAE;AAE7E,cAAM,IAAI,GAAG;AAAA,UACX;AAAA;AAAA,QAEF,EAAE;AAAA,UACA;AAAA,UACA,QAAQ;AAAA,UACR,QAAQ;AAAA,UACR,QAAQ;AAAA,UACR;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,KAAK,UAAU,eAAe;AAAA,UAC9B;AAAA,QACF,EAAE,IAAI;AAEN,eAAO,KAAK;AAAA,UACV,MAAM,QAAQ;AAAA,UACd,QAAQ;AAAA,UACR;AAAA,UACA,OAAO,QAAQ;AAAA,QACjB,CAAC;AAAA,MAEH,SAAS,KAAU;AACjB,eAAO,KAAK;AAAA,UACV,MAAM,QAAQ;AAAA,UACd,OAAO,IAAI;AAAA,QACb,CAAC;AAAA,MACH;AAAA,IACF;AAEA,UAAM,SAAS,KAAK;AAAA,MAClB,QAAQ;AAAA,MACR,SAAS,KAAK;AAAA,MACd,YAAY,KAAK;AAAA,MACjB,QAAQ;AAAA,MACR,SAAS,KAAK,UAAU,EAAE,UAAU,OAAO,OAAO,OAAO,CAAC;AAAA,IAC5D,CAAC;AAED,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,IAAI;AAAA,MACJ;AAAA,MACA;AAAA,MACA,SAAS;AAAA,QACP,OAAO,sBAAsB;AAAA,QAC7B,aAAa,OAAO,OAAO,OAAK,EAAE,WAAW,QAAQ,EAAE;AAAA,QACvD,eAAe,OAAO,OAAO,OAAK,EAAE,WAAW,gBAAgB,EAAE;AAAA,QACjE,QAAQ,OAAO;AAAA,MACjB;AAAA,IACF,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EAEH,SAAS,OAAY;AACnB,YAAQ,MAAM,iCAAiC,KAAK;AACpD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,+BAA+B,CAAC,GAAG;AAAA,MAC7E,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AAxHsB;AA6HtB,SAAS,2BAA2B,MAAsC;AACxE,QAAM,MAAM,oBAAI,KAAK;AACrB,QAAM,OAAO,IAAI,YAAY;AAE7B,UAAQ,MAAM;AAAA,IACZ,KAAK;AACH,aAAO;AAAA,QACL,aAAa;AAAA;AAAA,QACb,eAAe;AAAA,QACf,kBAAkB,IAAI,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC;AAAA,MAClD;AAAA,IACF,KAAK;AACH,aAAO;AAAA,QACL,aAAa;AAAA;AAAA,QACb,UAAU,KAAK,SAAS;AAAA,QACxB,cAAc,GAAG,IAAI;AAAA,MACvB;AAAA,IACF,KAAK;AACH,aAAO;AAAA,QACL,aAAa;AAAA;AAAA,QACb,kBAAkB;AAAA,QAClB,cAAc;AAAA,MAChB;AAAA,IACF,KAAK;AACH,aAAO;AAAA,QACL,YAAY;AAAA;AAAA,QACZ,oBAAoB;AAAA,MACtB;AAAA,IACF,KAAK;AACH,aAAO;AAAA,QACL,aAAa,OAAO,WAAW,EAAE,UAAU,GAAG,CAAC,EAAE,YAAY;AAAA,QAC7D,QAAQ;AAAA,QACR,kBAAkB;AAAA,MACpB;AAAA,IACF,KAAK;AACH,aAAO;AAAA,QACL,gBAAgB,MAAM,IAAI,IAAI,OAAO,WAAW,EAAE,UAAU,GAAG,CAAC,EAAE,YAAY,CAAC;AAAA,QAC/E,OAAO;AAAA,QACP,eAAe;AAAA,MACjB;AAAA,IACF,KAAK;AACH,aAAO;AAAA,QACL,cAAc,OAAO,WAAW,EAAE,UAAU,GAAG,CAAC,EAAE,YAAY;AAAA,QAC9D,eAAe;AAAA,QACf,aAAa;AAAA,QACb,aAAa;AAAA,MACf;AAAA,IACF,KAAK;AACH,aAAO;AAAA,QACL,cAAc;AAAA,QACd,YAAY,IAAI,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC;AAAA,QAC1C,oBAAoB;AAAA,QACpB,0BAA0B;AAAA,QAC1B,qBAAqB;AAAA,MACvB;AAAA,IACF,KAAK;AACH,aAAO;AAAA,QACL,eAAe;AAAA,QACf,cAAc;AAAA,QACd,oBAAoB;AAAA,QACpB,cAAc;AAAA,MAChB;AAAA,IACF;AACE,aAAO;AAAA,QACL,aAAa,IAAI,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC;AAAA,MAC7C;AAAA,EACJ;AACF;AAnES;AAwET,SAAS,2BAA2B,eAAuB,KAAkB;AAE3E,QAAM,qBAAqB;AAAA,IACzB;AAAA,IAAc;AAAA,IAAmB;AAAA,IACjC;AAAA,IAAgB;AAAA,IAAa;AAAA,EAC/B;AAEA,QAAM,sBAAsB;AAAA,IAC1B;AAAA,IAAqB;AAAA,EACvB;AAEA,MAAI,mBAAmB,SAAS,aAAa,EAAG,QAAO;AACvD,MAAI,oBAAoB,SAAS,aAAa,EAAG,QAAO;AACxD,SAAO;AACT;AAdS;AAmBT,eAAsB,uBAAuB,KAAc,KAA6B;AACtF,QAAM,aAAa,MAAM,aAAa,KAAK,GAAG;AAC9C,MAAI,sBAAsB,UAAU;AAClC,WAAO;AAAA,EACT;AAEA,MAAI;AACF,UAAM,EAAE,SAAS,MAAM,IAAI,MAAM,IAAI,GAAG;AAAA,MACtC;AAAA,IACF,EAAE,IAAI;AAEN,UAAM,EAAE,SAAS,UAAU,IAAI,MAAM,IAAI,GAAG;AAAA,MAC1C;AAAA,IACF,EAAE,IAAI;AAEN,UAAM,SAAS;AAAA,MACb,cAAa,oBAAI,KAAK,GAAE,YAAY;AAAA,MACpC,UAAU;AAAA,QACR,MAAM;AAAA,QACN,OAAO;AAAA,QACP,WAAW,CAAC,mBAAmB;AAAA,QAC/B,OAAO;AAAA,QACP,OAAO;AAAA,MACT;AAAA,MACA,cAAc,SAAS,CAAC;AAAA,MACxB,cAAc;AAAA,MACd,YAAY,aAAa,CAAC;AAAA,MAC1B,wBAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAQjB,oBAAI,KAAK,GAAE,YAAY,CAAC;AAAA,QAC7B,KAAK;AAAA,IACT;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU,QAAQ,MAAM,CAAC,GAAG;AAAA,MACnD,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,uBAAuB,4CAA2C,oBAAI,KAAK,GAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC,CAAC;AAAA,MAC1G;AAAA,IACF,CAAC;AAAA,EAEH,SAAS,OAAY;AACnB,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,4BAA4B,CAAC,GAAG;AAAA,MAC1E,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AArDsB;;;ACtgBtB,IAAM,gBAAgB;AAAA,EACpB,cAAc;AAAA,EACd,YAAY;AAAA,EACZ,KAAK;AAAA,EACL,UAAU;AAAA,EACV,SAAS;AAAA,EACT,MAAM;AAAA,EACN,OAAO;AAAA,EACP,KAAK;AAAA,EACL,iBAAiB;AAAA,EACjB,OAAO;AAAA,EACP,aAAa;AAAA,EACb,0BAA0B;AAAA,EAC1B,0BAA0B;AAC5B;AAoCA,eAAsB,oBAAoB,KAAc,KAA6B;AACnF,QAAM,MAAM,IAAI,IAAI,IAAI,GAAG;AAC3B,QAAM,QAAQ,OAAO,IAAI,aAAa,IAAI,OAAO,KAAK,EAAE;AACxD,QAAM,SAAS,IAAI,aAAa,IAAI,QAAQ;AAE5C,MAAI;AAEF,QAAI,UAA0B;AAAA,MAC5B;AAAA,QACE,IAAI;AAAA,QACJ,eAAe;AAAA,QACf,QAAQ;AAAA,QACR,aAAa;AAAA,QACb,aAAa,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,IAAO,EAAE,YAAY;AAAA,QACjE,eAAe;AAAA,MACjB;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,eAAe;AAAA,QACf,QAAQ;AAAA,QACR,aAAa;AAAA,QACb,aAAa,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,IAAO,EAAE,YAAY;AAAA,QACjE,eAAe;AAAA,MACjB;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,eAAe;AAAA,QACf,QAAQ;AAAA,QACR,aAAa;AAAA,QACb,aAAa,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,IAAO,EAAE,YAAY;AAAA,QACjE,eAAe;AAAA,MACjB;AAAA,MACA;AAAA,QACE,IAAI;AAAA,QACJ,eAAe;AAAA,QACf,QAAQ;AAAA,QACR,aAAa;AAAA,QACb,aAAa,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,KAAK,IAAO,EAAE,YAAY;AAAA,QAClE,eAAe;AAAA,QACf,UAAU;AAAA,QACV,eAAe,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,KAAK,IAAO,EAAE,YAAY;AAAA,MACtE;AAAA,IACF;AAGA,QAAI,QAAQ;AACV,YAAM,YAAY,SAAS,MAAM;AACjC,gBAAU,QAAQ,OAAO,CAAAC,OAAKA,GAAE,WAAW,SAAS;AAAA,IACtD;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,eAAe,QAAQ;AAAA,MACvB,iBAAiB,QAAQ,OAAO,CAAC,KAAKA,OAAM,MAAMA,GAAE,QAAQ,CAAC,IAAI,QAAQ,QAAQ,QAAQ,CAAC;AAAA,MAC1F,SAAS,QAAQ,MAAM,GAAG,KAAK;AAAA,IACjC,CAAC,GAAG;AAAA,MACF,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,yBAAyB,KAAK;AAC5C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,iCAAiC,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAClG;AACF;AA7DsB;AAkEtB,eAAsB,wBAAwB,KAAc,KAAU,MAA8B;AAClG,MAAI,KAAK,SAAS,WAAW,KAAK,SAAS,SAAS;AAClD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,eAAe,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAChF;AAEA,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAK5B,QAAI,CAAC,KAAK,aAAa,CAAC,KAAK,YAAY;AACvC,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IAC3F;AAEA,UAAM,UAAU,OAAO,WAAW;AAClC,UAAM,OAAM,oBAAI,KAAK,GAAE,YAAY;AAEnC,QAAI,IAAI,IAAI;AACV,YAAM,IAAI,GAAG;AAAA,QACX;AAAA;AAAA,MAEF,EAAE;AAAA,QACA;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL;AAAA,MACF,EAAE,IAAI;AAAA,IACR;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,UAAU;AAAA,MACV,YAAY;AAAA,IACd,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,uBAAuB,KAAK;AAC1C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,8BAA8B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC/F;AACF;AA3CsB;AAgDtB,eAAsB,kBAAkB,KAAc,KAA6B;AACjF,MAAI;AACF,UAAM,QAAQ;AAAA,MACZ,eAAe,cAAc;AAAA,MAC7B,YAAY,cAAc;AAAA,MAC1B,KAAK,cAAc;AAAA,MACnB,UAAU,cAAc;AAAA,MACxB,SAAS,GAAG,cAAc,OAAO,KAAK,cAAc,IAAI,KAAK,cAAc,KAAK,IAAI,cAAc,GAAG;AAAA,MACrG,OAAO,cAAc;AAAA,MACrB,OAAO,cAAc;AAAA,MACrB,SAAS,cAAc;AAAA,MACvB,UAAU,cAAc;AAAA,MACxB,mBAAmB,cAAc;AAAA,MACjC,eAAe;AAAA,MACf,gBAAgB;AAAA,MAChB,qBAAqB;AAAA,QACnB,GAAG;AAAA,QACH,GAAG;AAAA,QACH,GAAG;AAAA,QACH,GAAG;AAAA,QACH,GAAG;AAAA,MACL;AAAA,MACA,kBAAkB;AAAA,MAClB,kBAAkB;AAAA,MAClB,uBAAuB;AAAA,MACvB,gBAAgB;AAAA,MAChB,oBAAoB;AAAA,MACpB,eAAe;AAAA,MACf,6BAA6B;AAAA,IAC/B;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU,KAAK,GAAG;AAAA,MACzC,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,uBAAuB,KAAK;AAC1C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,+BAA+B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAChG;AACF;AAtCsB;AA4CtB,eAAsB,iBAAiB,KAAc,KAAU,MAA8B;AAC3F,MAAI,KAAK,SAAS,WAAW,KAAK,SAAS,SAAS;AAClD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,eAAe,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAChF;AAEA,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAO5B,QAAI,CAAC,KAAK,WAAW,CAAC,KAAK,aAAa,KAAK,UAAU,WAAW,GAAG;AACnE,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,8CAA8C,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IAC/G;AAEA,UAAM,SAAS,OAAO,WAAW;AACjC,UAAM,OAAM,oBAAI,KAAK,GAAE,YAAY;AACnC,UAAM,UAA+B,CAAC;AAGtC,eAAW,YAAY,KAAK,WAAW;AACrC,UAAI;AACF,YAAI,UAAU;AACd,YAAI,iBAAiB;AAErB,gBAAQ,UAAU;AAAA,UAChB,KAAK;AACH,6BAAiB,qBAAqB;AACtC,sBAAU,MAAM,gBAAgB,KAAK,KAAK,SAAS,KAAK,cAAc,CAAC,CAAC;AACxE,oBAAQ,YAAY,EAAE,SAAS,MAAM,KAAK,QAAQ;AAClD;AAAA,UACF,KAAK;AACH,6BAAiB,qBAAqB;AACtC,sBAAU,MAAM,cAAc,KAAK,KAAK,SAAS,KAAK,cAAc,CAAC,CAAC;AACtE,oBAAQ,UAAU,EAAE,SAAS,MAAM,KAAK,QAAQ;AAChD;AAAA,UACF,KAAK;AACH,6BAAiB,qBAAqB;AACtC,sBAAU,MAAM,eAAe,KAAK,KAAK,SAAS,KAAK,cAAc,CAAC,CAAC;AACvE,oBAAQ,WAAW,EAAE,SAAS,MAAM,KAAK,QAAQ;AACjD;AAAA,QACJ;AAGA,YAAI,IAAI,IAAI;AACV,gBAAM,IAAI,GAAG;AAAA,YACX;AAAA;AAAA,UAEF,EAAE;AAAA,YACA;AAAA,YACA;AAAA,YACA,KAAK;AAAA,YACL,KAAK,aAAa,KAAK,UAAU,KAAK,UAAU,IAAI;AAAA,YACpD;AAAA,YACA;AAAA,YACA,KAAK;AAAA,UACP,EAAE,IAAI;AAAA,QACR;AAAA,MACF,SAAS,KAAK;AACZ,gBAAQ,QAAQ,IAAI,EAAE,SAAS,OAAO,OAAO,OAAO,GAAG,EAAE;AAAA,MAC3D;AAAA,IACF;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,SAAS;AAAA,MACT,WAAW;AAAA,IACb,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,sBAAsB,KAAK;AACzC,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,+BAA+B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAChG;AACF;AA7EsB;AAkFtB,eAAsB,iBAAiB,KAAc,KAA6B;AAChF,QAAM,MAAM,IAAI,IAAI,IAAI,GAAG;AAC3B,QAAM,WAAW,IAAI,aAAa,IAAI,UAAU;AAChD,QAAM,QAAQ,OAAO,IAAI,aAAa,IAAI,OAAO,KAAK,EAAE;AAExD,MAAI;AACF,UAAM,OAAqB,CAAC;AAE5B,QAAI,CAAC,YAAY,aAAa,OAAO;AAEnC,YAAM,YAAY,MAAM,iBAAiB,KAAK,KAAK;AACnD,YAAM,cAAc,MAAM,eAAe,KAAK,KAAK;AACnD,YAAM,SAAS,MAAM,gBAAgB,KAAK,KAAK;AAE/C,WAAK,KAAK,GAAG,WAAW,GAAG,aAAa,GAAG,MAAM;AAAA,IACnD,OAAO;AAEL,cAAQ,UAAU;AAAA,QAChB,KAAK;AACH,iBAAO,IAAI,SAAS,KAAK,UAAU,MAAM,iBAAiB,KAAK,KAAK,CAAC,GAAG;AAAA,YACtE,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,UAChD,CAAC;AAAA,QACH,KAAK;AACH,iBAAO,IAAI,SAAS,KAAK,UAAU,MAAM,eAAe,KAAK,KAAK,CAAC,GAAG;AAAA,YACpE,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,UAChD,CAAC;AAAA,QACH,KAAK;AACH,iBAAO,IAAI,SAAS,KAAK,UAAU,MAAM,gBAAgB,KAAK,KAAK,CAAC,GAAG;AAAA,YACrE,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,UAChD,CAAC;AAAA,MACL;AAAA,IACF;AAGA,SAAK,KAAK,CAAC,GAAG,MAAM,IAAI,KAAK,EAAE,SAAS,EAAE,QAAQ,IAAI,IAAI,KAAK,EAAE,SAAS,EAAE,QAAQ,CAAC;AAErF,WAAO,IAAI,SAAS,KAAK,UAAU,KAAK,MAAM,GAAG,KAAK,CAAC,GAAG;AAAA,MACxD,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,sBAAsB,KAAK;AACzC,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,8BAA8B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC/F;AACF;AA3CsB;AAgDtB,eAAsB,oBAAoB,KAAc,KAA6B;AACnF,MAAI;AACF,UAAM,UAA2B;AAAA,MAC/B;AAAA,QACE,UAAU;AAAA,QACV,WAAW;AAAA,QACX,iBAAiB;AAAA,QACjB,kBAAkB;AAAA,QAClB,UAAU;AAAA,MACZ;AAAA,MACA;AAAA,QACE,UAAU;AAAA,QACV,WAAW;AAAA,QACX,iBAAiB;AAAA,QACjB,kBAAkB;AAAA,QAClB,UAAU;AAAA,MACZ;AAAA,MACA;AAAA,QACE,UAAU;AAAA,QACV,WAAW;AAAA,QACX,iBAAiB;AAAA,QACjB,kBAAkB;AAAA,QAClB,UAAU;AAAA,MACZ;AAAA,IACF;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,MAClC;AAAA,MACA,iBAAiB,QAAQ,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,WAAW,CAAC;AAAA,MAChE,qBAAqB,QAAQ,OAAO,CAAC,KAAK,MAAM,MAAM,EAAE,iBAAiB,CAAC,IAAI,QAAQ,QAAQ,QAAQ,CAAC;AAAA,IACzG,CAAC,GAAG;AAAA,MACF,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,yBAAyB,KAAK;AAC5C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC3F;AACF;AAtCsB;AA2CtB,eAAsB,mBAAmB,KAAc,KAAU,MAA8B;AAC7F,MAAI,KAAK,SAAS,WAAW,KAAK,SAAS,SAAS;AAClD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,eAAe,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAChF;AAEA,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAO5B,QAAI,CAAC,KAAK,WAAW,CAAC,KAAK,aAAa,CAAC,KAAK,eAAe;AAC3D,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IAC3F;AAEA,UAAM,SAAS,OAAO,WAAW;AACjC,UAAM,gBAAgB,IAAI,KAAK,KAAK,aAAa,EAAE,YAAY;AAE/D,QAAI,IAAI,IAAI;AACV,YAAM,IAAI,GAAG;AAAA,QACX;AAAA;AAAA,MAEF,EAAE;AAAA,QACA;AAAA,QACA,KAAK;AAAA,QACL,KAAK,UAAU,KAAK,SAAS;AAAA,QAC7B,KAAK,aAAa,KAAK,UAAU,KAAK,UAAU,IAAI;AAAA,QACpD;AAAA,QACA,KAAK;AAAA,MACP,EAAE,IAAI;AAAA,IACR;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,SAAS;AAAA,MACT,eAAe;AAAA,IACjB,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,wBAAwB,KAAK;AAC3C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC3F;AACF;AA9CsB;AAmDtB,eAAsB,qBAAqB,KAAc,KAA6B;AACpF,MAAI;AACF,UAAM,WAAW;AAAA,MACf;AAAA,QACE,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,MAAM;AAAA,QACN,WAAW,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,IAAO,EAAE,YAAY;AAAA,QAC1D,WAAW;AAAA,MACb;AAAA,MACA;AAAA,QACE,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,MAAM;AAAA,QACN,WAAW,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,IAAO,EAAE,YAAY;AAAA,QAC1D,WAAW;AAAA,MACb;AAAA,MACA;AAAA,QACE,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,MAAM;AAAA,QACN,WAAW,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,IAAO,EAAE,YAAY;AAAA,QAC1D,WAAW;AAAA,MACb;AAAA,IACF;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,gBAAgB,SAAS;AAAA,MACzB;AAAA,MACA,mBAAmB;AAAA,QACjB,UAAU;AAAA,QACV,SAAS;AAAA,QACT,UAAU;AAAA,MACZ;AAAA,IACF,CAAC,GAAG;AAAA,MACF,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,0BAA0B,KAAK;AAC7C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,2BAA2B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC5F;AACF;AAzCsB;AA8CtB,eAAsB,kBAAkB,KAAc,KAAU,MAA8B;AAC5F,MAAI,KAAK,SAAS,WAAW,KAAK,SAAS,SAAS;AAClD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,eAAe,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAChF;AAEA,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAM5B,QAAI,CAAC,KAAK,YAAY,CAAC,KAAK,cAAc,CAAC,KAAK,YAAY;AAC1D,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,0BAA0B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IAC3F;AAEA,UAAM,UAAU,OAAO,WAAW;AAElC,QAAI,IAAI,IAAI;AACV,YAAM,IAAI,GAAG;AAAA,QACX;AAAA;AAAA,MAEF,EAAE;AAAA,QACA;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,SACL,oBAAI,KAAK,GAAE,YAAY;AAAA,MACzB,EAAE,IAAI;AAAA,IACR;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,UAAU;AAAA,IACZ,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,uBAAuB,KAAK;AAC1C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,uBAAuB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EACxF;AACF;AA3CsB;AA+CtB,eAAe,gBAAgB,KAAU,SAAiB,WAAsC;AAE9F,MAAI,CAAC,IAAI,gBAAiB,OAAM,IAAI,MAAM,0BAA0B;AAGpE,QAAM,SAAS,OAAO,WAAW;AACjC,SAAO,2BAA2B,MAAM;AAC1C;AAPe;AASf,eAAe,cAAc,KAAU,SAAiB,WAAsC;AAE5F,MAAI,CAAC,IAAI,gBAAiB,OAAM,IAAI,MAAM,wBAAwB;AAGlE,QAAM,UAAU,OAAO,WAAW;AAClC,SAAO,uBAAuB,qBAAqB,SAAS,WAAW,OAAO;AAChF;AAPe;AASf,eAAe,eAAe,KAAU,SAAiB,WAAsC;AAE7F,MAAI,CAAC,IAAI,eAAgB,OAAM,IAAI,MAAM,yBAAyB;AAGlE,QAAM,SAAS,OAAO,WAAW;AACjC,SAAO,8BAA8B,MAAM;AAC7C;AAPe;AASf,eAAe,iBAAiB,KAAU,OAAsC;AAE9E,SAAO;AAAA,IACL;AAAA,MACE,IAAI;AAAA,MACJ,UAAU;AAAA,MACV,SAAS;AAAA,MACT,WAAW,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,IAAO,EAAE,YAAY;AAAA,MAC3D,kBAAkB;AAAA,MAClB,QAAQ;AAAA,IACV;AAAA,EACF;AACF;AAZe;AAcf,eAAe,eAAe,KAAU,OAAsC;AAE5E,SAAO;AAAA,IACL;AAAA,MACE,IAAI;AAAA,MACJ,UAAU;AAAA,MACV,SAAS;AAAA,MACT,WAAW,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,IAAO,EAAE,YAAY;AAAA,MAC3D,kBAAkB;AAAA,MAClB,QAAQ;AAAA,IACV;AAAA,EACF;AACF;AAZe;AAcf,eAAe,gBAAgB,KAAU,OAAsC;AAE7E,SAAO;AAAA,IACL;AAAA,MACE,IAAI;AAAA,MACJ,UAAU;AAAA,MACV,SAAS;AAAA,MACT,WAAW,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,IAAO,EAAE,YAAY;AAAA,MAC3D,kBAAkB;AAAA,MAClB,QAAQ;AAAA,IACV;AAAA,EACF;AACF;AAZe;;;ACvkBf,eAAsB,oBAAoB,KAAK;AAC7C,MAAI;AACF,UAAM,OAAO;AAAA,MACX,OAAO;AAAA,QACL;AAAA,UACE,IAAI;AAAA,UACJ,SAAS;AAAA,UACT,WAAW;AAAA,UACX,OAAO;AAAA,UACP,UAAU;AAAA,UACV,WAAW,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,IAAO,EAAE,YAAY;AAAA,QACjE;AAAA,QACA;AAAA,UACE,IAAI;AAAA,UACJ,SAAS;AAAA,UACT,WAAW;AAAA,UACX,OAAO;AAAA,UACP,UAAU;AAAA,UACV,WAAW,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,IAAO,EAAE,YAAY;AAAA,QACjE;AAAA,QACA;AAAA,UACE,IAAI;AAAA,UACJ,SAAS;AAAA,UACT,WAAW;AAAA,UACX,OAAO;AAAA,UACP,UAAU;AAAA,UACV,WAAW,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,IAAO,EAAE,YAAY;AAAA,QACjE;AAAA,MACF;AAAA,IACF;AACA,WAAO,IAAI,SAAS,KAAK,UAAU,IAAI,GAAG;AAAA,MACxC,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,yBAAyB,KAAK;AAC5C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,iCAAiC,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAClG;AACF;AArCsB;AAuCtB,eAAsB,uBAAuB,KAAK;AAChD,MAAI;AACF,UAAM,UAAU;AAAA,MACd,eAAe;AAAA,MACf,gBAAgB;AAAA,MAChB,SAAS;AAAA,QACP;AAAA,UACE,IAAI;AAAA,UACJ,UAAU;AAAA,UACV,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,WAAW,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,IAAO,EAAE,YAAY;AAAA,QACjE;AAAA,QACA;AAAA,UACE,IAAI;AAAA,UACJ,UAAU;AAAA,UACV,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,WAAW,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,IAAO,EAAE,YAAY;AAAA,QACjE;AAAA,QACA;AAAA,UACE,IAAI;AAAA,UACJ,UAAU;AAAA,UACV,QAAQ;AAAA,UACR,MAAM;AAAA,UACN,WAAW,IAAI,KAAK,KAAK,IAAI,IAAI,IAAI,KAAK,IAAO,EAAE,YAAY;AAAA,QACjE;AAAA,MACF;AAAA,IACF;AACA,WAAO,IAAI,SAAS,KAAK,UAAU,OAAO,GAAG;AAAA,MAC3C,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,oCAAoC,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EACrG;AACF;AApCsB;AAsCtB,eAAsB,yBAAyB,KAAK;AAClD,MAAI;AACF,UAAM,YAAY;AAAA,MAChB,WAAW;AAAA,MACX,iBAAiB;AAAA,MACjB,kBAAkB;AAAA,MAClB,wBAAwB;AAAA,MACxB,kBAAkB;AAAA,MAClB,kBAAkB;AAAA,MAClB,mBAAmB;AAAA,MACnB,2BAA2B;AAAA,MAC3B,UAAU;AAAA,QACR,IAAI;AAAA,QACJ,YAAY;AAAA,QACZ,OAAO;AAAA,MACT;AAAA,IACF;AACA,WAAO,IAAI,SAAS,KAAK,UAAU,SAAS,GAAG;AAAA,MAC7C,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,8BAA8B,KAAK;AACjD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,sCAAsC,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EACvG;AACF;AAxBsB;AA0BtB,eAAsB,oBAAoB,KAAK,KAAK,MAAM;AACxD,MAAI,KAAK,SAAS,WAAW,KAAK,SAAS,SAAS;AAClD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,eAAe,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAChF;AAEA,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,UAAM,EAAE,SAAS,SAAS,IAAI;AAE9B,QAAI,CAAC,WAAW,CAAC,UAAU;AACzB,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,8BAA8B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IAC/F;AAGA,UAAM,SAAS,MAAM,KAAK,IAAI,CAAC;AAC/B,UAAM,WAAW;AAAA,MACf,SAAS;AAAA,MACT,SAAS;AAAA,MACT;AAAA,MACA,WAAW;AAAA,MACX,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,MAClC,UAAU;AAAA,IACZ;AAGA,QAAI,IAAI,IAAI;AACV,YAAM,IAAI,GAAG;AAAA,QACX;AAAA;AAAA,MAEF,EAAE;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,KAAK,UAAU,CAAC,QAAQ,CAAC;AAAA,SACzB,oBAAI,KAAK,GAAE,YAAY;AAAA,QACvB;AAAA,QACA,KAAK;AAAA,MACP,EAAE,IAAI;AAAA,IACR;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU,QAAQ,GAAG;AAAA,MAC5C,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,yBAAyB,KAAK;AAC5C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,8BAA8B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC/F;AACF;AAhDsB;AAkDtB,eAAsB,kBAAkB,KAAK,KAAK,MAAM;AACtD,MAAI,KAAK,SAAS,WAAW,KAAK,SAAS,SAAS;AAClD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,eAAe,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAChF;AAEA,MAAI;AACF,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,UAAM,EAAE,cAAc,QAAQ,IAAI;AAElC,QAAI,CAAC,gBAAgB,CAAC,SAAS;AAC7B,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,kCAAkC,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IACnG;AAGA,UAAM,OAAO,MAAM,KAAK,IAAI,CAAC;AAC7B,UAAM,WAAW;AAAA,MACf,SAAS;AAAA,MACT,OAAO;AAAA,MACP;AAAA,MACA;AAAA,MACA,UAAS,oBAAI,KAAK,GAAE,YAAY;AAAA,MAChC,UAAU;AAAA,IACZ;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU,QAAQ,GAAG;AAAA,MAC5C,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,uBAAuB,KAAK;AAC1C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,8BAA8B,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC/F;AACF;AAhCsB;;;AClJtB,eAAsB,uBAAuB,KAAU,KAAyB;AAC9E,MAAI;AACF,YAAQ,IAAI,gCAAgC;AAK5C,UAAM,iBAAgB,oBAAI,KAAK,GAAE,YAAY;AAC7C,YAAQ,IAAI,yBAAyB,aAAa,EAAE;AAGpD,QAAI,IAAI,cAAc;AACpB,YAAM,IAAI,aAAa,IAAI,iBAAiB,aAAa;AAAA,IAC3D;AAEA,UAAM,SAAS,KAAK;AAAA,MAClB,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,SAAS,KAAK,UAAU,EAAE,WAAW,cAAc,CAAC;AAAA,IACtD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,oBAAoB,KAAK;AACvC,UAAM;AAAA,EACR;AACF;AAxBsB;AA6BtB,eAAsB,yBAAyB,KAAU,KAAyB;AAChF,MAAI;AACF,YAAQ,IAAI,6DAA6D;AAGzE,UAAM,gBAAgB,oBAAI,KAAK;AAC/B,kBAAc,YAAY,cAAc,YAAY,IAAI,CAAC;AAEzD,UAAM,cAAc,MAAM,IAAI,GAAG;AAAA,MAC/B;AAAA,IACF,EAAE,KAAK,cAAc,YAAY,CAAC,EAAE,IAAI;AAExC,YAAQ,IAAI,WAAW,YAAY,OAAO,wBAAwB;AAGlE,UAAM,iBAAiB,MAAM,IAAI,GAAG;AAAA,MAClC;AAAA,IACF,EAAE,KAAK,cAAc,YAAY,CAAC,EAAE,IAAI;AAExC,YAAQ,IAAI,WAAW,eAAe,OAAO,uBAAuB;AAMpE,UAAM,eAAe,MAAM,IAAI,GAAG;AAAA,MAChC;AAAA,IACF,EAAE,KAAK,cAAc,YAAY,CAAC,EAAE,IAAI;AAExC,YAAQ,IAAI,WAAW,aAAa,OAAO,qBAAqB;AAGhE,UAAM,gBAAgB,oBAAI,KAAK;AAC/B,kBAAc,YAAY,cAAc,YAAY,IAAI,CAAC;AAEzD,UAAM,gBAAgB,MAAM,IAAI,GAAG;AAAA,MACjC;AAAA,IACF,EAAE,KAAK,cAAc,YAAY,CAAC,EAAE,IAAI;AAExC,YAAQ,IAAI,WAAW,cAAc,OAAO,sBAAsB;AAElE,UAAM,oBAAmB,oBAAI,KAAK,GAAE,YAAY;AAChD,YAAQ,IAAI,uCAAuC,gBAAgB,EAAE;AAGrE,QAAI,IAAI,cAAc;AACpB,YAAM,IAAI,aAAa,IAAI,qBAAqB,gBAAgB;AAAA,IAClE;AAEA,UAAM,SAAS,KAAK;AAAA,MAClB,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,SAAS,KAAK,UAAU;AAAA,QACtB,WAAW;AAAA,QACX,oBAAoB,YAAY;AAAA,QAChC,mBAAmB,eAAe;AAAA,QAClC,iBAAiB,aAAa;AAAA,QAC9B,kBAAkB,cAAc;AAAA,MAClC,CAAC;AAAA,IACH,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,gCAAgC,KAAK;AACnD,UAAM;AAAA,EACR;AACF;AAhEsB;;;AC9BtB,eAAsB,kBAAkBC,UAAkB,KAAU;AAClE,MAAI;AACF,UAAM,OAAO,MAAMA,SAAQ,KAAK;AAGhC,UAAM,YAAYA,SAAQ,QAAQ,IAAI,iBAAiB;AAIvD,UAAM,EAAE,cAAc,UAAU,QAAQ,cAAc,OAAO,IAAI;AAEjE,QAAI,CAAC,cAAc;AACjB,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,uBAAuB,CAAC,GAAG;AAAA,QACrE,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAGA,QAAI,mBAAmB;AACvB,QAAI,CAAC,oBAAoB,IAAI,IAAI;AAC/B,UAAI;AACF,cAAM,aAAa,MAAM,IAAI,GAAG;AAAA,UAC9B;AAAA,QACF,EAAE,KAAK,YAAY,EAAE,MAAM;AAC3B,YAAI,YAAY;AACd,6BAAmB,WAAW;AAAA,QAChC;AAAA,MACF,SAAS,GAAG;AACV,gBAAQ,MAAM,sCAAsC,CAAC;AAAA,MACvD;AAAA,IACF;AAGA,QAAI,CAAC,IAAI,IAAI;AACX,cAAQ,KAAK,kDAAkD;AAAA,IACjE,OAAO;AACL,UAAI;AACF,cAAM,IAAI,GAAG;AAAA,UACX;AAAA;AAAA;AAAA,QAGF,EAAE;AAAA,UACA,UAAU;AAAA,UACV,iBAAgB,oBAAI,KAAK,GAAE,YAAY;AAAA,UACvC,SAAS,KAAK,UAAU,MAAM,IAAI;AAAA,UAClC;AAAA,QACF,EAAE,IAAI;AAAA,MACR,SAAS,SAAS;AAChB,gBAAQ,MAAM,2BAA2B,OAAO;AAAA,MAElD;AAAA,IACF;AAGA,QAAI,IAAI,eAAe,kBAAkB;AACvC,UAAI;AAEF,cAAM,WAAW,MAAM,IAAI,YAAY,IAAI,iBAAiB,SAAS,CAAC;AACtE,YAAI,UAAU;AACZ,gBAAM,SAAS,OAAO,WAAW;AAAA,YAC/B;AAAA,YACA,WAAW;AAAA,YACX;AAAA,YACA;AAAA,UACF,CAAC;AAAA,QACH;AAAA,MACF,SAAS,GAAG;AACV,gBAAQ,MAAM,8BAA8B,CAAC;AAAA,MAC/C;AAAA,IACF;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,MAAM,cAAc,UAAU,iBAAiB,CAAC,GAAG;AAAA,MAC/F,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,uBAAuB,KAAK;AAC1C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,wBAAwB,CAAC,GAAG;AAAA,MACtE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AAnFsB;;;ACAtB,eAAsB,qBAAqBC,UAAkB,KAAU;AACrE,MAAI;AACF,UAAM,OAAO,MAAMA,SAAQ,KAAK;AAGhC,UAAM,YAAYA,SAAQ,QAAQ,IAAI,qBAAqB;AAI3D,UAAM,EAAE,eAAe,UAAU,QAAQ,QAAQ,cAAc,IAAI;AAEnE,QAAI,CAAC,eAAe;AAClB,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,wBAAwB,CAAC,GAAG;AAAA,QACtE,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAGA,QAAI,CAAC,IAAI,IAAI;AACX,cAAQ,KAAK,mDAAmD;AAAA,IAClE,OAAO;AACL,UAAI;AACF,cAAM,IAAI,GAAG;AAAA,UACX;AAAA;AAAA,QAEF,EAAE;AAAA,UACA,OAAO,WAAW;AAAA,UAClB;AAAA,UACA;AAAA,UACA;AAAA,UACA,UAAU;AAAA,UACV,iBAAiB;AAAA,QACnB,EAAE,IAAI;AAAA,MACR,SAAS,SAAS;AAChB,gBAAQ,MAAM,yCAAyC,OAAO;AAAA,MAEhE;AAAA,IACF;AAGA,QAAI,IAAI,eAAe,UAAU;AAC/B,UAAI;AAEF,cAAM,WAAW,MAAM,IAAI,YAAY,IAAI,QAAQ;AACnD,YAAI,UAAU;AACZ,gBAAM,SAAS,OAAO,qBAAqB;AAAA,YACzC;AAAA,YACA;AAAA,YACA;AAAA,YACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,UACpC,CAAC;AAAA,QACH;AAAA,MACF,SAAS,GAAG;AACV,gBAAQ,MAAM,8BAA8B,CAAC;AAAA,MAC/C;AAAA,IACF;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,MAAM,cAAc,CAAC,GAAG;AAAA,MACpE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,0BAA0B,KAAK;AAC7C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,wBAAwB,CAAC,GAAG;AAAA,MACtE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AArEsB;;;ACDtB,eAAsB,uBAAuBC,UAAkB,KAAU;AACvE,MAAI;AACF,UAAM,OAAO,MAAMA,SAAQ,KAAK;AAGhC,UAAM,EAAE,UAAU,gBAAgB,eAAe,SAAS,IAAI;AAE9D,QAAI,CAAC,YAAY,CAAC,kBAAkB,CAAC,eAAe;AAClD,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,OAAO;AAAA,MACT,CAAC,GAAG;AAAA,QACF,QAAQ;AAAA,QACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC;AAAA,IACH;AAGA,UAAM,eAAe,OAAO,WAAW;AACvC,QAAI,CAAC,IAAI,IAAI;AACX,cAAQ,KAAK,uDAAuD;AAAA,IACtE,OAAO;AACL,UAAI;AACF,cAAM,IAAI,GAAG;AAAA,UACX;AAAA;AAAA;AAAA,QAGF,EAAE;AAAA,UACA;AAAA,UACA;AAAA,UACA,YAAY;AAAA,UACZ;AAAA,UACA;AAAA,QACF,EAAE,IAAI;AAAA,MACR,SAAS,SAAS;AAChB,gBAAQ,MAAM,4CAA4C,OAAO;AAAA,MAEnE;AAAA,IACF;AAGA,QAAI,IAAI,aAAa;AACnB,UAAI;AAEF,cAAM,WAAW,MAAM,IAAI,YAAY,IAAI,QAAQ;AACnD,YAAI,UAAU;AACZ,gBAAM,SAAS,OAAO,uBAAuB;AAAA,YAC3C;AAAA,YACA;AAAA,YACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,UACpC,CAAC;AAAA,QACH;AAAA,MACF,SAAS,GAAG;AACV,gBAAQ,MAAM,8BAA8B,CAAC;AAAA,MAC/C;AAAA,IACF;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT;AAAA,IACF,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,wBAAwB,CAAC,GAAG;AAAA,MACtE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AAtEsB;;;ACKtB,IAAM,8BAA8B;AAUpC,eAAe,mBAAmB,SAAiB,WAAqC;AACtF,MAAI;AAGF,WAAO;AAAA,EACT,SAAS,OAAO;AACd,YAAQ,MAAM,kCAAkC,KAAK;AACrD,WAAO;AAAA,EACT;AACF;AATe;AAYf,eAAsB,wBAAwBC,UAAkB,KAAU;AACxE,MAAI;AACF,UAAM,OAA2B,MAAMA,SAAQ,KAAK;AAGpD,QAAI,KAAK,WAAW;AAClB,YAAM,aAAa,KAAK,UAAU,EAAE,MAAM,KAAK,MAAM,WAAW,KAAK,WAAW,MAAM,KAAK,KAAK,CAAC;AACjG,YAAM,UAAU,MAAM,mBAAmB,YAAY,KAAK,SAAS;AACnE,UAAI,CAAC,SAAS;AACZ,eAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,oBAAoB,CAAC,GAAG;AAAA,UAClE,QAAQ;AAAA,UACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,QAChD,CAAC;AAAA,MACH;AAAA,IACF;AAEA,QAAI,KAAK,SAAS,iBAAiB;AAEjC,YAAM,EAAE,UAAU,SAAS,OAAO,IAAI,KAAK;AAE3C,UAAI,CAAC,IAAI,IAAI;AACX,gBAAQ,KAAK,kDAAkD;AAAA,MACjE,OAAO;AAEL,mBAAW,SAAS,UAAU,CAAC,GAAG;AAChC,cAAI;AACF,kBAAM,IAAI,GAAG;AAAA,cACX;AAAA;AAAA;AAAA,YAGF,EAAE;AAAA,cACA,MAAM,MAAM,OAAO,WAAW;AAAA,cAC9B;AAAA,cACA;AAAA,cACA,MAAM;AAAA,cACN,MAAM;AAAA,cACN,MAAM,QAAQ;AAAA,cACd,MAAM,eAAe;AAAA,cACrB;AAAA,YACF,EAAE,IAAI;AAAA,UACR,SAAS,YAAY;AACnB,oBAAQ,MAAM,0BAA0B,MAAM,IAAI,KAAK,UAAU;AAAA,UACnE;AAAA,QACF;AAAA,MACF;AAEA,cAAQ,IAAI,+BAA+B,QAAQ,IAAI,OAAO,KAAK,QAAQ,UAAU,CAAC,SAAS;AAAA,IACjG;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,eAAe;AAAA,MACf,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,IACpC,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,8BAA8B,KAAK;AACjD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,wBAAwB,CAAC,GAAG;AAAA,MACtE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AAhEsB;AAmEtB,eAAsB,sBAAsBA,UAAkB,KAAU;AACtE,MAAI;AACF,UAAM,OAA2B,MAAMA,SAAQ,KAAK;AAGpD,QAAI,KAAK,WAAW;AAClB,YAAM,aAAa,KAAK,UAAU,EAAE,MAAM,KAAK,MAAM,WAAW,KAAK,WAAW,MAAM,KAAK,KAAK,CAAC;AACjG,YAAM,UAAU,MAAM,mBAAmB,YAAY,KAAK,SAAS;AACnE,UAAI,CAAC,SAAS;AACZ,eAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,oBAAoB,CAAC,GAAG;AAAA,UAClE,QAAQ;AAAA,UACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,QAChD,CAAC;AAAA,MACH;AAAA,IACF;AAEA,QAAI,KAAK,SAAS,oBAAoB,KAAK,SAAS,gBAAgB;AAElE,YAAM,EAAE,OAAO,OAAO,SAAS,UAAU,aAAa,KAAK,MAAM,OAAO,IAAI,KAAK;AAEjF,UAAI,CAAC,IAAI,IAAI;AACX,gBAAQ,KAAK,gDAAgD;AAAA,MAC/D,OAAO;AACL,cAAM,SAAS,OAAO,WAAW;AACjC,YAAI;AACF,gBAAM,IAAI,GAAG;AAAA,YACX;AAAA;AAAA;AAAA,UAGF,EAAE;AAAA,YACA;AAAA,YACA,UAAU;AAAA,YACV;AAAA,YACA;AAAA,YACA,WAAW;AAAA,YACX,YAAY;AAAA,YACZ,gBAAe,oBAAI,KAAK,GAAE,YAAY;AAAA,YACtC,OAAO;AAAA,YACP,OAAO,KAAK,UAAU,IAAI,IAAI;AAAA,YAC9B;AAAA,UACF,EAAE,IAAI;AAAA,QACR,SAAS,WAAW;AAClB,kBAAQ,MAAM,qCAAqC,SAAS;AAAA,QAC9D;AAAA,MACF;AAEA,cAAQ,IAAI,kBAAkB,KAAK,IAAI,KAAK,KAAK,MAAM,KAAK,EAAE;AAAA,IAChE;AAEA,WAAO,IAAI,SAAS,KAAK,UAAU;AAAA,MACjC,SAAS;AAAA,MACT,eAAe;AAAA,MACf,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,IACpC,CAAC,GAAG;AAAA,MACF,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,wBAAwB,CAAC,GAAG;AAAA,MACtE,QAAQ;AAAA,MACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAChD,CAAC;AAAA,EACH;AACF;AAhEsB;AAmEf,SAAS,uBAAuB;AACrC,SAAO;AAAA,IACL,eAAe;AAAA,IACf,QAAQ;AAAA,IACR,sBAAsB;AAAA,IACtB,iBAAiB,CAAC,iBAAiB,kBAAkB,cAAc;AAAA,EACrE;AACF;AAPgB;;;ACnIhB,IAAI,SAAS;AAEN,IAAM,uBAAuB;AAAA,EAClC,WAAW;AAAA,EACX,WAAW;AAAA,EACX,UAAU;AAAA,EACV,iBAAiB;AACnB;AAEO,IAAMC,iBAAgB;AAAA,EAC3B,YAAY;AAAA,EACZ,eAAe;AAAA,EACf,cAAc;AAAA,EACd,KAAK;AAAA,EACL,UAAU;AAAA,EACV,SAAS;AAAA,EACT,MAAM;AAAA,EACN,OAAO;AAAA,EACP,KAAK;AAAA,EACL,OAAO;AAAA,EACP,iBAAiB;AAAA,EACjB,OAAO;AAAA,EACP,aAAa;AAAA,EACb,0BAA0B;AAAA,EAC1B,0BAA0B;AAAA,EAC1B,aAAa;AACf;AAqBA,eAAe,WAAW,KAAc,KAA6C;AACnF,QAAM,aAAa,IAAI,QAAQ,IAAI,eAAe;AAClD,MAAI,CAAC,cAAc,CAAC,WAAW,WAAW,SAAS,GAAG;AACpD,WAAO;AAAA,EACT;AAEA,QAAM,QAAQ,WAAW,UAAU,CAAC;AACpC,MAAI;AACF,UAAM,UAAU,MAAM,cAAI,OAAO,OAAO,IAAI,cAAc,kCAAkC;AAC5F,QAAI,CAAC,QAAS,QAAO;AAErB,UAAM,EAAE,QAAQ,IAAI,cAAI,OAAO,KAAK;AACpC,WAAO;AAAA,EACT,SAAS,OAAO;AACd,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO;AAAA,EACT;AACF;AAjBe;AAmBf,SAAS,eAAyB;AAChC,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,eAAe,CAAC,GAAG;AAAA,IAC7D,QAAQ;AAAA,IACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,EAChD,CAAC;AACH;AALS;AAOT,SAAS,YAAsB;AAC7B,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,YAAY,CAAC,GAAG;AAAA,IAC1D,QAAQ;AAAA,IACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,EAChD,CAAC;AACH;AALS;AAQT,eAAe,gBAAgB,KAAU;AACvC,MAAI;AACF,QAAI,CAAC,IAAI,IAAI;AACX,cAAQ,IAAI,wCAAwC,OAAO,KAAK,GAAG,CAAC;AACpE;AAAA,IACF;AACA,UAAM,MAAM,MAAM,IAAI,GAAG,QAAQ,qCAAqC,EAAE,MAAM;AAC9E,YAAQ,IAAI,wBAAwB,GAAG;AACvC,QAAI,CAAC,OAAO,OAAO,IAAI,UAAU,UAAU;AACzC,cAAQ,IAAI,yDAAyD;AACrE;AAAA,IACF;AACA,QAAI,IAAI,UAAU,GAAG;AACnB,YAAM,gBAAgB,MAAM,iBAAO,KAAK,aAAa,EAAE;AACvD,YAAM,IAAI,GAAG;AAAA,QACX;AAAA,MACF,EAAE,KAAK,iBAAiB,uCAAuC,aAAa,EAAE,IAAI;AAClF,cAAQ,IAAI,oBAAoB;AAAA,IAClC;AAAA,EACF,SAAS,GAAG;AACV,YAAQ,IAAI,0BAA0B,CAAC;AAAA,EACzC;AACF;AAtBe;AAwBf,SAAS,YAAY,MAAW,OAAiB;AAC/C,MAAI,CAAC,QAAQ,CAAC,MAAM,SAAS,KAAK,IAAI,EAAG,OAAM,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AAC1F;AAFS;AAIT,SAAS,+BAA+B,SAAc;AACpD,MAAI,CAAC,WAAW,OAAO,YAAY,SAAU,QAAO;AACpD,MAAI,CAAC,QAAQ,cAAc,OAAO,QAAQ,eAAe,SAAU,QAAO;AAC1E,MAAI,CAAC,QAAQ,UAAU,OAAO,QAAQ,WAAW,SAAU,QAAO;AAClE,SAAO;AACT;AALS;AAOT,eAAe,uBAAuB,KAAU;AAC9C,QAAM,aAAa;AAAA,IACjB,KAAK,IAAI;AAAA,IACT,KAAK,IAAI;AAAA,IACT,KAAK;AAAA,IACL,OAAO;AAAA,EACT;AACA,QAAM,WAAW,MAAM,cAAI,KAAK,YAAY,IAAI,oBAAoB;AACpE,QAAM,MAAM,MAAM,MAAM,8CAA8C;AAAA,IACpE,QAAQ;AAAA,IACR,SAAS,EAAE,gBAAgB,oCAAoC;AAAA,IAC/D,MAAM,oEAAoE,QAAQ;AAAA,EACpF,CAAC;AACD,MAAI,CAAC,IAAI,GAAI,OAAM,IAAI,MAAM,wCAAwC;AACrE,QAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,SAAO,KAAK,gBAAgB;AAC9B;AAhBe;AAmBf,eAAe,eAAe,KAAc,KAAU;AACpD,QAAM,MAAM,IAAI,IAAI,IAAI,GAAG;AAC3B,QAAM,IAAI,IAAI,aAAa,IAAI,GAAG;AAClC,MAAI,MAAM;AACV,QAAM,SAAS,CAAC;AAChB,MAAI,GAAG;AACL,WAAO;AACP,WAAO,KAAK,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,IAAI,CAAC,GAAG;AAAA,EACpD;AACA,SAAO;AACP,QAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,GAAG,EAAE,KAAK,GAAG,MAAM,EAAE,IAAI;AAC3D,SAAO,IAAI,SAAS,KAAK,UAAU,KAAK,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACvG;AAZe;AAcf,eAAe,qBAAqB,KAAc,KAAU;AAC1D,QAAM,UAAU,MAAM,IAAI,GAAG,QAAQ,qFAAqF,EAAE,IAAI;AAChI,QAAM,WAAW,MAAM,IAAI,GAAG,QAAQ,qFAAqF,EAAE,IAAI;AACjI,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,QAAQ,SAAS,UAAU,SAAS,QAAQ,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACnJ;AAJe;AAOf,eAAe,oBAAoB,KAAc,KAAU,MAAW;AACpE,MAAI,CAAC,QAAQ,KAAK,SAAS,SAAU,QAAO,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AACrF,QAAM,MAAM;AAAA;AAEZ,QAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,GAAG,EAAE,KAAK,KAAK,EAAE,EAAE,IAAI;AACzD,SAAO,IAAI,SAAS,KAAK,UAAU,KAAK,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACvG;AANe;AAQf,eAAe,SAAS,KAAc,KAAU,MAAW;AACzD,MAAI,CAAC,KAAM,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,gBAAgB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAC1F,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,KAAK,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACnG;AAHe;AAKf,eAAe,mBAAmB,KAAc,KAAU;AACxD,QAAM,MAAM,IAAI,IAAI,IAAI,GAAG;AAC3B,QAAM,IAAI,IAAI,aAAa,IAAI,GAAG;AAClC,MAAI,MAAM;AAAA;AAAA;AAGV,QAAM,SAAS,CAAC;AAChB,MAAI,GAAG;AACL,WAAO;AACP,WAAO,KAAK,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,IAAI,CAAC,KAAK,IAAI,CAAC,GAAG;AAAA,EACpD;AACA,SAAO;AACP,QAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,GAAG,EAAE,KAAK,GAAG,MAAM,EAAE,IAAI;AAC3D,SAAO,IAAI,SAAS,KAAK,UAAU,KAAK,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACvG;AAde;AAgBf,eAAe,sBAAsB,KAAc,KAAU;AAC3D,QAAM,KAAK,IAAI,IAAI,MAAM,GAAG,EAAE,IAAI;AAClC,QAAM,MAAM,MAAM,IAAI,GAAG,QAAQ,kJAAkJ,EAAE,KAAK,EAAE,EAAE,MAAM;AACpM,MAAI,CAAC,IAAK,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,YAAY,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AACrF,SAAO,IAAI,SAAS,KAAK,UAAU,GAAG,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAC9F;AALe;AAOf,eAAe,yBAAyB,KAAc,KAAU;AAC9D,QAAM,KAAK,IAAI,IAAI,MAAM,GAAG,EAAE,IAAI;AAClC,QAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,QAAM,SAAS,CAAC,qBAAqB,iBAAiB,iBAAiB,uBAAuB,mBAAmB,cAAc;AAC/H,QAAM,UAAU,CAAC;AACjB,QAAM,SAAS,CAAC;AAChB,aAAWC,MAAK,QAAQ;AACtB,QAAI,KAAKA,EAAC,MAAM,QAAW;AACzB,cAAQ,KAAK,GAAGA,EAAC,MAAM;AACvB,aAAO,KAAK,KAAKA,EAAC,CAAC;AAAA,IACrB;AAAA,EACF;AACA,MAAI,CAAC,QAAQ,OAAQ,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,sBAAsB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAC1G,SAAO,KAAK,EAAE;AACd,QAAM,IAAI,GAAG,QAAQ,kCAAkC,QAAQ,KAAK,IAAI,CAAC,6CAA6C,EAAE,KAAK,GAAG,MAAM,EAAE,IAAI;AAC5I,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,KAAK,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAC5G;AAhBe;AAmBf,eAAe,cAAcC,UAAkB,KAAU;AACvD,QAAM,KAAKA,SAAQ,IAAI,MAAM,GAAG,EAAE,CAAC;AACnC,QAAM,OAAO,MAAMA,SAAQ,KAAK;AAChC,QAAM,SAAS,CAAC,SAAS,WAAW,aAAa,OAAO,QAAQ,UAAU,cAAc;AACxF,QAAM,UAAU,CAAC;AACjB,QAAM,SAAS,CAAC;AAChB,aAAWD,MAAK,QAAQ;AACtB,QAAI,KAAKA,EAAC,MAAM,QAAW;AACzB,UAAIA,OAAM,QAAQ;AAChB,gBAAQ,KAAK,eAAe;AAC5B,eAAO,KAAK,KAAK,UAAU,KAAK,IAAI,CAAC;AAAA,MACvC,OAAO;AACL,gBAAQ,KAAK,GAAGA,EAAC,MAAM;AACvB,eAAO,KAAK,KAAKA,EAAC,CAAC;AAAA,MACrB;AAAA,IACF;AAAA,EACF;AACA,MAAI,CAAC,QAAQ,OAAQ,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,sBAAsB,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAC1G,SAAO,KAAK,EAAE;AACd,QAAM,IAAI,GAAG,QAAQ,wBAAwB,QAAQ,KAAK,IAAI,CAAC,eAAe,EAAE,KAAK,GAAG,MAAM,EAAE,IAAI;AACpG,QAAM,IAAI,GAAG,QAAQ,6GAA6G,EAAE;AAAA,IAClI;AAAA,IAAU;AAAA,IAAY;AAAA,IAAI,KAAK,UAAU,IAAI;AAAA,EAC/C,EAAE,IAAI;AACN,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,KAAK,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAC5G;AAxBe;AA0Bf,eAAe,cAAcC,UAAkB,KAAU;AACvD,QAAM,KAAKA,SAAQ,IAAI,MAAM,GAAG,EAAE,CAAC;AACnC,QAAM,IAAI,GAAG,QAAQ,sDAAsD,EAAE,KAAK,EAAE,EAAE,IAAI;AAC1F,QAAM,IAAI,GAAG,QAAQ,6GAA6G,EAAE;AAAA,IAClI;AAAA,IAAU;AAAA,IAAY;AAAA,IAAI;AAAA,EAC5B,EAAE,IAAI;AACN,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,KAAK,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAC5G;AAPe;AASf,eAAe,kBAAkBA,UAAkB,KAAU;AAC3D,QAAM,QAAQA,SAAQ,IAAI,MAAM,GAAG;AACnC,QAAM,SAAS,MAAM,CAAC;AACtB,QAAM,IAAI,GAAG,QAAQ,yCAAyC,EAAE,KAAK,MAAM,EAAE,IAAI;AACjF,QAAM,IAAI,GAAG,QAAQ,6GAA6G,EAAE;AAAA,IAClI;AAAA,IAAU;AAAA,IAAiB;AAAA,IAAQ;AAAA,EACrC,EAAE,IAAI;AACN,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,KAAK,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAC5G;AARe;AAUf,eAAe,eAAeA,UAAkB,KAAU;AACxD,QAAM,MAAM,IAAI,IAAIA,SAAQ,GAAG;AAC/B,QAAM,OAAO,IAAI,aAAa,IAAI,MAAM;AACxC,QAAM,OAAO,IAAI,aAAa,IAAI,MAAM;AACxC,QAAM,KAAK,IAAI,aAAa,IAAI,IAAI;AACpC,QAAM,OAAO,IAAI,aAAa,OAAO,MAAM;AAC3C,MAAI,QAAQ;AACZ,QAAM,SAAS,CAAC;AAChB,MAAI,MAAM;AACR,aAAS;AACT,WAAO,KAAK,IAAI,IAAI,KAAK,IAAI,IAAI,KAAK,IAAI,IAAI,GAAG;AAAA,EACnD;AACA,MAAI,MAAM;AACR,aAAS;AACT,WAAO,KAAK,IAAI;AAAA,EAClB;AACA,MAAI,IAAI;AACN,aAAS;AACT,WAAO,KAAK,EAAE;AAAA,EAChB;AACA,aAAW,OAAO,MAAM;AACtB,aAAS;AACT,WAAO,KAAK,IAAI,GAAG,GAAG;AAAA,EACxB;AACA,WAAS;AACT,QAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,KAAK,EAAE,KAAK,GAAG,MAAM,EAAE,IAAI;AAC7D,SAAO,IAAI,SAAS,KAAK,UAAU,KAAK,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACvG;AA3Be;AA6Bf,eAAe,aAAaA,UAAkB,KAAU;AACtD,QAAM,MAAM,IAAI,IAAIA,SAAQ,GAAG;AAC/B,QAAM,SAAS,IAAI,aAAa,IAAI,QAAQ;AAC5C,QAAM,MAAM,IAAI,aAAa,IAAI,KAAK;AACtC,QAAM,SAAS,IAAI,aAAa,IAAI,QAAQ,KAAK;AACjD,QAAM,QAAQ,OAAO,IAAI,aAAa,IAAI,OAAO,KAAK,EAAE;AACxD,QAAM,SAAS,OAAO,IAAI,aAAa,IAAI,QAAQ,KAAK,CAAC;AAEzD,MAAI,QAAQ;AACZ,QAAM,SAAgB,CAAC,MAAM;AAE7B,MAAI,QAAQ;AACV,aAAS;AACT,WAAO,KAAK,MAAM;AAAA,EACpB;AACA,MAAI,KAAK;AACP,aAAS;AACT,WAAO,KAAK,IAAI,GAAG,GAAG;AAAA,EACxB;AACA,WAAS;AACT,SAAO,KAAK,OAAO,MAAM;AAEzB,QAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,KAAK,EAAE,KAAK,GAAG,MAAM,EAAE,IAAI;AAC7D,SAAO,IAAI,SAAS,KAAK,UAAU,KAAK,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACvG;AAxBe;AA0Bf,eAAe,WAAWA,UAAkB,KAAU;AACpD,QAAM,KAAKA,SAAQ,IAAI,MAAM,GAAG,EAAE,IAAI;AACtC,QAAM,OAAO,MAAM,IAAI,GAAG;AAAA,IACxB;AAAA,EACF,EAAE,KAAK,EAAE,EAAE,MAAM;AACjB,MAAI,CAAC,KAAM,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,YAAY,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AACtF,QAAM,QAAQ,MAAM,IAAI,GAAG;AAAA,IACzB;AAAA,EACF,EAAE,KAAK,EAAE,EAAE,IAAI;AACf,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,MAAM,OAAO,MAAM,QAAQ,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACzH;AAVe;AAYf,eAAe,YAAYA,UAAkB,KAAU;AACrD,QAAM,SAASA,SAAQ,IAAI,MAAM,GAAG,EAAE,CAAC;AACvC,QAAM,OAAO,MAAMA,SAAQ,KAAK;AAChC,QAAM,KAAK,WAAK;AAChB,QAAM,IAAI,GAAG;AAAA,IACX;AAAA;AAAA;AAAA,EAGF,EACG;AAAA,IACC;AAAA,IACA;AAAA,IACA,KAAK,aAAa;AAAA,IAClB,KAAK,aAAa;AAAA,IAClB,KAAK,SAAS;AAAA,IACd,KAAK,QAAQ;AAAA,IACb,KAAK,YAAY;AAAA,EACnB,EACC,IAAI;AACP,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,MAAM,GAAG,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAChH;AApBe;AAsBf,eAAe,oBAAoBA,UAAkB,KAAU;AAC7D,QAAM,MAAM,IAAI,IAAIA,SAAQ,GAAG;AAC/B,QAAM,OAAO,IAAI,aAAa,IAAI,MAAM;AACxC,QAAM,SAAS,IAAI,aAAa,IAAI,QAAQ,KAAK;AACjD,MAAI,QAAQ;AACZ,QAAM,SAAgB,CAAC,MAAM;AAC7B,MAAI,MAAM;AACR,aAAS;AACT,WAAO,KAAK,IAAI;AAAA,EAClB;AACA,WAAS;AACT,QAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,KAAK,EAAE,KAAK,GAAG,MAAM,EAAE,IAAI;AAC7D,SAAO,IAAI,SAAS,KAAK,UAAU,KAAK,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACvG;AAbe;AAgBf,eAAe,qBAAqBA,UAAkB,KAAU,MAAW;AACzE,cAAY,MAAM,CAAC,SAAS,OAAO,CAAC;AACpC,QAAM,EAAE,WAAW,MAAM,OAAO,eAAe,IAAI,MAAMA,SAAQ,KAAK;AACtE,QAAM,cAAc,MAAM,uBAAuB,GAAG;AACpD,QAAM,eAAe;AAAA,IACnB,cAAc;AAAA,IACd,WAAW;AAAA,MACT;AAAA,QACE;AAAA,QACA,MAAM;AAAA,QACN,eAAe;AAAA,QACf,YAAY;AAAA,MACd;AAAA,IACF;AAAA,IACA,YAAY;AAAA,MACV,SAAS;AAAA,QACP;AAAA,UACE;AAAA,UACA;AAAA,UACA,aAAa;AAAA,UACb,cAAc;AAAA,UACd,cAAc,UAAU,SAAS;AAAA,QACnC;AAAA,MACF;AAAA,IACF;AAAA,IACA,mBAAmB;AAAA,MACjB,KAAK,GAAG,IAAI,OAAO;AAAA,MACnB,gBAAgB;AAAA,MAChB,uBAAuB;AAAA,MACvB,kBAAkB;AAAA,MAClB,iBAAiB;AAAA,MACjB,2BAA2B;AAAA,IAC7B;AAAA,IACA,QAAQ;AAAA,EACV;AACA,QAAM,MAAM,MAAM;AAAA,IAChB,GAAG,IAAI,iBAAiB,kBAAkB,IAAI,mBAAmB;AAAA,IACjE;AAAA,MACE,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,eAAe,UAAU,WAAW;AAAA,QACpC,gBAAgB;AAAA,MAClB;AAAA,MACA,MAAM,KAAK,UAAU,YAAY;AAAA,IACnC;AAAA,EACF;AACA,MAAI,CAAC,IAAI,IAAI;AACX,UAAM,MAAM,MAAM,IAAI,KAAK;AAC3B,WAAO,IAAI,SAAS,KAAK,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC1C;AACA,QAAM,WAAW,MAAM,IAAI,KAAK;AAChC,QAAM,IAAI,GAAG;AAAA,IACX;AAAA;AAAA,EAEF,EAAE,KAAK,WAAW,SAAS,YAAY,MAAM,EAAE,IAAI;AACnD,SAAO,SAAS,KAAK;AAAA,IACnB,SAAS;AAAA,IACT,YAAY,SAAS;AAAA,EACvB,CAAC;AACH;AA3De;AA6Df,eAAe,yBAAyBA,UAAkB,KAAU,MAAW;AAC7E,cAAY,MAAM,CAAC,SAAS,SAAS,QAAQ,CAAC;AAC9C,QAAM,EAAE,YAAY,WAAW,MAAM,MAAM,IAAI,MAAMA,SAAQ,KAAK;AAClE,QAAM,cAAc,MAAM,uBAAuB,GAAG;AACpD,QAAM,OAAO;AAAA,IACX,WAAW,IAAI;AAAA,IACf,sBAAsB;AAAA,IACtB;AAAA,IACA,UAAU;AAAA,IACV,cAAc,UAAU,SAAS;AAAA,EACnC;AACA,QAAM,MAAM,MAAM;AAAA,IAChB,GAAG,IAAI,iBAAiB,kBAAkB,IAAI,mBAAmB,cAAc,UAAU;AAAA,IACzF;AAAA,MACE,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,eAAe,UAAU,WAAW;AAAA,QACpC,gBAAgB;AAAA,MAClB;AAAA,MACA,MAAM,KAAK,UAAU,IAAI;AAAA,IAC3B;AAAA,EACF;AACA,MAAI,CAAC,IAAI,IAAI;AACX,UAAM,MAAM,MAAM,IAAI,KAAK;AAC3B,WAAO,IAAI,SAAS,KAAK,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC1C;AACA,QAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,SAAO,SAAS,KAAK,EAAE,KAAK,KAAK,IAAI,CAAC;AACxC;AA5Be;AA8Bf,eAAe,sBAAsB,KAAc,KAAU;AAC3D,QAAM,SAAS,IAAI,QAAQ,IAAI,aAAa;AAC5C,MAAI,WAAW,IAAI;AACjB,WAAO,IAAI,SAAS,gBAAgB,EAAE,QAAQ,IAAI,CAAC;AAErD,MAAI;AACJ,MAAI;AACF,WAAO,MAAM,IAAI,KAAK;AAAA,EACxB,QAAQ;AACN,WAAO,IAAI,SAAS,gBAAgB,EAAE,QAAQ,IAAI,CAAC;AAAA,EACrD;AAEA,MAAI,CAAC,+BAA+B,IAAI;AACtC,WAAO,IAAI,SAAS,kBAAkB,EAAE,QAAQ,IAAI,CAAC;AAEvD,QAAM,EAAE,YAAY,OAAO,IAAI;AAE/B,QAAM,IAAI,GAAG;AAAA,IACX;AAAA,EACF,EAAE,KAAK,QAAQ,UAAU,EAAE,IAAI;AAE/B,SAAO,IAAI,SAAS,MAAM,EAAE,QAAQ,IAAI,CAAC;AAC3C;AAtBe;AAwBf,eAAe,iBAAiBA,UAAkB,KAAU,MAAW;AACrE,QAAM,MAAM,IAAI,IAAIA,SAAQ,GAAG;AAC/B,QAAM,QAAQ,IAAI,aAAa,IAAI,OAAO;AAC1C,MAAI,UAAU,UAAU;AACtB,gBAAY,MAAM,CAAC,QAAQ,CAAC;AAC5B,UAAMC,QAAO,MAAM,IAAI,GAAG;AAAA,MACxB;AAAA,IACF,EAAE,KAAK,KAAK,EAAE,EAAE,IAAI;AACpB,WAAO,SAAS,KAAKA,MAAK,OAAO;AAAA,EACnC;AACA,cAAY,MAAM,CAAC,SAAS,OAAO,CAAC;AACpC,QAAM,OAAO,MAAM,IAAI,GAAG;AAAA,IACxB;AAAA,EACF,EAAE,IAAI;AACN,SAAO,SAAS,KAAK,KAAK,OAAO;AACnC;AAfe;AAkBf,eAAe,oBAAoB,KAAc,KAAU;AACzD,QAAM,EAAE,MAAM,OAAO,UAAU,KAAK,IAAI,MAAM,IAAI,KAAK;AACvD,MAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,YAAY,CAAC,KAAM,QAAO,IAAI,SAAS,kBAAkB,EAAE,QAAQ,IAAI,CAAC;AAChG,QAAM,gBAAgB,MAAM,iBAAO,KAAK,UAAU,EAAE;AACpD,MAAI;AACF,UAAM,IAAI,GAAG;AAAA,MACX;AAAA,IACF,EAAE,KAAK,MAAM,OAAO,eAAe,IAAI,EAAE,IAAI;AAC7C,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,IAAI,KAAK,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,EACvG,SAAS,GAAG;AACV,WAAO,IAAI,SAAS,wBAAwB,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC7D;AACF;AAZe;AAcf,eAAe,qBAAqB,KAAc,KAAU;AAC1D,QAAM,EAAE,MAAM,OAAO,UAAU,MAAM,IAAI,MAAM,IAAI,KAAK;AACxD,MAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAU,QAAO,IAAI,SAAS,kBAAkB,EAAE,QAAQ,IAAI,CAAC;AACvF,QAAM,gBAAgB,MAAM,iBAAO,KAAK,UAAU,EAAE;AACpD,MAAI;AACF,UAAM,IAAI,GAAG;AAAA,MACX;AAAA,IACF,EAAE,KAAK,MAAM,OAAO,SAAS,MAAM,aAAa,EAAE,IAAI;AACtD,WAAO,IAAI,SAAS,KAAK,UAAU,EAAE,IAAI,KAAK,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,EACvG,SAAS,GAAG;AACV,WAAO,IAAI,SAAS,wBAAwB,EAAE,QAAQ,IAAI,CAAC;AAAA,EAC7D;AACF;AAZe;AAcf,eAAe,iBAAiB,KAAc,KAAU;AACtD,QAAM,EAAE,OAAO,SAAS,IAAI,MAAM,IAAI,KAAK;AAC3C,QAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,qCAAqC,EAAE,KAAK,KAAK,EAAE,MAAM;AAC3F,MAAI,CAAC,KAAM,QAAO,IAAI,SAAS,uBAAuB,EAAE,QAAQ,IAAI,CAAC;AACrE,QAAM,QAAQ,MAAM,iBAAO,QAAQ,UAAU,KAAK,aAAa;AAC/D,MAAI,CAAC,MAAO,QAAO,IAAI,SAAS,uBAAuB,EAAE,QAAQ,IAAI,CAAC;AACtE,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAC7G;AAPe;AASf,eAAe,kBAAkB,KAAc,KAAU;AACvD,QAAM,EAAE,OAAO,SAAS,IAAI,MAAM,IAAI,KAAK;AAC3C,QAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,uCAAuC,EAAE,KAAK,KAAK,EAAE,MAAM;AAC7F,MAAI,CAAC,KAAM,QAAO,IAAI,SAAS,uBAAuB,EAAE,QAAQ,IAAI,CAAC;AACrE,QAAM,QAAQ,MAAM,iBAAO,QAAQ,UAAU,KAAK,aAAa;AAC/D,MAAI,CAAC,MAAO,QAAO,IAAI,SAAS,uBAAuB,EAAE,QAAQ,IAAI,CAAC;AACtE,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAC7G;AAPe;AAUf,eAAe,oBAAoBD,UAAkB,KAAU;AAC7D,QAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,yDAAyD,EAAE,IAAI;AACjG,SAAO,IAAI,SAAS,KAAK,UAAU,KAAK,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AACvG;AAHe;AAKf,eAAe,qBAAqBA,UAAkB,KAAU;AAC9D,QAAM,OAAO,MAAMA,SAAQ,KAAK;AAChC,QAAM,KAAK,WAAK;AAChB,QAAM,IAAI,GAAG;AAAA,IACX;AAAA;AAAA,EAEF,EAAE,KAAK,IAAI,KAAK,WAAW,KAAK,OAAO,KAAK,QAAQ,MAAM,KAAK,SAAS,IAAI,EAAE,IAAI;AAClF,SAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,MAAM,GAAG,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAChH;AARe;AAWf,IAAOE,iBAAQ;AAAA,EACb,MAAM,MAAM,KAAc,KAAU,KAA6B;AAC/D,QAAI,CAAC,QAAQ;AACX,YAAM,gBAAgB,GAAG;AACzB,eAAS;AAAA,IACX;AACA,UAAM,MAAM,IAAI,IAAI,IAAI,GAAG;AAG3B,QAAI,IAAI,SAAS,WAAW,cAAc,GAAG;AAC3C,YAAM,UAAU,IAAI,SAAS,QAAQ,mBAAmB,EAAE;AAC1D,YAAM,aAAa,IAAI,QAAQ,WAAW,KAAK,GAAG;AAClD,aAAO,eAAe,YAAY,UAAU,EAAE,OAAO,CAAC,EAAE,CAAC;AACzD,YAAM,OAAO,MAAM,gBAAc,OAAO,YAAY,GAAG;AACvD,aAAO,KAAK,IAAI;AAAA,IAClB;AAGA,QAAI,IAAI,SAAS,WAAW,UAAU,GAAG;AACvC,YAAM,UAAU,IAAI,SAAS,QAAQ,eAAe,EAAE;AACtD,YAAM,SAAS,IAAI,QAAQ,WAAW,KAAK,GAAG;AAC9C,aAAO,eAAe,QAAQ,UAAU,EAAE,OAAO,CAAC,EAAE,CAAC;AACrD,YAAM,OAAO,MAAM,YAAU,OAAO,QAAQ,GAAG;AAC/C,aAAO,KAAK,IAAI;AAAA,IAClB;AAGA,QAAI,IAAI,SAAS,WAAW,UAAU,GAAG;AACvC,YAAM,UAAU,IAAI,SAAS,QAAQ,eAAe,EAAE;AACtD,YAAM,SAAS,IAAI,QAAQ,WAAW,KAAK,GAAG;AAC9C,aAAO,eAAe,QAAQ,UAAU,EAAE,OAAO,CAAC,EAAE,CAAC;AACrD,YAAM,OAAO,MAAM,YAAU,OAAO,QAAQ,GAAG;AAC/C,aAAO,KAAK,IAAI;AAAA,IAClB;AAGA,QAAI,IAAI,SAAS,WAAW,mBAAmB,GAAG;AAChD,YAAM,UAAU,IAAI,SAAS,QAAQ,kBAAkB,EAAE;AACzD,YAAM,gBAAgB,IAAI,QAAQ,WAAW,KAAK,GAAG;AACrD,aAAO,eAAe,eAAe,UAAU,EAAE,OAAO,CAAC,EAAE,CAAC;AAC5D,YAAM,OAAO,MAAM,mBAAiB,OAAO,eAAe,GAAG;AAC7D,aAAO,KAAK,IAAI;AAAA,IAClB;AAGA,QAAI,IAAI,SAAS,WAAW,cAAc,GAAG;AAC3C,YAAM,UAAU,IAAI,SAAS,QAAQ,mBAAmB,EAAE;AAC1D,YAAM,aAAa,IAAI,QAAQ,WAAW,KAAK,GAAG;AAClD,aAAO,eAAe,YAAY,UAAU,EAAE,OAAO,CAAC,EAAE,CAAC;AACzD,YAAM,OAAO,MAAM,gBAAc,OAAO,YAAY,GAAG;AACvD,aAAO,KAAK,IAAI;AAAA,IAClB;AAGA,QAAI,IAAI,SAAS,WAAW,UAAU,GAAG;AACvC,YAAM,UAAU,IAAI,SAAS,QAAQ,eAAe,EAAE;AACtD,YAAM,SAAS,IAAI,QAAQ,WAAW,KAAK,GAAG;AAC9C,aAAO,eAAe,QAAQ,UAAU,EAAE,OAAO,CAAC,EAAE,CAAC;AACrD,YAAM,OAAO,MAAM,YAAU,OAAO,QAAQ,GAAG;AAC/C,aAAO,KAAK,IAAI;AAAA,IAClB;AAGA,QAAI,IAAI,SAAS,WAAW,UAAU,GAAG;AACvC,YAAM,UAAU,IAAI,SAAS,QAAQ,eAAe,EAAE;AACtD,YAAM,SAAS,IAAI,QAAQ,WAAW,KAAK,GAAG;AAC9C,aAAO,eAAe,QAAQ,UAAU,EAAE,OAAO,CAAC,EAAE,CAAC;AACrD,YAAM,OAAO,MAAM,YAAU,OAAO,QAAQ,GAAG;AAC/C,aAAO,KAAK,IAAI;AAAA,IAClB;AAGA,QAAI,OAAO,IAAI,SAAS,IAAI,MAAM,SAAS,aAAa;AACtD,YAAM,cAAc,IAAI;AACxB,YAAM,aAAa,IAAI;AACvB,UAAI,eAAe,YAAY;AAC7B,cAAM,OAAO,EAAE,MAAM,SAAS,IAAI,EAAE;AACpC,cAAM,oBAAoB;AAAA,UACxB,MAAM,oCAAa,EAAE,SAAS,YAAY,UAAU,YAAY,IAA1D;AAAA,QACR,GAAG,KAAK,IAAI;AAAA,MACd;AACA,aAAO,IAAI,SAAS,kCAAkC,EAAE,QAAQ,IAAI,CAAC;AAAA,IACvE;AAGA,QAAI,IAAI,aAAa,WAAW;AAC9B,aAAO,KAAK,YAAY,CAAC;AAAA,IAC3B;AAGA,QAAI,IAAI,aAAa,0BAA0B,IAAI,WAAW,OAAO;AACnE,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,UAAI,KAAK,SAAS,QAAS,QAAO,KAAK,UAAU,CAAC;AAClD,aAAO,MAAM,eAAe,KAAK,GAAG;AAAA,IACtC;AACA,QAAI,IAAI,aAAa,gCAAgC,IAAI,WAAW,OAAO;AACzE,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,UAAI,KAAK,SAAS,QAAS,QAAO,KAAK,UAAU,CAAC;AAClD,aAAO,MAAM,qBAAqB,KAAK,GAAG;AAAA,IAC5C;AAGA,QAAI,IAAI,aAAa,2BAA2B;AAC9C,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,UAAU;AAAA,QAC7C,GAAG,qBAAqB,SAAS;AAAA,QACjC,sBAAsB,qBAAqB,SAAS;AAAA,QACpD;AAAA,MACF,EAAE,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IAC3D;AACA,QAAI,IAAI,aAAa,iBAAiB;AACpC,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,QAAQ;AAAA,QAC3C;AAAA,QACA;AAAA,QACA;AAAA,MACF,EAAE,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IAC3D;AACA,QAAI,IAAI,aAAa,wBAAwB;AAC3C,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO;AAAA,QAC1C,mCAAmC,qBAAqB,SAAS;AAAA,QACjE;AAAA,QACA,GAAG,qBAAqB,SAAS;AAAA,MACnC,EAAE,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IAC3D;AACA,QAAI,IAAI,aAAa,0BAA0B;AAC7C,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,UAAU;AAAA,QAC7C;AAAA,QACA;AAAA,QACA;AAAA,MACF,EAAE,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IAC3D;AAGA,QAAI,IAAI,aAAa,qBAAqB,IAAI,WAAW,QAAQ;AAC/D,aAAO,MAAM,UAAU,KAAK,GAAG;AAAA,IACjC;AACA,QAAI,IAAI,aAAa,yBAAyB,IAAI,WAAW,QAAQ;AACnE,aAAO,MAAM,cAAc,KAAK,GAAG;AAAA,IACrC;AACA,QAAI,IAAI,aAAa,0BAA0B,IAAI,WAAW,QAAQ;AACpE,aAAO,MAAM,eAAe,KAAK,GAAG;AAAA,IACtC;AAGA,QAAI,IAAI,aAAa,uBAAuB,IAAI,WAAW,QAAQ;AACjE,aAAO,KAAK,MAAM,kBAAkB,KAAK,GAAG,CAAC;AAAA,IAC/C;AACA,QAAI,IAAI,aAAa,0BAA0B,IAAI,WAAW,QAAQ;AACpE,aAAO,KAAK,MAAM,qBAAqB,KAAK,GAAG,CAAC;AAAA,IAClD;AACA,QAAI,IAAI,aAAa,4BAA4B,IAAI,WAAW,QAAQ;AACtE,aAAO,KAAK,MAAM,uBAAuB,KAAK,GAAG,CAAC;AAAA,IACpD;AAGA,QAAI,IAAI,aAAa,8BAA8B,IAAI,WAAW,QAAQ;AACxE,aAAO,KAAK,MAAM,wBAAwB,KAAK,GAAG,CAAC;AAAA,IACrD;AACA,QAAI,IAAI,aAAa,4BAA4B,IAAI,WAAW,QAAQ;AACtE,aAAO,KAAK,MAAM,sBAAsB,KAAK,GAAG,CAAC;AAAA,IACnD;AACA,QAAI,IAAI,aAAa,8BAA8B,IAAI,WAAW,OAAO;AACvE,aAAO,KAAK,IAAI,SAAS,KAAK,UAAU,qBAAqB,CAAC,GAAG;AAAA,QAC/D,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAChD,CAAC,CAAC;AAAA,IACJ;AAGA,QAAI,IAAI,aAAa,yBAAyB,IAAI,WAAW,OAAO;AAClE,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,aAAO,MAAM,oBAAoB,KAAK,KAAK,IAAI;AAAA,IACjD;AAGA,QAAI,IAAI,aAAa,aAAa,IAAI,WAAW,OAAO;AACtD,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,aAAO,MAAM,SAAS,KAAK,KAAK,IAAI;AAAA,IACtC;AAGA,QAAI,IAAI,aAAa,wBAAwB,IAAI,WAAW,OAAO;AACjE,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,UAAI,KAAK,SAAS,WAAW,KAAK,SAAS,QAAS,QAAO,KAAK,UAAU,CAAC;AAC3E,aAAO,MAAM,mBAAmB,KAAK,GAAG;AAAA,IAC1C;AAGA,QAAI,IAAI,SAAS,WAAW,oBAAoB,KAAK,IAAI,WAAW,OAAO;AACzE,aAAO,MAAM,sBAAsB,KAAK,GAAG;AAAA,IAC7C;AACA,QAAI,IAAI,SAAS,WAAW,oBAAoB,KAAK,IAAI,WAAW,SAAS;AAC3E,aAAO,MAAM,yBAAyB,KAAK,GAAG;AAAA,IAChD;AAGA,QAAI,IAAI,SAAS,WAAW,cAAc,GAAG;AAC3C,aAAO,MAAM,cAAc,MAAM,KAAK,KAAK,GAAG;AAAA,IAChD;AAGA,QAAI,IAAI,aAAa,6BAA6B,IAAI,WAAW,OAAO;AACtE,aAAO,IAAI,SAAS,KAAK,UAAU,gBAAgB,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IAC3G;AACA,QAAI,IAAI,aAAa,8BAA8B,IAAI,WAAW,OAAO;AACvE,aAAO,IAAI,SAAS,KAAK,UAAU,sBAAsB,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IACjH;AACA,QAAI,IAAI,aAAa,gCAAgC,IAAI,WAAW,OAAO;AACzE,aAAO,IAAI,SAAS,KAAK,UAAU,yBAAyB,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IACpH;AAGA,QAAI,IAAI,SAAS,WAAW,sBAAsB,KAAK,IAAI,WAAW,SAAS;AAC7E,YAAM,KAAK,IAAI,SAAS,MAAM,GAAG,EAAE,IAAI;AACvC,YAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,YAAM,IAAI,GAAG;AAAA,QACX;AAAA,MACF,EAAE;AAAA,QACA,KAAK,mBAAmB;AAAA,QACxB,KAAK,kBAAkB;AAAA,QACvB,KAAK,kBAAkB,KAAK,UAAU,KAAK,eAAe,IAAI;AAAA,SAC9D,oBAAI,KAAK,GAAE,YAAY;AAAA,QACvB;AAAA,MACF,EAAE,IAAI;AACN,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,SAAS,KAAK,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IAC5G;AAGA,QAAI,IAAI,aAAa,yBAAyB,IAAI,WAAW,QAAQ;AACnE,YAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,YAAM,KAAK,WAAK;AAChB,YAAM,OAAM,oBAAI,KAAK,GAAE,YAAY;AACnC,YAAM,eAAe;AAAA,QACnB;AAAA,QACA,WAAW,KAAK;AAAA,QAChB,WAAW,KAAK;AAAA,QAChB,aAAa,KAAK,eAAe;AAAA,QACjC,QAAQ,KAAK;AAAA,QACb,QAAQ;AAAA,QACR,YAAY;AAAA,QACZ,YAAY;AAAA,MACd;AACA,YAAM,IAAI,GAAG;AAAA,QACX;AAAA;AAAA,MAEF,EAAE;AAAA,QACA;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK,eAAe;AAAA,QACpB,KAAK;AAAA,QACL;AAAA,QACA;AAAA,QACA;AAAA,MACF,EAAE,IAAI;AAGN,YAAM,SAAS,MAAM;AAAA,QACnB;AAAA,QACA;AAAA,QACA,KAAK;AAAA;AAAA,QACL,KAAK,cAAc;AAAA,QACnB,KAAK,WAAW;AAAA,MAClB;AAGA,YAAM,IAAI,GAAG;AAAA,QACX;AAAA;AAAA;AAAA,MAGF,EAAE;AAAA,QACA,OAAO,aAAa;AAAA,QACpB,OAAO,aAAa,qBAAqB;AAAA,QACzC,OAAO,aAAa,YAAY;AAAA,QAChC,OAAO,aAAa,eAAe;AAAA,QACnC,OAAO,aAAa,QAAQ;AAAA,QAC5B,OAAO,aAAa,QAAQ;AAAA,QAC5B,OAAO,aAAa,eAAe;AAAA,QACnC,OAAO,aAAa;AAAA,QACpB;AAAA,MACF,EAAE,IAAI;AAEN,aAAO,IAAI,SAAS,KAAK,UAAU,MAAM,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IACjG;AAGA,QAAI,IAAI,SAAS,WAAW,oBAAoB,KAAK,IAAI,WAAW,OAAO;AACzE,YAAM,KAAK,IAAI,SAAS,MAAM,GAAG,EAAE,IAAI;AACvC,YAAM,MAAM,MAAM,IAAI,GAAG,QAAQ,gDAAgD,EAAE,KAAK,EAAE,EAAE,MAAM;AAClG,UAAI,CAAC,IAAK,QAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,YAAY,CAAC,GAAG,EAAE,QAAQ,IAAI,CAAC;AAGrF,UAAI,IAAI,WAAW,aAAa,IAAI,mBAAmB;AACrD,YAAI;AACF,gBAAM,eAAe,MAAM,sBAAsB,KAAK,IAAI,iBAAiB;AAC3E,cAAI,aAAa,gBAAgB;AAE/B,kBAAM,IAAI,GAAG;AAAA,cACX;AAAA,YACF,EAAE;AAAA,cACA,aAAa,eAAe,OAAO,YAAY;AAAA,cAC/C,aAAa,eAAe,WAAW,aAAa,UAAU;AAAA,cAC9D,aAAa,eAAe,WAAW,aAAa,oBAAqB,aAAa,eAAe,SAAS,CAAC,GAAG,gBAAgB;AAAA,cAClI,aAAa,eAAe,OAAO;AAAA,eACnC,oBAAI,KAAK,GAAE,YAAY;AAAA,cACvB;AAAA,YACF,EAAE,IAAI;AAGN,kBAAM,aAAa,MAAM,IAAI,GAAG,QAAQ,gDAAgD,EAAE,KAAK,EAAE,EAAE,MAAM;AACzG,mBAAO,IAAI,SAAS,KAAK,UAAU,UAAU,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,UACrG;AAAA,QACF,SAAS,KAAK;AACZ,kBAAQ,MAAM,qCAAqC,GAAG;AAAA,QACxD;AAAA,MACF;AAEA,aAAO,IAAI,SAAS,KAAK,UAAU,GAAG,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IAC9F;AAGA,QAAI,IAAI,aAAa,uBAAuB,IAAI,WAAW,OAAO;AAChE,YAAM,SAAS,mBAAmB;AAClC,aAAO,IAAI,SAAS,KAAK,UAAU,MAAM,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IACjG;AAGA,QAAI,IAAI,aAAa,wCAAwC,IAAI,WAAW,QAAQ;AAClF,YAAM,OAAO,MAAM,0BAA0B,GAAG;AAChD,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,SAAS;AAAA,QACT,WAAW,KAAK;AAAA,QAChB,iBAAiB;AAAA,MACnB,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IACzD;AAGA,QAAI,IAAI,SAAS,WAAW,mBAAmB,KAAK,IAAI,WAAW,SAAS;AAC1E,aAAO,MAAM,cAAc,KAAK,GAAG;AAAA,IACrC;AACA,QAAI,IAAI,SAAS,WAAW,mBAAmB,KAAK,IAAI,WAAW,UAAU;AAC3E,aAAO,MAAM,cAAc,KAAK,GAAG;AAAA,IACrC;AACA,QAAI,IAAI,SAAS,WAAW,mBAAmB,KAAK,IAAI,SAAS,SAAS,QAAQ,KAAK,IAAI,WAAW,UAAU;AAC9G,aAAO,MAAM,kBAAkB,KAAK,GAAG;AAAA,IACzC;AACA,QAAI,IAAI,aAAa,6BAA6B,IAAI,WAAW,OAAO;AACtE,aAAO,MAAM,eAAe,KAAK,GAAG;AAAA,IACtC;AAGA,QAAI,IAAI,aAAa,sBAAsB,IAAI,WAAW,OAAO;AAC/D,aAAO,MAAM,aAAa,KAAK,GAAG;AAAA,IACpC;AACA,QAAI,IAAI,SAAS,WAAW,mBAAmB,KAAK,IAAI,WAAW,OAAO;AACxE,aAAO,MAAM,WAAW,KAAK,GAAG;AAAA,IAClC;AACA,QAAI,IAAI,SAAS,WAAW,mBAAmB,KAAK,IAAI,SAAS,SAAS,OAAO,KAAK,IAAI,WAAW,QAAQ;AAC3G,aAAO,MAAM,YAAY,KAAK,GAAG;AAAA,IACnC;AACA,QAAI,IAAI,SAAS,WAAW,iBAAiB,KAAK,IAAI,SAAS,SAAS,YAAY,KAAK,IAAI,WAAW,OAAO;AAC7G,YAAM,WAAW,IAAI,SAAS,MAAM,GAAG,EAAE,CAAC;AAC1C,YAAM,MAAM;AACZ,YAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,GAAG,EAAE,KAAK,QAAQ,EAAE,IAAI;AAC1D,YAAM,QAAQ,KAAK,QAAQ,IAAI,CAAC,UAAe,EAAE,GAAG,MAAM,MAAM,KAAK,YAAY,KAAK,MAAM,KAAK,SAAS,IAAI,CAAC,EAAE,EAAE;AACnH,aAAO,IAAI,SAAS,KAAK,UAAU,KAAK,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IAChG;AACA,QAAI,IAAI,SAAS,WAAW,iBAAiB,KAAK,IAAI,SAAS,SAAS,YAAY,KAAK,IAAI,WAAW,OAAO;AAC7G,YAAM,WAAW,IAAI,SAAS,MAAM,GAAG,EAAE,CAAC;AAC1C,YAAM,MAAM;AACZ,YAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,GAAG,EAAE,KAAK,QAAQ,EAAE,IAAI;AAC1D,YAAM,QAAQ,KAAK,QAAQ,IAAI,CAAC,UAAe,EAAE,GAAG,MAAM,MAAM,KAAK,YAAY,KAAK,MAAM,KAAK,SAAS,IAAI,CAAC,EAAE,EAAE;AACnH,aAAO,IAAI,SAAS,KAAK,UAAU,KAAK,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IAChG;AACA,QAAI,IAAI,aAAa,uBAAuB,IAAI,WAAW,OAAO;AAChE,aAAO,MAAM,oBAAoB,KAAK,GAAG;AAAA,IAC3C;AAGA,QAAI,IAAI,aAAa,qBAAqB;AACxC,UAAI;AACF,cAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,qFAAqF,EAAE,IAAI;AAC7H,cAAM,QAAQ,KAAK,QAAQ,IAAI,CAAC,UAAe;AAAA,UAC7C,GAAG;AAAA,UACH,MAAM,KAAK,YAAY,KAAK,MAAM,KAAK,SAAS,IAAI,CAAC;AAAA,QACvD,EAAE;AACF,eAAO,IAAI,SAAS,KAAK,UAAU,KAAK,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,MAChG,SAAS,GAAG;AACV,eAAO,IAAI,SAAS,qCAAqC,EAAE,QAAQ,IAAI,CAAC;AAAA,MAC1E;AAAA,IACF;AAEA,QAAI,IAAI,aAAa,0BAA0B;AAC7C,UAAI;AACF,cAAM,OAAO,MAAM,IAAI,GAAG,QAAQ,6FAA6F,EAAE,IAAI;AACrI,eAAO,IAAI,SAAS,KAAK,UAAU,KAAK,OAAO,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,MACvG,SAAS,GAAG;AACV,eAAO,IAAI,SAAS,6CAA6C,EAAE,QAAQ,IAAI,CAAC;AAAA,MAClF;AAAA,IACF;AAEA,QAAI,IAAI,aAAa,wBAAwB;AAC3C,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,QAAQ;AAAA,QACR,QAAQ;AAAA,QACR,OAAO;AAAA,QACP,SAAS;AAAA,QACT,WAAW;AAAA,QACX,cAAc;AAAA,QACd,KAAK;AAAA,QACL,MAAM,CAAC,QAAQ,YAAY;AAAA,MAC7B,CAAC,GAAG,EAAE,SAAS,EAAE,gBAAgB,mBAAmB,EAAE,CAAC;AAAA,IACzD;AAEA,QAAI,IAAI,aAAa,mBAAmB;AACtC,UAAI;AACF,cAAM,SAAS,MAAM,eAAe;AACpC,eAAO,IAAI,SAAS,QAAQ,EAAE,SAAS,EAAE,gBAAgB,kBAAkB,EAAE,CAAC;AAAA,MAChF,SAAS,GAAG;AACV,eAAO,IAAI,SAAS,8BAA8B,EAAE,QAAQ,IAAI,CAAC;AAAA,MACnE;AAAA,IACF;AAEA,QAAI,IAAI,aAAa,kBAAkB;AACrC,UAAI;AACF,cAAM,QAAQ,MAAM,cAAc;AAClC,eAAO,IAAI,SAAS,OAAO,EAAE,SAAS,EAAE,gBAAgB,kBAAkB,EAAE,CAAC;AAAA,MAC/E,SAAS,GAAG;AACV,eAAO,IAAI,SAAS,6BAA6B,EAAE,QAAQ,IAAI,CAAC;AAAA,MAClE;AAAA,IACF;AAGA,QAAI,IAAI,aAAa,uBAAuB;AAC1C,aAAO,MAAM,oBAAoB,GAAG;AAAA,IACtC;AACA,QAAI,IAAI,aAAa,0BAA0B;AAC7C,aAAO,MAAM,uBAAuB,GAAG;AAAA,IACzC;AACA,QAAI,IAAI,aAAa,4BAA4B;AAC/C,aAAO,MAAM,yBAAyB,GAAG;AAAA,IAC3C;AACA,QAAI,IAAI,aAAa,yBAAyB,IAAI,WAAW,QAAQ;AACnE,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,UAAI,KAAK,SAAS,WAAW,KAAK,SAAS,QAAS,QAAO,KAAK,UAAU,CAAC;AAC3E,aAAO,MAAM,oBAAoB,KAAK,KAAK,IAAI;AAAA,IACjD;AACA,QAAI,IAAI,aAAa,uBAAuB,IAAI,WAAW,QAAQ;AACjE,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,UAAI,KAAK,SAAS,WAAW,KAAK,SAAS,QAAS,QAAO,KAAK,UAAU,CAAC;AAC3E,aAAO,MAAM,kBAAkB,KAAK,KAAK,IAAI;AAAA,IAC/C;AAGA,QAAI,IAAI,aAAa,mCAAmC,IAAI,WAAW,QAAQ;AAC7E,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,UAAI,KAAK,SAAS,WAAW,KAAK,SAAS,QAAS,QAAO,KAAK,UAAU,CAAC;AAC3E,aAAO,MAAM,qBAAqB,KAAK,KAAK,IAAI;AAAA,IAClD;AACA,QAAI,IAAI,aAAa,gCAAgC,IAAI,WAAW,QAAQ;AAC1E,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,UAAI,KAAK,SAAS,WAAW,KAAK,SAAS,QAAS,QAAO,KAAK,UAAU,CAAC;AAC3E,aAAO,MAAM,yBAAyB,KAAK,KAAK,IAAI;AAAA,IACtD;AACA,QAAI,IAAI,aAAa,2BAA2B,IAAI,WAAW,QAAQ;AACrE,aAAO,MAAM,sBAAsB,KAAK,GAAG;AAAA,IAC7C;AACA,QAAI,IAAI,SAAS,WAAW,iBAAiB,GAAG;AAC9C,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,aAAO,MAAM,iBAAiB,KAAK,KAAK,IAAI;AAAA,IAC9C;AAGA,QAAI,IAAI,aAAa,qBAAqB,IAAI,WAAW,QAAQ;AAC/D,aAAO,KAAK,MAAM,oBAAoB,KAAK,GAAG,CAAC;AAAA,IACjD;AACA,QAAI,IAAI,aAAa,sBAAsB,IAAI,WAAW,QAAQ;AAChE,aAAO,KAAK,MAAM,qBAAqB,KAAK,GAAG,CAAC;AAAA,IAClD;AACA,QAAI,IAAI,aAAa,kBAAkB,IAAI,WAAW,QAAQ;AAC5D,aAAO,KAAK,MAAM,iBAAiB,KAAK,GAAG,CAAC;AAAA,IAC9C;AACA,QAAI,IAAI,aAAa,mBAAmB,IAAI,WAAW,QAAQ;AAC7D,aAAO,KAAK,MAAM,kBAAkB,KAAK,GAAG,CAAC;AAAA,IAC/C;AAGA,QAAI,IAAI,aAAa,2BAA2B,IAAI,WAAW,OAAO;AACpE,aAAO,MAAM,oBAAoB,KAAK,GAAG;AAAA,IAC3C;AACA,QAAI,IAAI,aAAa,0BAA0B,IAAI,WAAW,QAAQ;AACpE,aAAO,MAAM,qBAAqB,KAAK,GAAG;AAAA,IAC5C;AAGA,QAAI,IAAI,aAAa,sBAAsB,IAAI,WAAW,OAAO;AAC/D,aAAO,KAAK,MAAM,iBAAiB,KAAK,GAAG,CAAC;AAAA,IAC9C;AACA,QAAI,IAAI,aAAa,sBAAsB,IAAI,WAAW,QAAQ;AAChE,aAAO,KAAK,MAAM,sBAAsB,KAAK,GAAG,CAAC;AAAA,IACnD;AACA,QAAI,IAAI,SAAS,WAAW,mBAAmB,KAAK,IAAI,WAAW,OAAO;AACxE,YAAM,KAAK,IAAI,SAAS,MAAM,GAAG,EAAE,IAAI;AACvC,aAAO,KAAK,MAAM,oBAAoB,KAAK,KAAK,EAAE,CAAC;AAAA,IACrD;AACA,QAAI,IAAI,SAAS,WAAW,mBAAmB,KAAK,IAAI,WAAW,UAAU;AAC3E,YAAM,KAAK,IAAI,SAAS,MAAM,GAAG,EAAE,IAAI;AACvC,aAAO,KAAK,MAAM,sBAAsB,KAAK,KAAK,EAAE,CAAC;AAAA,IACvD;AAGA,QAAI,IAAI,aAAa,6BAA6B,IAAI,WAAW,OAAO;AACtE,aAAO,KAAK,MAAM,uBAAuB,KAAK,GAAG,CAAC;AAAA,IACpD;AACA,QAAI,IAAI,aAAa,uBAAuB,IAAI,WAAW,OAAO;AAChE,aAAO,KAAK,MAAM,uBAAuB,KAAK,GAAG,CAAC;AAAA,IACpD;AACA,QAAI,IAAI,aAAa,6BAA6B,IAAI,WAAW,QAAQ;AACvE,aAAO,KAAK,MAAM,uBAAuB,KAAK,GAAG,CAAC;AAAA,IACpD;AACA,QAAI,IAAI,SAAS,MAAM,yCAAyC,KAAK,IAAI,WAAW,OAAO;AACzF,YAAM,KAAK,IAAI,SAAS,MAAM,GAAG,EAAE,CAAC;AACpC,aAAO,KAAK,MAAM,0BAA0B,KAAK,KAAK,EAAE,CAAC;AAAA,IAC3D;AACA,QAAI,IAAI,SAAS,MAAM,uCAAuC,KAAK,IAAI,WAAW,QAAQ;AACxF,YAAM,KAAK,IAAI,SAAS,MAAM,GAAG,EAAE,CAAC;AACpC,aAAO,KAAK,MAAM,wBAAwB,KAAK,KAAK,EAAE,CAAC;AAAA,IACzD;AACA,QAAI,IAAI,SAAS,MAAM,+BAA+B,KAAK,IAAI,WAAW,OAAO;AAC/E,YAAM,KAAK,IAAI,SAAS,MAAM,GAAG,EAAE,IAAI;AACvC,aAAO,KAAK,MAAM,qBAAqB,KAAK,KAAK,EAAE,CAAC;AAAA,IACtD;AAGA,QAAI,IAAI,aAAa,eAAe,IAAI,WAAW,OAAO;AACxD,aAAO,KAAK,MAAM,eAAe,KAAK,GAAG,CAAC;AAAA,IAC5C;AACA,QAAI,IAAI,aAAa,uBAAuB,IAAI,WAAW,OAAO;AAChE,aAAO,KAAK,MAAM,kBAAkB,KAAK,GAAG,CAAC;AAAA,IAC/C;AACA,QAAI,IAAI,SAAS,MAAM,uBAAuB,KAAK,IAAI,WAAW,OAAO;AACvE,YAAM,KAAK,IAAI,SAAS,MAAM,GAAG,EAAE,IAAI;AACvC,aAAO,KAAK,MAAM,oBAAoB,KAAK,KAAK,EAAE,CAAC;AAAA,IACrD;AAGA,QAAI,IAAI,aAAa,2BAA2B,IAAI,WAAW,OAAO;AACpE,aAAO,KAAK,MAAM,sBAAsB,KAAK,GAAG,CAAC;AAAA,IACnD;AACA,QAAI,IAAI,aAAa,kCAAkC,IAAI,WAAW,OAAO;AAC3E,aAAO,KAAK,MAAM,6BAA6B,KAAK,GAAG,CAAC;AAAA,IAC1D;AACA,QAAI,IAAI,aAAa,+BAA+B,IAAI,WAAW,QAAQ;AACzE,aAAO,KAAK,MAAM,2BAA2B,KAAK,GAAG,CAAC;AAAA,IACxD;AACA,QAAI,IAAI,aAAa,4BAA4B,IAAI,WAAW,OAAO;AACrE,aAAO,KAAK,MAAM,uBAAuB,KAAK,GAAG,CAAC;AAAA,IACpD;AAGA,QAAI,IAAI,aAAa,sBAAsB,IAAI,WAAW,QAAQ;AAChE,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,aAAO,KAAK,MAAM,iBAAiB,KAAK,KAAK,IAAI,CAAC;AAAA,IACpD;AACA,QAAI,IAAI,aAAa,sBAAsB,IAAI,WAAW,OAAO;AAC/D,aAAO,KAAK,MAAM,iBAAiB,KAAK,GAAG,CAAC;AAAA,IAC9C;AACA,QAAI,IAAI,aAAa,yBAAyB,IAAI,WAAW,OAAO;AAClE,aAAO,KAAK,MAAM,oBAAoB,KAAK,GAAG,CAAC;AAAA,IACjD;AACA,QAAI,IAAI,aAAa,0BAA0B,IAAI,WAAW,QAAQ;AACpE,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,aAAO,KAAK,MAAM,mBAAmB,KAAK,KAAK,IAAI,CAAC;AAAA,IACtD;AACA,QAAI,IAAI,aAAa,0BAA0B,IAAI,WAAW,OAAO;AACnE,aAAO,KAAK,MAAM,qBAAqB,KAAK,GAAG,CAAC;AAAA,IAClD;AACA,QAAI,IAAI,aAAa,uBAAuB,IAAI,WAAW,QAAQ;AACjE,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,aAAO,KAAK,MAAM,kBAAkB,KAAK,KAAK,IAAI,CAAC;AAAA,IACrD;AAGA,QAAI,IAAI,aAAa,gCAAgC,IAAI,WAAW,OAAO;AACzE,aAAO,KAAK,MAAM,oBAAoB,KAAK,GAAG,CAAC;AAAA,IACjD;AACA,QAAI,IAAI,aAAa,8BAA8B,IAAI,WAAW,QAAQ;AACxE,YAAM,OAAO,MAAM,WAAW,KAAK,GAAG;AACtC,UAAI,CAAC,KAAM,QAAO,KAAK,aAAa,CAAC;AACrC,aAAO,KAAK,MAAM,wBAAwB,KAAK,KAAK,IAAI,CAAC;AAAA,IAC3D;AACA,QAAI,IAAI,aAAa,8BAA8B,IAAI,WAAW,OAAO;AACvE,aAAO,KAAK,MAAM,kBAAkB,KAAK,GAAG,CAAC;AAAA,IAC/C;AAKA,QAAI,IAAI,SAAS,WAAW,aAAa,GAAG;AAC1C,YAAM,UAAU,IAAI,SAAS,QAAQ,kBAAkB,EAAE;AACzD,YAAM,YAAY,IAAI,QAAQ,WAAW,KAAK,GAAG;AACjD,aAAO,eAAe,WAAW,UAAU,EAAE,OAAO,CAAC,EAAE,CAAC;AACxD,YAAM,OAAO,MAAM,eAAa,OAAO,WAAW,GAAG;AACrD,aAAO,KAAK,IAAI;AAAA,IAClB;AAGA,QAAI,IAAI,SAAS,WAAW,UAAU,GAAG;AAEvC,YAAM,UAAU,IAAI,SAAS,QAAQ,eAAe,EAAE;AAEtD,YAAM,SAAS,IAAI,QAAQ,WAAW,KAAK,GAAG;AAE9C,aAAO,eAAe,QAAQ,UAAU,EAAE,OAAO,CAAC,EAAE,CAAC;AAErD,YAAM,OAAO,MAAM,YAAU,OAAO,QAAQ,GAAG;AAC/C,aAAO,KAAK,IAAI;AAAA,IAClB;AAGA,QAAI,IAAI,aAAa,sBAAsB,QAAQ,WAAW,QAAQ;AACpE,aAAO,MAAM,iBAAiB,OAAO,SAAS,MAAM,OAAO,GAAG;AAAA,IAChE;AAEA,WAAO,IAAI,SAAS,aAAa,EAAE,QAAQ,IAAI,CAAC;AAAA,EAClD;AAAA;AAAA,EAGA,MAAM,UAAUC,QAAY,KAAU,KAAU;AAC9C,YAAQ,IAAI,4BAA4B;AACxC,UAAM,uBAAuB,KAAK,GAAG;AACrC,UAAM,yBAAyB,KAAK,GAAG;AAAA,EACzC;AACF;",
  "names": ["t", "r", "o", "e", "n", "raw", "nodeCrypto", "callback", "salt", "hash", "o", "r", "err", "h", "u", "hash", "_key", "isLE", "_32n", "t", "randomBytes", "window", "raw", "request", "match", "request", "request", "request", "raw", "p", "r", "request", "event", "h", "p", "r", "Node", "_Node", "p", "Node", "Hono", "Hono", "match", "match", "r", "f", "getKey", "hash", "req", "r", "request", "request", "request", "request", "BUSINESS_INFO", "f", "request", "rows", "index_default", "event"]
}
